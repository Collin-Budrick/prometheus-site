FROM node:20-alpine as base
WORKDIR /app
COPY package.json pnpm-workspace.yaml .npmrc* ./
COPY apps/web/package.json apps/web/
RUN corepack enable && pnpm install --filter web --ignore-scripts
COPY apps/web ./apps/web
RUN pnpm --filter web build

FROM node:20-alpine
WORKDIR /app
ENV WEB_PORT=4173
COPY --from=base /app/apps/web/dist ./dist
EXPOSE 4173
CMD ["pnpm", "--filter", "web", "preview", "--", "--host", "0.0.0.0", "--port", "4173"]
