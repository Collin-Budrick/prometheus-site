/*!
 * ONNX Runtime Web v1.24.0-dev.20251227-38355ba07c
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var Rr=Object.defineProperty;var Ji=Object.getOwnPropertyDescriptor;var Xi=Object.getOwnPropertyNames;var Zi=Object.prototype.hasOwnProperty;var kr=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(t,a)=>(typeof require<"u"?require:t)[a]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var R=(o,t)=>()=>(o&&(t=o(o=0)),t);var bt=(o,t)=>{for(var a in t)Rr(o,a,{get:t[a],enumerable:!0})},Qi=(o,t,a,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Xi(t))!Zi.call(o,i)&&i!==a&&Rr(o,i,{get:()=>t[i],enumerable:!(u=Ji(t,i))||u.enumerable});return o};var kt=o=>Qi(Rr({},"__esModule",{value:!0}),o);var Nt,He,qe,Ki,So,Nr=R(()=>{"use strict";Nt=new Map,He=[],qe=(o,t,a)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let u=Nt.get(o);if(u===void 0)Nt.set(o,{backend:t,priority:a});else{if(u.priority>a)return;if(u.priority===a&&u.backend!==t)throw new Error(`cannot register backend "${o}" using priority ${a}`)}if(a>=0){let i=He.indexOf(o);i!==-1&&He.splice(i,1);for(let c=0;c<He.length;c++)if(Nt.get(He[c]).priority<=a){He.splice(c,0,o);return}He.push(o)}return}throw new TypeError("not a valid backend")},Ki=async o=>{let t=Nt.get(o);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let a=!!t.initPromise;try{return a||(t.initPromise=t.backend.init(o)),await t.initPromise,t.initialized=!0,t.backend}catch(u){return a||(t.error=`${u}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},So=async o=>{let t=o.executionProviders||[],a=t.map(h=>typeof h=="string"?h:h.name),u=a.length===0?He:a,i,c=[],l=new Set;for(let h of u){let g=await Ki(h);typeof g=="string"?c.push({name:h,err:g}):(i||(i=g),i===g&&l.add(h))}if(!i)throw new Error(`no available backend found. ERR: ${c.map(h=>`[${h.name}] ${h.err}`).join(", ")}`);for(let{name:h,err:g}of c)a.includes(h)&&console.warn(`removing requested execution provider "${h}" from session options because it is not available: ${g}`);let d=t.filter(h=>l.has(typeof h=="string"?h:h.name));return[i,new Proxy(o,{get:(h,g)=>g==="executionProviders"?d:Reflect.get(h,g)})]}});var Ao=R(()=>{"use strict";Nr()});var Io,xo=R(()=>{"use strict";Io="1.24.0-dev.20251116-b39e144322"});var Oo,ee,Wr=R(()=>{"use strict";xo();Oo="warning",ee={wasm:{},webgl:{},webgpu:{},versions:{common:Io},set logLevel(o){if(o!==void 0){if(typeof o!="string"||["verbose","info","warning","error","fatal"].indexOf(o)===-1)throw new Error(`Unsupported logging level: ${o}`);Oo=o}},get logLevel(){return Oo}};Object.defineProperty(ee,"logLevel",{enumerable:!0})});var Z,Lo=R(()=>{"use strict";Wr();Z=ee});var Bo,Co,Mo=R(()=>{"use strict";Bo=(o,t)=>{let a=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);a.width=o.dims[3],a.height=o.dims[2];let u=a.getContext("2d");if(u!=null){let i,c;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(i=o.dims[2],c=o.dims[3]):(i=o.dims[3],c=o.dims[2]);let l=t?.format!==void 0?t.format:"RGB",d=t?.norm,h,g;d===void 0||d.mean===void 0?h=[255,255,255,255]:typeof d.mean=="number"?h=[d.mean,d.mean,d.mean,d.mean]:(h=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(h[3]=d.mean[3])),d===void 0||d.bias===void 0?g=[0,0,0,0]:typeof d.bias=="number"?g=[d.bias,d.bias,d.bias,d.bias]:(g=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(g[3]=d.bias[3]));let y=c*i,w=0,T=y,E=y*2,B=-1;l==="RGBA"?(w=0,T=y,E=y*2,B=y*3):l==="RGB"?(w=0,T=y,E=y*2):l==="RBG"&&(w=0,E=y,T=y*2);for(let P=0;P<c;P++)for(let V=0;V<i;V++){let M=(o.data[w++]-g[0])*h[0],O=(o.data[T++]-g[1])*h[1],U=(o.data[E++]-g[2])*h[2],D=B===-1?255:(o.data[B++]-g[3])*h[3];u.fillStyle="rgba("+M+","+O+","+U+","+D+")",u.fillRect(V,P,1,1)}if("toDataURL"in a)return a.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Co=(o,t)=>{let a=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),u;if(a!=null){let i,c,l;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(i=o.dims[2],c=o.dims[1],l=o.dims[3]):(i=o.dims[3],c=o.dims[2],l=o.dims[1]);let d=t!==void 0&&t.format!==void 0?t.format:"RGB",h=t?.norm,g,y;h===void 0||h.mean===void 0?g=[255,255,255,255]:typeof h.mean=="number"?g=[h.mean,h.mean,h.mean,h.mean]:(g=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(g[3]=h.mean[3])),h===void 0||h.bias===void 0?y=[0,0,0,0]:typeof h.bias=="number"?y=[h.bias,h.bias,h.bias,h.bias]:(y=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(y[3]=h.bias[3]));let w=c*i;if(t!==void 0&&(t.format!==void 0&&l===4&&t.format!=="RGBA"||l===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let T=4,E=0,B=1,P=2,V=3,M=0,O=w,U=w*2,D=-1;d==="RGBA"?(M=0,O=w,U=w*2,D=w*3):d==="RGB"?(M=0,O=w,U=w*2):d==="RBG"&&(M=0,U=w,O=w*2),u=a.createImageData(i,c);for(let $=0;$<c*i;E+=T,B+=T,P+=T,V+=T,$++)u.data[E]=(o.data[M++]-y[0])*g[0],u.data[B]=(o.data[O++]-y[1])*g[1],u.data[P]=(o.data[U++]-y[2])*g[2],u.data[V]=D===-1?255:(o.data[D++]-y[3])*g[3]}else throw new Error("Can not access image data");return u}});var Fr,Do,Po,Uo,Ro,ko,No=R(()=>{"use strict";Wt();Fr=(o,t)=>{if(o===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:a,width:u}=t,i=t.norm??{mean:255,bias:0},c,l;typeof i.mean=="number"?c=[i.mean,i.mean,i.mean,i.mean]:c=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?l=[i.bias,i.bias,i.bias,i.bias]:l=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let d=t.format!==void 0?t.format:"RGBA",h=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",g=a*u,y=h==="RGBA"?new Float32Array(g*4):new Float32Array(g*3),w=4,T=0,E=1,B=2,P=3,V=0,M=g,O=g*2,U=-1;d==="RGB"&&(w=3,T=0,E=1,B=2,P=-1),h==="RGBA"?U=g*3:h==="RBG"?(V=0,O=g,M=g*2):h==="BGR"&&(O=0,M=g,V=g*2);for(let $=0;$<g;$++,T+=w,B+=w,E+=w,P+=w)y[V++]=(o[T]+l[0])/c[0],y[M++]=(o[E]+l[1])/c[1],y[O++]=(o[B]+l[2])/c[2],U!==-1&&P!==-1&&(y[U++]=(o[P]+l[3])/c[3]);return h==="RGBA"?new oe("float32",y,[1,4,a,u]):new oe("float32",y,[1,3,a,u])},Do=async(o,t)=>{let a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=typeof ImageData<"u"&&o instanceof ImageData,i=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,c=typeof o=="string",l,d=t??{},h=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},g=y=>typeof HTMLCanvasElement<"u"&&y instanceof HTMLCanvasElement||y instanceof OffscreenCanvas?y.getContext("2d"):null;if(a){let y=h();y.width=o.width,y.height=o.height;let w=g(y);if(w!=null){let T=o.height,E=o.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(T=t.resizedHeight,E=t.resizedWidth),t!==void 0){if(d=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=T,d.width=E}else d.tensorFormat="RGBA",d.height=T,d.width=E;w.drawImage(o,0,0),l=w.getImageData(0,0,E,T).data}else throw new Error("Can not access image data")}else if(u){let y,w;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(y=t.resizedHeight,w=t.resizedWidth):(y=o.height,w=o.width),t!==void 0&&(d=t),d.format="RGBA",d.height=y,d.width=w,t!==void 0){let T=h();T.width=w,T.height=y;let E=g(T);if(E!=null)E.putImageData(o,0,0),l=E.getImageData(0,0,w,y).data;else throw new Error("Can not access image data")}else l=o.data}else if(i){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let y=h();y.width=o.width,y.height=o.height;let w=g(y);if(w!=null){let T=o.height,E=o.width;return w.drawImage(o,0,0,E,T),l=w.getImageData(0,0,E,T).data,d.height=T,d.width=E,Fr(l,d)}else throw new Error("Can not access image data")}else{if(c)return new Promise((y,w)=>{let T=h(),E=g(T);if(!o||!E)return w();let B=new Image;B.crossOrigin="Anonymous",B.src=o,B.onload=()=>{T.width=B.width,T.height=B.height,E.drawImage(B,0,0,T.width,T.height);let P=E.getImageData(0,0,T.width,T.height);d.height=T.height,d.width=T.width,y(Fr(P.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(l!==void 0)return Fr(l,d);throw new Error("Input data provided is not supported - aborted tensor creation")},Po=(o,t)=>{let{width:a,height:u,download:i,dispose:c}=t,l=[1,u,a,4];return new oe({location:"texture",type:"float32",texture:o,dims:l,download:i,dispose:c})},Uo=(o,t)=>{let{dataType:a,dims:u,download:i,dispose:c}=t;return new oe({location:"gpu-buffer",type:a??"float32",gpuBuffer:o,dims:u,download:i,dispose:c})},Ro=(o,t)=>{let{dataType:a,dims:u,download:i,dispose:c}=t;return new oe({location:"ml-tensor",type:a??"float32",mlTensor:o,dims:u,download:i,dispose:c})},ko=(o,t,a)=>new oe({location:"cpu-pinned",type:o,data:t,dims:a??[t.length]})});var Ye,Tt,Wo,Fo,Go=R(()=>{"use strict";Ye=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Tt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Wo=!1,Fo=()=>{if(!Wo){Wo=!0;let o=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,a=globalThis.Float16Array,u=typeof a<"u"&&a.from;o&&(Ye.set("int64",BigInt64Array),Tt.set(BigInt64Array,"int64")),t&&(Ye.set("uint64",BigUint64Array),Tt.set(BigUint64Array,"uint64")),u?(Ye.set("float16",a),Tt.set(a,"float16")):Ye.set("float16",Uint16Array)}}});var $o,zo,jo=R(()=>{"use strict";Wt();$o=o=>{let t=1;for(let a=0;a<o.length;a++){let u=o[a];if(typeof u!="number"||!Number.isSafeInteger(u))throw new TypeError(`dims[${a}] must be an integer, got: ${u}`);if(u<0)throw new RangeError(`dims[${a}] must be a non-negative integer, got: ${u}`);t*=u}return t},zo=(o,t)=>{switch(o.location){case"cpu":return new oe(o.type,o.data,t);case"cpu-pinned":return new oe({location:"cpu-pinned",data:o.data,type:o.type,dims:t});case"texture":return new oe({location:"texture",texture:o.texture,type:o.type,dims:t});case"gpu-buffer":return new oe({location:"gpu-buffer",gpuBuffer:o.gpuBuffer,type:o.type,dims:t});case"ml-tensor":return new oe({location:"ml-tensor",mlTensor:o.mlTensor,type:o.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${o.location} is not supported`)}}});var oe,Wt=R(()=>{"use strict";Mo();No();Go();jo();oe=class{constructor(t,a,u){Fo();let i,c;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,i=t.type,c=t.dims,t.location){case"cpu-pinned":{let d=Ye.get(i);if(!d)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(t.data instanceof d))throw new TypeError(`buffer should be of type ${d.name}`);this.cpuData=t.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let d,h;if(typeof t=="string")if(i=t,h=u,t==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");d=a}else{let g=Ye.get(t);if(g===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(a)){if(t==="float16"&&g===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${g.name} as data.`);t==="uint64"||t==="int64"?d=g.from(a,BigInt):d=g.from(a)}else if(a instanceof g)d=a;else if(a instanceof Uint8ClampedArray)if(t==="uint8")d=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&a instanceof Uint16Array&&g!==Uint16Array)d=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${i} tensor's data must be type of ${g}`)}else if(h=a,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let g=typeof t[0];if(g==="string")i="string",d=t;else if(g==="boolean")i="bool",d=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${g}.`)}else if(t instanceof Uint8ClampedArray)i="uint8",d=Uint8Array.from(t);else{let g=Tt.get(t.constructor);if(g===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);i=g,d=t}if(h===void 0)h=[d.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");c=h,this.cpuData=d,this.dataLocation="cpu"}let l=$o(c);if(this.cpuData&&l!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(l/2)===this.cpuData.length))throw new Error(`Tensor's size(${l}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=c,this.size=l}static async fromImage(t,a){return Do(t,a)}static fromTexture(t,a){return Po(t,a)}static fromGpuBuffer(t,a){return Uo(t,a)}static fromMLTensor(t,a){return Ro(t,a)}static fromPinnedBuffer(t,a,u){return ko(t,a,u)}toDataURL(t){return Bo(this,t)}toImageData(t){return Co(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,t&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return zo(this,t)}}});var Te,Gr=R(()=>{"use strict";Wt();Te=oe});var Vo,Ho,Je,Xe,Ue,Re,$r=R(()=>{"use strict";Wr();Vo=(o,t)=>{(typeof ee.trace>"u"?!ee.wasm.trace:!ee.trace)||console.timeStamp(`${o}::ORT::${t}`)},Ho=(o,t)=>{let a=new Error().stack?.split(/\r\n|\r|\n/g)||[],u=!1;for(let i=0;i<a.length;i++){if(u&&!a[i].includes("TRACE_FUNC")){let c=`FUNC_${o}::${a[i].trim().split(" ")[1]}`;t&&(c+=`::${t}`),Vo("CPU",c);return}a[i].includes("TRACE_FUNC")&&(u=!0)}},Je=o=>{(typeof ee.trace>"u"?!ee.wasm.trace:!ee.trace)||Ho("BEGIN",o)},Xe=o=>{(typeof ee.trace>"u"?!ee.wasm.trace:!ee.trace)||Ho("END",o)},Ue=o=>{(typeof ee.trace>"u"?!ee.wasm.trace:!ee.trace)||console.time(`ORT::${o}`)},Re=o=>{(typeof ee.trace>"u"?!ee.wasm.trace:!ee.trace)||console.timeEnd(`ORT::${o}`)}});var Ft,qo=R(()=>{"use strict";Nr();Gr();$r();Ft=class o{constructor(t){this.handler=t}async run(t,a,u){Je(),Ue("InferenceSession.run");let i={},c={};if(typeof t!="object"||t===null||t instanceof Te||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let l=!0;if(typeof a=="object"){if(a===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(a instanceof Te)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(a)){if(a.length===0)throw new TypeError("'fetches' cannot be an empty array.");l=!1;for(let g of a){if(typeof g!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(g)===-1)throw new RangeError(`'fetches' contains invalid output name: ${g}.`);i[g]=null}if(typeof u=="object"&&u!==null)c=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else{let g=!1,y=Object.getOwnPropertyNames(a);for(let w of this.outputNames)if(y.indexOf(w)!==-1){let T=a[w];(T===null||T instanceof Te)&&(g=!0,l=!1,i[w]=T)}if(g){if(typeof u=="object"&&u!==null)c=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else c=a}}else if(typeof a<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let g of this.inputNames)if(typeof t[g]>"u")throw new Error(`input '${g}' is missing in 'feeds'.`);if(l)for(let g of this.outputNames)i[g]=null;let d=await this.handler.run(t,i,c),h={};for(let g in d)if(Object.hasOwnProperty.call(d,g)){let y=d[g];y instanceof Te?h[g]=y:h[g]=new Te(y.type,y.data,y.dims)}return Re("InferenceSession.run"),Xe(),h}async release(){return this.handler.dispose()}static async create(t,a,u,i){Je(),Ue("InferenceSession.create");let c,l={};if(typeof t=="string"){if(c=t,typeof a=="object"&&a!==null)l=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(c=t,typeof a=="object"&&a!==null)l=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let y=t,w=0,T=t.byteLength;if(typeof a=="object"&&a!==null)l=a;else if(typeof a=="number"){if(w=a,!Number.isSafeInteger(w))throw new RangeError("'byteOffset' must be an integer.");if(w<0||w>=y.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${y.byteLength}).`);if(T=t.byteLength-w,typeof u=="number"){if(T=u,!Number.isSafeInteger(T))throw new RangeError("'byteLength' must be an integer.");if(T<=0||w+T>y.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${y.byteLength-w}].`);if(typeof i=="object"&&i!==null)l=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof u<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof a<"u")throw new TypeError("'options' must be an object.");c=new Uint8Array(y,w,T)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,h]=await So(l),g=await d.createInferenceSessionHandler(c,h);return Re("InferenceSession.create"),Xe(),new o(g)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var eu,Yo=R(()=>{"use strict";qo();eu=Ft});var Jo=R(()=>{"use strict"});var Xo=R(()=>{"use strict"});var Zo=R(()=>{"use strict"});var Qo=R(()=>{"use strict"});var zr={};bt(zr,{InferenceSession:()=>eu,TRACE:()=>Vo,TRACE_EVENT_BEGIN:()=>Ue,TRACE_EVENT_END:()=>Re,TRACE_FUNC_BEGIN:()=>Je,TRACE_FUNC_END:()=>Xe,Tensor:()=>Te,env:()=>Z,registerBackend:()=>qe});var ke=R(()=>{"use strict";Ao();Lo();Yo();Gr();Jo();Xo();$r();Zo();Qo()});var Gt=R(()=>{"use strict"});var ra={};bt(ra,{default:()=>tu});var ea,ta,tu,na=R(()=>{"use strict";jr();Ne();$t();ea="ort-wasm-proxy-worker",ta=globalThis.self?.name===ea;ta&&(self.onmessage=o=>{let{type:t,in:a}=o.data;try{switch(t){case"init-wasm":zt(a.wasm).then(()=>{jt(a).then(()=>{postMessage({type:t})},u=>{postMessage({type:t,err:u})})},u=>{postMessage({type:t,err:u})});break;case"init-ep":{let{epName:u,env:i}=a;Vt(i,u).then(()=>{postMessage({type:t})},c=>{postMessage({type:t,err:c})});break}case"copy-from":{let{buffer:u}=a,i=vt(u);postMessage({type:t,out:i});break}case"create":{let{model:u,options:i}=a;Ht(u,i).then(c=>{postMessage({type:t,out:c})},c=>{postMessage({type:t,err:c})});break}case"release":qt(a),postMessage({type:t});break;case"run":{let{sessionId:u,inputIndices:i,inputs:c,outputIndices:l,options:d}=a;Yt(u,i,c,l,new Array(l.length).fill(null),d).then(h=>{h.some(g=>g[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:h},Xt([...c,...h]))},h=>{postMessage({type:t,err:h})});break}case"end-profiling":Jt(a),postMessage({type:t});break;default:}}catch(u){postMessage({type:t,err:u})}});tu=ta?null:o=>new Worker(o??me,{type:"module",name:ea})});var aa={};bt(aa,{default:()=>ru});async function oa(o={}){var t=o,a=!!globalThis.window,u=!!globalThis.WorkerGlobalScope,i=u&&self.name?.startsWith("em-pthread");t.mountExternalData=(e,r)=>{e.startsWith("./")&&(e=e.substring(2)),(t.o||(t.o=new Map)).set(e,r)},t.unmountExternalData=()=>{delete t.o},globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,Z:!0}).buffer.constructor;var c,l,d=(e,r)=>{throw r},h=import.meta.url,g="";if(a||u){try{g=new URL(".",h).href}catch{}u&&(l=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),c=async e=>{if($(e))return new Promise((n,s)=>{var f=new XMLHttpRequest;f.open("GET",e,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?n(f.response):s(f.status)},f.onerror=s,f.send(null)});var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw Error(r.status+" : "+r.url)}}var y,w,T,E,B,P,V=console.log.bind(console),M=console.error.bind(console),O=V,U=M,D=!1,$=e=>e.startsWith("file://");function p(){Pe.buffer!=q.buffer&&J()}if(i){var re=!1;async function e(r){try{var n=r.data,s=n.i;if(s==="load"){let f=[];self.onmessage=m=>f.push(m),P=()=>{postMessage({i:"loaded"});for(let m of f)e(m);self.onmessage=e};for(let m of n.K)t[m]&&!t[m].proxy||(t[m]=(...v)=>{postMessage({i:"callHandler",J:m,args:v})},m=="print"&&(O=t[m]),m=="printErr"&&(U=t[m]));Pe=n.S,J(),w=n.T,Ge(),Rt()}else if(s==="run"){(function(f){var m=(p(),_)[f+52>>>2>>>0];f=(p(),_)[f+56>>>2>>>0],Eo(m,m-f),pe(m)})(n.h),Cr(n.h,0,0,1,0,0),un(),wr(n.h),re||(ro(),re=!0);try{await Ha(n.P,n.u)}catch(f){if(f!="unwind")throw f}}else n.target!=="setimmediate"&&(s==="checkMailbox"?re&&xt():s&&(U(`worker: received unknown command ${s}`),U(n)))}catch(f){throw go(),f}}self.onunhandledrejection=r=>{throw r.reason||r},self.onmessage=e}var q,z,se,Me,A,_,Fe,C,Y,nt,H,le=!1;function J(){var e=Pe.buffer;t.HEAP8=q=new Int8Array(e),se=new Int16Array(e),t.HEAPU8=z=new Uint8Array(e),Me=new Uint16Array(e),t.HEAP32=A=new Int32Array(e),t.HEAPU32=_=new Uint32Array(e),Fe=new Float32Array(e),C=new Float64Array(e),Y=new BigInt64Array(e),nt=new BigUint64Array(e)}function K(){le=!0,i?P():Ce.__wasm_call_ctors()}function ot(e){throw U(e="Aborted("+e+")"),D=!0,e+=". Build with -sASSERTIONS for more info.",le&&vo(),e=new WebAssembly.RuntimeError(e),B?.(e),e}function at(){if(!(wt={HaveOffsetConverter:qi,__pthread_create_js:hn,__syscall_fcntl64:gn,__syscall_fstat64:yn,__syscall_getcwd:wn,__syscall_getdents64:bn,__syscall_ioctl:Tn,__syscall_lstat64:vn,__syscall_mkdirat:En,__syscall_newfstatat:_n,__syscall_openat:Sn,__syscall_readlinkat:An,__syscall_rmdir:In,__syscall_stat64:xn,__syscall_unlinkat:On,_abort_js:qa,_embind_register_bigint:Ja,_embind_register_bool:Xa,_embind_register_emval:Qa,_embind_register_float:es,_embind_register_integer:ts,_embind_register_memory_view:rs,_embind_register_std_string:ns,_embind_register_std_wstring:cs,_embind_register_void:ls,_emscripten_init_main_thread_js:ps,_emscripten_notify_mailbox_postmessage:ms,_emscripten_receive_on_main_thread_js:hs,_emscripten_runtime_keepalive_clear:gs,_emscripten_thread_cleanup:ys,_emscripten_thread_mailbox_await:wr,_emscripten_thread_set_strongref:ws,_emval_await:Dn,_emval_create_invoker:Ss,_emval_decref:hr,_emval_equals:As,_emval_get_global:Is,_emval_get_module_property:xs,_emval_get_property:Os,_emval_incref:Ls,_emval_invoke:Pn,_emval_invoke_i64:Pn,_emval_new_array:Bs,_emval_new_array_from_memory_view:Cs,_emval_new_cstring:Ms,_emval_new_object:Ds,_emval_run_destructors:Ps,_emval_set_property:Us,_gmtime_js:Rs,_localtime_js:ks,_mktime_js:Ns,_mmap_js:Nn,_munmap_js:Wn,_setitimer_js:Fn,_tzset_js:Fs,clock_time_get:zs,emscripten_asm_const_int:js,emscripten_asm_const_ptr:Vs,emscripten_check_blocking_allowed:Hs,emscripten_date_now:Gs,emscripten_errn:qs,emscripten_exit_with_live_runtime:Ys,emscripten_get_heap_max:Js,emscripten_get_now:Ws,emscripten_has_asyncify:Xs,emscripten_num_logical_cores:Zs,emscripten_pc_get_function:Ct,emscripten_resize_heap:Ks,emscripten_stack_snapshot:Qs,emscripten_stack_unwind_buffer:ei,emwgpuAdapterRequestDevice:ii,emwgpuBufferDestroy:ui,emwgpuBufferGetConstMappedRange:fi,emwgpuBufferGetMappedRange:ci,emwgpuBufferMapAsync:li,emwgpuBufferUnmap:pi,emwgpuDelete:di,emwgpuDeviceCreateBuffer:mi,emwgpuDeviceCreateComputePipelineAsync:hi,emwgpuDeviceCreateShaderModule:gi,emwgpuDeviceDestroy:yi,emwgpuDevicePopErrorScope:wi,emwgpuInstanceRequestAdapter:bi,emwgpuWaitAny:qn,environ_get:Jn,environ_sizes_get:Xn,exit:lr,fd_close:Zn,fd_read:Qn,fd_seek:Kn,fd_write:eo,memory:Pe,proc_exit:$e,wgpuAdapterGetLimits:vi,wgpuAdapterHasFeature:Ei,wgpuBufferGetSize:_i,wgpuBufferGetUsage:Si,wgpuCommandEncoderBeginComputePass:Ai,wgpuCommandEncoderCopyBufferToBuffer:Ii,wgpuCommandEncoderFinish:xi,wgpuCommandEncoderResolveQuerySet:Oi,wgpuComputePassEncoderDispatchWorkgroups:Li,wgpuComputePassEncoderDispatchWorkgroupsIndirect:Bi,wgpuComputePassEncoderEnd:Ci,wgpuComputePassEncoderSetBindGroup:Mi,wgpuComputePassEncoderSetPipeline:Di,wgpuComputePassEncoderWriteTimestamp:Pi,wgpuComputePipelineGetBindGroupLayout:Ui,wgpuDeviceCreateBindGroup:Ri,wgpuDeviceCreateCommandEncoder:ki,wgpuDeviceCreateQuerySet:Ni,wgpuDeviceGetAdapterInfo:Wi,wgpuDeviceGetFeatures:Gi,wgpuDeviceGetLimits:$i,wgpuDevicePushErrorScope:zi,wgpuQueueSubmit:ji,wgpuQueueWriteBuffer:Vi}).I){wt.I=!0;var e=wt,r=/^(invoke_.*|__asyncjs__.*)$/;for(let[n,s]of Object.entries(e))typeof s=="function"&&(s.A||r.test(n))&&(e[n]=s=new WebAssembly.Suspending(s))}return{env:wt,wasi_snapshot_preview1:wt}}async function Ge(){function e(s,f){s=Ce=s.exports;var m=/^(OrtAppendExecutionProvider|OrtCreateSession|OrtRun|OrtRunWithBinding|OrtBindInput|main|__main_argc_argv)$/;br=new Set;var v={};for(let[b,S]of Object.entries(s))typeof S=="function"?(m.test(b)&&(br.add(S),S=WebAssembly.promising(S)),v[b]=bs(S)):v[b]=S;return Ce=v,Ce=function(){var b=Ce,S=k=>N=>k(N)>>>0,I=k=>()=>k()>>>0;return(b=Object.assign({},b)).__getTypeName=S(b.__getTypeName),b.pthread_self=I(b.pthread_self),b.malloc=S(b.malloc),b.memalign=(k=>(N,te)=>k(N,te)>>>0)(b.memalign),b._emscripten_stack_alloc=S(b._emscripten_stack_alloc),b.emscripten_stack_get_current=I(b.emscripten_stack_get_current),b}(),an.push(Ce._emscripten_tls_init),to=(s=Ce).__getTypeName,ro=s._embind_initialize_bindings,t._OrtInit=s.OrtInit,t._OrtGetLastError=s.OrtGetLastError,t._OrtCreateSessionOptions=s.OrtCreateSessionOptions,t._OrtAppendExecutionProvider=s.OrtAppendExecutionProvider,t._OrtAddFreeDimensionOverride=s.OrtAddFreeDimensionOverride,t._OrtAddSessionConfigEntry=s.OrtAddSessionConfigEntry,t._OrtReleaseSessionOptions=s.OrtReleaseSessionOptions,t._OrtCreateSession=s.OrtCreateSession,t._OrtReleaseSession=s.OrtReleaseSession,t._OrtGetInputOutputCount=s.OrtGetInputOutputCount,t._OrtGetInputOutputMetadata=s.OrtGetInputOutputMetadata,t._OrtFree=s.OrtFree,t._OrtCreateTensor=s.OrtCreateTensor,t._OrtGetTensorData=s.OrtGetTensorData,t._OrtReleaseTensor=s.OrtReleaseTensor,t._OrtCreateRunOptions=s.OrtCreateRunOptions,t._OrtAddRunConfigEntry=s.OrtAddRunConfigEntry,t._OrtReleaseRunOptions=s.OrtReleaseRunOptions,t._OrtCreateBinding=s.OrtCreateBinding,t._OrtBindInput=s.OrtBindInput,t._OrtBindOutput=s.OrtBindOutput,t._OrtClearBoundOutputs=s.OrtClearBoundOutputs,t._OrtReleaseBinding=s.OrtReleaseBinding,t._OrtRunWithBinding=s.OrtRunWithBinding,t._OrtRun=s.OrtRun,t._OrtEndProfiling=s.OrtEndProfiling,Ar=t._OrtGetWebGpuDevice=s.OrtGetWebGpuDevice,Pt=s.pthread_self,be=t._free=s.free,gt=t._malloc=s.malloc,no=t._wgpuBufferRelease=s.wgpuBufferRelease,oo=t._wgpuCreateInstance=s.wgpuCreateInstance,ao=s.emwgpuCreateBindGroup,so=s.emwgpuCreateBindGroupLayout,io=s.emwgpuCreateCommandBuffer,uo=s.emwgpuCreateCommandEncoder,fo=s.emwgpuCreateComputePassEncoder,co=s.emwgpuCreateQuerySet,lo=s.emwgpuCreateBuffer,po=s.emwgpuCreateDevice,mo=s.emwgpuCreateQueue,Ir=s.emwgpuOnCreateComputePipelineCompleted,xr=s.emwgpuOnDeviceLostCompleted,Or=s.emwgpuOnMapAsyncCompleted,Lr=s.emwgpuOnPopErrorScopeCompleted,yt=s.emwgpuOnRequestAdapterCompleted,Br=s.emwgpuOnRequestDeviceCompleted,ho=s.emwgpuOnUncapturedError,Cr=s._emscripten_thread_init,go=s._emscripten_thread_crashed,yo=s._emscripten_run_js_on_main_thread,wo=s._emscripten_thread_free_data,Mr=s._emscripten_thread_exit,bo=s._emscripten_timeout,To=s._emscripten_check_mailbox,Dr=s.memalign,vo=s.__trap,Eo=s.emscripten_stack_set_limits,pe=s._emscripten_stack_restore,Ut=s._emscripten_stack_alloc,de=s.emscripten_stack_get_current,_o=s.__indirect_function_table,w=f,Ce}var r,n=at();return t.instantiateWasm?new Promise(s=>{t.instantiateWasm(n,(f,m)=>{s(e(f,m))})}):i?e(new WebAssembly.Instance(w,at()),w):(H??=t.locateFile?t.locateFile?t.locateFile("ort-wasm-simd-threaded.jspi.wasm",g):g+"ort-wasm-simd-threaded.jspi.wasm":new URL("ort-wasm-simd-threaded.jspi.wasm",import.meta.url).href,r=await async function(s){var f=H;if(!y&&!$(f))try{var m=fetch(f,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(m,s)}catch(v){U(`wasm streaming compile failed: ${v}`),U("falling back to ArrayBuffer instantiation")}return async function(v,b){try{var S=await async function(I){if(!y)try{var k=await c(I);return new Uint8Array(k)}catch{}if(I==H&&y)I=new Uint8Array(y);else{if(!l)throw"both async and sync fetching of the wasm failed";I=l(I)}return I}(v);return await WebAssembly.instantiate(S,b)}catch(I){U(`failed to asynchronously prepare wasm: ${I}`),ot(I)}}(f,s)}(n),e(r.instance,r.module))}class st{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var It=e=>{e.terminate(),e.onmessage=()=>{}},ve=()=>{for(var e=ye;0<e.length;)e.shift()(t)},ye=[],Ee=0,Q=null,X=e=>{De.length==0&&(cn(),fn(De[0]));var r=De.pop();if(!r)return 6;mt.push(r),ze[e.h]=r,r.h=e.h;var n={i:"run",P:e.O,u:e.u,h:e.h};return r.postMessage(n,e.D),0},W=0,j=(e,r,...n)=>{for(var s=2*n.length,f=de(),m=Ut(8*s),v=m>>>3,b=0;b<n.length;b++){var S=n[b];typeof S=="bigint"?((p(),Y)[v+2*b>>>0]=1n,(p(),Y)[v+2*b+1>>>0]=S):((p(),Y)[v+2*b>>>0]=0n,(p(),C)[v+2*b+1>>>0]=S)}return e=yo(e,0,s,m,r),pe(f),e};function $e(e){if(i)return j(0,1,e);if(T=e,!(0<W)){for(var r of mt)It(r);for(r of De)It(r);De=[],mt=[],ze={},D=!0}d(0,new st(e))}function cr(e){if(i)return j(1,0,e);lr(e)}var lr=e=>{if(T=e,i)throw cr(e),"unwind";$e(e)},De=[],mt=[],an=[],ze={},sn=e=>{var r=e.h;delete ze[r],De.push(e),mt.splice(mt.indexOf(e),1),e.h=0,wo(r)};function un(){an.forEach(e=>e())}var fn=e=>new Promise(r=>{e.onmessage=f=>{var m=f.data;if(f=m.i,m.s&&m.s!=Pt()){var v=ze[m.s];v?v.postMessage(m,m.D):U(`Internal error! Worker sent a message "${f}" to target pthread ${m.s}, but that thread no longer exists!`)}else f==="checkMailbox"?xt():f==="spawnThread"?X(m):f==="cleanupThread"?yr(()=>{sn(ze[m.R])}):f==="loaded"?(e.loaded=!0,r(e)):m.target==="setimmediate"?e.postMessage(m):f==="uncaughtException"?e.onerror(m.error):f==="callHandler"?t[m.J](...m.args):f&&U(`worker sent an unknown command ${f}`)},e.onerror=f=>{throw U(`worker sent an error! ${f.filename}:${f.lineno}: ${f.message}`),f};var n,s=[];for(n of[])t.propertyIsEnumerable(n)&&s.push(n);e.postMessage({i:"load",K:s,S:Pe,T:w})});function cn(){var e=new Worker((()=>{let r=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new r("ort.jspi.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});De.push(e)}var Pe,pr=[],Ha=async(e,r)=>{W=0;var n=WebAssembly,s=n.promising,f=pr[e];f||(pr[e]=f=_o.get(e),br?.has(f)&&(pr[e]=f=WebAssembly.promising(f))),e=s.call(n,f)(r),e=await e,0<W?T=e:Mr(e)},ue=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e),ln=globalThis.TextDecoder&&new TextDecoder,pn=(e,r,n,s)=>{if(n=r+n,s)return n;for(;e[r]&&!(r>=n);)++r;return r},dn=(e,r=0,n,s)=>{if(16<(n=pn(e,r>>>=0,n,s))-r&&e.buffer&&ln)return ln.decode(e.buffer instanceof ArrayBuffer?e.subarray(r,n):e.slice(r,n));for(s="";r<n;){var f=e[r++];if(128&f){var m=63&e[r++];if((224&f)==192)s+=String.fromCharCode((31&f)<<6|m);else{var v=63&e[r++];65536>(f=(240&f)==224?(15&f)<<12|m<<6|v:(7&f)<<18|m<<12|v<<6|63&e[r++])?s+=String.fromCharCode(f):(f-=65536,s+=String.fromCharCode(55296|f>>10,56320|1023&f))}}else s+=String.fromCharCode(f)}return s},it=(e,r,n)=>(e>>>=0)?dn((p(),z),e,r,n):"";function mn(e,r,n,s){return i?j(2,1,e,r,n,s):hn(e,r,n,s)}function hn(e,r,n,s){if(e>>>=0,r>>>=0,n>>>=0,s>>>=0,!globalThis.SharedArrayBuffer)return 6;var f=[];return i&&f.length===0?mn(e,r,n,s):(e={O:n,h:e,u:s,D:f},i?(e.i="spawnThread",postMessage(e,f),0):X(e))}function gn(e,r,n){return i?j(3,1,e,r,n):0}function yn(e,r){if(i)return j(4,1,e,r)}function wn(e,r){if(i)return j(5,1,e,r)}function bn(e,r,n){if(i)return j(6,1,e,r,n)}function Tn(e,r,n){return i?j(7,1,e,r,n):0}function vn(e,r){if(i)return j(8,1,e,r)}function En(e,r,n){if(i)return j(9,1,e,r,n)}function _n(e,r,n,s){if(i)return j(10,1,e,r,n,s)}function Sn(e,r,n,s){if(i)return j(11,1,e,r,n,s)}function An(e,r,n,s){if(i)return j(12,1,e,r,n,s)}function In(e){if(i)return j(13,1,e)}function xn(e,r){if(i)return j(14,1,e,r)}function On(e,r,n){if(i)return j(15,1,e,r,n)}var qa=()=>ot(""),_e=e=>{e>>>=0;for(var r="";;){var n=(p(),z)[e++>>>0];if(!n)return r;r+=String.fromCharCode(n)}},dr={},mr={},Ya={},ut=class extends Error{constructor(e){super(e),this.name="BindingError"}};function xe(e,r,n={}){return function(s,f,m={}){var v=f.name;if(!s)throw new ut(`type "${v}" must have a positive integer typeid pointer`);if(mr.hasOwnProperty(s)){if(m.L)return;throw new ut(`Cannot register type '${v}' twice`)}mr[s]=f,delete Ya[s],dr.hasOwnProperty(s)&&(f=dr[s],delete dr[s],f.forEach(b=>b()))}(e,r,n)}var Ln=(e,r,n)=>{switch(r){case 1:return n?s=>(p(),q)[s>>>0]:s=>(p(),z)[s>>>0];case 2:return n?s=>(p(),se)[s>>>1>>>0]:s=>(p(),Me)[s>>>1>>>0];case 4:return n?s=>(p(),A)[s>>>2>>>0]:s=>(p(),_)[s>>>2>>>0];case 8:return n?s=>(p(),Y)[s>>>3>>>0]:s=>(p(),nt)[s>>>3>>>0];default:throw new TypeError(`invalid integer width (${r}): ${e}`)}};function Ja(e,r,n,s,f){e>>>=0,n>>>=0,r=_e(r>>>0);let m=v=>v;if(s=s===0n){let v=8*n;m=b=>BigInt.asUintN(v,b),f=m(f)}xe(e,{name:r,g:m,l:(v,b)=>(typeof b=="number"&&(b=BigInt(b)),b),j:Ln(r,n,!s),m:null})}function Xa(e,r,n,s){xe(e>>>=0,{name:r=_e(r>>>0),g:function(f){return!!f},l:function(f,m){return m?n:s},j:function(f){return this.g((p(),z)[f>>>0])},m:null})}var Bn=[],je=[0,1,,1,null,1,!0,1,!1,1];function hr(e){9<(e>>>=0)&&--je[e+1]==0&&(je[e]=void 0,Bn.push(e))}var he=e=>{if(!e)throw new ut(`Cannot use deleted val. handle = ${e}`);return je[e]},we=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let r=Bn.pop()||je.length;return je[r]=e,je[r+1]=1,r}};function gr(e){return this.g((p(),_)[e>>>2>>>0])}var Za={name:"emscripten::val",g:e=>{var r=he(e);return hr(e),r},l:(e,r)=>we(r),j:gr,m:null};function Qa(e){return xe(e>>>0,Za)}var Ka=(e,r)=>{switch(r){case 4:return function(n){return this.g((p(),Fe)[n>>>2>>>0])};case 8:return function(n){return this.g((p(),C)[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${r}): ${e}`)}};function es(e,r,n){n>>>=0,xe(e>>>=0,{name:r=_e(r>>>0),g:s=>s,l:(s,f)=>f,j:Ka(r,n),m:null})}function ts(e,r,n,s,f){e>>>=0,n>>>=0,r=_e(r>>>0);let m=b=>b;if(s===0){var v=32-8*n;m=b=>b<<v>>>v,f=m(f)}xe(e,{name:r,g:m,l:(b,S)=>S,j:Ln(r,n,s!==0),m:null})}function rs(e,r,n){function s(m){var v=(p(),_)[m>>>2>>>0];return m=(p(),_)[m+4>>>2>>>0],new f((p(),q).buffer,m,v)}var f=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][r];xe(e>>>=0,{name:n=_e(n>>>0),g:s,j:s},{L:!0})}var Oe=(e,r,n)=>{var s=(p(),z);if(r>>>=0,0<n){var f=r;n=r+n-1;for(var m=0;m<e.length;++m){var v=e.codePointAt(m);if(127>=v){if(r>=n)break;s[r++>>>0]=v}else if(2047>=v){if(r+1>=n)break;s[r++>>>0]=192|v>>6,s[r++>>>0]=128|63&v}else if(65535>=v){if(r+2>=n)break;s[r++>>>0]=224|v>>12,s[r++>>>0]=128|v>>6&63,s[r++>>>0]=128|63&v}else{if(r+3>=n)break;s[r++>>>0]=240|v>>18,s[r++>>>0]=128|v>>12&63,s[r++>>>0]=128|v>>6&63,s[r++>>>0]=128|63&v,m++}}s[r>>>0]=0,e=r-f}else e=0;return e},Le=e=>{for(var r=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);127>=s?r++:2047>=s?r+=2:55296<=s&&57343>=s?(r+=4,++n):r+=3}return r};function ns(e,r){xe(e>>>=0,{name:r=_e(r>>>0),g(n){var s=(p(),_)[n>>>2>>>0];return s=it(n+4,s,!0),be(n),s},l(n,s){s instanceof ArrayBuffer&&(s=new Uint8Array(s));var f=typeof s=="string";if(!(f||ArrayBuffer.isView(s)&&s.BYTES_PER_ELEMENT==1))throw new ut("Cannot pass non-string to std::string");var m=f?Le(s):s.length,v=gt(4+m+1),b=v+4;return(p(),_)[v>>>2>>>0]=m,f?Oe(s,b,m+1):(p(),z).set(s,b>>>0),n!==null&&n.push(be,v),v},j:gr,m(n){be(n)}})}var Cn=globalThis.TextDecoder?new TextDecoder("utf-16le"):void 0,os=(e,r,n)=>{if(e>>>=1,16<(r=pn((p(),Me),e,r/2,n))-e&&Cn)return Cn.decode((p(),Me).slice(e,r));for(n="";e<r;++e){var s=(p(),Me)[e>>>0];n+=String.fromCharCode(s)}return n},as=(e,r,n)=>{if(n??=2147483647,2>n)return 0;var s=r;n=(n-=2)<2*e.length?n/2:e.length;for(var f=0;f<n;++f){var m=e.charCodeAt(f);(p(),se)[r>>>1>>>0]=m,r+=2}return(p(),se)[r>>>1>>>0]=0,r-s},ss=e=>2*e.length,is=(e,r,n)=>{var s="";e>>>=2;for(var f=0;!(f>=r/4);f++){var m=(p(),_)[e+f>>>0];if(!m&&!n)break;s+=String.fromCodePoint(m)}return s},us=(e,r,n)=>{if(r>>>=0,n??=2147483647,4>n)return 0;var s=r;n=s+n-4;for(var f=0;f<e.length;++f){var m=e.codePointAt(f);if(65535<m&&f++,(p(),A)[r>>>2>>>0]=m,(r+=4)+4>n)break}return(p(),A)[r>>>2>>>0]=0,r-s},fs=e=>{for(var r=0,n=0;n<e.length;++n)65535<e.codePointAt(n)&&n++,r+=4;return r};function cs(e,r,n){if(e>>>=0,r>>>=0,n=_e(n>>>=0),r===2)var s=os,f=as,m=ss;else s=is,f=us,m=fs;xe(e,{name:n,g:v=>{var b=(p(),_)[v>>>2>>>0];return b=s(v+4,b*r,!0),be(v),b},l:(v,b)=>{if(typeof b!="string")throw new ut(`Cannot pass non-string to C++ string type ${n}`);var S=m(b),I=gt(4+S+r);return(p(),_)[I>>>2>>>0]=S/r,f(b,I+4,S+r),v!==null&&v.push(be,I),I},j:gr,m(v){be(v)}})}function ls(e,r){xe(e>>>=0,{M:!0,name:r=_e(r>>>0),g:()=>{},l:()=>{}})}function ps(e){Cr(e>>>0,!u,1,!a,131072,!1),un()}var yr=e=>{if(!D)try{if(e(),!(0<W))try{i?Pt()&&Mr(T):lr(T)}catch(r){r instanceof st||r=="unwind"||d(0,r)}}catch(r){r instanceof st||r=="unwind"||d(0,r)}},ds=!Atomics.waitAsync||globalThis.navigator?.userAgent&&91>Number((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)||[])[2]);function wr(e){e>>>=0,ds||(Atomics.waitAsync((p(),A),e>>>2,e).value.then(xt),e+=128,Atomics.store((p(),A),e>>>2,1))}var xt=()=>yr(()=>{var e=Pt();e&&(wr(e),To())});function ms(e,r){(e>>>=0)==r>>>0?setTimeout(xt):i?postMessage({s:e,i:"checkMailbox"}):(e=ze[e])&&e.postMessage({i:"checkMailbox"})}var Ot=[];function hs(e,r,n,s,f){for(r>>>=0,s/=2,Ot.length=s,n=f>>>0>>>3,f=0;f<s;f++)(p(),Y)[n+2*f>>>0]?Ot[f]=(p(),Y)[n+2*f+1>>>0]:Ot[f]=(p(),C)[n+2*f+1>>>0];return(r?Pr[r]:Hi[e])(...Ot)}var gs=()=>{W=0};function ys(e){e>>>=0,i?postMessage({i:"cleanupThread",R:e}):sn(ze[e])}function ws(e){}function bs(e){return(...r)=>e(...r)}var br=null,Mn=async e=>{W+=1;try{return await e()}finally{--W}};function Dn(e){return e>>>=0,Mn(async()=>{var r=await he(e);return we(r)})}Dn.A=!0;var Tr=[],Ts=e=>{var r=Tr.length;return Tr.push(e),r},vs=(e,r)=>{for(var n=Array(e),s=0;s<e;++s){var f=s,m=(p(),_)[r+4*s>>>2>>>0],v=mr[m];if(v===void 0)throw e=`parameter ${s}`,m=to(m),r=_e(m),be(m),new ut(`${e} has unknown type ${r}`);n[f]=v}return n},Es=(e,r,n)=>{var s=[];return e=e(s,n),s.length&&((p(),_)[r>>>2>>>0]=we(s)),e},_s={},Lt=e=>{var r=_s[e];return r===void 0?_e(e):r};function Ss(e,r,n){var[s,...f]=vs(e,r>>>0);r=s.l.bind(s);var m=f.map(S=>S.j.bind(S));e--;var v={toValue:he};switch(e=m.map((S,I)=>{var k=`argFromPtr${I}`;return v[k]=S,`${k}(args${I?"+"+8*I:""})`}),n){case 0:var b="toValue(handle)";break;case 2:b="new (toValue(handle))";break;case 3:b="";break;case 1:v.getStringOrSymbol=Lt,b="toValue(handle)[getStringOrSymbol(methodName)]"}return b+=`(${e})`,s.M||(v.toReturnWire=r,v.emval_returnValue=Es,b=`return emval_returnValue(toReturnWire, destructorsRef, ${b})`),b=`return function (handle, methodName, destructorsRef, args) {
  ${b}
  }`,n=new Function(Object.keys(v),b)(...Object.values(v)),b=`methodCaller<(${f.map(S=>S.name)}) => ${s.name}>`,Ts(Object.defineProperty(n,"name",{value:b}))}function As(e,r){return r>>>=0,(e=he(e>>>0))==he(r)}function Is(e){return(e>>>=0)?(e=Lt(e),we(globalThis[e])):we(globalThis)}function xs(e){return e=Lt(e>>>0),we(t[e])}function Os(e,r){return r>>>=0,e=he(e>>>0),r=he(r),we(e[r])}function Ls(e){9<(e>>>=0)&&(je[e+1]+=1)}function Pn(e,r,n,s,f){return Tr[e>>>0](r>>>0,n>>>0,s>>>0,f>>>0)}function Bs(){return we([])}function Cs(e){e=he(e>>>0);for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=e[n];return we(r)}function Ms(e){return we(Lt(e>>>0))}function Ds(){return we({})}function Ps(e){for(var r=he(e>>>=0);r.length;){var n=r.pop();r.pop()(n)}hr(e)}function Us(e,r,n){r>>>=0,n>>>=0,e=he(e>>>0),r=he(r),n=he(n),e[r]=n}function Rs(e,r){e=ue(e),r>>>=0,e=new Date(1e3*e),(p(),A)[r>>>2>>>0]=e.getUTCSeconds(),(p(),A)[r+4>>>2>>>0]=e.getUTCMinutes(),(p(),A)[r+8>>>2>>>0]=e.getUTCHours(),(p(),A)[r+12>>>2>>>0]=e.getUTCDate(),(p(),A)[r+16>>>2>>>0]=e.getUTCMonth(),(p(),A)[r+20>>>2>>>0]=e.getUTCFullYear()-1900,(p(),A)[r+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(p(),A)[r+28>>>2>>>0]=e}var Un=e=>e%4==0&&(e%100!=0||e%400==0),Rn=[0,31,60,91,121,152,182,213,244,274,305,335],kn=[0,31,59,90,120,151,181,212,243,273,304,334];function ks(e,r){e=ue(e),r>>>=0,e=new Date(1e3*e),(p(),A)[r>>>2>>>0]=e.getSeconds(),(p(),A)[r+4>>>2>>>0]=e.getMinutes(),(p(),A)[r+8>>>2>>>0]=e.getHours(),(p(),A)[r+12>>>2>>>0]=e.getDate(),(p(),A)[r+16>>>2>>>0]=e.getMonth(),(p(),A)[r+20>>>2>>>0]=e.getFullYear()-1900,(p(),A)[r+24>>>2>>>0]=e.getDay();var n=(Un(e.getFullYear())?Rn:kn)[e.getMonth()]+e.getDate()-1|0;(p(),A)[r+28>>>2>>>0]=n,(p(),A)[r+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var s=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=s&&e.getTimezoneOffset()==Math.min(s,n)),(p(),A)[r+32>>>2>>>0]=e}function Ns(e){e>>>=0;var r=new Date((p(),A)[e+20>>>2>>>0]+1900,(p(),A)[e+16>>>2>>>0],(p(),A)[e+12>>>2>>>0],(p(),A)[e+8>>>2>>>0],(p(),A)[e+4>>>2>>>0],(p(),A)[e>>>2>>>0],0),n=(p(),A)[e+32>>>2>>>0],s=r.getTimezoneOffset(),f=new Date(r.getFullYear(),6,1).getTimezoneOffset(),m=new Date(r.getFullYear(),0,1).getTimezoneOffset(),v=Math.min(m,f);return 0>n?(p(),A)[e+32>>>2>>>0]=+(f!=m&&v==s):0<n!=(v==s)&&(f=Math.max(m,f),r.setTime(r.getTime()+6e4*((0<n?v:f)-s))),(p(),A)[e+24>>>2>>>0]=r.getDay(),n=(Un(r.getFullYear())?Rn:kn)[r.getMonth()]+r.getDate()-1|0,(p(),A)[e+28>>>2>>>0]=n,(p(),A)[e>>>2>>>0]=r.getSeconds(),(p(),A)[e+4>>>2>>>0]=r.getMinutes(),(p(),A)[e+8>>>2>>>0]=r.getHours(),(p(),A)[e+12>>>2>>>0]=r.getDate(),(p(),A)[e+16>>>2>>>0]=r.getMonth(),(p(),A)[e+20>>>2>>>0]=r.getYear(),e=r.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Nn(e,r,n,s,f,m,v){return i?j(16,1,e,r,n,s,f,m,v):-52}function Wn(e,r,n,s,f,m){if(i)return j(17,1,e,r,n,s,f,m)}var ht={},Ws=()=>performance.timeOrigin+performance.now();function Fn(e,r){if(i)return j(18,1,e,r);if(ht[e]&&(clearTimeout(ht[e].id),delete ht[e]),!r)return 0;var n=setTimeout(()=>{delete ht[e],yr(()=>bo(e,performance.timeOrigin+performance.now()))},r);return ht[e]={id:n,$:r},0}function Fs(e,r,n,s){e>>>=0,r>>>=0,n>>>=0,s>>>=0;var f=new Date().getFullYear(),m=new Date(f,0,1).getTimezoneOffset();f=new Date(f,6,1).getTimezoneOffset();var v=Math.max(m,f);(p(),_)[e>>>2>>>0]=60*v,(p(),A)[r>>>2>>>0]=+(m!=f),e=(r=b=>{var S=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(S/60)).padStart(2,"0")}${String(S%60).padStart(2,"0")}`})(m),r=r(f),f<m?(Oe(e,n,17),Oe(r,s,17)):(Oe(e,s,17),Oe(r,n,17))}var Gs=()=>Date.now(),$s=1;function zs(e,r,n){if(n>>>=0,!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!$s)return 52;e=performance.timeOrigin+performance.now()}return e=Math.round(1e6*e),(p(),Y)[n>>>3>>>0]=BigInt(e),0}var vr=[],Gn=(e,r)=>{vr.length=0;for(var n;n=(p(),z)[e++>>>0];){var s=n!=105;r+=(s&=n!=112)&&r%8?4:0,vr.push(n==112?(p(),_)[r>>>2>>>0]:n==106?(p(),Y)[r>>>3>>>0]:n==105?(p(),A)[r>>>2>>>0]:(p(),C)[r>>>3>>>0]),r+=s?8:4}return vr};function js(e,r,n){return e>>>=0,r=Gn(r>>>0,n>>>0),Pr[e](...r)}function Vs(e,r,n){return e>>>=0,r=Gn(r>>>0,n>>>0),Pr[e](...r)}var Hs=()=>{};function qs(e,r){return U(it(e>>>0,r>>>0))}var Ys=()=>{throw W+=1,"unwind"};function Js(){return 4294901760}var Xs=()=>2,Zs=()=>navigator.hardwareConcurrency,Ve={},$n=e=>{var r=Le(e)+1,n=gt(r);return n&&Oe(e,n,r),n},Bt=e=>{var r;return(r=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(e))?+r[1]:(r=/:(\d+):\d+(?:\)|$)/.exec(e))?2147483648|+r[1]:0},zn=e=>{for(var r of e)(e=Bt(r))&&(Ve[e]=r)};function Qs(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),zn(e),Ve.B=Bt(e[3]),Ve.N=e,Ve.B}function Ct(e){if(!(e=Ve[e>>>0]))return 0;var r;if(r=/^\s+at .*\.wasm\.(.*) \(.*\)$/.exec(e))e=r[1];else if(r=/^\s+at (.*) \(.*\)$/.exec(e))e=r[1];else{if(!(r=/^(.+?)@/.exec(e)))return 0;e=r[1]}return be(Ct.C??0),Ct.C=$n(e),Ct.C}function Ks(e){e>>>=0;var r=(p(),z).length;if(e<=r||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var s=r*(1+.2/n);s=Math.min(s,e+100663296);e:{s=(Math.min(4294901760,65536*Math.ceil(Math.max(e,s)/65536))-Pe.buffer.byteLength+65535)/65536|0;try{Pe.grow(s),J();var f=1;break e}catch{}f=void 0}if(f)return!0}return!1}function ei(e,r,n){if(e>>>=0,r>>>=0,Ve.B==e)var s=Ve.N;else(s=Error().stack.toString().split(`
`))[0]=="Error"&&s.shift(),zn(s);for(var f=3;s[f]&&Bt(s[f])!=e;)++f;for(e=0;e<n&&s[e+f];++e)(p(),A)[r+4*e>>>2>>>0]=Bt(s[e+f]);return e}var Se=e=>{var r=Le(e)+1,n=Ut(r);return Oe(e,n,r),n},Er=[],fe=(e,r)=>{Er[e>>>=0]=r},Ae=[],Mt=[],ft=(e,r)=>{Mt[e]=new Promise(n=>r.finally(()=>n(e)))},x=e=>{if(e)return Er[e>>>0]},Dt=(e,r,n)=>{(p(),_)[e>>>2>>>0]=r,(p(),_)[e+4>>>2>>>0]=n},jn=e=>{var r=(p(),_)[e>>>2>>>0];return e=(p(),_)[e+4>>>2>>>0],it(r,e)},Be=e=>{var r=(p(),_)[e>>>2>>>0];return e=(p(),_)[e+4>>>2>>>0],r?it(r,e):e===0?"":void 0},ti=e=>{var r=Be(e+4),n=(n=(p(),_)[e+12>>>2>>>0])?x(n):"auto";if(e+=16){var s=x((p(),_)[e+4>>>2>>>0]),f=(p(),_)[e+16>>>2>>>0],m=(p(),_)[e+20>>>2>>>0];if(f){for(var v={},b=0;b<f;++b){var S=m+24*b;v[jn(S+4)]=(p(),C)[S+16>>>3>>>0]}f=v}else f=void 0;e={module:s,constants:f,entryPoint:Be(e+8)}}else e=void 0;return{label:r,layout:n,compute:e}},Vn=(e,r)=>{function n(f,m){f=e[f],(p(),A)[r+m>>>2>>>0]=f}function s(f,m){f=e[f],(p(),Y)[r+m>>>3>>>0]=BigInt(f)}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),s("maxUniformBufferBindingSize",64),s("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),s("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.Y!==void 0&&n("maxImmediateSize",148)},ri=[,"validation","out-of-memory","internal"],ni=[,"compatibility","core"],Hn={1:"core-features-and-limits",2:"depth-clip-control",3:"depth32float-stencil8",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"timestamp-query",10:"indirect-first-instance",11:"shader-f16",12:"rg11b10ufloat-renderable",13:"bgra8unorm-storage",14:"float32-filterable",15:"float32-blendable",16:"clip-distances",17:"dual-source-blending",18:"subgroups",19:"texture-formats-tier1",20:"texture-formats-tier2",21:"primitive-index",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},oi=[,"low-power","high-performance"],ai=[,"occlusion","timestamp"],si={undefined:1,unknown:1,destroyed:2};function ii(e,r,n,s,f,m){r=ue(r),n=ue(n),s>>>=0,f>>>=0,m>>>=0;var v=x(e>>>0);if(e={},m){var b=(p(),_)[m+12>>>2>>>0];if(b){var S=(p(),_)[m+16>>>2>>>0];e.requiredFeatures=Array.from((p(),_).subarray(S>>>2>>>0,S+4*b>>>2>>>0),L=>Hn[L])}var I=(p(),_)[m+20>>>2>>>0];if(I){let L=function(Ie,ne,Ur=!1){ne=I+ne,(ne=(p(),_)[ne>>>2>>>0])==4294967295||Ur&&ne==0||(k[Ie]=ne)},ie=function(Ie,ne){ne=I+ne;var Ur=(p(),_)[ne>>>2>>>0],Yi=(p(),_)[ne+4>>>2>>>0];Ur==4294967295&&Yi==4294967295||(k[Ie]=4294967296*(p(),_)[ne+4>>>2>>>0]+(p(),_)[ne>>>2>>>0])};var N=L,te=ie,k={};L("maxTextureDimension1D",4),L("maxTextureDimension2D",8),L("maxTextureDimension3D",12),L("maxTextureArrayLayers",16),L("maxBindGroups",20),L("maxBindGroupsPlusVertexBuffers",24),L("maxDynamicUniformBuffersPerPipelineLayout",32),L("maxDynamicStorageBuffersPerPipelineLayout",36),L("maxSampledTexturesPerShaderStage",40),L("maxSamplersPerShaderStage",44),L("maxStorageBuffersPerShaderStage",48),L("maxStorageTexturesPerShaderStage",52),L("maxUniformBuffersPerShaderStage",56),L("minUniformBufferOffsetAlignment",80),L("minStorageBufferOffsetAlignment",84),ie("maxUniformBufferBindingSize",64),ie("maxStorageBufferBindingSize",72),L("maxVertexBuffers",88),ie("maxBufferSize",96),L("maxVertexAttributes",104),L("maxVertexBufferArrayStride",108),L("maxInterStageShaderVariables",112),L("maxColorAttachments",116),L("maxColorAttachmentBytesPerSample",120),L("maxComputeWorkgroupStorageSize",124),L("maxComputeInvocationsPerWorkgroup",128),L("maxComputeWorkgroupSizeX",132),L("maxComputeWorkgroupSizeY",136),L("maxComputeWorkgroupSizeZ",140),L("maxComputeWorkgroupsPerDimension",144),L("maxImmediateSize",148,!0),e.requiredLimits=k}(b=(p(),_)[m+24>>>2>>>0])&&(b={label:Be(b+4)},e.defaultQueue=b),e.label=Be(m+4)}W+=1,ft(r,v.requestDevice(e).then(L=>{--W,fe(f,L.queue),fe(s,L),n&&(W+=1,ft(n,L.lost.then(ie=>{--W,L.onuncapturederror=()=>{};var Ie=de(),ne=Se(ie.message);xr(n,si[ie.reason],ne),pe(Ie)}))),L.onuncapturederror=ie=>{var Ie=5;ie.error instanceof GPUValidationError?Ie=2:ie.error instanceof GPUOutOfMemoryError?Ie=3:ie.error instanceof GPUInternalError&&(Ie=4);var ne=de();ie=Se(ie.error.message),ho(s,Ie,ie),pe(ne)},"adapterInfo"in L||(L.adapterInfo=v.info),Br(r,1,s,0)},L=>{--W;var ie=de();L=Se(L.message),Br(r,3,s,L),n&&xr(n,4,L),pe(ie)}))}function ui(e){var r=x(e>>>=0),n=Ae[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Ae[e]}r.destroy()}var ct=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";ct.v||(ct.v={}),ct.v[e]||(ct.v[e]=1,U(e))};function fi(e,r,n){r>>>=0,n>>>=0;var s=x(e>>>=0);n===0&&ct(),n==4294967295&&(n=void 0);try{var f=s.getMappedRange(r,n)}catch{return 0}var m=Dr(16,f.byteLength);return(p(),z).set(new Uint8Array(f),m>>>0),Ae[e].push(()=>be(m)),m}function ci(e,r,n){r>>>=0,n>>>=0;var s=x(e>>>=0);n===0&&ct(),n==4294967295&&(n=void 0);try{var f=s.getMappedRange(r,n)}catch{return 0}var m=Dr(16,f.byteLength);return(p(),z).fill(0,m,f.byteLength),Ae[e].push(()=>{new Uint8Array(f).set((p(),z).subarray(m>>>0,m+f.byteLength>>>0)),be(m)}),m}function li(e,r,n,s,f){e>>>=0,r=ue(r),n=ue(n),f>>>=0;var m=x(e);Ae[e]=[],f==4294967295&&(f=void 0),W+=1,ft(r,m.mapAsync(n,s>>>0,f).then(()=>{--W,Or(r,1,0)},v=>{--W,de();var b=Se(v.message);Or(r,v.name==="AbortError"?4:v.name==="OperationError"?3:0,b),delete Ae[e]}))}function pi(e){var r=x(e>>>=0),n=Ae[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Ae[e],r.unmap()}}function di(e){delete Er[e>>>0]}function mi(e,r,n){e>>>=0,r>>>=0,n>>>=0;var s=!!(p(),_)[r+32>>>2>>>0];r={label:Be(r+4),usage:(p(),_)[r+16>>>2>>>0],size:4294967296*(p(),_)[r+28>>>2>>>0]+(p(),_)[r+24>>>2>>>0],mappedAtCreation:s},e=x(e);try{var f=e.createBuffer(r)}catch{return!1}return fe(n,f),s&&(Ae[n]=[]),!0}function hi(e,r,n,s){e>>>=0,r=ue(r),s>>>=0,n=ti(n>>>0),e=x(e),W+=1,ft(r,e.createComputePipelineAsync(n).then(f=>{--W,fe(s,f),Ir(r,1,s,0)},f=>{--W;var m=de(),v=Se(f.message);Ir(r,f.reason==="validation"?3:f.reason==="internal"?4:0,s,v),pe(m)}))}function gi(e,r,n){e>>>=0,r>>>=0,n>>>=0;var s=(p(),_)[r>>>2>>>0],f=(p(),_)[s+4>>>2>>>0];r={label:Be(r+4),code:""},f===2&&(r.code=jn(s+8)),fe(n,x(e).createShaderModule(r))}var yi=e=>{(e=x(e)).onuncapturederror=null,e.destroy()};function wi(e,r){r=ue(r),e=x(e>>>0),W+=1,ft(r,e.popErrorScope().then(n=>{--W;var s=5;n?n instanceof GPUValidationError?s=2:n instanceof GPUOutOfMemoryError?s=3:n instanceof GPUInternalError&&(s=4):s=1;var f=de();n=n?Se(n.message):0,Lr(r,1,s,n),pe(f)},n=>{--W;var s=de();n=Se(n.message),Lr(r,1,5,n),pe(s)}))}function bi(e,r,n,s){if(r=ue(r),s>>>=0,n>>>=0){var f=(p(),_)[n+4>>>2>>>0];f={featureLevel:ni[f],powerPreference:oi[(p(),_)[n+8>>>2>>>0]],forceFallbackAdapter:!!(p(),_)[n+12>>>2>>>0]},(n=(p(),_)[n>>>2>>>0])!==0&&(p(),f.ba=!!(p(),_)[n+8>>>2>>>0])}"gpu"in navigator?(W+=1,ft(r,navigator.gpu.requestAdapter(f).then(m=>{if(--W,m)fe(s,m),yt(r,1,s,0);else{m=de();var v=Se("WebGPU not available on this browser (requestAdapter returned null)");yt(r,3,s,v),pe(m)}},m=>{--W;var v=de();m=Se(m.message),yt(r,4,s,m),pe(v)}))):(n=de(),f=Se("WebGPU not available on this browser (navigator.gpu is not available)"),yt(r,3,s,f),pe(n))}function qn(e,r,n){return e>>>=0,r>>>=0,n>>>=0,Mn(async()=>{var s=[];if(n){var f=(p(),A)[n>>>2>>>0];s.length=r+1,s[r]=new Promise(b=>setTimeout(b,f,0))}else s.length=r;for(var m=0;m<r;++m){var v=4294967296*(p(),_)[e+8*m+4>>>2>>>0]+(p(),_)[e+8*m>>>2>>>0];if(!(v in Mt))return v;s[m]=Mt[v]}return s=await Promise.race(s),delete Mt[s],s})}qn.A=!0;var _r,Sr={},Yn=()=>{if(!_r){var e,r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Sr)Sr[e]===void 0?delete r[e]:r[e]=Sr[e];var n=[];for(e in r)n.push(`${e}=${r[e]}`);_r=n}return _r};function Jn(e,r){if(i)return j(19,1,e,r);e>>>=0,r>>>=0;var n,s=0,f=0;for(n of Yn()){var m=r+s;(p(),_)[e+f>>>2>>>0]=m,s+=Oe(n,m,1/0)+1,f+=4}return 0}function Xn(e,r){if(i)return j(20,1,e,r);e>>>=0,r>>>=0;var n=Yn();for(var s of((p(),_)[e>>>2>>>0]=n.length,e=0,n))e+=Le(s)+1;return(p(),_)[r>>>2>>>0]=e,0}function Zn(e){return i?j(21,1,e):52}function Qn(e,r,n,s){return i?j(22,1,e,r,n,s):52}function Kn(e,r,n,s){return i?j(23,1,e,r,n,s):70}var Ti=[null,[],[]];function eo(e,r,n,s){if(i)return j(24,1,e,r,n,s);r>>>=0,n>>>=0,s>>>=0;for(var f=0,m=0;m<n;m++){var v=(p(),_)[r>>>2>>>0],b=(p(),_)[r+4>>>2>>>0];r+=8;for(var S=0;S<b;S++){var I=e,k=(p(),z)[v+S>>>0],N=Ti[I];k===0||k===10?((I===1?O:U)(dn(N)),N.length=0):N.push(k)}f+=b}return(p(),_)[s>>>2>>>0]=f,0}function vi(e,r){return Vn(x(e>>>0).limits,r>>>0),1}function Ei(e,r){return x(e>>>0).features.has(Hn[r])}function _i(e){return BigInt(x(e>>>0).size)}function Si(e){return BigInt(x(e>>>0).usage)}function Ai(e,r){if(e>>>=0,r>>>=0){var n=Be(r+4);n={label:n,timestampWrites:r=(r=(p(),_)[r+12>>>2>>>0])!==0?{querySet:x((p(),_)[r+4>>>2>>>0]),beginningOfPassWriteIndex:(p(),_)[r+8>>>2>>>0],endOfPassWriteIndex:(p(),_)[r+12>>>2>>>0]}:void 0}}return e=x(e),r=fo(0),fe(r,e.beginComputePass(n)),r}function Ii(e,r,n,s,f,m){n=ue(n),f=ue(f),m=ue(m),x(e>>>0).copyBufferToBuffer(x(r>>>0),n,x(s>>>0),f,m)}function xi(e){e=x(e>>>0);var r=io(0);return fe(r,e.finish()),r}function Oi(e,r,n,s,f,m){m=ue(m),x(e>>>0).resolveQuerySet(x(r>>>0),n,s,x(f>>>0),m)}function Li(e,r,n,s){x(e>>>0).dispatchWorkgroups(r,n,s)}function Bi(e,r,n){n=ue(n),x(e>>>0).dispatchWorkgroupsIndirect(x(r>>>0),n)}function Ci(e){x(e>>>0).end()}function Mi(e,r,n,s,f){s>>>=0,f>>>=0,e=x(e>>>0),n=x(n>>>0),s==0?e.setBindGroup(r,n):e.setBindGroup(r,n,(p(),_),f>>>2,s)}function Di(e,r){x(e>>>0).setPipeline(x(r>>>0))}function Pi(e,r,n){x(e>>>0).aa(x(r>>>0),n)}function Ui(e,r){e=x(e>>>0);var n=so(0);return fe(n,e.getBindGroupLayout(r)),n}function Ri(e,r){e>>>=0;var n=Be(4+(r>>>=0)),s=x((p(),_)[r+12>>>2>>>0]),f=(p(),_)[r+16>>>2>>>0];r=(p(),_)[r+20>>>2>>>0];for(var m=[],v=0;v<f;++v){var b=m,S=b.push,I=r+40*v,k=(p(),_)[I+8>>>2>>>0],N=(p(),_)[I+32>>>2>>>0],te=(p(),_)[I+36>>>2>>>0],L=(p(),_)[I+4>>>2>>>0];k?(N=I+24,(N=(p(),_)[N>>>2>>>0]+4294967296*(p(),A)[N+4>>>2>>>0])==-1&&(N=void 0),I={binding:L,resource:{buffer:x(k),offset:4294967296*(p(),_)[I+4+16>>>2>>>0]+(p(),_)[I+16>>>2>>>0],size:N}}):I=N?{binding:L,resource:x(N)}:{binding:L,resource:x(te)},S.call(b,I)}return n={label:n,layout:s,entries:m},e=x(e),s=ao(0),fe(s,e.createBindGroup(n)),s}function ki(e,r){var n;return e>>>=0,(r>>>=0)&&(n={label:Be(r+4)}),e=x(e),r=uo(0),fe(r,e.createCommandEncoder(n)),r}function Ni(e,r){e>>>=0,r>>>=0,r={type:ai[(p(),_)[r+12>>>2>>>0]],count:(p(),_)[r+16>>>2>>>0]},e=x(e);var n=co(0);return fe(n,e.createQuerySet(r)),n}function Wi(e,r){e=x(e>>>0).adapterInfo,r>>>=0,(p(),A)[r+52>>>2>>>0]=e.subgroupMinSize,(p(),A)[r+56>>>2>>>0]=e.subgroupMaxSize;var n=$n(e.vendor+e.architecture+e.device+e.description),s=Le(e.vendor);return Dt(r+4,n,s),n+=s,s=Le(e.architecture),Dt(r+12,n,s),n+=s,s=Le(e.device),Dt(r+20,n,s),Dt(r+28,n+s,Le(e.description)),(p(),A)[r+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,(p(),A)[r+40>>>2>>>0]=e,(p(),A)[r+44>>>2>>>0]=0,(p(),A)[r+48>>>2>>>0]=0,1}var Fi={"core-features-and-limits":1,"depth-clip-control":2,"depth32float-stencil8":3,"texture-compression-bc":4,"texture-compression-bc-sliced-3d":5,"texture-compression-etc2":6,"texture-compression-astc":7,"texture-compression-astc-sliced-3d":8,"timestamp-query":9,"indirect-first-instance":10,"shader-f16":11,"rg11b10ufloat-renderable":12,"bgra8unorm-storage":13,"float32-filterable":14,"float32-blendable":15,"clip-distances":16,"dual-source-blending":17,subgroups:18,"texture-formats-tier1":19,"texture-formats-tier2":20,"primitive-index":21,"chromium-experimental-unorm16-texture-formats":327692,"chromium-experimental-snorm16-texture-formats":327693,"chromium-experimental-multi-draw-indirect":327732};function Gi(e,r){r>>>=0,e=x(e>>>0);var n=gt(4*e.features.size),s=0,f=0;e.features.forEach(m=>{0<=(m=Fi[m])&&((p(),A)[n+s>>>2>>>0]=m,s+=4,f++)}),(p(),_)[r+4>>>2>>>0]=n,(p(),_)[r>>>2>>>0]=f}function $i(e,r){return Vn(x(e>>>0).limits,r>>>0),1}function zi(e,r){x(e>>>0).pushErrorScope(ri[r])}function ji(e,r,n){r>>>=0,n>>>=0,e=x(e>>>0),r=Array.from((p(),A).subarray(n>>>2>>>0,n+4*r>>>2>>>0),s=>x(s)),e.submit(r)}function Vi(e,r,n,s,f){n=ue(n),s>>>=0,f>>>=0,e=x(e>>>0),r=x(r>>>0),s=(p(),z).subarray(s>>>0,s+f>>>0),e.writeBuffer(r,n,s,0,f)}i||function(){for(var e=t.numThreads-1;e--;)cn();ye.push(async()=>{var r=async function(){if(!i)return Promise.all(De.map(fn))}();Ee++,await r,--Ee==0&&Q&&(r=Q,Q=null,r())})}(),i||(Pe=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),J()),t.wasmBinary&&(y=t.wasmBinary),t.stackSave=()=>de(),t.stackRestore=e=>pe(e),t.stackAlloc=e=>Ut(e),t.setValue=function(e,r,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":(p(),q)[e>>>0]=r;break;case"i16":(p(),se)[e>>>1>>>0]=r;break;case"i32":(p(),A)[e>>>2>>>0]=r;break;case"i64":(p(),Y)[e>>>3>>>0]=BigInt(r);break;case"float":(p(),Fe)[e>>>2>>>0]=r;break;case"double":(p(),C)[e>>>3>>>0]=r;break;case"*":(p(),_)[e>>>2>>>0]=r;break;default:ot(`invalid type for setValue: ${n}`)}},t.getValue=function(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":return(p(),q)[e>>>0];case"i16":return(p(),se)[e>>>1>>>0];case"i32":return(p(),A)[e>>>2>>>0];case"i64":return(p(),Y)[e>>>3>>>0];case"float":return(p(),Fe)[e>>>2>>>0];case"double":return(p(),C)[e>>>3>>>0];case"*":return(p(),_)[e>>>2>>>0];default:ot(`invalid type for getValue: ${r}`)}},t.UTF8ToString=it,t.stringToUTF8=Oe,t.lengthBytesUTF8=Le;var to,ro,Ar,Pt,be,gt,no,oo,ao,so,io,uo,fo,co,lo,po,mo,Ir,xr,Or,Lr,yt,Br,ho,Cr,go,yo,wo,Mr,bo,To,Dr,vo,Eo,pe,Ut,de,_o,wt,Ce,Hi=[$e,cr,mn,gn,yn,wn,bn,Tn,vn,En,_n,Sn,An,In,xn,On,Nn,Wn,Fn,Jn,Xn,Zn,Qn,Kn,eo],Pr={1111904:(e,r,n,s,f)=>{if(t===void 0||!t.o)return 1;if((e=it(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=t.o.get(e)))return 2;if(r=Number(r>>>0),n=Number(n>>>0),s=Number(s>>>0),r+n>e.byteLength)return 3;try{let m=e.subarray(r,r+n);switch(f){case 0:(p(),z).set(m,s>>>0);break;case 1:t.F?t.F(s,m):t.X(s,m);break;default:return 4}return 0}catch{return 4}},1112728:(e,r,n)=>{t.H(e,(p(),z).subarray(r>>>0,r+n>>>0))},1112792:()=>t.V(),1112834:e=>{t.G(e)},1112871:()=>typeof wasmOffsetConverter<"u"};function qi(){return typeof wasmOffsetConverter<"u"}function Rt(){0<Ee?Q=Rt:i?(E?.(t),K()):(ve(),0<Ee?Q=Rt:async function(){t.calledRun=!0,D||(K(),E?.(t))}())}return i||(Ce=await Ge(),Rt()),t.PTR_SIZE=4,t.webgpuInit=e=>{let r=new WeakMap,n,s,f=1;t.webgpuRegisterDevice=b=>{if(s!==void 0)throw Error("another WebGPU EP inference session is being created.");if(b){var S=r.get(b);if(!S){let I=((k,N=0)=>{var te=mo(N);return N=po(N,te),fe(te,k.queue),fe(N,k),N})(b,S=oo(0));S=[f++,S,I],r.set(b,S)}return n=b,s=S[0],S}n=void 0,s=0};let m=new Map;t.webgpuOnCreateSession=b=>{if(s!==void 0){var S=s;if(s=void 0,b){let I=Ar(S);m.set(b,I),S===0&&e(n??x(I))}n=void 0}},t.webgpuOnReleaseSession=b=>{m.delete(b)};let v=Symbol("gpuBufferMetadata");t.webgpuRegisterBuffer=(b,S,I)=>{if(I)return b[v]=[I,NaN],I;if(I=b[v])return I[1]++,I[0];if((S=m.get(S))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return S=((k,N=0)=>(k.mapState!="pending"||ot(),N=lo(N,k.mapState=="mapped"?3:1),fe(N,k),k.mapState=="mapped"&&(Ae[N]=[]),N))(b,S),b[v]=[S,1],S},t.webgpuUnregisterBuffer=b=>{let S=b[v];if(!S)throw Error("Buffer is not registered");S[1]--,S[1]===0&&(no(S[0]),delete b[v])},t.webgpuGetBuffer=b=>x(b),t.webgpuCreateDownloader=(b,S,I)=>{if((I=m.get(I))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let k=x(I),N=16*Math.ceil(Number(S)/16);return async()=>{let te=k.createBuffer({size:N,usage:9});try{let L=k.createCommandEncoder();return L.copyBufferToBuffer(b,0,te,0,N),k.queue.submit([L.finish()]),await te.mapAsync(GPUMapMode.READ),te.getMappedRange().slice(0,S)}finally{te.destroy()}}},t.F=(b,S)=>{var I=S.buffer;let k=S.byteOffset,N=S.byteLength;if(S=16*Math.ceil(Number(N)/16),b=x(b),!n){var te=Ar(s);n=x(te)}let L=(te=n.createBuffer({mappedAtCreation:!0,size:S,usage:6})).getMappedRange();new Uint8Array(L).set(new Uint8Array(I,k,N)),te.unmap(),(I=n.createCommandEncoder()).copyBufferToBuffer(te,0,b,0,S),n.queue.submit([I.finish()]),te.destroy()}},t.webnnInit=e=>{let r=e[0];[t.V,t.G,t.webnnEnsureTensor,t.H,t.webnnDownloadTensor,t.U,t.webnnEnableTraceEvent]=e.slice(1),t.webnnReleaseTensorId=t.G,t.webnnUploadTensor=t.H,t.webnnRegisterMLContext=t.U,t.webnnOnRunStart=n=>r.onRunStart(n),t.webnnOnRunEnd=r.onRunEnd.bind(r),t.webnnOnReleaseSession=n=>{r.onReleaseSession(n)},t.webnnCreateMLTensorDownloader=(n,s)=>r.createMLTensorDownloader(n,s),t.webnnRegisterMLTensor=(n,s,f,m)=>r.registerMLTensor(n,s,f,m),t.webnnCreateMLContext=n=>r.createMLContext(n),t.webnnRegisterMLConstant=(n,s,f,m,v,b)=>r.registerMLConstant(n,s,f,m,v,t.o,b),t.webnnRegisterGraphInput=r.registerGraphInput.bind(r),t.webnnIsGraphInput=r.isGraphInput.bind(r),t.webnnRegisterGraphOutput=r.registerGraphOutput.bind(r),t.webnnIsGraphOutput=r.isGraphOutput.bind(r),t.webnnCreateTemporaryTensor=r.createTemporaryTensor.bind(r),t.webnnIsGraphInputOutputTypeSupported=r.isGraphInputOutputTypeSupported.bind(r)},le?t:new Promise((e,r)=>{E=e,B=r})}var ru,nu,sa=R(()=>{"use strict";ru=oa,nu=globalThis.self?.name?.startsWith("em-pthread");nu&&oa()});var fa,Hr,ou,me,ca,Vr,au,su,la,iu,ia,pa,ua,da,$t=R(()=>{"use strict";Gt();fa=typeof location>"u"?void 0:location.origin,Hr=import.meta.url>"file:"&&import.meta.url<"file;",ou=()=>{if(!!1){if(Hr){let o=URL;return new URL(new o("ort.jspi.bundle.min.mjs",import.meta.url).href,fa).href}return import.meta.url}},me=ou(),ca=()=>{if(me&&!me.startsWith("blob:"))return me.substring(0,me.lastIndexOf("/")+1)},Vr=(o,t)=>{try{let a=t??me;return(a?new URL(o,a):new URL(o)).origin===fa}catch{return!1}},au=(o,t)=>{let a=t??me;try{return(a?new URL(o,a):new URL(o)).href}catch{return}},su=(o,t)=>`${t??"./"}${o}`,la=async o=>{let a=await(await fetch(o,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},iu=async o=>(await import(/*webpackIgnore:true*/ /*@vite-ignore*/o)).default,ia=(na(),kt(ra)).default,pa=async()=>{if(!me)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Vr(me))return[void 0,ia()];let o=await la(me);return[o,ia(o)]},ua=(sa(),kt(aa)).default,da=async(o,t,a,u)=>{let i=ua&&!(o||t);if(i)if(me)i=Vr(me);else if(u&&!a)i=!0;else throw new Error("cannot determine the script source URL.");if(i)return[void 0,ua];{let c="ort-wasm-simd-threaded.jspi.mjs",l=o??au(c,t),d=!!1&&a&&l&&!Vr(l,t),h=d?await la(l):l??su(c,t);return[d?h:void 0,await iu(h)]}}});var qr,Yr,Zt,ma,uu,fu,cu,zt,G,Ne=R(()=>{"use strict";$t();Yr=!1,Zt=!1,ma=!1,uu=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fu=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},cu=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},zt=async o=>{if(Yr)return Promise.resolve();if(Zt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(ma)throw new Error("previous call to 'initializeWebAssembly()' failed.");Zt=!0;let t=o.initTimeout,a=o.numThreads;if(o.simd!==!1){if(o.simd==="relaxed"){if(!cu())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!fu())throw new Error("WebAssembly SIMD is not supported in the current environment.")}if(!("Suspending"in WebAssembly))throw new Error("WebAssembly JSPI is not supported in the current environment.");let u=uu();a>1&&!u&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+a+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),o.numThreads=a=1);let i=o.wasmPaths,c=typeof i=="string"?i:void 0,l=i?.mjs,d=l?.href??l,h=i?.wasm,g=h?.href??h,y=o.wasmBinary,[w,T]=await da(d,c,a>1,!!y||!!g),E=!1,B=[];if(t>0&&B.push(new Promise(P=>{setTimeout(()=>{E=!0,P()},t)})),B.push(new Promise((P,V)=>{let M={numThreads:a};if(y)M.wasmBinary=y;else if(g||c)M.locateFile=O=>g??c+O;else if(d&&d.indexOf("blob:")!==0)M.locateFile=O=>new URL(O,d).href;else if(w){let O=ca();O&&(M.locateFile=U=>O+U)}T(M).then(O=>{Zt=!1,Yr=!0,qr=O,P(),w&&URL.revokeObjectURL(w)},O=>{Zt=!1,ma=!0,V(O)})})),await Promise.race(B),E)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},G=()=>{if(Yr&&qr)return qr;throw new Error("WebAssembly is not initialized yet.")}});var ce,Et,F,Qt=R(()=>{"use strict";Ne();ce=(o,t)=>{let a=G(),u=a.lengthBytesUTF8(o)+1,i=a._malloc(u);return a.stringToUTF8(o,i,u),t.push(i),i},Et=(o,t,a,u)=>{if(typeof o=="object"&&o!==null){if(a.has(o))throw new Error("Circular reference in options");a.add(o)}Object.entries(o).forEach(([i,c])=>{let l=t?t+i:i;if(typeof c=="object")Et(c,l+".",a,u);else if(typeof c=="string"||typeof c=="number")u(l,c.toString());else if(typeof c=="boolean")u(l,c?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof c}`)})},F=o=>{let t=G(),a=t.stackSave();try{let u=t.PTR_SIZE,i=t.stackAlloc(2*u);t._OrtGetLastError(i,i+u);let c=Number(t.getValue(i,u===4?"i32":"i64")),l=t.getValue(i+u,"*"),d=l?t.UTF8ToString(l):"";throw new Error(`${o} ERROR_CODE: ${c}, ERROR_MESSAGE: ${d}`)}finally{t.stackRestore(a)}}});var ha,ga=R(()=>{"use strict";Ne();Qt();ha=o=>{let t=G(),a=0,u=[],i=o||{};try{if(o?.logSeverityLevel===void 0)i.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)i.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(i.terminate=!1);let c=0;return o?.tag!==void 0&&(c=ce(o.tag,u)),a=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,c),a===0&&F("Can't create run options."),o?.extra!==void 0&&Et(o.extra,"",new WeakSet,(l,d)=>{let h=ce(l,u),g=ce(d,u);t._OrtAddRunConfigEntry(a,h,g)!==0&&F(`Can't set a run config entry: ${l} - ${d}.`)}),[a,u]}catch(c){throw a!==0&&t._OrtReleaseRunOptions(a),u.forEach(l=>t._free(l)),c}}});var lu,pu,du,Jr,Qe,mu,ya,wa=R(()=>{"use strict";Ne();Qt();lu=o=>{switch(o){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${o}`)}},pu=o=>{switch(o){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${o}`)}},du=o=>{o.extra||(o.extra={}),o.extra.session||(o.extra.session={});let t=o.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),o.executionProviders&&o.executionProviders.some(a=>(typeof a=="string"?a:a.name)==="webgpu")&&(o.enableMemPattern=!1)},Jr=(o,t,a,u)=>{let i=ce(t,u),c=ce(a,u);G()._OrtAddSessionConfigEntry(o,i,c)!==0&&F(`Can't set a session config entry: ${t} - ${a}.`)},Qe=(o,t,a,u)=>{let i=ce(t,u),c=ce(a,u);o.push([i,c])},mu=async(o,t,a)=>{let u=t.executionProviders;for(let i of u){let c=typeof i=="string"?i:i.name,l=[];switch(c){case"webnn":if(c="WEBNN",typeof i!="string"){let T=i?.deviceType;T&&Jr(o,"deviceType",T,a)}break;case"webgpu":{c="WebGPU";let w;if(typeof i!="string"){let E=i;if(E.device)if(typeof GPUDevice<"u"&&E.device instanceof GPUDevice)w=E.device;else throw new Error("Invalid GPU device set in WebGPU EP options.");let{enableGraphCapture:B}=t;if(typeof B=="boolean"&&B&&Qe(l,"enableGraphCapture","1",a),typeof E.preferredLayout=="string"&&Qe(l,"preferredLayout",E.preferredLayout,a),E.forceCpuNodeNames){let P=Array.isArray(E.forceCpuNodeNames)?E.forceCpuNodeNames:[E.forceCpuNodeNames];Qe(l,"forceCpuNodeNames",P.join(`
`),a)}E.validationMode&&Qe(l,"validationMode",E.validationMode,a)}let T=G().webgpuRegisterDevice(w);if(T){let[E,B,P]=T;Qe(l,"deviceId",E.toString(),a),Qe(l,"webgpuInstance",B.toString(),a),Qe(l,"webgpuDevice",P.toString(),a)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${c}`)}let d=ce(c,a),h=l.length,g=0,y=0;if(h>0){g=G()._malloc(h*G().PTR_SIZE),a.push(g),y=G()._malloc(h*G().PTR_SIZE),a.push(y);for(let w=0;w<h;w++)G().setValue(g+w*G().PTR_SIZE,l[w][0],"*"),G().setValue(y+w*G().PTR_SIZE,l[w][1],"*")}await G()._OrtAppendExecutionProvider(o,d,g,y,h)!==0&&F(`Can't append execution provider: ${c}.`)}},ya=async o=>{let t=G(),a=0,u=[],i=o||{};du(i);try{let c=lu(i.graphOptimizationLevel??"all"),l=pu(i.executionMode??"sequential"),d=typeof i.logId=="string"?ce(i.logId,u):0,h=i.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log severity level is not valid: ${h}`);let g=i.logVerbosityLevel??0;if(!Number.isInteger(g)||g<0||g>4)throw new Error(`log verbosity level is not valid: ${g}`);let y=typeof i.optimizedModelFilePath=="string"?ce(i.optimizedModelFilePath,u):0;if(a=t._OrtCreateSessionOptions(c,!!i.enableCpuMemArena,!!i.enableMemPattern,l,!!i.enableProfiling,0,d,h,g,y),a===0&&F("Can't create session options."),i.executionProviders&&await mu(a,i,u),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Jr(a,"enableGraphCapture",i.enableGraphCapture.toString(),u)}if(i.freeDimensionOverrides)for(let[w,T]of Object.entries(i.freeDimensionOverrides)){if(typeof w!="string")throw new Error(`free dimension override name must be a string: ${w}`);if(typeof T!="number"||!Number.isInteger(T)||T<0)throw new Error(`free dimension override value must be a non-negative integer: ${T}`);let E=ce(w,u);t._OrtAddFreeDimensionOverride(a,E,T)!==0&&F(`Can't set a free dimension override: ${w} - ${T}.`)}return i.extra!==void 0&&Et(i.extra,"",new WeakSet,(w,T)=>{Jr(a,w,T,u)}),[a,u]}catch(c){throw a!==0&&t._OrtReleaseSessionOptions(a)!==0&&F("Can't release session options."),u.forEach(l=>t._free(l)),c}}});var We,Kt,lt,Ke,_t,er,tr,Xr,et=R(()=>{"use strict";We=o=>{switch(o){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${o}`)}},Kt=o=>{switch(o){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${o}`)}},lt=(o,t)=>{let a=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][o],u=typeof t=="number"?t:t.reduce((i,c)=>i*c,1);return a>0?Math.ceil(u*a):void 0},Ke=o=>{switch(o){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${o}`)}},_t=o=>{switch(o){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${o}`)}},er=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",tr=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint64"||o==="int8"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",Xr=o=>{switch(o){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${o}`)}}});var St,Zr=R(()=>{"use strict";Gt();St=async o=>{if(typeof o=="string")if(!1)try{let{readFile:t}=kr("node:fs/promises");return new Uint8Array(await t(o))}catch(t){if(t.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:a}=kr("node:fs"),u=a(o),i=[];for await(let c of u)i.push(c);return new Uint8Array(Buffer.concat(i))}throw t}else{let t=await fetch(o);if(!t.ok)throw new Error(`failed to load external data file: ${o}`);let a=t.headers.get("Content-Length"),u=a?parseInt(a,10):0;if(u<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${o}, no response body.`);let i=t.body.getReader(),c;try{c=new ArrayBuffer(u)}catch(d){if(d instanceof RangeError){let h=Math.ceil(u/65536);c=new WebAssembly.Memory({initial:h,maximum:h}).buffer}else throw d}let l=0;for(;;){let{done:d,value:h}=await i.read();if(d)break;let g=h.byteLength;new Uint8Array(c,l,g).set(h),l+=g}return new Uint8Array(c,0,u)}}else return o instanceof Blob?new Uint8Array(await o.arrayBuffer()):o instanceof Uint8Array?o:new Uint8Array(o)}});var ba,Ta=R(()=>{"use strict";et();ba=(o,t)=>new(Ke(t))(o)});var hu,gu,va,Ea,_a,yu,ae,Qr=R(()=>{"use strict";et();hu=["V","I","W","E","F"],gu=(o,t)=>{console.log(`[${hu[o]},${new Date().toISOString()}]${t}`)},_a=(o,t)=>{va=o,Ea=t},yu=(o,t)=>{let a=_t(o),u=_t(va);a>=u&&gu(a,typeof t=="function"?t():t)},ae=(...o)=>{Ea&&yu(...o)}});var Aa,en,Ia,wu,Sa,bu,xa,rr,nr,Kr,Oa,La=R(()=>{"use strict";et();Qr();Aa=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),en=(o,t)=>{if(t==="int32")return o;let a=Aa.get(t);if(!a)throw new Error(`WebNN backend does not support data type: ${t}`);let u=a/8;if(o.byteLength%u!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${u}.`);let i=o.byteLength/u,c=new(Ke(t))(o.buffer,o.byteOffset,i);switch(t){case"int64":case"uint64":{let l=new Int32Array(i);for(let d=0;d<i;d++){let h=c[d];if(h>2147483647n||h<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");l[d]=Number(h)}return new Uint8Array(l.buffer)}case"int8":case"uint8":case"uint32":{if(t==="uint32"&&c.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let l=Int32Array.from(c,Number);return new Uint8Array(l.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},Ia=(o,t)=>{if(t==="int32")return o;if(o.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let a=o.byteLength/4,u=new Int32Array(o.buffer,o.byteOffset,a);switch(t){case"int64":{let i=BigInt64Array.from(u,BigInt);return new Uint8Array(i.buffer)}case"uint64":{if(u.some(c=>c<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let i=BigUint64Array.from(u,BigInt);return new Uint8Array(i.buffer)}case"int8":{if(u.some(c=>c<-128||c>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let i=Int8Array.from(u,Number);return new Uint8Array(i.buffer)}case"uint8":{if(u.some(i=>i<0||i>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(u,Number)}case"uint32":{if(u.some(c=>c<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let i=Uint32Array.from(u,Number);return new Uint8Array(i.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},wu=1,Sa=()=>wu++,bu=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),xa=(o,t)=>{let a=Aa.get(o);if(!a)throw new Error(`WebNN backend does not support data type: ${o}`);return t.length>0?Math.ceil(t.reduce((u,i)=>u*i)*a/8):0},rr=class{constructor(t){this.isDataConverted=!1;let{sessionId:a,context:u,tensor:i,dataType:c,shape:l,fallbackDataType:d}=t;this.sessionId=a,this.mlContext=u,this.mlTensor=i,this.dataType=c,this.tensorShape=l,this.fallbackDataType=d}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return xa(this.dataType,this.tensorShape)}destroy(){ae("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),u=Ia(new Uint8Array(a),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(u);return}else return u.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,a,u){return this.mlContext===t&&this.dataType===a&&this.tensorShape.length===u.length&&this.tensorShape.every((i,c)=>i===u[c])}setIsDataConverted(t){this.isDataConverted=t}},nr=class{constructor(t,a){this.tensorManager=t;this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,a,u,i){let c=this.tensorManager.getMLContext(t),l=this.tensorManager.getMLOpSupportLimits(t),d;if(!l?.input.dataTypes.includes(a)){if(d=bu.get(a),!d||l?.input.dataTypes.includes(d))throw new Error(`WebNN backend does not support data type: ${a}`);ae("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${d}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(c,a,u))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==xa(a,u))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let h=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,a,u,h,!0,!0,d),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let a=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=en(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else ae("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(t){if(this.activeUpload){let a=this.wrapper?.isDataConverted?Ia(this.activeUpload,this.wrapper?.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(a):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},Kr=class{constructor(t){this.backend=t;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(t){let a=this.backend.getMLContext(t);if(!a)throw new Error("MLContext not found for session.");return a}getMLOpSupportLimits(t){return this.backend.getMLOpSupportLimits(t)}reserveTensorId(){let t=Sa();return this.tensorTrackersById.set(t,new nr(this)),t}releaseTensorId(t){let a=this.tensorTrackersById.get(t);a&&(this.tensorTrackersById.delete(t),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(t,a,u,i,c){ae("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${u}, shape: ${i}, copyOld: ${c}}`);let l=this.tensorTrackersById.get(a);if(!l)throw new Error("Tensor not found.");return l.ensureTensor(t,u,i,c)}upload(t,a){let u=this.tensorTrackersById.get(t);if(!u)throw new Error("Tensor not found.");u.upload(a)}async download(t,a){ae("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${a?.byteLength}}`);let u=this.tensorTrackersById.get(t);if(!u)throw new Error("Tensor not found.");return u.download(a)}releaseTensorsForSession(t){for(let a of this.freeTensors)a.sessionId===t&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==t)}registerTensor(t,a,u,i){let c=this.getMLContext(t),l=Sa(),d=new rr({sessionId:t,context:c,tensor:a,dataType:u,shape:i});return this.tensorTrackersById.set(l,new nr(this,d)),this.externalTensors.add(d),l}async getCachedTensor(t,a,u,i,c,l,d){let h=this.getMLContext(t);for(let[y,w]of this.freeTensors.entries())if(w.canReuseTensor(h,a,u)){ae("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${u}`);let T=this.freeTensors.splice(y,1)[0];return T.sessionId=t,T}ae("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${u}}`);let g=await h.createTensor({dataType:d??a,shape:u,dimensions:u,usage:i,writable:c,readable:l});return new rr({sessionId:t,context:h,tensor:g,dataType:a,shape:u,fallbackDataType:d})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},Oa=(...o)=>new Kr(...o)});var Ba={};bt(Ba,{WebNNBackend:()=>tn});var or,Tu,tn,Ca=R(()=>{"use strict";et();Ne();Ta();La();Qr();or=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Tu=(o,t)=>{if(o===t)return!0;if(o===void 0||t===void 0)return!1;let a=Object.keys(o).sort(),u=Object.keys(t).sort();return a.length===u.length&&a.every((i,c)=>i===u[c]&&o[i]===t[i])},tn=class{constructor(t){this.tensorManager=Oa(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;this.mlOpSupportLimitsBySessionId=new Map;_a(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){ae("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){ae("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let a=this.temporarySessionTensorIds.get(t);if(a){for(let u of a)ae("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${u}}`),this.tensorManager.releaseTensorId(u);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let u=this.mlContextCache.findIndex(i=>i.gpuDevice===t);if(u!==-1)return this.mlContextCache[u].mlContext;{let i=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:i}),i}}else if(t===void 0){let u=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(u!==-1)return this.mlContextCache[u].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let a=this.mlContextCache.findIndex(u=>Tu(u.options,t));if(a!==-1)return this.mlContextCache[a].mlContext;{let u=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:u}),u}}registerMLContext(t,a){this.mlContextBySessionId.set(t,a);let u=this.sessionIdsByMLContext.get(a);u||(u=new Set,this.sessionIdsByMLContext.set(a,u)),u.add(t),this.mlOpSupportLimitsBySessionId.has(t)||this.mlOpSupportLimitsBySessionId.set(t,a.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let a=this.mlContextBySessionId.get(t);if(!a)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t),this.mlOpSupportLimitsBySessionId.delete(t);let u=this.sessionIdsByMLContext.get(a);if(u.delete(t),u.size===0){this.sessionIdsByMLContext.delete(a);let i=this.mlContextCache.findIndex(c=>c.mlContext===a);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}getMLOpSupportLimits(t){return this.mlOpSupportLimitsBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){ae("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,a,u,i,c){let l=or.get(u);if(!l)throw new Error(`Unsupported ONNX data type: ${u}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,a,l,i,c)}async createTemporaryTensor(t,a,u){ae("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${u}}`);let i=or.get(a);if(!i)throw new Error(`Unsupported ONNX data type: ${a}`);let c=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,c,i,u,!1);let l=this.temporarySessionTensorIds.get(t);return l?l.push(c):this.temporarySessionTensorIds.set(t,[c]),c}uploadTensor(t,a){if(!G().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ae("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${a.byteLength}}`),this.tensorManager.upload(t,a)}async downloadTensor(t,a){return this.tensorManager.download(t,a)}createMLTensorDownloader(t,a){return async()=>{let u=await this.tensorManager.download(t);return ba(u,a)}}registerMLTensor(t,a,u,i){let c=or.get(u);if(!c)throw new Error(`Unsupported ONNX data type: ${u}`);let l=this.tensorManager.registerTensor(t,a,c,i);return ae("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${c}, dimensions: ${i}} -> {tensorId: ${l}}`),l}registerMLConstant(t,a,u,i,c,l,d=!1){if(!l)throw new Error("External mounted files are not available.");let h=t;t.startsWith("./")&&(h=t.substring(2));let g=l.get(h);if(!g)throw new Error(`File with name ${h} not found in preloaded files.`);if(a+u>g.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let y=g.slice(a,a+u).buffer,w;switch(c.dataType){case"float32":w=new Float32Array(y);break;case"float16":w=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(y):new Uint16Array(y);break;case"int32":w=new Int32Array(y);break;case"uint32":w=new Uint32Array(y);break;case"int64":if(d){let T=en(new Uint8Array(y),"int64");w=new Int32Array(T.buffer),c.dataType="int32"}else w=new BigInt64Array(y);break;case"uint64":w=new BigUint64Array(y);break;case"int8":w=new Int8Array(y);break;case"int4":case"uint4":case"uint8":w=new Uint8Array(y);break;default:throw new Error(`Unsupported data type: ${c.dataType} in creating WebNN Constant from external data.`)}return ae("verbose",()=>`[WebNN] registerMLConstant {dataType: ${c.dataType}, shape: ${c.shape}}} ${d?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(c,w)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,a){let u=this.sessionGraphInputs.get(t);return u?u.includes(a):!1}isGraphOutput(t,a){let u=this.sessionGraphOutputs.get(t);return u?u.includes(a):!1}isGraphInputOutputTypeSupported(t,a,u=!0){let i=or.get(We(a)),c=this.mlOpSupportLimitsBySessionId.get(t);return typeof i>"u"?!1:u?!!c?.input.dataTypes.includes(i):!!c?.output.dataTypes.includes(i)}flush(){}}});var vu,jt,Vt,tt,Eu,Ma,vt,Ht,qt,Da,Yt,Jt,Xt,jr=R(()=>{"use strict";ke();ga();wa();et();Ne();Qt();Zr();vu=(o,t)=>{G()._OrtInit(o,t)!==0&&F("Can't initialize onnxruntime.")},jt=async o=>{vu(o.wasm.numThreads,_t(o.logLevel))},Vt=async(o,t)=>{G().asyncInit?.();let a=o.webgpu.adapter;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(a){if(typeof a.limits!="object"||typeof a.features!="object"||typeof a.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let u=o.webgpu.powerPreference;if(u!==void 0&&u!=="low-power"&&u!=="high-performance")throw new Error(`Invalid powerPreference setting: "${u}"`);let i=o.webgpu.forceFallbackAdapter;if(i!==void 0&&typeof i!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${i}"`);if(a=await navigator.gpu.requestAdapter({powerPreference:u,forceFallbackAdapter:i}),!a)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(t==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(t==="webgpu"&&G().webgpuInit(u=>{o.webgpu.device=u}),t==="webnn"){let u=new(Ca(),kt(Ba)).WebNNBackend(o);G().webnnInit([u,()=>u.reserveTensorId(),i=>u.releaseTensorId(i),async(i,c,l,d,h)=>u.ensureTensor(i,c,l,d,h),(i,c)=>{u.uploadTensor(i,c)},async(i,c)=>u.downloadTensor(i,c),(i,c)=>u.registerMLContext(i,c),!!o.trace])}},tt=new Map,Eu=o=>{let t=G(),a=t.stackSave();try{let u=t.PTR_SIZE,i=t.stackAlloc(2*u);t._OrtGetInputOutputCount(o,i,i+u)!==0&&F("Can't get session input/output count.");let l=u===4?"i32":"i64";return[Number(t.getValue(i,l)),Number(t.getValue(i+u,l))]}finally{t.stackRestore(a)}},Ma=(o,t)=>{let a=G(),u=a.stackSave(),i=0;try{let c=a.PTR_SIZE,l=a.stackAlloc(2*c);a._OrtGetInputOutputMetadata(o,t,l,l+c)!==0&&F("Can't get session input/output metadata.");let h=Number(a.getValue(l,"*"));i=Number(a.getValue(l+c,"*"));let g=a.HEAP32[i/4];if(g===0)return[h,0];let y=a.HEAPU32[i/4+1],w=[];for(let T=0;T<y;T++){let E=Number(a.getValue(i+8+T*c,"*"));w.push(E!==0?a.UTF8ToString(E):Number(a.getValue(i+8+(T+y)*c,"*")))}return[h,g,w]}finally{a.stackRestore(u),i!==0&&a._OrtFree(i)}},vt=o=>{let t=G(),a=t._malloc(o.byteLength);if(a===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${o.byteLength}.`);return t.HEAPU8.set(o,a),[a,o.byteLength]},Ht=async(o,t)=>{let a,u,i=G();Array.isArray(o)?[a,u]=o:o.buffer===i.HEAPU8.buffer?[a,u]=[o.byteOffset,o.byteLength]:[a,u]=vt(o);let c=0,l=0,d=0,h=[],g=[],y=[];try{if([l,h]=await ya(t),t?.externalData&&i.mountExternalData){let D=[];for(let $ of t.externalData){let p=typeof $=="string"?$:$.path;D.push(St(typeof $=="string"?$:$.data).then(re=>{i.mountExternalData(p,re)}))}await Promise.all(D)}for(let D of t?.executionProviders??[])if((typeof D=="string"?D:D.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof D!="string"){let p=D,re=p?.context,q=p?.gpuDevice,z=p?.deviceType,se=p?.powerPreference;re?i.currentContext=re:q?i.currentContext=await i.webnnCreateMLContext(q):i.currentContext=await i.webnnCreateMLContext({deviceType:z,powerPreference:se})}else i.currentContext=await i.webnnCreateMLContext();break}c=await i._OrtCreateSession(a,u,l),i.webgpuOnCreateSession?.(c),c===0&&F("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(c,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[w,T]=Eu(c),E=!!t?.enableGraphCapture,B=[],P=[],V=[],M=[],O=[];for(let D=0;D<w;D++){let[$,p,re]=Ma(c,D);$===0&&F("Can't get an input name."),g.push($);let q=i.UTF8ToString($);B.push(q),V.push(p===0?{name:q,isTensor:!1}:{name:q,isTensor:!0,type:Kt(p),shape:re})}for(let D=0;D<T;D++){let[$,p,re]=Ma(c,D+w);$===0&&F("Can't get an output name."),y.push($);let q=i.UTF8ToString($);P.push(q),M.push(p===0?{name:q,isTensor:!1}:{name:q,isTensor:!0,type:Kt(p),shape:re});{if(E&&t?.preferredOutputLocation===void 0){O.push("gpu-buffer");continue}let z=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[q]??"cpu",se=i.webnnIsGraphOutput;if(z==="cpu"&&se&&se(c,q)){O.push("ml-tensor-cpu-output");continue}if(z!=="cpu"&&z!=="cpu-pinned"&&z!=="gpu-buffer"&&z!=="ml-tensor")throw new Error(`Not supported preferred output location: ${z}.`);if(E&&z!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${z}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);O.push(z)}}let U=null;return O.some(D=>D==="gpu-buffer"||D==="ml-tensor"||D==="ml-tensor-cpu-output")&&(d=i._OrtCreateBinding(c),d===0&&F("Can't create IO binding."),U={handle:d,outputPreferredLocations:O,outputPreferredLocationsEncoded:O.map(D=>D==="ml-tensor-cpu-output"?"ml-tensor":D).map(D=>Xr(D))}),tt.set(c,[c,g,y,U,E,!1]),[c,B,P,V,M]}catch(w){throw g.forEach(T=>i._OrtFree(T)),y.forEach(T=>i._OrtFree(T)),d!==0&&i._OrtReleaseBinding(d)!==0&&F("Can't release IO binding."),c!==0&&i._OrtReleaseSession(c)!==0&&F("Can't release session."),w}finally{i._free(a),l!==0&&i._OrtReleaseSessionOptions(l)!==0&&F("Can't release session options."),h.forEach(w=>i._free(w)),i.unmountExternalData?.()}},qt=o=>{let t=G(),a=tt.get(o);if(!a)throw new Error(`cannot release session. invalid session id: ${o}`);let[u,i,c,l,d]=a;l&&(d&&t._OrtClearBoundOutputs(l.handle)!==0&&F("Can't clear bound outputs."),t._OrtReleaseBinding(l.handle)!==0&&F("Can't release IO binding.")),t.jsepOnReleaseSession?.(o),t.webnnOnReleaseSession?.(o),t.webgpuOnReleaseSession?.(o),i.forEach(h=>t._OrtFree(h)),c.forEach(h=>t._OrtFree(h)),t._OrtReleaseSession(u)!==0&&F("Can't release session."),tt.delete(o)},Da=async(o,t,a,u,i,c,l=!1)=>{if(!o){t.push(0);return}let d=G(),h=d.PTR_SIZE,g=o[0],y=o[1],w=o[3],T=w,E,B;if(g==="string"&&(w==="gpu-buffer"||w==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(l&&w!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${c} when enableGraphCapture is true.`);if(w==="gpu-buffer"){let M=o[2].gpuBuffer;B=lt(We(g),y);{let O=d.webgpuRegisterBuffer;if(!O)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');E=O(M,u)}}else if(w==="ml-tensor"){let M=o[2].mlTensor;B=lt(We(g),y);let O=d.webnnRegisterMLTensor;if(!O)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');E=O(u,M,We(g),y)}else{let M=o[2];if(Array.isArray(M)){B=h*M.length,E=d._malloc(B),a.push(E);for(let O=0;O<M.length;O++){if(typeof M[O]!="string")throw new TypeError(`tensor data at index ${O} is not a string`);d.setValue(E+O*h,ce(M[O],a),"*")}}else{let O=d.webnnIsGraphInput,U=d.webnnIsGraphOutput;if(g!=="string"&&O&&U){let D=d.UTF8ToString(i);if(O(u,D)||U(u,D)){let $=We(g);B=lt($,y),T="ml-tensor";let p=d.webnnCreateTemporaryTensor,re=d.webnnUploadTensor;if(!p||!re)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let q=await p(u,$,y);re(q,new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),E=q}else B=M.byteLength,E=d._malloc(B),a.push(E),d.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,B),E)}else B=M.byteLength,E=d._malloc(B),a.push(E),d.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,B),E)}}let P=d.stackSave(),V=d.stackAlloc(4*y.length);try{y.forEach((O,U)=>d.setValue(V+U*h,O,h===4?"i32":"i64"));let M=d._OrtCreateTensor(We(g),E,B,V,y.length,Xr(T));M===0&&F(`Can't create tensor for input/output. session=${u}, index=${c}.`),t.push(M)}finally{d.stackRestore(P)}},Yt=async(o,t,a,u,i,c)=>{let l=G(),d=l.PTR_SIZE,h=tt.get(o);if(!h)throw new Error(`cannot run inference. invalid session id: ${o}`);let g=h[0],y=h[1],w=h[2],T=h[3],E=h[4],B=h[5],P=t.length,V=u.length,M=0,O=[],U=[],D=[],$=[],p=[],re=l.stackSave(),q=l.stackAlloc(P*d),z=l.stackAlloc(P*d),se=l.stackAlloc(V*d),Me=l.stackAlloc(V*d);try{[M,O]=ha(c),Ue("wasm prepareInputOutputTensor");for(let C=0;C<P;C++)await Da(a[C],U,$,o,y[t[C]],t[C],E);for(let C=0;C<V;C++)await Da(i[C],D,$,o,w[u[C]],P+u[C],E);Re("wasm prepareInputOutputTensor");for(let C=0;C<P;C++)l.setValue(q+C*d,U[C],"*"),l.setValue(z+C*d,y[t[C]],"*");for(let C=0;C<V;C++)l.setValue(se+C*d,D[C],"*"),l.setValue(Me+C*d,w[u[C]],"*");if(T&&!B){let{handle:C,outputPreferredLocations:Y,outputPreferredLocationsEncoded:nt}=T;if(y.length!==P)throw new Error(`input count from feeds (${P}) is expected to be always equal to model's input count (${y.length}).`);Ue("wasm bindInputsOutputs");for(let H=0;H<P;H++){let le=t[H];await l._OrtBindInput(C,y[le],U[H])!==0&&F(`Can't bind input[${H}] for session=${o}.`)}for(let H=0;H<V;H++){let le=u[H];i[H]?.[3]?(p.push(D[H]),l._OrtBindOutput(C,w[le],D[H],0)!==0&&F(`Can't bind pre-allocated output[${H}] for session=${o}.`)):l._OrtBindOutput(C,w[le],0,nt[le])!==0&&F(`Can't bind output[${H}] to ${Y[H]} for session=${o}.`)}Re("wasm bindInputsOutputs"),tt.set(o,[g,y,w,T,E,!0])}l.jsepOnRunStart?.(g),l.webnnOnRunStart?.(g);let A;T?A=await l._OrtRunWithBinding(g,T.handle,V,se,M):A=await l._OrtRun(g,z,q,P,Me,V,se,M),A!==0&&F("failed to call OrtRun().");let _=[],Fe=[];Ue("wasm ProcessOutputTensor");for(let C=0;C<V;C++){let Y=Number(l.getValue(se+C*d,"*"));if(Y===D[C]||p.includes(D[C])){_.push(i[C]),Y!==D[C]&&l._OrtReleaseTensor(Y)!==0&&F("Can't release tensor.");continue}let nt=l.stackSave(),H=l.stackAlloc(4*d),le=!1,J,K=0;try{l._OrtGetTensorData(Y,H,H+d,H+2*d,H+3*d)!==0&&F(`Can't access output tensor data on index ${C}.`);let at=d===4?"i32":"i64",Ge=Number(l.getValue(H,at));K=l.getValue(H+d,"*");let st=l.getValue(H+d*2,"*"),It=Number(l.getValue(H+d*3,at)),ve=[];for(let Q=0;Q<It;Q++)ve.push(Number(l.getValue(st+Q*d,at)));l._OrtFree(st)!==0&&F("Can't free memory for tensor dims.");let ye=ve.reduce((Q,X)=>Q*X,1);J=Kt(Ge);let Ee=T?.outputPreferredLocations[u[C]];if(J==="string"){if(Ee==="gpu-buffer"||Ee==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Q=[];for(let X=0;X<ye;X++){let W=l.getValue(K+X*d,"*"),j=l.getValue(K+(X+1)*d,"*"),$e=X===ye-1?void 0:j-W;Q.push(l.UTF8ToString(W,$e))}_.push([J,ve,Q,"cpu"])}else if(Ee==="gpu-buffer"&&ye>0){let Q=l.webgpuGetBuffer;if(!Q)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let X=Q(K),W=lt(Ge,ye);if(W===void 0||!er(J))throw new Error(`Unsupported data type: ${J}`);le=!0;{l.webgpuRegisterBuffer(X,o,K);let j=l.webgpuCreateDownloader(X,W,o);_.push([J,ve,{gpuBuffer:X,download:async()=>{let $e=await j();return new(Ke(J))($e)},dispose:()=>{l._OrtReleaseTensor(Y)!==0&&F("Can't release tensor.")}},"gpu-buffer"])}}else if(Ee==="ml-tensor"&&ye>0){let Q=l.webnnEnsureTensor,X=l.webnnIsGraphInputOutputTypeSupported;if(!Q||!X)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(lt(Ge,ye)===void 0||!tr(J))throw new Error(`Unsupported data type: ${J}`);if(!X(o,J,!1))throw new Error(`preferredLocation "ml-tensor" for ${J} output is not supported by current WebNN Context.`);let j=await Q(o,K,Ge,ve,!1);le=!0,_.push([J,ve,{mlTensor:j,download:l.webnnCreateMLTensorDownloader(K,J),dispose:()=>{l.webnnReleaseTensorId(K),l._OrtReleaseTensor(Y)}},"ml-tensor"])}else if(Ee==="ml-tensor-cpu-output"&&ye>0){let Q=l.webnnCreateMLTensorDownloader(K,J)(),X=_.length;le=!0,Fe.push((async()=>{let W=[X,await Q];return l.webnnReleaseTensorId(K),l._OrtReleaseTensor(Y),W})()),_.push([J,ve,[],"cpu"])}else{let Q=Ke(J),X=new Q(ye);new Uint8Array(X.buffer,X.byteOffset,X.byteLength).set(l.HEAPU8.subarray(K,K+X.byteLength)),_.push([J,ve,X,"cpu"])}}finally{l.stackRestore(nt),J==="string"&&K&&l._free(K),le||l._OrtReleaseTensor(Y)}}T&&!E&&(l._OrtClearBoundOutputs(T.handle)!==0&&F("Can't clear bound outputs."),tt.set(o,[g,y,w,T,E,!1]));for(let[C,Y]of await Promise.all(Fe))_[C][2]=Y;return Re("wasm ProcessOutputTensor"),_}finally{l.webnnOnRunEnd?.(g),l.stackRestore(re),a.forEach(A=>{A&&A[3]==="gpu-buffer"&&l.webgpuUnregisterBuffer(A[2].gpuBuffer)}),i.forEach(A=>{A&&A[3]==="gpu-buffer"&&l.webgpuUnregisterBuffer(A[2].gpuBuffer)}),U.forEach(A=>l._OrtReleaseTensor(A)),D.forEach(A=>l._OrtReleaseTensor(A)),$.forEach(A=>l._free(A)),M!==0&&l._OrtReleaseRunOptions(M),O.forEach(A=>l._free(A))}},Jt=o=>{let t=G(),a=tt.get(o);if(!a)throw new Error("invalid session id");let u=a[0],i=t._OrtEndProfiling(u);i===0&&F("Can't get an profile file name."),t._OrtFree(i)},Xt=o=>{let t=[];for(let a of o){let u=a[2];!Array.isArray(u)&&"buffer"in u&&t.push(u.buffer)}return t}});var rt,ge,At,sr,ir,ar,rn,nn,pt,dt,Su,Pa,Ua,Ra,ka,Na,Wa,Fa,on=R(()=>{"use strict";ke();jr();Ne();$t();rt=()=>!!Z.wasm.proxy&&typeof document<"u",At=!1,sr=!1,ir=!1,nn=new Map,pt=(o,t)=>{let a=nn.get(o);a?a.push(t):nn.set(o,[t])},dt=()=>{if(At||!sr||ir||!ge)throw new Error("worker not ready")},Su=o=>{switch(o.data.type){case"init-wasm":At=!1,o.data.err?(ir=!0,rn[1](o.data.err)):(sr=!0,rn[0]()),ar&&(URL.revokeObjectURL(ar),ar=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=nn.get(o.data.type);o.data.err?t.shift()[1](o.data.err):t.shift()[0](o.data.out);break}default:}},Pa=async()=>{if(!sr){if(At)throw new Error("multiple calls to 'initWasm()' detected.");if(ir)throw new Error("previous call to 'initWasm()' failed.");if(At=!0,rt())return new Promise((o,t)=>{ge?.terminate(),pa().then(([a,u])=>{try{ge=u,ge.onerror=c=>t(c),ge.onmessage=Su,rn=[o,t];let i={type:"init-wasm",in:Z};!i.in.wasm.wasmPaths&&(a||Hr)&&(i.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jspi.wasm",import.meta.url).href}),ge.postMessage(i),ar=a}catch(i){t(i)}},t)});try{await zt(Z.wasm),await jt(Z),sr=!0}catch(o){throw ir=!0,o}finally{At=!1}}},Ua=async o=>{if(rt())return dt(),new Promise((t,a)=>{pt("init-ep",[t,a]);let u={type:"init-ep",in:{epName:o,env:Z}};ge.postMessage(u)});await Vt(Z,o)},Ra=async o=>rt()?(dt(),new Promise((t,a)=>{pt("copy-from",[t,a]);let u={type:"copy-from",in:{buffer:o}};ge.postMessage(u,[o.buffer])})):vt(o),ka=async(o,t)=>{if(rt()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return dt(),new Promise((a,u)=>{pt("create",[a,u]);let i={type:"create",in:{model:o,options:{...t}}},c=[];o instanceof Uint8Array&&c.push(o.buffer),ge.postMessage(i,c)})}else return Ht(o,t)},Na=async o=>{if(rt())return dt(),new Promise((t,a)=>{pt("release",[t,a]);let u={type:"release",in:o};ge.postMessage(u)});qt(o)},Wa=async(o,t,a,u,i,c)=>{if(rt()){if(a.some(l=>l[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(l=>l))throw new Error("pre-allocated output tensor is not supported for proxy.");return dt(),new Promise((l,d)=>{pt("run",[l,d]);let h=a,g={type:"run",in:{sessionId:o,inputIndices:t,inputs:h,outputIndices:u,options:c}};ge.postMessage(g,Xt(h))})}else return Yt(o,t,a,u,i,c)},Fa=async o=>{if(rt())return dt(),new Promise((t,a)=>{pt("end-profiling",[t,a]);let u={type:"end-profiling",in:o};ge.postMessage(u)});Jt(o)}});var Ga,Au,ur,$a=R(()=>{"use strict";ke();on();et();Gt();Zr();Ga=(o,t)=>{switch(o.location){case"cpu":return[o.type,o.dims,o.data,"cpu"];case"gpu-buffer":return[o.type,o.dims,{gpuBuffer:o.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[o.type,o.dims,{mlTensor:o.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${o.location} for ${t()}`)}},Au=o=>{switch(o[3]){case"cpu":return new Te(o[0],o[2],o[1]);case"gpu-buffer":{let t=o[0];if(!er(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:a,download:u,dispose:i}=o[2];return Te.fromGpuBuffer(a,{dataType:t,dims:o[1],download:u,dispose:i})}case"ml-tensor":{let t=o[0];if(!tr(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:a,download:u,dispose:i}=o[2];return Te.fromMLTensor(a,{dataType:t,dims:o[1],download:u,dispose:i})}default:throw new Error(`invalid data location: ${o[3]}`)}},ur=class{async fetchModelAndCopyToWasmMemory(t){return Ra(await St(t))}async loadModel(t,a){Je();let u;typeof t=="string"?u=await this.fetchModelAndCopyToWasmMemory(t):u=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await ka(u,a),Xe()}async dispose(){return Na(this.sessionId)}async run(t,a,u){Je();let i=[],c=[];Object.entries(t).forEach(T=>{let E=T[0],B=T[1],P=this.inputNames.indexOf(E);if(P===-1)throw new Error(`invalid input '${E}'`);i.push(B),c.push(P)});let l=[],d=[];Object.entries(a).forEach(T=>{let E=T[0],B=T[1],P=this.outputNames.indexOf(E);if(P===-1)throw new Error(`invalid output '${E}'`);l.push(B),d.push(P)});let h=i.map((T,E)=>Ga(T,()=>`input "${this.inputNames[c[E]]}"`)),g=l.map((T,E)=>T?Ga(T,()=>`output "${this.outputNames[d[E]]}"`):null),y=await Wa(this.sessionId,c,h,d,g,u),w={};for(let T=0;T<y.length;T++)w[this.outputNames[d[T]]]=l[T]??Au(y[T]);return Xe(),w}startProfiling(){}endProfiling(){Fa(this.sessionId)}}});var ja={};bt(ja,{OnnxruntimeWebAssemblyBackend:()=>fr,initializeFlags:()=>za,wasmBackend:()=>Iu});var za,fr,Iu,Va=R(()=>{"use strict";ke();on();$a();za=()=>{(typeof Z.wasm.initTimeout!="number"||Z.wasm.initTimeout<0)&&(Z.wasm.initTimeout=0);let o=Z.wasm.simd;if(typeof o!="boolean"&&o!==void 0&&o!=="fixed"&&o!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${o}". Reset it to \`false\` and ignore SIMD feature checking.`),Z.wasm.simd=!1),typeof Z.wasm.proxy!="boolean"&&(Z.wasm.proxy=!1),typeof Z.wasm.trace!="boolean"&&(Z.wasm.trace=!1),typeof Z.wasm.numThreads!="number"||!Number.isInteger(Z.wasm.numThreads)||Z.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Z.wasm.numThreads=1;else{let t=typeof navigator>"u"?kr("node:os").cpus().length:navigator.hardwareConcurrency;Z.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},fr=class{async init(t){za(),await Pa(),await Ua(t)}async createInferenceSessionHandler(t,a){let u=new ur;return await u.loadModel(t,a),u}},Iu=new fr});ke();ke();ke();var Ko="1.24.0-dev.20251227-38355ba07c";var Ac=zr;{let o=(Va(),kt(ja)).wasmBackend;qe("webgpu",o,5),qe("webnn",o,5),qe("cpu",o,10),qe("wasm",o,10)}Object.defineProperty(Z.versions,"web",{value:Ko,enumerable:!0});export{eu as InferenceSession,Vo as TRACE,Ue as TRACE_EVENT_BEGIN,Re as TRACE_EVENT_END,Je as TRACE_FUNC_BEGIN,Xe as TRACE_FUNC_END,Te as Tensor,Ac as default,Z as env,qe as registerBackend};
//# sourceMappingURL=ort.jspi.bundle.min.mjs.map
