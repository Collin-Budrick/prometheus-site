/*!
 * ONNX Runtime Web v1.24.0-dev.20251116-b39e144322
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var Pr=Object.defineProperty;var Yi=Object.getOwnPropertyDescriptor;var Ji=Object.getOwnPropertyNames;var Xi=Object.prototype.hasOwnProperty;var Ur=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(t,a)=>(typeof require<"u"?require:t)[a]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var U=(o,t)=>()=>(o&&(t=o(o=0)),t);var Tt=(o,t)=>{for(var a in t)Pr(o,a,{get:t[a],enumerable:!0})},Zi=(o,t,a,f)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ji(t))!Xi.call(o,s)&&s!==a&&Pr(o,s,{get:()=>t[s],enumerable:!(f=Yi(t,s))||f.enumerable});return o};var Ut=o=>Zi(Pr({},"__esModule",{value:!0}),o);var Rt,Je,Xe,Qi,So,Rr=U(()=>{"use strict";Rt=new Map,Je=[],Xe=(o,t,a)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let f=Rt.get(o);if(f===void 0)Rt.set(o,{backend:t,priority:a});else{if(f.priority>a)return;if(f.priority===a&&f.backend!==t)throw new Error(`cannot register backend "${o}" using priority ${a}`)}if(a>=0){let s=Je.indexOf(o);s!==-1&&Je.splice(s,1);for(let c=0;c<Je.length;c++)if(Rt.get(Je[c]).priority<=a){Je.splice(c,0,o);return}Je.push(o)}return}throw new TypeError("not a valid backend")},Qi=async o=>{let t=Rt.get(o);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let a=!!t.initPromise;try{return a||(t.initPromise=t.backend.init(o)),await t.initPromise,t.initialized=!0,t.backend}catch(f){return a||(t.error=`${f}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},So=async o=>{let t=o.executionProviders||[],a=t.map(h=>typeof h=="string"?h:h.name),f=a.length===0?Je:a,s,c=[],l=new Set;for(let h of f){let g=await Qi(h);typeof g=="string"?c.push({name:h,err:g}):(s||(s=g),s===g&&l.add(h))}if(!s)throw new Error(`no available backend found. ERR: ${c.map(h=>`[${h.name}] ${h.err}`).join(", ")}`);for(let{name:h,err:g}of c)a.includes(h)&&console.warn(`removing requested execution provider "${h}" from session options because it is not available: ${g}`);let d=t.filter(h=>l.has(typeof h=="string"?h:h.name));return[s,new Proxy(o,{get:(h,g)=>g==="executionProviders"?d:Reflect.get(h,g)})]}});var Ao=U(()=>{"use strict";Rr()});var Io,xo=U(()=>{"use strict";Io="1.24.0-dev.20251116-b39e144322"});var Oo,K,kr=U(()=>{"use strict";xo();Oo="warning",K={wasm:{},webgl:{},webgpu:{},versions:{common:Io},set logLevel(o){if(o!==void 0){if(typeof o!="string"||["verbose","info","warning","error","fatal"].indexOf(o)===-1)throw new Error(`Unsupported logging level: ${o}`);Oo=o}},get logLevel(){return Oo}};Object.defineProperty(K,"logLevel",{enumerable:!0})});var q,Lo=U(()=>{"use strict";kr();q=K});var Bo,Co,Mo=U(()=>{"use strict";Bo=(o,t)=>{let a=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);a.width=o.dims[3],a.height=o.dims[2];let f=a.getContext("2d");if(f!=null){let s,c;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(s=o.dims[2],c=o.dims[3]):(s=o.dims[3],c=o.dims[2]);let l=t?.format!==void 0?t.format:"RGB",d=t?.norm,h,g;d===void 0||d.mean===void 0?h=[255,255,255,255]:typeof d.mean=="number"?h=[d.mean,d.mean,d.mean,d.mean]:(h=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(h[3]=d.mean[3])),d===void 0||d.bias===void 0?g=[0,0,0,0]:typeof d.bias=="number"?g=[d.bias,d.bias,d.bias,d.bias]:(g=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(g[3]=d.bias[3]));let b=c*s,y=0,v=b,_=b*2,L=-1;l==="RGBA"?(y=0,v=b,_=b*2,L=b*3):l==="RGB"?(y=0,v=b,_=b*2):l==="RBG"&&(y=0,_=b,v=b*2);for(let D=0;D<c;D++)for(let $=0;$<s;$++){let C=(o.data[y++]-g[0])*h[0],B=(o.data[v++]-g[1])*h[1],j=(o.data[_++]-g[2])*h[2],M=L===-1?255:(o.data[L++]-g[3])*h[3];f.fillStyle="rgba("+C+","+B+","+j+","+M+")",f.fillRect($,D,1,1)}if("toDataURL"in a)return a.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Co=(o,t)=>{let a=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),f;if(a!=null){let s,c,l;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(s=o.dims[2],c=o.dims[1],l=o.dims[3]):(s=o.dims[3],c=o.dims[2],l=o.dims[1]);let d=t!==void 0&&t.format!==void 0?t.format:"RGB",h=t?.norm,g,b;h===void 0||h.mean===void 0?g=[255,255,255,255]:typeof h.mean=="number"?g=[h.mean,h.mean,h.mean,h.mean]:(g=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(g[3]=h.mean[3])),h===void 0||h.bias===void 0?b=[0,0,0,0]:typeof h.bias=="number"?b=[h.bias,h.bias,h.bias,h.bias]:(b=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(b[3]=h.bias[3]));let y=c*s;if(t!==void 0&&(t.format!==void 0&&l===4&&t.format!=="RGBA"||l===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let v=4,_=0,L=1,D=2,$=3,C=0,B=y,j=y*2,M=-1;d==="RGBA"?(C=0,B=y,j=y*2,M=y*3):d==="RGB"?(C=0,B=y,j=y*2):d==="RBG"&&(C=0,j=y,B=y*2),f=a.createImageData(s,c);for(let P=0;P<c*s;_+=v,L+=v,D+=v,$+=v,P++)f.data[_]=(o.data[C++]-b[0])*g[0],f.data[L]=(o.data[B++]-b[1])*g[1],f.data[D]=(o.data[j++]-b[2])*g[2],f.data[$]=M===-1?255:(o.data[M++]-b[3])*g[3]}else throw new Error("Can not access image data");return f}});var Nr,Do,Po,Uo,Ro,ko,No=U(()=>{"use strict";kt();Nr=(o,t)=>{if(o===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:a,width:f}=t,s=t.norm??{mean:255,bias:0},c,l;typeof s.mean=="number"?c=[s.mean,s.mean,s.mean,s.mean]:c=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?l=[s.bias,s.bias,s.bias,s.bias]:l=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let d=t.format!==void 0?t.format:"RGBA",h=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",g=a*f,b=h==="RGBA"?new Float32Array(g*4):new Float32Array(g*3),y=4,v=0,_=1,L=2,D=3,$=0,C=g,B=g*2,j=-1;d==="RGB"&&(y=3,v=0,_=1,L=2,D=-1),h==="RGBA"?j=g*3:h==="RBG"?($=0,B=g,C=g*2):h==="BGR"&&(B=0,C=g,$=g*2);for(let P=0;P<g;P++,v+=y,L+=y,_+=y,D+=y)b[$++]=(o[v]+l[0])/c[0],b[C++]=(o[_]+l[1])/c[1],b[B++]=(o[L]+l[2])/c[2],j!==-1&&D!==-1&&(b[j++]=(o[D]+l[3])/c[3]);return h==="RGBA"?new oe("float32",b,[1,4,a,f]):new oe("float32",b,[1,3,a,f])},Do=async(o,t)=>{let a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,f=typeof ImageData<"u"&&o instanceof ImageData,s=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,c=typeof o=="string",l,d=t??{},h=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},g=b=>typeof HTMLCanvasElement<"u"&&b instanceof HTMLCanvasElement||b instanceof OffscreenCanvas?b.getContext("2d"):null;if(a){let b=h();b.width=o.width,b.height=o.height;let y=g(b);if(y!=null){let v=o.height,_=o.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(v=t.resizedHeight,_=t.resizedWidth),t!==void 0){if(d=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=v,d.width=_}else d.tensorFormat="RGBA",d.height=v,d.width=_;y.drawImage(o,0,0),l=y.getImageData(0,0,_,v).data}else throw new Error("Can not access image data")}else if(f){let b,y;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(b=t.resizedHeight,y=t.resizedWidth):(b=o.height,y=o.width),t!==void 0&&(d=t),d.format="RGBA",d.height=b,d.width=y,t!==void 0){let v=h();v.width=y,v.height=b;let _=g(v);if(_!=null)_.putImageData(o,0,0),l=_.getImageData(0,0,y,b).data;else throw new Error("Can not access image data")}else l=o.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let b=h();b.width=o.width,b.height=o.height;let y=g(b);if(y!=null){let v=o.height,_=o.width;return y.drawImage(o,0,0,_,v),l=y.getImageData(0,0,_,v).data,d.height=v,d.width=_,Nr(l,d)}else throw new Error("Can not access image data")}else{if(c)return new Promise((b,y)=>{let v=h(),_=g(v);if(!o||!_)return y();let L=new Image;L.crossOrigin="Anonymous",L.src=o,L.onload=()=>{v.width=L.width,v.height=L.height,_.drawImage(L,0,0,v.width,v.height);let D=_.getImageData(0,0,v.width,v.height);d.height=v.height,d.width=v.width,b(Nr(D.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(l!==void 0)return Nr(l,d);throw new Error("Input data provided is not supported - aborted tensor creation")},Po=(o,t)=>{let{width:a,height:f,download:s,dispose:c}=t,l=[1,f,a,4];return new oe({location:"texture",type:"float32",texture:o,dims:l,download:s,dispose:c})},Uo=(o,t)=>{let{dataType:a,dims:f,download:s,dispose:c}=t;return new oe({location:"gpu-buffer",type:a??"float32",gpuBuffer:o,dims:f,download:s,dispose:c})},Ro=(o,t)=>{let{dataType:a,dims:f,download:s,dispose:c}=t;return new oe({location:"ml-tensor",type:a??"float32",mlTensor:o,dims:f,download:s,dispose:c})},ko=(o,t,a)=>new oe({location:"cpu-pinned",type:o,data:t,dims:a??[t.length]})});var Ze,vt,Wo,Fo,Go=U(()=>{"use strict";Ze=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),vt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Wo=!1,Fo=()=>{if(!Wo){Wo=!0;let o=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,a=globalThis.Float16Array,f=typeof a<"u"&&a.from;o&&(Ze.set("int64",BigInt64Array),vt.set(BigInt64Array,"int64")),t&&(Ze.set("uint64",BigUint64Array),vt.set(BigUint64Array,"uint64")),f?(Ze.set("float16",a),vt.set(a,"float16")):Ze.set("float16",Uint16Array)}}});var $o,zo,jo=U(()=>{"use strict";kt();$o=o=>{let t=1;for(let a=0;a<o.length;a++){let f=o[a];if(typeof f!="number"||!Number.isSafeInteger(f))throw new TypeError(`dims[${a}] must be an integer, got: ${f}`);if(f<0)throw new RangeError(`dims[${a}] must be a non-negative integer, got: ${f}`);t*=f}return t},zo=(o,t)=>{switch(o.location){case"cpu":return new oe(o.type,o.data,t);case"cpu-pinned":return new oe({location:"cpu-pinned",data:o.data,type:o.type,dims:t});case"texture":return new oe({location:"texture",texture:o.texture,type:o.type,dims:t});case"gpu-buffer":return new oe({location:"gpu-buffer",gpuBuffer:o.gpuBuffer,type:o.type,dims:t});case"ml-tensor":return new oe({location:"ml-tensor",mlTensor:o.mlTensor,type:o.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${o.location} is not supported`)}}});var oe,kt=U(()=>{"use strict";Mo();No();Go();jo();oe=class{constructor(t,a,f){Fo();let s,c;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,s=t.type,c=t.dims,t.location){case"cpu-pinned":{let d=Ze.get(s);if(!d)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(t.data instanceof d))throw new TypeError(`buffer should be of type ${d.name}`);this.cpuData=t.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let d,h;if(typeof t=="string")if(s=t,h=f,t==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");d=a}else{let g=Ze.get(t);if(g===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(a)){if(t==="float16"&&g===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${g.name} as data.`);t==="uint64"||t==="int64"?d=g.from(a,BigInt):d=g.from(a)}else if(a instanceof g)d=a;else if(a instanceof Uint8ClampedArray)if(t==="uint8")d=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&a instanceof Uint16Array&&g!==Uint16Array)d=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${s} tensor's data must be type of ${g}`)}else if(h=a,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let g=typeof t[0];if(g==="string")s="string",d=t;else if(g==="boolean")s="bool",d=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${g}.`)}else if(t instanceof Uint8ClampedArray)s="uint8",d=Uint8Array.from(t);else{let g=vt.get(t.constructor);if(g===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);s=g,d=t}if(h===void 0)h=[d.length];else if(!Array.isArray(h))throw new TypeError("A tensor's dims must be a number array");c=h,this.cpuData=d,this.dataLocation="cpu"}let l=$o(c);if(this.cpuData&&l!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(l/2)===this.cpuData.length))throw new Error(`Tensor's size(${l}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=c,this.size=l}static async fromImage(t,a){return Do(t,a)}static fromTexture(t,a){return Po(t,a)}static fromGpuBuffer(t,a){return Uo(t,a)}static fromMLTensor(t,a){return Ro(t,a)}static fromPinnedBuffer(t,a,f){return ko(t,a,f)}toDataURL(t){return Bo(this,t)}toImageData(t){return Co(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,t&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return zo(this,t)}}});var Ee,Wr=U(()=>{"use strict";kt();Ee=oe});var Vo,Ho,Qe,Ke,Fe,Ge,Fr=U(()=>{"use strict";kr();Vo=(o,t)=>{(typeof K.trace>"u"?!K.wasm.trace:!K.trace)||console.timeStamp(`${o}::ORT::${t}`)},Ho=(o,t)=>{let a=new Error().stack?.split(/\r\n|\r|\n/g)||[],f=!1;for(let s=0;s<a.length;s++){if(f&&!a[s].includes("TRACE_FUNC")){let c=`FUNC_${o}::${a[s].trim().split(" ")[1]}`;t&&(c+=`::${t}`),Vo("CPU",c);return}a[s].includes("TRACE_FUNC")&&(f=!0)}},Qe=o=>{(typeof K.trace>"u"?!K.wasm.trace:!K.trace)||Ho("BEGIN",o)},Ke=o=>{(typeof K.trace>"u"?!K.wasm.trace:!K.trace)||Ho("END",o)},Fe=o=>{(typeof K.trace>"u"?!K.wasm.trace:!K.trace)||console.time(`ORT::${o}`)},Ge=o=>{(typeof K.trace>"u"?!K.wasm.trace:!K.trace)||console.timeEnd(`ORT::${o}`)}});var Nt,qo=U(()=>{"use strict";Rr();Wr();Fr();Nt=class o{constructor(t){this.handler=t}async run(t,a,f){Qe(),Fe("InferenceSession.run");let s={},c={};if(typeof t!="object"||t===null||t instanceof Ee||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let l=!0;if(typeof a=="object"){if(a===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(a instanceof Ee)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(a)){if(a.length===0)throw new TypeError("'fetches' cannot be an empty array.");l=!1;for(let g of a){if(typeof g!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(g)===-1)throw new RangeError(`'fetches' contains invalid output name: ${g}.`);s[g]=null}if(typeof f=="object"&&f!==null)c=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else{let g=!1,b=Object.getOwnPropertyNames(a);for(let y of this.outputNames)if(b.indexOf(y)!==-1){let v=a[y];(v===null||v instanceof Ee)&&(g=!0,l=!1,s[y]=v)}if(g){if(typeof f=="object"&&f!==null)c=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else c=a}}else if(typeof a<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let g of this.inputNames)if(typeof t[g]>"u")throw new Error(`input '${g}' is missing in 'feeds'.`);if(l)for(let g of this.outputNames)s[g]=null;let d=await this.handler.run(t,s,c),h={};for(let g in d)if(Object.hasOwnProperty.call(d,g)){let b=d[g];b instanceof Ee?h[g]=b:h[g]=new Ee(b.type,b.data,b.dims)}return Ge("InferenceSession.run"),Ke(),h}async release(){return this.handler.dispose()}static async create(t,a,f,s){Qe(),Fe("InferenceSession.create");let c,l={};if(typeof t=="string"){if(c=t,typeof a=="object"&&a!==null)l=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(c=t,typeof a=="object"&&a!==null)l=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let b=t,y=0,v=t.byteLength;if(typeof a=="object"&&a!==null)l=a;else if(typeof a=="number"){if(y=a,!Number.isSafeInteger(y))throw new RangeError("'byteOffset' must be an integer.");if(y<0||y>=b.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${b.byteLength}).`);if(v=t.byteLength-y,typeof f=="number"){if(v=f,!Number.isSafeInteger(v))throw new RangeError("'byteLength' must be an integer.");if(v<=0||y+v>b.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${b.byteLength-y}].`);if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof f<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof a<"u")throw new TypeError("'options' must be an object.");c=new Uint8Array(b,y,v)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,h]=await So(l),g=await d.createInferenceSessionHandler(c,h);return Ge("InferenceSession.create"),Ke(),new o(g)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var Ki,Yo=U(()=>{"use strict";qo();Ki=Nt});var Jo=U(()=>{"use strict"});var Xo=U(()=>{"use strict"});var Zo=U(()=>{"use strict"});var Qo=U(()=>{"use strict"});var Gr={};Tt(Gr,{InferenceSession:()=>Ki,TRACE:()=>Vo,TRACE_EVENT_BEGIN:()=>Fe,TRACE_EVENT_END:()=>Ge,TRACE_FUNC_BEGIN:()=>Qe,TRACE_FUNC_END:()=>Ke,Tensor:()=>Ee,env:()=>q,registerBackend:()=>Xe});var $e=U(()=>{"use strict";Ao();Lo();Yo();Wr();Jo();Xo();Fr();Zo();Qo()});var Wt=U(()=>{"use strict"});var ra={};Tt(ra,{default:()=>eu});var ea,ta,eu,na=U(()=>{"use strict";$r();ze();Ft();ea="ort-wasm-proxy-worker",ta=globalThis.self?.name===ea;ta&&(self.onmessage=o=>{let{type:t,in:a}=o.data;try{switch(t){case"init-wasm":Gt(a.wasm).then(()=>{$t(a).then(()=>{postMessage({type:t})},f=>{postMessage({type:t,err:f})})},f=>{postMessage({type:t,err:f})});break;case"init-ep":{let{epName:f,env:s}=a;zt(s,f).then(()=>{postMessage({type:t})},c=>{postMessage({type:t,err:c})});break}case"copy-from":{let{buffer:f}=a,s=Et(f);postMessage({type:t,out:s});break}case"create":{let{model:f,options:s}=a;jt(f,s).then(c=>{postMessage({type:t,out:c})},c=>{postMessage({type:t,err:c})});break}case"release":Vt(a),postMessage({type:t});break;case"run":{let{sessionId:f,inputIndices:s,inputs:c,outputIndices:l,options:d}=a;Ht(f,s,c,l,new Array(l.length).fill(null),d).then(h=>{h.some(g=>g[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:h},Yt([...c,...h]))},h=>{postMessage({type:t,err:h})});break}case"end-profiling":qt(a),postMessage({type:t});break;default:}}catch(f){postMessage({type:t,err:f})}});eu=ta?null:o=>new Worker(o??he,{type:"module",name:ea})});var aa={};Tt(aa,{default:()=>tu});async function oa(o={}){var t=o,a=typeof window=="object",f=typeof WorkerGlobalScope<"u",s=f&&self.name?.startsWith("em-pthread");t.mountExternalData=(e,r)=>{e.startsWith("./")&&(e=e.substring(2)),(t.o||(t.o=new Map)).set(e,r)},t.unmountExternalData=()=>{delete t.o};var c,l,d=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,$:!0}).buffer.constructor,h=(e,r)=>{throw r},g=import.meta.url,b="";if(a||f){try{b=new URL(".",g).href}catch{}f&&(l=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),c=async e=>{if(se(e))return new Promise((n,i)=>{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=()=>{u.status==200||u.status==0&&u.response?n(u.response):i(u.status)},u.onerror=i,u.send(null)});var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw Error(r.status+" : "+r.url)}}var y,v,_,L,D,$,C,B=console.log.bind(console),j=console.error.bind(console),M=B,P=j,Y=!1,se=e=>e.startsWith("file://");function p(){te.buffer!=Oe.buffer&&mt()}if(s){var ee=!1;async function e(r){try{var n=r.data,i=n.i;if(i==="load"){let u=[];self.onmessage=m=>u.push(m),C=()=>{postMessage({i:"loaded"});for(let m of u)e(m);self.onmessage=e};for(let m of n.K)t[m]&&!t[m].proxy||(t[m]=(...T)=>{postMessage({i:"callHandler",J:m,args:T})},m=="print"&&(M=t[m]),m=="printErr"&&(P=t[m]));te=n.T,mt(),$(n.U)}else if(i==="run"){(function(u){var m=(p(),S)[u+52>>>2>>>0];u=(p(),S)[u+56>>>2>>>0],_o(m,m-u),de(m)})(n.h),Br(n.h,0,0,1,0,0),sn(),hr(n.h),ee||(no(),ee=!0);try{await Ha(n.P,n.u)}catch(u){if(u!="unwind")throw u}}else n.target!=="setimmediate"&&(i==="checkMailbox"?ee&&xt():i&&(P(`worker: received unknown command ${i}`),P(n)))}catch(u){throw yo(),u}}self.onunhandledrejection=r=>{throw r.reason||r},self.onmessage=e}var te,Oe,R,ie,_e,E,S,Pe,F,J,X,Q=!1;function mt(){var e=te.buffer;t.HEAP8=Oe=new Int8Array(e),ie=new Int16Array(e),t.HEAPU8=R=new Uint8Array(e),_e=new Uint16Array(e),t.HEAP32=E=new Int32Array(e),t.HEAPU32=S=new Uint32Array(e),Pe=new Float32Array(e),F=new Float64Array(e),J=new BigInt64Array(e),X=new BigUint64Array(e)}function st(){Q=!0,s?C():De.__wasm_call_ctors()}var Ue,Re=0,Ve=null;function we(){if(--Re==0&&Ve){var e=Ve;Ve=null,e()}}function ue(e){throw P(e="Aborted("+e+")"),Y=!0,e+=". Build with -sASSERTIONS for more info.",Q&&Eo(),e=new WebAssembly.RuntimeError(e),D?.(e),e}function ke(){if(!(bt={HaveOffsetConverter:Hi,__pthread_create_js:pn,__syscall_fcntl64:gn,__syscall_fstat64:yn,__syscall_getcwd:wn,__syscall_getdents64:bn,__syscall_ioctl:Tn,__syscall_lstat64:vn,__syscall_mkdirat:En,__syscall_newfstatat:_n,__syscall_openat:Sn,__syscall_readlinkat:An,__syscall_rmdir:In,__syscall_stat64:xn,__syscall_unlinkat:On,_abort_js:qa,_embind_register_bigint:Ja,_embind_register_bool:Xa,_embind_register_emval:Qa,_embind_register_float:es,_embind_register_integer:ts,_embind_register_memory_view:rs,_embind_register_std_string:ns,_embind_register_std_wstring:cs,_embind_register_void:ls,_emscripten_init_main_thread_js:ps,_emscripten_notify_mailbox_postmessage:ds,_emscripten_receive_on_main_thread_js:ms,_emscripten_runtime_keepalive_clear:hs,_emscripten_thread_cleanup:gs,_emscripten_thread_mailbox_await:hr,_emscripten_thread_set_strongref:ys,_emval_await:Pn,_emval_create_invoker:_s,_emval_decref:dr,_emval_equals:Ss,_emval_get_global:As,_emval_get_module_property:Is,_emval_get_property:xs,_emval_incref:Os,_emval_invoke:Un,_emval_invoke_i64:Un,_emval_new_array:Ls,_emval_new_array_from_memory_view:Bs,_emval_new_cstring:Cs,_emval_new_object:Ms,_emval_run_destructors:Ds,_emval_set_property:Ps,_gmtime_js:Us,_localtime_js:Rs,_mktime_js:ks,_mmap_js:Wn,_munmap_js:Fn,_setitimer_js:Gn,_tzset_js:Ws,clock_time_get:$s,emscripten_asm_const_int:zs,emscripten_asm_const_ptr:js,emscripten_check_blocking_allowed:Vs,emscripten_date_now:Fs,emscripten_errn:Hs,emscripten_exit_with_live_runtime:qs,emscripten_get_heap_max:Ys,emscripten_get_now:Ns,emscripten_has_asyncify:Js,emscripten_num_logical_cores:Xs,emscripten_pc_get_function:Bt,emscripten_resize_heap:Zs,emscripten_stack_snapshot:Qs,emscripten_stack_unwind_buffer:Ks,emwgpuAdapterRequestDevice:si,emwgpuBufferDestroy:ii,emwgpuBufferGetConstMappedRange:ui,emwgpuBufferGetMappedRange:fi,emwgpuBufferMapAsync:ci,emwgpuBufferUnmap:li,emwgpuDelete:pi,emwgpuDeviceCreateBuffer:di,emwgpuDeviceCreateComputePipelineAsync:mi,emwgpuDeviceCreateShaderModule:hi,emwgpuDeviceDestroy:gi,emwgpuDevicePopErrorScope:yi,emwgpuInstanceRequestAdapter:wi,emwgpuWaitAny:Yn,environ_get:Xn,environ_sizes_get:Zn,exit:fr,fd_close:Qn,fd_read:Kn,fd_seek:eo,fd_write:to,memory:te,proc_exit:ur,wgpuAdapterGetLimits:Ti,wgpuAdapterHasFeature:vi,wgpuBufferGetSize:Ei,wgpuBufferGetUsage:_i,wgpuCommandEncoderBeginComputePass:Si,wgpuCommandEncoderCopyBufferToBuffer:Ai,wgpuCommandEncoderFinish:Ii,wgpuCommandEncoderResolveQuerySet:xi,wgpuComputePassEncoderDispatchWorkgroups:Oi,wgpuComputePassEncoderDispatchWorkgroupsIndirect:Li,wgpuComputePassEncoderEnd:Bi,wgpuComputePassEncoderSetBindGroup:Ci,wgpuComputePassEncoderSetPipeline:Mi,wgpuComputePassEncoderWriteTimestamp:Di,wgpuComputePipelineGetBindGroupLayout:Pi,wgpuDeviceCreateBindGroup:Ui,wgpuDeviceCreateCommandEncoder:Ri,wgpuDeviceCreateQuerySet:ki,wgpuDeviceGetAdapterInfo:Ni,wgpuDeviceGetFeatures:Fi,wgpuDeviceGetLimits:Gi,wgpuDevicePushErrorScope:$i,wgpuQueueSubmit:zi,wgpuQueueWriteBuffer:ji}).I){bt.I=!0;var e=bt,r=/^(invoke_.*|__asyncjs__.*)$/;for(let[n,i]of Object.entries(e))typeof i=="function"&&(i.A||r.test(n))&&(e[n]=i=new WebAssembly.Suspending(i))}return{env:bt,wasi_snapshot_preview1:bt}}class Z{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var H=e=>{e.terminate(),e.onmessage=()=>{}},be=[],Ne=e=>{We.length==0&&(fn(),un(We[0]));var r=We.pop();if(!r)return 6;ht.push(r),He[e.h]=r,r.h=e.h;var n={i:"run",P:e.O,u:e.u,h:e.h};return r.postMessage(n,e.D),0},z=0,V=(e,r,...n)=>{for(var i=2*n.length,u=me(),m=Pt(8*i),T=m>>>3,w=0;w<n.length;w++){var A=n[w];typeof A=="bigint"?((p(),J)[T+2*w>>>0]=1n,(p(),J)[T+2*w+1>>>0]=A):((p(),J)[T+2*w>>>0]=0n,(p(),F)[T+2*w+1>>>0]=A)}return e=wo(e,0,i,m,r),de(u),e};function ur(e){if(s)return V(0,1,e);if(_=e,!(0<z)){for(var r of ht)H(r);for(r of We)H(r);We=[],ht=[],He={},Y=!0}h(0,new Z(e))}function nn(e){if(s)return V(1,0,e);fr(e)}var fr=e=>{if(_=e,s)throw nn(e),"unwind";ur(e)},We=[],ht=[],on=[],He={},an=e=>{var r=e.h;delete He[r],We.push(e),ht.splice(ht.indexOf(e),1),e.h=0,bo(r)};function sn(){on.forEach(e=>e())}var un=e=>new Promise(r=>{e.onmessage=u=>{var m=(u=u.data).i;if(u.s&&u.s!=Sr()){var T=He[u.s];T?T.postMessage(u,u.D):P(`Internal error! Worker sent a message "${m}" to target pthread ${u.s}, but that thread no longer exists!`)}else m==="checkMailbox"?xt():m==="spawnThread"?Ne(u):m==="cleanupThread"?an(He[u.R]):m==="loaded"?(e.loaded=!0,r(e)):u.target==="setimmediate"?e.postMessage(u):m==="callHandler"?t[u.J](...u.args):m&&P(`worker sent an unknown command ${m}`)},e.onerror=u=>{throw P(`worker sent an error! ${u.filename}:${u.lineno}: ${u.message}`),u};var n,i=[];for(n of[])t.propertyIsEnumerable(n)&&i.push(n);e.postMessage({i:"load",K:i,T:te,U:v})});function fn(){var e=new Worker((()=>{let r=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new r("ort.jspi.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});We.push(e)}var cn,cr=[],Ha=async(e,r)=>{z=0;var n=WebAssembly,i=n.promising,u=cr[e];u||(cr[e]=u=cn.get(e),gr?.has(u)&&(cr[e]=u=WebAssembly.promising(u))),e=i.call(n,u)(r),e=await e,0<z?_=e:Cr(e)};function ln(e,r,n,i){return s?V(2,1,e,r,n,i):pn(e,r,n,i)}var ce=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function pn(e,r,n,i){if(e>>>=0,n>>>=0,i>>>=0,d===void 0)return 6;var u=[];return s&&u.length===0?ln(e,r>>>=0,n,i):(e={O:n,h:e,u:i,D:u},s?(e.i="spawnThread",postMessage(e,u),0):Ne(e))}var dn=typeof TextDecoder<"u"?new TextDecoder:void 0,mn=(e,r,n,i)=>{if(n=r+n,i)return n;for(;e[r]&&!(r>=n);)++r;return r},hn=(e,r=0,n,i)=>{if(16<(n=mn(e,r>>>=0,n,i))-r&&e.buffer&&dn)return dn.decode(e.buffer instanceof ArrayBuffer?e.subarray(r,n):e.slice(r,n));for(i="";r<n;){var u=e[r++];if(128&u){var m=63&e[r++];if((224&u)==192)i+=String.fromCharCode((31&u)<<6|m);else{var T=63&e[r++];65536>(u=(240&u)==224?(15&u)<<12|m<<6|T:(7&u)<<18|m<<12|T<<6|63&e[r++])?i+=String.fromCharCode(u):(u-=65536,i+=String.fromCharCode(55296|u>>10,56320|1023&u))}}else i+=String.fromCharCode(u)}return i},it=(e,r,n)=>(e>>>=0)?hn((p(),R),e,r,n):"";function gn(e,r,n){return s?V(3,1,e,r,n):0}function yn(e,r){if(s)return V(4,1,e,r)}function wn(e,r){if(s)return V(5,1,e,r)}function bn(e,r,n){if(s)return V(6,1,e,r,n)}function Tn(e,r,n){return s?V(7,1,e,r,n):0}function vn(e,r){if(s)return V(8,1,e,r)}function En(e,r,n){if(s)return V(9,1,e,r,n)}function _n(e,r,n,i){if(s)return V(10,1,e,r,n,i)}function Sn(e,r,n,i){if(s)return V(11,1,e,r,n,i)}function An(e,r,n,i){if(s)return V(12,1,e,r,n,i)}function In(e){if(s)return V(13,1,e)}function xn(e,r){if(s)return V(14,1,e,r)}function On(e,r,n){if(s)return V(15,1,e,r,n)}var qa=()=>ue(""),Se=e=>{e>>>=0;for(var r="";;){var n=(p(),R)[e++>>>0];if(!n)return r;r+=String.fromCharCode(n)}},lr={},pr={},Ya={},ut=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Le(e,r,n={}){return function(i,u,m={}){var T=u.name;if(!i)throw new ut(`type "${T}" must have a positive integer typeid pointer`);if(pr.hasOwnProperty(i)){if(m.L)return;throw new ut(`Cannot register type '${T}' twice`)}pr[i]=u,delete Ya[i],lr.hasOwnProperty(i)&&(u=lr[i],delete lr[i],u.forEach(w=>w()))}(e,r,n)}var Ln=(e,r,n)=>{switch(r){case 1:return n?i=>(p(),Oe)[i>>>0]:i=>(p(),R)[i>>>0];case 2:return n?i=>(p(),ie)[i>>>1>>>0]:i=>(p(),_e)[i>>>1>>>0];case 4:return n?i=>(p(),E)[i>>>2>>>0]:i=>(p(),S)[i>>>2>>>0];case 8:return n?i=>(p(),J)[i>>>3>>>0]:i=>(p(),X)[i>>>3>>>0];default:throw new TypeError(`invalid integer width (${r}): ${e}`)}};function Ja(e,r,n,i,u){e>>>=0,n>>>=0,r=Se(r>>>0);let m=T=>T;if(i=i===0n){let T=8*n;m=w=>BigInt.asUintN(T,w),u=m(u)}Le(e,{name:r,g:m,l:(T,w)=>(typeof w=="number"&&(w=BigInt(w)),w),j:Ln(r,n,!i),m:null})}function Xa(e,r,n,i){Le(e>>>=0,{name:r=Se(r>>>0),g:function(u){return!!u},l:function(u,m){return m?n:i},j:function(u){return this.g((p(),R)[u>>>0])},m:null})}var Bn=[],qe=[0,1,,1,null,1,!0,1,!1,1];function dr(e){9<(e>>>=0)&&--qe[e+1]==0&&(qe[e]=void 0,Bn.push(e))}var ge=e=>{if(!e)throw new ut(`Cannot use deleted val. handle = ${e}`);return qe[e]},Te=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let r=Bn.pop()||qe.length;return qe[r]=e,qe[r+1]=1,r}};function mr(e){return this.g((p(),S)[e>>>2>>>0])}var Za={name:"emscripten::val",g:e=>{var r=ge(e);return dr(e),r},l:(e,r)=>Te(r),j:mr,m:null};function Qa(e){return Le(e>>>0,Za)}var Ka=(e,r)=>{switch(r){case 4:return function(n){return this.g((p(),Pe)[n>>>2>>>0])};case 8:return function(n){return this.g((p(),F)[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${r}): ${e}`)}};function es(e,r,n){n>>>=0,Le(e>>>=0,{name:r=Se(r>>>0),g:i=>i,l:(i,u)=>u,j:Ka(r,n),m:null})}function ts(e,r,n,i,u){e>>>=0,n>>>=0,r=Se(r>>>0);let m=w=>w;if(i===0){var T=32-8*n;m=w=>w<<T>>>T,u=m(u)}Le(e,{name:r,g:m,l:(w,A)=>A,j:Ln(r,n,i!==0),m:null})}function rs(e,r,n){function i(m){var T=(p(),S)[m>>>2>>>0];return m=(p(),S)[m+4>>>2>>>0],new u((p(),Oe).buffer,m,T)}var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][r];Le(e>>>=0,{name:n=Se(n>>>0),g:i,j:i},{L:!0})}var Be=(e,r,n)=>{var i=(p(),R);if(r>>>=0,0<n){var u=r;n=r+n-1;for(var m=0;m<e.length;++m){var T=e.codePointAt(m);if(127>=T){if(r>=n)break;i[r++>>>0]=T}else if(2047>=T){if(r+1>=n)break;i[r++>>>0]=192|T>>6,i[r++>>>0]=128|63&T}else if(65535>=T){if(r+2>=n)break;i[r++>>>0]=224|T>>12,i[r++>>>0]=128|T>>6&63,i[r++>>>0]=128|63&T}else{if(r+3>=n)break;i[r++>>>0]=240|T>>18,i[r++>>>0]=128|T>>12&63,i[r++>>>0]=128|T>>6&63,i[r++>>>0]=128|63&T,m++}}i[r>>>0]=0,e=r-u}else e=0;return e},Ce=e=>{for(var r=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);127>=i?r++:2047>=i?r+=2:55296<=i&&57343>=i?(r+=4,++n):r+=3}return r};function ns(e,r){Le(e>>>=0,{name:r=Se(r>>>0),g(n){var i=(p(),S)[n>>>2>>>0];return i=it(n+4,i,!0),ve(n),i},l(n,i){i instanceof ArrayBuffer&&(i=new Uint8Array(i));var u=typeof i=="string";if(!(u||ArrayBuffer.isView(i)&&i.BYTES_PER_ELEMENT==1))throw new ut("Cannot pass non-string to std::string");var m=u?Ce(i):i.length,T=yt(4+m+1),w=T+4;return(p(),S)[T>>>2>>>0]=m,u?Be(i,w,m+1):(p(),R).set(i,w>>>0),n!==null&&n.push(ve,T),T},j:mr,m(n){ve(n)}})}var Cn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,os=(e,r,n)=>{if(e>>>=1,16<(r=mn((p(),_e),e,r/2,n))-e&&Cn)return Cn.decode((p(),_e).buffer instanceof ArrayBuffer?(p(),_e).subarray(e>>>0,r>>>0):(p(),_e).slice(e,r));for(n="";e<r;++e){var i=(p(),_e)[e>>>0];n+=String.fromCharCode(i)}return n},as=(e,r,n)=>{if(n??=2147483647,2>n)return 0;var i=r;n=(n-=2)<2*e.length?n/2:e.length;for(var u=0;u<n;++u){var m=e.charCodeAt(u);(p(),ie)[r>>>1>>>0]=m,r+=2}return(p(),ie)[r>>>1>>>0]=0,r-i},ss=e=>2*e.length,is=(e,r,n)=>{var i="";e>>>=2;for(var u=0;!(u>=r/4);u++){var m=(p(),S)[e+u>>>0];if(!m&&!n)break;i+=String.fromCodePoint(m)}return i},us=(e,r,n)=>{if(r>>>=0,n??=2147483647,4>n)return 0;var i=r;n=i+n-4;for(var u=0;u<e.length;++u){var m=e.codePointAt(u);if(65535<m&&u++,(p(),E)[r>>>2>>>0]=m,(r+=4)+4>n)break}return(p(),E)[r>>>2>>>0]=0,r-i},fs=e=>{for(var r=0,n=0;n<e.length;++n)65535<e.codePointAt(n)&&n++,r+=4;return r};function cs(e,r,n){if(e>>>=0,r>>>=0,n=Se(n>>>=0),r===2)var i=os,u=as,m=ss;else i=is,u=us,m=fs;Le(e,{name:n,g:T=>{var w=(p(),S)[T>>>2>>>0];return w=i(T+4,w*r,!0),ve(T),w},l:(T,w)=>{if(typeof w!="string")throw new ut(`Cannot pass non-string to C++ string type ${n}`);var A=m(w),I=yt(4+A+r);return(p(),S)[I>>>2>>>0]=A/r,u(w,I+4,A+r),T!==null&&T.push(ve,I),I},j:mr,m(T){ve(T)}})}function ls(e,r){Le(e>>>=0,{M:!0,name:r=Se(r>>>0),g:()=>{},l:()=>{}})}function ps(e){Br(e>>>0,!f,1,!a,131072,!1),sn()}var Mn=e=>{if(!Y)try{if(e(),!(0<z))try{s?Cr(_):fr(_)}catch(r){r instanceof Z||r=="unwind"||h(0,r)}}catch(r){r instanceof Z||r=="unwind"||h(0,r)}};function hr(e){e>>>=0,typeof Atomics.S=="function"&&(Atomics.S((p(),E),e>>>2,e).value.then(xt),e+=128,Atomics.store((p(),E),e>>>2,1))}var xt=()=>{var e=Sr();e&&(hr(e),Mn(vo))};function ds(e,r){(e>>>=0)==r>>>0?setTimeout(xt):s?postMessage({s:e,i:"checkMailbox"}):(e=He[e])&&e.postMessage({i:"checkMailbox"})}var Ot=[];function ms(e,r,n,i,u){for(r>>>=0,i/=2,Ot.length=i,n=u>>>0>>>3,u=0;u<i;u++)(p(),J)[n+2*u>>>0]?Ot[u]=(p(),J)[n+2*u+1>>>0]:Ot[u]=(p(),F)[n+2*u+1>>>0];return(r?Er[r]:Vi[e])(...Ot)}var hs=()=>{z=0};function gs(e){e>>>=0,s?postMessage({i:"cleanupThread",R:e}):an(He[e])}function ys(e){}function ws(e){return(...r)=>e(...r)}var gr=null,Dn=async e=>{z+=1;try{return await e()}finally{--z}};function Pn(e){return e>>>=0,Dn(async()=>{var r=await ge(e);return Te(r)})}Pn.A=!0;var yr=[],bs=e=>{var r=yr.length;return yr.push(e),r},Ts=(e,r)=>{for(var n=Array(e),i=0;i<e;++i){var u=i,m=(p(),S)[r+4*i>>>2>>>0],T=pr[m];if(T===void 0)throw e=`parameter ${i}`,m=ro(m),r=Se(m),ve(m),new ut(`${e} has unknown type ${r}`);n[u]=T}return n},vs=(e,r,n)=>{var i=[];return e=e(i,n),i.length&&((p(),S)[r>>>2>>>0]=Te(i)),e},Es={},Lt=e=>{var r=Es[e];return r===void 0?Se(e):r};function _s(e,r,n){var[i,...u]=Ts(e,r>>>0);r=i.l.bind(i);var m=u.map(A=>A.j.bind(A));e--;var T={toValue:ge};switch(e=m.map((A,I)=>{var k=`argFromPtr${I}`;return T[k]=A,`${k}(args${I?"+"+8*I:""})`}),n){case 0:var w="toValue(handle)";break;case 2:w="new (toValue(handle))";break;case 3:w="";break;case 1:T.getStringOrSymbol=Lt,w="toValue(handle)[getStringOrSymbol(methodName)]"}return w+=`(${e})`,i.M||(T.toReturnWire=r,T.emval_returnValue=vs,w=`return emval_returnValue(toReturnWire, destructorsRef, ${w})`),w=`return function (handle, methodName, destructorsRef, args) {
  ${w}
  }`,n=new Function(Object.keys(T),w)(...Object.values(T)),w=`methodCaller<(${u.map(A=>A.name)}) => ${i.name}>`,bs(Object.defineProperty(n,"name",{value:w}))}function Ss(e,r){return r>>>=0,(e=ge(e>>>0))==ge(r)}function As(e){return(e>>>=0)==0?Te(globalThis):(e=Lt(e),Te(globalThis[e]))}function Is(e){return e=Lt(e>>>0),Te(t[e])}function xs(e,r){return r>>>=0,e=ge(e>>>0),r=ge(r),Te(e[r])}function Os(e){9<(e>>>=0)&&(qe[e+1]+=1)}function Un(e,r,n,i,u){return yr[e>>>0](r>>>0,n>>>0,i>>>0,u>>>0)}function Ls(){return Te([])}function Bs(e){e=ge(e>>>0);for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=e[n];return Te(r)}function Cs(e){return Te(Lt(e>>>0))}function Ms(){return Te({})}function Ds(e){for(var r=ge(e>>>=0);r.length;){var n=r.pop();r.pop()(n)}dr(e)}function Ps(e,r,n){r>>>=0,n>>>=0,e=ge(e>>>0),r=ge(r),n=ge(n),e[r]=n}function Us(e,r){e=ce(e),r>>>=0,e=new Date(1e3*e),(p(),E)[r>>>2>>>0]=e.getUTCSeconds(),(p(),E)[r+4>>>2>>>0]=e.getUTCMinutes(),(p(),E)[r+8>>>2>>>0]=e.getUTCHours(),(p(),E)[r+12>>>2>>>0]=e.getUTCDate(),(p(),E)[r+16>>>2>>>0]=e.getUTCMonth(),(p(),E)[r+20>>>2>>>0]=e.getUTCFullYear()-1900,(p(),E)[r+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(p(),E)[r+28>>>2>>>0]=e}var Rn=e=>e%4==0&&(e%100!=0||e%400==0),kn=[0,31,60,91,121,152,182,213,244,274,305,335],Nn=[0,31,59,90,120,151,181,212,243,273,304,334];function Rs(e,r){e=ce(e),r>>>=0,e=new Date(1e3*e),(p(),E)[r>>>2>>>0]=e.getSeconds(),(p(),E)[r+4>>>2>>>0]=e.getMinutes(),(p(),E)[r+8>>>2>>>0]=e.getHours(),(p(),E)[r+12>>>2>>>0]=e.getDate(),(p(),E)[r+16>>>2>>>0]=e.getMonth(),(p(),E)[r+20>>>2>>>0]=e.getFullYear()-1900,(p(),E)[r+24>>>2>>>0]=e.getDay();var n=(Rn(e.getFullYear())?kn:Nn)[e.getMonth()]+e.getDate()-1|0;(p(),E)[r+28>>>2>>>0]=n,(p(),E)[r+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=i&&e.getTimezoneOffset()==Math.min(i,n)),(p(),E)[r+32>>>2>>>0]=e}function ks(e){e>>>=0;var r=new Date((p(),E)[e+20>>>2>>>0]+1900,(p(),E)[e+16>>>2>>>0],(p(),E)[e+12>>>2>>>0],(p(),E)[e+8>>>2>>>0],(p(),E)[e+4>>>2>>>0],(p(),E)[e>>>2>>>0],0),n=(p(),E)[e+32>>>2>>>0],i=r.getTimezoneOffset(),u=new Date(r.getFullYear(),6,1).getTimezoneOffset(),m=new Date(r.getFullYear(),0,1).getTimezoneOffset(),T=Math.min(m,u);return 0>n?(p(),E)[e+32>>>2>>>0]=+(u!=m&&T==i):0<n!=(T==i)&&(u=Math.max(m,u),r.setTime(r.getTime()+6e4*((0<n?T:u)-i))),(p(),E)[e+24>>>2>>>0]=r.getDay(),n=(Rn(r.getFullYear())?kn:Nn)[r.getMonth()]+r.getDate()-1|0,(p(),E)[e+28>>>2>>>0]=n,(p(),E)[e>>>2>>>0]=r.getSeconds(),(p(),E)[e+4>>>2>>>0]=r.getMinutes(),(p(),E)[e+8>>>2>>>0]=r.getHours(),(p(),E)[e+12>>>2>>>0]=r.getDate(),(p(),E)[e+16>>>2>>>0]=r.getMonth(),(p(),E)[e+20>>>2>>>0]=r.getYear(),e=r.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Wn(e,r,n,i,u,m,T){return s?V(16,1,e,r,n,i,u,m,T):-52}function Fn(e,r,n,i,u,m){if(s)return V(17,1,e,r,n,i,u,m)}var gt={},Ns=()=>performance.timeOrigin+performance.now();function Gn(e,r){if(s)return V(18,1,e,r);if(gt[e]&&(clearTimeout(gt[e].id),delete gt[e]),!r)return 0;var n=setTimeout(()=>{delete gt[e],Mn(()=>To(e,performance.timeOrigin+performance.now()))},r);return gt[e]={id:n,aa:r},0}function Ws(e,r,n,i){e>>>=0,r>>>=0,n>>>=0,i>>>=0;var u=new Date().getFullYear(),m=new Date(u,0,1).getTimezoneOffset();u=new Date(u,6,1).getTimezoneOffset();var T=Math.max(m,u);(p(),S)[e>>>2>>>0]=60*T,(p(),E)[r>>>2>>>0]=+(m!=u),e=(r=w=>{var A=Math.abs(w);return`UTC${0<=w?"-":"+"}${String(Math.floor(A/60)).padStart(2,"0")}${String(A%60).padStart(2,"0")}`})(m),r=r(u),u<m?(Be(e,n,17),Be(r,i,17)):(Be(e,i,17),Be(r,n,17))}var Fs=()=>Date.now(),Gs=1;function $s(e,r,n){if(n>>>=0,!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!Gs)return 52;e=performance.timeOrigin+performance.now()}return e=Math.round(1e6*e),(p(),J)[n>>>3>>>0]=BigInt(e),0}var wr=[],$n=(e,r)=>{wr.length=0;for(var n;n=(p(),R)[e++>>>0];){var i=n!=105;r+=(i&=n!=112)&&r%8?4:0,wr.push(n==112?(p(),S)[r>>>2>>>0]:n==106?(p(),J)[r>>>3>>>0]:n==105?(p(),E)[r>>>2>>>0]:(p(),F)[r>>>3>>>0]),r+=i?8:4}return wr};function zs(e,r,n){return e>>>=0,r=$n(r>>>0,n>>>0),Er[e](...r)}function js(e,r,n){return e>>>=0,r=$n(r>>>0,n>>>0),Er[e](...r)}var Vs=()=>{};function Hs(e,r){return P(it(e>>>0,r>>>0))}var qs=()=>{throw z+=1,"unwind"};function Ys(){return 4294901760}var Js=()=>2,Xs=()=>navigator.hardwareConcurrency,Ye={},zn=e=>{var r=Ce(e)+1,n=yt(r);return n&&Be(e,n,r),n};function Bt(e){if(!(2147483648&(e>>>=0)))return ue("Cannot use emscripten_pc_get_function on native functions without -sUSE_OFFSET_CONVERTER"),0;if(!(e=Ye[e]))return 0;var r;if(r=/^\s+at (.*) \(.*\)$/.exec(e))e=r[1];else{if(!(r=/^(.+?)@/.exec(e)))return 0;e=r[1]}return ve(Bt.C??0),Bt.C=zn(e),Bt.C}function Zs(e){e>>>=0;var r=(p(),R).length;if(e<=r||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var i=r*(1+.2/n);i=Math.min(i,e+100663296);e:{i=(Math.min(4294901760,65536*Math.ceil(Math.max(e,i)/65536))-te.buffer.byteLength+65535)/65536|0;try{te.grow(i),mt();var u=1;break e}catch{}u=void 0}if(u)return!0}return!1}var Ct=e=>{var r;if(r=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(e))return+r[1];if(/\bwasm-function\[(\d+)\]:(\d+)/.exec(e))ue("Legacy backtrace format detected but -sUSE_OFFSET_CONVERTER not present.");else if(r=/:(\d+):\d+(?:\)|$)/.exec(e))return 2147483648|+r[1];return 0},jn=e=>{e.forEach(r=>{var n=Ct(r);n&&(Ye[n]=r)})};function Qs(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),jn(e),Ye.B=Ct(e[3]),Ye.N=e,Ye.B}function Ks(e,r,n){if(e>>>=0,r>>>=0,Ye.B==e)var i=Ye.N;else(i=Error().stack.toString().split(`
`))[0]=="Error"&&i.shift(),jn(i);for(var u=3;i[u]&&Ct(i[u])!=e;)++u;for(e=0;e<n&&i[e+u];++e)(p(),E)[r+4*e>>>2>>>0]=Ct(i[e+u]);return e}var Ae=e=>{var r=Ce(e)+1,n=Pt(r);return Be(e,n,r),n},br=[],le=(e,r)=>{br[e>>>=0]=r},Ie=[],Mt=[],ft=(e,r)=>{Mt[e]=new Promise(n=>r.finally(()=>n(e)))},x=e=>{if(e)return br[e>>>0]},Dt=(e,r,n)=>{(p(),S)[e>>>2>>>0]=r,(p(),S)[e+4>>>2>>>0]=n},Vn=e=>{var r=(p(),S)[e>>>2>>>0];return e=(p(),S)[e+4>>>2>>>0],it(r,e)},Me=e=>{var r=(p(),S)[e>>>2>>>0];return e=(p(),S)[e+4>>>2>>>0],r?it(r,e):e===0?"":void 0},ei=e=>{var r=Me(e+4),n=(n=(p(),S)[e+12>>>2>>>0])?x(n):"auto";if(e+=16){var i=x((p(),S)[e+4>>>2>>>0]),u=(p(),S)[e+16>>>2>>>0],m=(p(),S)[e+20>>>2>>>0];if(u){for(var T={},w=0;w<u;++w){var A=m+24*w;T[Vn(A+4)]=(p(),F)[A+16>>>3>>>0]}u=T}else u=void 0;e={module:i,constants:u,entryPoint:Me(e+8)}}else e=void 0;return{label:r,layout:n,compute:e}},Hn=(e,r)=>{function n(u,m){u=e[u],(p(),E)[r+m>>>2>>>0]=u}function i(u,m){u=e[u],(p(),J)[r+m>>>3>>>0]=BigInt(u)}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),i("maxUniformBufferBindingSize",64),i("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),i("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.Z!==void 0&&n("maxImmediateSize",148)},ti=[,"validation","out-of-memory","internal"],ri=[,"compatibility","core"],qn={1:"core-features-and-limits",2:"depth-clip-control",3:"depth32float-stencil8",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"timestamp-query",10:"indirect-first-instance",11:"shader-f16",12:"rg11b10ufloat-renderable",13:"bgra8unorm-storage",14:"float32-filterable",15:"float32-blendable",16:"clip-distances",17:"dual-source-blending",18:"subgroups",19:"texture-formats-tier1",20:"texture-formats-tier2",21:"primitive-index",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},ni=[,"low-power","high-performance"],oi=[,"occlusion","timestamp"],ai={undefined:1,unknown:1,destroyed:2};function si(e,r,n,i,u,m){r=ce(r),n=ce(n),i>>>=0,u>>>=0,m>>>=0;var T=x(e>>>0);if(e={},m){var w=(p(),S)[m+12>>>2>>>0];if(w){var A=(p(),S)[m+16>>>2>>>0];e.requiredFeatures=Array.from((p(),S).subarray(A>>>2>>>0,A+4*w>>>2>>>0),O=>qn[O])}var I=(p(),S)[m+20>>>2>>>0];if(I){let O=function(xe,ne,Dr=!1){ne=I+ne,(ne=(p(),S)[ne>>>2>>>0])==4294967295||Dr&&ne==0||(k[xe]=ne)},fe=function(xe,ne){ne=I+ne;var Dr=(p(),S)[ne>>>2>>>0],qi=(p(),S)[ne+4>>>2>>>0];Dr==4294967295&&qi==4294967295||(k[xe]=4294967296*(p(),S)[ne+4>>>2>>>0]+(p(),S)[ne>>>2>>>0])};var N=O,re=fe,k={};O("maxTextureDimension1D",4),O("maxTextureDimension2D",8),O("maxTextureDimension3D",12),O("maxTextureArrayLayers",16),O("maxBindGroups",20),O("maxBindGroupsPlusVertexBuffers",24),O("maxDynamicUniformBuffersPerPipelineLayout",32),O("maxDynamicStorageBuffersPerPipelineLayout",36),O("maxSampledTexturesPerShaderStage",40),O("maxSamplersPerShaderStage",44),O("maxStorageBuffersPerShaderStage",48),O("maxStorageTexturesPerShaderStage",52),O("maxUniformBuffersPerShaderStage",56),O("minUniformBufferOffsetAlignment",80),O("minStorageBufferOffsetAlignment",84),fe("maxUniformBufferBindingSize",64),fe("maxStorageBufferBindingSize",72),O("maxVertexBuffers",88),fe("maxBufferSize",96),O("maxVertexAttributes",104),O("maxVertexBufferArrayStride",108),O("maxInterStageShaderVariables",112),O("maxColorAttachments",116),O("maxColorAttachmentBytesPerSample",120),O("maxComputeWorkgroupStorageSize",124),O("maxComputeInvocationsPerWorkgroup",128),O("maxComputeWorkgroupSizeX",132),O("maxComputeWorkgroupSizeY",136),O("maxComputeWorkgroupSizeZ",140),O("maxComputeWorkgroupsPerDimension",144),O("maxImmediateSize",148,!0),e.requiredLimits=k}(w=(p(),S)[m+24>>>2>>>0])&&(w={label:Me(w+4)},e.defaultQueue=w),e.label=Me(m+4)}z+=1,ft(r,T.requestDevice(e).then(O=>{--z,le(u,O.queue),le(i,O),n&&(z+=1,ft(n,O.lost.then(fe=>{--z,O.onuncapturederror=()=>{};var xe=me(),ne=Ae(fe.message);Ir(n,ai[fe.reason],ne),de(xe)}))),O.onuncapturederror=fe=>{var xe=5;fe.error instanceof GPUValidationError?xe=2:fe.error instanceof GPUOutOfMemoryError?xe=3:fe.error instanceof GPUInternalError&&(xe=4);var ne=me();fe=Ae(fe.error.message),go(i,xe,fe),de(ne)},"adapterInfo"in O||(O.adapterInfo=T.info),Lr(r,1,i,0)},O=>{--z;var fe=me();O=Ae(O.message),Lr(r,3,i,O),n&&Ir(n,4,O),de(fe)}))}function ii(e){var r=x(e>>>=0),n=Ie[e];if(n){for(var i=0;i<n.length;++i)n[i]();delete Ie[e]}r.destroy()}var ct=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";ct.v||(ct.v={}),ct.v[e]||(ct.v[e]=1,P(e))};function ui(e,r,n){r>>>=0,n>>>=0;var i=x(e>>>=0);n===0&&ct(),n==4294967295&&(n=void 0);try{var u=i.getMappedRange(r,n)}catch{return 0}var m=Mr(16,u.byteLength);return(p(),R).set(new Uint8Array(u),m>>>0),Ie[e].push(()=>ve(m)),m}function fi(e,r,n){r>>>=0,n>>>=0;var i=x(e>>>=0);n===0&&ct(),n==4294967295&&(n=void 0);try{var u=i.getMappedRange(r,n)}catch{return 0}var m=Mr(16,u.byteLength);return(p(),R).fill(0,m,u.byteLength),Ie[e].push(()=>{new Uint8Array(u).set((p(),R).subarray(m>>>0,m+u.byteLength>>>0)),ve(m)}),m}function ci(e,r,n,i,u){e>>>=0,r=ce(r),n=ce(n),u>>>=0;var m=x(e);Ie[e]=[],u==4294967295&&(u=void 0),z+=1,ft(r,m.mapAsync(n,i>>>0,u).then(()=>{--z,xr(r,1,0)},T=>{--z,me();var w=Ae(T.message);xr(r,T.name==="AbortError"?4:T.name==="OperationError"?3:0,w),delete Ie[e]}))}function li(e){var r=x(e>>>=0),n=Ie[e];if(n){for(var i=0;i<n.length;++i)n[i]();delete Ie[e],r.unmap()}}function pi(e){delete br[e>>>0]}function di(e,r,n){e>>>=0,r>>>=0,n>>>=0;var i=!!(p(),S)[r+32>>>2>>>0];r={label:Me(r+4),usage:(p(),S)[r+16>>>2>>>0],size:4294967296*(p(),S)[r+28>>>2>>>0]+(p(),S)[r+24>>>2>>>0],mappedAtCreation:i},e=x(e);try{var u=e.createBuffer(r)}catch{return!1}return le(n,u),i&&(Ie[n]=[]),!0}function mi(e,r,n,i){e>>>=0,r=ce(r),i>>>=0,n=ei(n>>>0),e=x(e),z+=1,ft(r,e.createComputePipelineAsync(n).then(u=>{--z,le(i,u),Ar(r,1,i,0)},u=>{--z;var m=me(),T=Ae(u.message);Ar(r,u.reason==="validation"?3:u.reason==="internal"?4:0,i,T),de(m)}))}function hi(e,r,n){e>>>=0,r>>>=0,n>>>=0;var i=(p(),S)[r>>>2>>>0],u=(p(),S)[i+4>>>2>>>0];r={label:Me(r+4),code:""},u===2&&(r.code=Vn(i+8)),le(n,x(e).createShaderModule(r))}var gi=e=>{(e=x(e)).onuncapturederror=null,e.destroy()};function yi(e,r){r=ce(r),e=x(e>>>0),z+=1,ft(r,e.popErrorScope().then(n=>{--z;var i=5;n?n instanceof GPUValidationError?i=2:n instanceof GPUOutOfMemoryError?i=3:n instanceof GPUInternalError&&(i=4):i=1;var u=me();n=n?Ae(n.message):0,Or(r,1,i,n),de(u)},n=>{--z;var i=me();n=Ae(n.message),Or(r,1,5,n),de(i)}))}function wi(e,r,n,i){if(r=ce(r),i>>>=0,n>>>=0){var u=(p(),S)[n+4>>>2>>>0];u={featureLevel:ri[u],powerPreference:ni[(p(),S)[n+8>>>2>>>0]],forceFallbackAdapter:!!(p(),S)[n+12>>>2>>>0]},(n=(p(),S)[n>>>2>>>0])!==0&&(p(),u.da=!!(p(),S)[n+8>>>2>>>0])}"gpu"in navigator?(z+=1,ft(r,navigator.gpu.requestAdapter(u).then(m=>{if(--z,m)le(i,m),wt(r,1,i,0);else{m=me();var T=Ae("WebGPU not available on this browser (requestAdapter returned null)");wt(r,3,i,T),de(m)}},m=>{--z;var T=me();m=Ae(m.message),wt(r,4,i,m),de(T)}))):(n=me(),u=Ae("WebGPU not available on this browser (navigator.gpu is not available)"),wt(r,3,i,u),de(n))}function Yn(e,r,n){return e>>>=0,r>>>=0,n>>>=0,Dn(async()=>{var i=[];if(n){var u=(p(),E)[n>>>2>>>0];i.length=r+1,i[r]=new Promise(w=>setTimeout(w,u,0))}else i.length=r;for(var m=0;m<r;++m){var T=4294967296*(p(),S)[e+8*m+4>>>2>>>0]+(p(),S)[e+8*m>>>2>>>0];if(!(T in Mt))return T;i[m]=Mt[T]}return i=await Promise.race(i),delete Mt[i],i})}Yn.A=!0;var Tr,vr={},Jn=()=>{if(!Tr){var e,r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in vr)vr[e]===void 0?delete r[e]:r[e]=vr[e];var n=[];for(e in r)n.push(`${e}=${r[e]}`);Tr=n}return Tr};function Xn(e,r){if(s)return V(19,1,e,r);e>>>=0,r>>>=0;var n,i=0,u=0;for(n of Jn()){var m=r+i;(p(),S)[e+u>>>2>>>0]=m,i+=Be(n,m,1/0)+1,u+=4}return 0}function Zn(e,r){if(s)return V(20,1,e,r);e>>>=0,r>>>=0;var n=Jn();for(var i of((p(),S)[e>>>2>>>0]=n.length,e=0,n))e+=Ce(i)+1;return(p(),S)[r>>>2>>>0]=e,0}function Qn(e){return s?V(21,1,e):52}function Kn(e,r,n,i){return s?V(22,1,e,r,n,i):52}function eo(e,r,n,i){return s?V(23,1,e,r,n,i):70}var bi=[null,[],[]];function to(e,r,n,i){if(s)return V(24,1,e,r,n,i);r>>>=0,n>>>=0,i>>>=0;for(var u=0,m=0;m<n;m++){var T=(p(),S)[r>>>2>>>0],w=(p(),S)[r+4>>>2>>>0];r+=8;for(var A=0;A<w;A++){var I=e,k=(p(),R)[T+A>>>0],N=bi[I];k===0||k===10?((I===1?M:P)(hn(N)),N.length=0):N.push(k)}u+=w}return(p(),S)[i>>>2>>>0]=u,0}function Ti(e,r){return Hn(x(e>>>0).limits,r>>>0),1}function vi(e,r){return x(e>>>0).features.has(qn[r])}function Ei(e){return BigInt(x(e>>>0).size)}function _i(e){return BigInt(x(e>>>0).usage)}function Si(e,r){if(e>>>=0,r>>>=0){var n=Me(r+4);n={label:n,timestampWrites:r=(r=(p(),S)[r+12>>>2>>>0])!==0?{querySet:x((p(),S)[r+4>>>2>>>0]),beginningOfPassWriteIndex:(p(),S)[r+8>>>2>>>0],endOfPassWriteIndex:(p(),S)[r+12>>>2>>>0]}:void 0}}return e=x(e),r=co(0),le(r,e.beginComputePass(n)),r}function Ai(e,r,n,i,u,m){n=ce(n),u=ce(u),m=ce(m),x(e>>>0).copyBufferToBuffer(x(r>>>0),n,x(i>>>0),u,m)}function Ii(e){e=x(e>>>0);var r=uo(0);return le(r,e.finish()),r}function xi(e,r,n,i,u,m){m=ce(m),x(e>>>0).resolveQuerySet(x(r>>>0),n,i,x(u>>>0),m)}function Oi(e,r,n,i){x(e>>>0).dispatchWorkgroups(r,n,i)}function Li(e,r,n){n=ce(n),x(e>>>0).dispatchWorkgroupsIndirect(x(r>>>0),n)}function Bi(e){x(e>>>0).end()}function Ci(e,r,n,i,u){i>>>=0,u>>>=0,e=x(e>>>0),n=x(n>>>0),i==0?e.setBindGroup(r,n):e.setBindGroup(r,n,(p(),S),u>>>2,i)}function Mi(e,r){x(e>>>0).setPipeline(x(r>>>0))}function Di(e,r,n){x(e>>>0).ba(x(r>>>0),n)}function Pi(e,r){e=x(e>>>0);var n=io(0);return le(n,e.getBindGroupLayout(r)),n}function Ui(e,r){e>>>=0;var n=Me(4+(r>>>=0)),i=x((p(),S)[r+12>>>2>>>0]),u=(p(),S)[r+16>>>2>>>0];r=(p(),S)[r+20>>>2>>>0];for(var m=[],T=0;T<u;++T){var w=m,A=w.push,I=r+40*T,k=(p(),S)[I+8>>>2>>>0],N=(p(),S)[I+32>>>2>>>0],re=(p(),S)[I+36>>>2>>>0],O=(p(),S)[I+4>>>2>>>0];k?(N=I+24,(N=(p(),S)[N>>>2>>>0]+4294967296*(p(),E)[N+4>>>2>>>0])==-1&&(N=void 0),I={binding:O,resource:{buffer:x(k),offset:4294967296*(p(),S)[I+4+16>>>2>>>0]+(p(),S)[I+16>>>2>>>0],size:N}}):I=N?{binding:O,resource:x(N)}:{binding:O,resource:x(re)},A.call(w,I)}return n={label:n,layout:i,entries:m},e=x(e),i=so(0),le(i,e.createBindGroup(n)),i}function Ri(e,r){var n;return e>>>=0,(r>>>=0)&&(n={label:Me(r+4)}),e=x(e),r=fo(0),le(r,e.createCommandEncoder(n)),r}function ki(e,r){e>>>=0,r>>>=0,r={type:oi[(p(),S)[r+12>>>2>>>0]],count:(p(),S)[r+16>>>2>>>0]},e=x(e);var n=lo(0);return le(n,e.createQuerySet(r)),n}function Ni(e,r){e=x(e>>>0).adapterInfo,r>>>=0,(p(),E)[r+52>>>2>>>0]=e.subgroupMinSize,(p(),E)[r+56>>>2>>>0]=e.subgroupMaxSize;var n=zn(e.vendor+e.architecture+e.device+e.description),i=Ce(e.vendor);return Dt(r+4,n,i),n+=i,i=Ce(e.architecture),Dt(r+12,n,i),n+=i,i=Ce(e.device),Dt(r+20,n,i),Dt(r+28,n+i,Ce(e.description)),(p(),E)[r+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,(p(),E)[r+40>>>2>>>0]=e,(p(),E)[r+44>>>2>>>0]=0,(p(),E)[r+48>>>2>>>0]=0,1}var Wi={"core-features-and-limits":1,"depth-clip-control":2,"depth32float-stencil8":3,"texture-compression-bc":4,"texture-compression-bc-sliced-3d":5,"texture-compression-etc2":6,"texture-compression-astc":7,"texture-compression-astc-sliced-3d":8,"timestamp-query":9,"indirect-first-instance":10,"shader-f16":11,"rg11b10ufloat-renderable":12,"bgra8unorm-storage":13,"float32-filterable":14,"float32-blendable":15,"clip-distances":16,"dual-source-blending":17,subgroups:18,"texture-formats-tier1":19,"texture-formats-tier2":20,"primitive-index":21,"chromium-experimental-unorm16-texture-formats":327692,"chromium-experimental-snorm16-texture-formats":327693,"chromium-experimental-multi-draw-indirect":327732};function Fi(e,r){r>>>=0,e=x(e>>>0);var n=yt(4*e.features.size),i=0,u=0;e.features.forEach(m=>{0<=(m=Wi[m])&&((p(),E)[n+i>>>2>>>0]=m,i+=4,u++)}),(p(),S)[r+4>>>2>>>0]=n,(p(),S)[r>>>2>>>0]=u}function Gi(e,r){return Hn(x(e>>>0).limits,r>>>0),1}function $i(e,r){x(e>>>0).pushErrorScope(ti[r])}function zi(e,r,n){r>>>=0,n>>>=0,e=x(e>>>0),r=Array.from((p(),E).subarray(n>>>2>>>0,n+4*r>>>2>>>0),i=>x(i)),e.submit(r)}function ji(e,r,n,i,u){n=ce(n),i>>>=0,u>>>=0,e=x(e>>>0),r=x(r>>>0),i=(p(),R).subarray(i>>>0,i+u>>>0),e.writeBuffer(r,n,i,0,u)}s||function(){for(var e=t.numThreads-1;e--;)fn();be.push(()=>{Re++,function(r){s?r():Promise.all(We.map(un)).then(r)}(()=>we())})}(),s||(te=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),mt()),t.wasmBinary&&(y=t.wasmBinary),t.stackSave=()=>me(),t.stackRestore=e=>de(e),t.stackAlloc=e=>Pt(e),t.setValue=function(e,r,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":(p(),Oe)[e>>>0]=r;break;case"i16":(p(),ie)[e>>>1>>>0]=r;break;case"i32":(p(),E)[e>>>2>>>0]=r;break;case"i64":(p(),J)[e>>>3>>>0]=BigInt(r);break;case"float":(p(),Pe)[e>>>2>>>0]=r;break;case"double":(p(),F)[e>>>3>>>0]=r;break;case"*":(p(),S)[e>>>2>>>0]=r;break;default:ue(`invalid type for setValue: ${n}`)}},t.getValue=function(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":return(p(),Oe)[e>>>0];case"i16":return(p(),ie)[e>>>1>>>0];case"i32":return(p(),E)[e>>>2>>>0];case"i64":return(p(),J)[e>>>3>>>0];case"float":return(p(),Pe)[e>>>2>>>0];case"double":return(p(),F)[e>>>3>>>0];case"*":return(p(),S)[e>>>2>>>0];default:ue(`invalid type for getValue: ${r}`)}},t.UTF8ToString=it,t.stringToUTF8=Be,t.lengthBytesUTF8=Ce;var Vi=[ur,nn,ln,gn,yn,wn,bn,Tn,vn,En,_n,Sn,An,In,xn,On,Wn,Fn,Gn,Xn,Zn,Qn,Kn,eo,to],Er={1090448:(e,r,n,i,u)=>{if(t===void 0||!t.o)return 1;if((e=it(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=t.o.get(e)))return 2;if(r=Number(r>>>0),n=Number(n>>>0),i=Number(i>>>0),r+n>e.byteLength)return 3;try{let m=e.subarray(r,r+n);switch(u){case 0:(p(),R).set(m,i>>>0);break;case 1:t.F?t.F(i,m):t.Y(i,m);break;default:return 4}return 0}catch{return 4}},1091272:(e,r,n)=>{t.H(e,(p(),R).subarray(r>>>0,r+n>>>0))},1091336:()=>t.W(),1091378:e=>{t.G(e)},1091415:()=>typeof wasmOffsetConverter<"u"};function Hi(){return typeof wasmOffsetConverter<"u"}var ro,no,_r,Sr,ve,yt,oo,ao,so,io,uo,fo,co,lo,po,mo,ho,Ar,Ir,xr,Or,wt,Lr,go,Br,yo,wo,bo,Cr,To,vo,Mr,Eo,_o,de,Pt,me,bt,De=await async function(){function e(i,u){i=De=i.exports;var m=/^(OrtAppendExecutionProvider|OrtCreateSession|OrtRun|OrtRunWithBinding|OrtBindInput|main|__main_argc_argv)$/;gr=new Set;var T={};for(let[w,A]of Object.entries(i))typeof A=="function"?(m.test(w)&&(gr.add(A),A=WebAssembly.promising(A)),T[w]=ws(A)):T[w]=A;return De=T,De=function(){var w=De,A=k=>N=>k(N)>>>0,I=k=>()=>k()>>>0;return(w=Object.assign({},w)).__getTypeName=A(w.__getTypeName),w.pthread_self=I(w.pthread_self),w.malloc=A(w.malloc),w.memalign=(k=>(N,re)=>k(N,re)>>>0)(w.memalign),w._emscripten_stack_alloc=A(w._emscripten_stack_alloc),w.emscripten_stack_get_current=I(w.emscripten_stack_get_current),w}(),on.push(De._emscripten_tls_init),cn=De.__indirect_function_table,v=u,ro=(u=De).__getTypeName,no=u._embind_initialize_bindings,t._OrtInit=u.OrtInit,t._OrtGetLastError=u.OrtGetLastError,t._OrtCreateSessionOptions=u.OrtCreateSessionOptions,t._OrtAppendExecutionProvider=u.OrtAppendExecutionProvider,t._OrtAddFreeDimensionOverride=u.OrtAddFreeDimensionOverride,t._OrtAddSessionConfigEntry=u.OrtAddSessionConfigEntry,t._OrtReleaseSessionOptions=u.OrtReleaseSessionOptions,t._OrtCreateSession=u.OrtCreateSession,t._OrtReleaseSession=u.OrtReleaseSession,t._OrtGetInputOutputCount=u.OrtGetInputOutputCount,t._OrtGetInputOutputMetadata=u.OrtGetInputOutputMetadata,t._OrtFree=u.OrtFree,t._OrtCreateTensor=u.OrtCreateTensor,t._OrtGetTensorData=u.OrtGetTensorData,t._OrtReleaseTensor=u.OrtReleaseTensor,t._OrtCreateRunOptions=u.OrtCreateRunOptions,t._OrtAddRunConfigEntry=u.OrtAddRunConfigEntry,t._OrtReleaseRunOptions=u.OrtReleaseRunOptions,t._OrtCreateBinding=u.OrtCreateBinding,t._OrtBindInput=u.OrtBindInput,t._OrtBindOutput=u.OrtBindOutput,t._OrtClearBoundOutputs=u.OrtClearBoundOutputs,t._OrtReleaseBinding=u.OrtReleaseBinding,t._OrtRunWithBinding=u.OrtRunWithBinding,t._OrtRun=u.OrtRun,t._OrtEndProfiling=u.OrtEndProfiling,t._OrtGetWebGpuDevice=_r=u.OrtGetWebGpuDevice,Sr=u.pthread_self,t._free=ve=u.free,t._malloc=yt=u.malloc,t._wgpuBufferRelease=oo=u.wgpuBufferRelease,t._wgpuCreateInstance=ao=u.wgpuCreateInstance,so=u.emwgpuCreateBindGroup,io=u.emwgpuCreateBindGroupLayout,uo=u.emwgpuCreateCommandBuffer,fo=u.emwgpuCreateCommandEncoder,co=u.emwgpuCreateComputePassEncoder,lo=u.emwgpuCreateQuerySet,po=u.emwgpuCreateBuffer,mo=u.emwgpuCreateDevice,ho=u.emwgpuCreateQueue,Ar=u.emwgpuOnCreateComputePipelineCompleted,Ir=u.emwgpuOnDeviceLostCompleted,xr=u.emwgpuOnMapAsyncCompleted,Or=u.emwgpuOnPopErrorScopeCompleted,wt=u.emwgpuOnRequestAdapterCompleted,Lr=u.emwgpuOnRequestDeviceCompleted,go=u.emwgpuOnUncapturedError,Br=u._emscripten_thread_init,yo=u._emscripten_thread_crashed,wo=u._emscripten_run_js_on_main_thread,bo=u._emscripten_thread_free_data,Cr=u._emscripten_thread_exit,To=u._emscripten_timeout,vo=u._emscripten_check_mailbox,Mr=u.memalign,Eo=u.__trap,_o=u.emscripten_stack_set_limits,de=u._emscripten_stack_restore,Pt=u._emscripten_stack_alloc,me=u.emscripten_stack_get_current,we(),De}Re++;var r,n=ke();return t.instantiateWasm?new Promise(i=>{t.instantiateWasm(n,(u,m)=>{i(e(u,m))})}):s?new Promise(i=>{$=u=>{var m=new WebAssembly.Instance(u,ke());i(e(m,u))}}):(Ue??=t.locateFile?t.locateFile?t.locateFile("ort-wasm-simd-threaded.jspi.wasm",b):b+"ort-wasm-simd-threaded.jspi.wasm":new URL("ort-wasm-simd-threaded.jspi.wasm",import.meta.url).href,r=await async function(i){var u=Ue;if(!y&&typeof WebAssembly.instantiateStreaming=="function"&&!se(u))try{var m=fetch(u,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(m,i)}catch(T){P(`wasm streaming compile failed: ${T}`),P("falling back to ArrayBuffer instantiation")}return async function(T,w){try{var A=await async function(I){if(!y)try{var k=await c(I);return new Uint8Array(k)}catch{}if(I==Ue&&y)I=new Uint8Array(y);else{if(!l)throw"both async and sync fetching of the wasm failed";I=l(I)}return I}(T);return await WebAssembly.instantiate(A,w)}catch(I){P(`failed to asynchronously prepare wasm: ${I}`),ue(I)}}(u,i)}(n),e(r.instance,r.module))}();return function e(){0<Re?Ve=e:s?(L?.(t),st()):((()=>{for(var r=be;0<r.length;)r.shift()(t)})(),0<Re?Ve=e:async function(){t.calledRun=!0,Y||(st(),L?.(t))}())}(),t.PTR_SIZE=4,t.webgpuInit=e=>{let r=new WeakMap,n,i,u=1;t.webgpuRegisterDevice=w=>{if(i!==void 0)throw Error("another WebGPU EP inference session is being created.");if(w){var A=r.get(w);if(!A){let I=((k,N=0)=>{var re=ho(N);return N=mo(N,re),le(re,k.queue),le(N,k),N})(w,A=ao(0));A=[u++,A,I],r.set(w,A)}return n=w,i=A[0],A}n=void 0,i=0};let m=new Map;t.webgpuOnCreateSession=w=>{if(i!==void 0){var A=i;if(i=void 0,w){let I=_r(A);m.set(w,I),A===0&&e(n??x(I))}n=void 0}},t.webgpuOnReleaseSession=w=>{m.delete(w)};let T=Symbol("gpuBufferMetadata");t.webgpuRegisterBuffer=(w,A,I)=>{if(I)return w[T]=[I,NaN],I;if(I=w[T])return I[1]++,I[0];if((A=m.get(A))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return A=((k,N=0)=>(k.mapState!="pending"||ue(),N=po(N,k.mapState=="mapped"?3:1),le(N,k),k.mapState=="mapped"&&(Ie[N]=[]),N))(w,A),w[T]=[A,1],A},t.webgpuUnregisterBuffer=w=>{let A=w[T];if(!A)throw Error("Buffer is not registered");A[1]--,A[1]===0&&(oo(A[0]),delete w[T])},t.webgpuGetBuffer=w=>x(w),t.webgpuCreateDownloader=(w,A,I)=>{if((I=m.get(I))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let k=x(I),N=16*Math.ceil(Number(A)/16);return async()=>{let re=k.createBuffer({size:N,usage:9});try{let O=k.createCommandEncoder();return O.copyBufferToBuffer(w,0,re,0,N),k.queue.submit([O.finish()]),await re.mapAsync(GPUMapMode.READ),re.getMappedRange().slice(0,A)}finally{re.destroy()}}},t.F=(w,A)=>{var I=A.buffer;let k=A.byteOffset,N=A.byteLength;if(A=16*Math.ceil(Number(N)/16),w=x(w),!n){var re=_r(i);n=x(re)}let O=(re=n.createBuffer({mappedAtCreation:!0,size:A,usage:6})).getMappedRange();new Uint8Array(O).set(new Uint8Array(I,k,N)),re.unmap(),(I=n.createCommandEncoder()).copyBufferToBuffer(re,0,w,0,A),n.queue.submit([I.finish()]),re.destroy()}},t.webnnInit=e=>{let r=e[0];[t.W,t.G,t.webnnEnsureTensor,t.H,t.webnnDownloadTensor,t.V,t.webnnEnableTraceEvent]=e.slice(1),t.webnnReleaseTensorId=t.G,t.webnnUploadTensor=t.H,t.webnnRegisterMLContext=t.V,t.webnnOnRunStart=n=>r.onRunStart(n),t.webnnOnRunEnd=r.onRunEnd.bind(r),t.webnnOnReleaseSession=n=>{r.onReleaseSession(n)},t.webnnCreateMLTensorDownloader=(n,i)=>r.createMLTensorDownloader(n,i),t.webnnRegisterMLTensor=(n,i,u,m)=>r.registerMLTensor(n,i,u,m),t.webnnCreateMLContext=n=>r.createMLContext(n),t.webnnRegisterMLConstant=(n,i,u,m,T,w)=>r.registerMLConstant(n,i,u,m,T,t.o,w),t.webnnRegisterGraphInput=r.registerGraphInput.bind(r),t.webnnIsGraphInput=r.isGraphInput.bind(r),t.webnnRegisterGraphOutput=r.registerGraphOutput.bind(r),t.webnnIsGraphOutput=r.isGraphOutput.bind(r),t.webnnCreateTemporaryTensor=r.createTemporaryTensor.bind(r),t.webnnIsGraphInputOutputTypeSupported=r.isGraphInputOutputTypeSupported.bind(r)},Q?t:new Promise((e,r)=>{L=e,D=r})}var tu,ru,sa=U(()=>{"use strict";tu=oa,ru=globalThis.self?.name?.startsWith("em-pthread");ru&&oa()});var fa,jr,nu,he,ca,zr,ou,au,la,su,ia,pa,ua,da,Ft=U(()=>{"use strict";Wt();fa=typeof location>"u"?void 0:location.origin,jr=import.meta.url>"file:"&&import.meta.url<"file;",nu=()=>{if(!!1){if(jr){let o=URL;return new URL(new o("ort.jspi.bundle.min.mjs",import.meta.url).href,fa).href}return import.meta.url}},he=nu(),ca=()=>{if(he&&!he.startsWith("blob:"))return he.substring(0,he.lastIndexOf("/")+1)},zr=(o,t)=>{try{let a=t??he;return(a?new URL(o,a):new URL(o)).origin===fa}catch{return!1}},ou=(o,t)=>{let a=t??he;try{return(a?new URL(o,a):new URL(o)).href}catch{return}},au=(o,t)=>`${t??"./"}${o}`,la=async o=>{let a=await(await fetch(o,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},su=async o=>(await import(/*webpackIgnore:true*/ /*@vite-ignore*/o)).default,ia=(na(),Ut(ra)).default,pa=async()=>{if(!he)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(zr(he))return[void 0,ia()];let o=await la(he);return[o,ia(o)]},ua=(sa(),Ut(aa)).default,da=async(o,t,a,f)=>{let s=ua&&!(o||t);if(s)if(he)s=zr(he);else if(f&&!a)s=!0;else throw new Error("cannot determine the script source URL.");if(s)return[void 0,ua];{let c="ort-wasm-simd-threaded.jspi.mjs",l=o??ou(c,t),d=!!1&&a&&l&&!zr(l,t),h=d?await la(l):l??au(c,t);return[d?h:void 0,await su(h)]}}});var Vr,Hr,Jt,ma,iu,uu,fu,Gt,G,ze=U(()=>{"use strict";Ft();Hr=!1,Jt=!1,ma=!1,iu=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},uu=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},fu=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Gt=async o=>{if(Hr)return Promise.resolve();if(Jt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(ma)throw new Error("previous call to 'initializeWebAssembly()' failed.");Jt=!0;let t=o.initTimeout,a=o.numThreads;if(o.simd!==!1){if(o.simd==="relaxed"){if(!fu())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!uu())throw new Error("WebAssembly SIMD is not supported in the current environment.")}if(!("Suspending"in WebAssembly))throw new Error("WebAssembly JSPI is not supported in the current environment.");let f=iu();a>1&&!f&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+a+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),o.numThreads=a=1);let s=o.wasmPaths,c=typeof s=="string"?s:void 0,l=s?.mjs,d=l?.href??l,h=s?.wasm,g=h?.href??h,b=o.wasmBinary,[y,v]=await da(d,c,a>1,!!b||!!g),_=!1,L=[];if(t>0&&L.push(new Promise(D=>{setTimeout(()=>{_=!0,D()},t)})),L.push(new Promise((D,$)=>{let C={numThreads:a};if(b)C.wasmBinary=b;else if(g||c)C.locateFile=B=>g??c+B;else if(d&&d.indexOf("blob:")!==0)C.locateFile=B=>new URL(B,d).href;else if(y){let B=ca();B&&(C.locateFile=j=>B+j)}v(C).then(B=>{Jt=!1,Hr=!0,Vr=B,D(),y&&URL.revokeObjectURL(y)},B=>{Jt=!1,ma=!0,$(B)})})),await Promise.race(L),_)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},G=()=>{if(Hr&&Vr)return Vr;throw new Error("WebAssembly is not initialized yet.")}});var pe,_t,W,Xt=U(()=>{"use strict";ze();pe=(o,t)=>{let a=G(),f=a.lengthBytesUTF8(o)+1,s=a._malloc(f);return a.stringToUTF8(o,s,f),t.push(s),s},_t=(o,t,a,f)=>{if(typeof o=="object"&&o!==null){if(a.has(o))throw new Error("Circular reference in options");a.add(o)}Object.entries(o).forEach(([s,c])=>{let l=t?t+s:s;if(typeof c=="object")_t(c,l+".",a,f);else if(typeof c=="string"||typeof c=="number")f(l,c.toString());else if(typeof c=="boolean")f(l,c?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof c}`)})},W=o=>{let t=G(),a=t.stackSave();try{let f=t.PTR_SIZE,s=t.stackAlloc(2*f);t._OrtGetLastError(s,s+f);let c=Number(t.getValue(s,f===4?"i32":"i64")),l=t.getValue(s+f,"*"),d=l?t.UTF8ToString(l):"";throw new Error(`${o} ERROR_CODE: ${c}, ERROR_MESSAGE: ${d}`)}finally{t.stackRestore(a)}}});var ha,ga=U(()=>{"use strict";ze();Xt();ha=o=>{let t=G(),a=0,f=[],s=o||{};try{if(o?.logSeverityLevel===void 0)s.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)s.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(s.terminate=!1);let c=0;return o?.tag!==void 0&&(c=pe(o.tag,f)),a=t._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,c),a===0&&W("Can't create run options."),o?.extra!==void 0&&_t(o.extra,"",new WeakSet,(l,d)=>{let h=pe(l,f),g=pe(d,f);t._OrtAddRunConfigEntry(a,h,g)!==0&&W(`Can't set a run config entry: ${l} - ${d}.`)}),[a,f]}catch(c){throw a!==0&&t._OrtReleaseRunOptions(a),f.forEach(l=>t._free(l)),c}}});var cu,lu,pu,qr,tt,du,ya,wa=U(()=>{"use strict";ze();Xt();cu=o=>{switch(o){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${o}`)}},lu=o=>{switch(o){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${o}`)}},pu=o=>{o.extra||(o.extra={}),o.extra.session||(o.extra.session={});let t=o.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),o.executionProviders&&o.executionProviders.some(a=>(typeof a=="string"?a:a.name)==="webgpu")&&(o.enableMemPattern=!1)},qr=(o,t,a,f)=>{let s=pe(t,f),c=pe(a,f);G()._OrtAddSessionConfigEntry(o,s,c)!==0&&W(`Can't set a session config entry: ${t} - ${a}.`)},tt=(o,t,a,f)=>{let s=pe(t,f),c=pe(a,f);o.push([s,c])},du=async(o,t,a)=>{let f=t.executionProviders;for(let s of f){let c=typeof s=="string"?s:s.name,l=[];switch(c){case"webnn":if(c="WEBNN",typeof s!="string"){let v=s?.deviceType;v&&qr(o,"deviceType",v,a)}break;case"webgpu":{c="WebGPU";let y;if(typeof s!="string"){let _=s;if(_.device)if(typeof GPUDevice<"u"&&_.device instanceof GPUDevice)y=_.device;else throw new Error("Invalid GPU device set in WebGPU EP options.");let{enableGraphCapture:L}=t;if(typeof L=="boolean"&&L&&tt(l,"enableGraphCapture","1",a),typeof _.preferredLayout=="string"&&tt(l,"preferredLayout",_.preferredLayout,a),_.forceCpuNodeNames){let D=Array.isArray(_.forceCpuNodeNames)?_.forceCpuNodeNames:[_.forceCpuNodeNames];tt(l,"forceCpuNodeNames",D.join(`
`),a)}_.validationMode&&tt(l,"validationMode",_.validationMode,a)}let v=G().webgpuRegisterDevice(y);if(v){let[_,L,D]=v;tt(l,"deviceId",_.toString(),a),tt(l,"webgpuInstance",L.toString(),a),tt(l,"webgpuDevice",D.toString(),a)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${c}`)}let d=pe(c,a),h=l.length,g=0,b=0;if(h>0){g=G()._malloc(h*G().PTR_SIZE),a.push(g),b=G()._malloc(h*G().PTR_SIZE),a.push(b);for(let y=0;y<h;y++)G().setValue(g+y*G().PTR_SIZE,l[y][0],"*"),G().setValue(b+y*G().PTR_SIZE,l[y][1],"*")}await G()._OrtAppendExecutionProvider(o,d,g,b,h)!==0&&W(`Can't append execution provider: ${c}.`)}},ya=async o=>{let t=G(),a=0,f=[],s=o||{};pu(s);try{let c=cu(s.graphOptimizationLevel??"all"),l=lu(s.executionMode??"sequential"),d=typeof s.logId=="string"?pe(s.logId,f):0,h=s.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log severity level is not valid: ${h}`);let g=s.logVerbosityLevel??0;if(!Number.isInteger(g)||g<0||g>4)throw new Error(`log verbosity level is not valid: ${g}`);let b=typeof s.optimizedModelFilePath=="string"?pe(s.optimizedModelFilePath,f):0;if(a=t._OrtCreateSessionOptions(c,!!s.enableCpuMemArena,!!s.enableMemPattern,l,!!s.enableProfiling,0,d,h,g,b),a===0&&W("Can't create session options."),s.executionProviders&&await du(a,s,f),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);qr(a,"enableGraphCapture",s.enableGraphCapture.toString(),f)}if(s.freeDimensionOverrides)for(let[y,v]of Object.entries(s.freeDimensionOverrides)){if(typeof y!="string")throw new Error(`free dimension override name must be a string: ${y}`);if(typeof v!="number"||!Number.isInteger(v)||v<0)throw new Error(`free dimension override value must be a non-negative integer: ${v}`);let _=pe(y,f);t._OrtAddFreeDimensionOverride(a,_,v)!==0&&W(`Can't set a free dimension override: ${y} - ${v}.`)}return s.extra!==void 0&&_t(s.extra,"",new WeakSet,(y,v)=>{qr(a,y,v,f)}),[a,f]}catch(c){throw a!==0&&t._OrtReleaseSessionOptions(a)!==0&&W("Can't release session options."),f.forEach(l=>t._free(l)),c}}});var je,Zt,lt,rt,St,Qt,Kt,Yr,nt=U(()=>{"use strict";je=o=>{switch(o){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${o}`)}},Zt=o=>{switch(o){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${o}`)}},lt=(o,t)=>{let a=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][o],f=typeof t=="number"?t:t.reduce((s,c)=>s*c,1);return a>0?Math.ceil(f*a):void 0},rt=o=>{switch(o){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${o}`)}},St=o=>{switch(o){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${o}`)}},Qt=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",Kt=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint64"||o==="int8"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",Yr=o=>{switch(o){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${o}`)}}});var At,Jr=U(()=>{"use strict";Wt();At=async o=>{if(typeof o=="string")if(!1)try{let{readFile:t}=Ur("node:fs/promises");return new Uint8Array(await t(o))}catch(t){if(t.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:a}=Ur("node:fs"),f=a(o),s=[];for await(let c of f)s.push(c);return new Uint8Array(Buffer.concat(s))}throw t}else{let t=await fetch(o);if(!t.ok)throw new Error(`failed to load external data file: ${o}`);let a=t.headers.get("Content-Length"),f=a?parseInt(a,10):0;if(f<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${o}, no response body.`);let s=t.body.getReader(),c;try{c=new ArrayBuffer(f)}catch(d){if(d instanceof RangeError){let h=Math.ceil(f/65536);c=new WebAssembly.Memory({initial:h,maximum:h}).buffer}else throw d}let l=0;for(;;){let{done:d,value:h}=await s.read();if(d)break;let g=h.byteLength;new Uint8Array(c,l,g).set(h),l+=g}return new Uint8Array(c,0,f)}}else return o instanceof Blob?new Uint8Array(await o.arrayBuffer()):o instanceof Uint8Array?o:new Uint8Array(o)}});var ba,Ta=U(()=>{"use strict";nt();ba=(o,t)=>new(rt(t))(o)});var mu,hu,va,Ea,_a,gu,ae,Xr=U(()=>{"use strict";nt();mu=["V","I","W","E","F"],hu=(o,t)=>{console.log(`[${mu[o]},${new Date().toISOString()}]${t}`)},_a=(o,t)=>{va=o,Ea=t},gu=(o,t)=>{let a=St(o),f=St(va);a>=f&&hu(a,typeof t=="function"?t():t)},ae=(...o)=>{Ea&&gu(...o)}});var Aa,Qr,Ia,yu,Sa,wu,xa,er,tr,Zr,Oa,La=U(()=>{"use strict";nt();Xr();Aa=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Qr=(o,t)=>{if(t==="int32")return o;let a=Aa.get(t);if(!a)throw new Error(`WebNN backend does not support data type: ${t}`);let f=a/8;if(o.byteLength%f!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${f}.`);let s=o.byteLength/f,c=new(rt(t))(o.buffer,o.byteOffset,s);switch(t){case"int64":case"uint64":{let l=new Int32Array(s);for(let d=0;d<s;d++){let h=c[d];if(h>2147483647n||h<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");l[d]=Number(h)}return new Uint8Array(l.buffer)}case"int8":case"uint8":case"uint32":{if(t==="uint32"&&c.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let l=Int32Array.from(c,Number);return new Uint8Array(l.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},Ia=(o,t)=>{if(t==="int32")return o;if(o.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let a=o.byteLength/4,f=new Int32Array(o.buffer,o.byteOffset,a);switch(t){case"int64":{let s=BigInt64Array.from(f,BigInt);return new Uint8Array(s.buffer)}case"uint64":{if(f.some(c=>c<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let s=BigUint64Array.from(f,BigInt);return new Uint8Array(s.buffer)}case"int8":{if(f.some(c=>c<-128||c>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let s=Int8Array.from(f,Number);return new Uint8Array(s.buffer)}case"uint8":{if(f.some(s=>s<0||s>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(f,Number)}case"uint32":{if(f.some(c=>c<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let s=Uint32Array.from(f,Number);return new Uint8Array(s.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},yu=1,Sa=()=>yu++,wu=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),xa=(o,t)=>{let a=Aa.get(o);if(!a)throw new Error(`WebNN backend does not support data type: ${o}`);return t.length>0?Math.ceil(t.reduce((f,s)=>f*s)*a/8):0},er=class{constructor(t){this.isDataConverted=!1;let{sessionId:a,context:f,tensor:s,dataType:c,shape:l,fallbackDataType:d}=t;this.sessionId=a,this.mlContext=f,this.mlTensor=s,this.dataType=c,this.tensorShape=l,this.fallbackDataType=d}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return xa(this.dataType,this.tensorShape)}destroy(){ae("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),f=Ia(new Uint8Array(a),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(f);return}else return f.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,a,f){return this.mlContext===t&&this.dataType===a&&this.tensorShape.length===f.length&&this.tensorShape.every((s,c)=>s===f[c])}setIsDataConverted(t){this.isDataConverted=t}},tr=class{constructor(t,a){this.tensorManager=t;this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,a,f,s){let c=this.tensorManager.getMLContext(t),l=this.tensorManager.getMLOpSupportLimits(t),d;if(!l?.input.dataTypes.includes(a)){if(d=wu.get(a),!d||l?.input.dataTypes.includes(d))throw new Error(`WebNN backend does not support data type: ${a}`);ae("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${d}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(c,a,f))return this.wrapper.tensor;if(s){if(this.wrapper.byteLength!==xa(a,f))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let h=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,a,f,h,!0,!0,d),s&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let a=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=Qr(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else ae("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(t){if(this.activeUpload){let a=this.wrapper?.isDataConverted?Ia(this.activeUpload,this.wrapper?.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(a):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},Zr=class{constructor(t){this.backend=t;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(t){let a=this.backend.getMLContext(t);if(!a)throw new Error("MLContext not found for session.");return a}getMLOpSupportLimits(t){return this.backend.getMLOpSupportLimits(t)}reserveTensorId(){let t=Sa();return this.tensorTrackersById.set(t,new tr(this)),t}releaseTensorId(t){let a=this.tensorTrackersById.get(t);a&&(this.tensorTrackersById.delete(t),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(t,a,f,s,c){ae("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${f}, shape: ${s}, copyOld: ${c}}`);let l=this.tensorTrackersById.get(a);if(!l)throw new Error("Tensor not found.");return l.ensureTensor(t,f,s,c)}upload(t,a){let f=this.tensorTrackersById.get(t);if(!f)throw new Error("Tensor not found.");f.upload(a)}async download(t,a){ae("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${a?.byteLength}}`);let f=this.tensorTrackersById.get(t);if(!f)throw new Error("Tensor not found.");return f.download(a)}releaseTensorsForSession(t){for(let a of this.freeTensors)a.sessionId===t&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==t)}registerTensor(t,a,f,s){let c=this.getMLContext(t),l=Sa(),d=new er({sessionId:t,context:c,tensor:a,dataType:f,shape:s});return this.tensorTrackersById.set(l,new tr(this,d)),this.externalTensors.add(d),l}async getCachedTensor(t,a,f,s,c,l,d){let h=this.getMLContext(t);for(let[b,y]of this.freeTensors.entries())if(y.canReuseTensor(h,a,f)){ae("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${f}`);let v=this.freeTensors.splice(b,1)[0];return v.sessionId=t,v}ae("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${f}}`);let g=await h.createTensor({dataType:d??a,shape:f,dimensions:f,usage:s,writable:c,readable:l});return new er({sessionId:t,context:h,tensor:g,dataType:a,shape:f,fallbackDataType:d})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},Oa=(...o)=>new Zr(...o)});var Ba={};Tt(Ba,{WebNNBackend:()=>Kr});var rr,bu,Kr,Ca=U(()=>{"use strict";nt();ze();Ta();La();Xr();rr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),bu=(o,t)=>{if(o===t)return!0;if(o===void 0||t===void 0)return!1;let a=Object.keys(o).sort(),f=Object.keys(t).sort();return a.length===f.length&&a.every((s,c)=>s===f[c]&&o[s]===t[s])},Kr=class{constructor(t){this.tensorManager=Oa(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;this.mlOpSupportLimitsBySessionId=new Map;_a(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){ae("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){ae("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let a=this.temporarySessionTensorIds.get(t);if(a){for(let f of a)ae("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${f}}`),this.tensorManager.releaseTensorId(f);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let f=this.mlContextCache.findIndex(s=>s.gpuDevice===t);if(f!==-1)return this.mlContextCache[f].mlContext;{let s=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:s}),s}}else if(t===void 0){let f=this.mlContextCache.findIndex(s=>s.options===void 0&&s.gpuDevice===void 0);if(f!==-1)return this.mlContextCache[f].mlContext;{let s=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:s}),s}}let a=this.mlContextCache.findIndex(f=>bu(f.options,t));if(a!==-1)return this.mlContextCache[a].mlContext;{let f=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:f}),f}}registerMLContext(t,a){this.mlContextBySessionId.set(t,a);let f=this.sessionIdsByMLContext.get(a);f||(f=new Set,this.sessionIdsByMLContext.set(a,f)),f.add(t),this.mlOpSupportLimitsBySessionId.has(t)||this.mlOpSupportLimitsBySessionId.set(t,a.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let a=this.mlContextBySessionId.get(t);if(!a)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t),this.mlOpSupportLimitsBySessionId.delete(t);let f=this.sessionIdsByMLContext.get(a);if(f.delete(t),f.size===0){this.sessionIdsByMLContext.delete(a);let s=this.mlContextCache.findIndex(c=>c.mlContext===a);s!==-1&&this.mlContextCache.splice(s,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}getMLOpSupportLimits(t){return this.mlOpSupportLimitsBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){ae("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,a,f,s,c){let l=rr.get(f);if(!l)throw new Error(`Unsupported ONNX data type: ${f}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,a,l,s,c)}async createTemporaryTensor(t,a,f){ae("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${f}}`);let s=rr.get(a);if(!s)throw new Error(`Unsupported ONNX data type: ${a}`);let c=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,c,s,f,!1);let l=this.temporarySessionTensorIds.get(t);return l?l.push(c):this.temporarySessionTensorIds.set(t,[c]),c}uploadTensor(t,a){if(!G().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ae("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${a.byteLength}}`),this.tensorManager.upload(t,a)}async downloadTensor(t,a){return this.tensorManager.download(t,a)}createMLTensorDownloader(t,a){return async()=>{let f=await this.tensorManager.download(t);return ba(f,a)}}registerMLTensor(t,a,f,s){let c=rr.get(f);if(!c)throw new Error(`Unsupported ONNX data type: ${f}`);let l=this.tensorManager.registerTensor(t,a,c,s);return ae("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${c}, dimensions: ${s}} -> {tensorId: ${l}}`),l}registerMLConstant(t,a,f,s,c,l,d=!1){if(!l)throw new Error("External mounted files are not available.");let h=t;t.startsWith("./")&&(h=t.substring(2));let g=l.get(h);if(!g)throw new Error(`File with name ${h} not found in preloaded files.`);if(a+f>g.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let b=g.slice(a,a+f).buffer,y;switch(c.dataType){case"float32":y=new Float32Array(b);break;case"float16":y=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(b):new Uint16Array(b);break;case"int32":y=new Int32Array(b);break;case"uint32":y=new Uint32Array(b);break;case"int64":if(d){let v=Qr(new Uint8Array(b),"int64");y=new Int32Array(v.buffer),c.dataType="int32"}else y=new BigInt64Array(b);break;case"uint64":y=new BigUint64Array(b);break;case"int8":y=new Int8Array(b);break;case"int4":case"uint4":case"uint8":y=new Uint8Array(b);break;default:throw new Error(`Unsupported data type: ${c.dataType} in creating WebNN Constant from external data.`)}return ae("verbose",()=>`[WebNN] registerMLConstant {dataType: ${c.dataType}, shape: ${c.shape}}} ${d?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),s.constant(c,y)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,a){let f=this.sessionGraphInputs.get(t);return f?f.includes(a):!1}isGraphOutput(t,a){let f=this.sessionGraphOutputs.get(t);return f?f.includes(a):!1}isGraphInputOutputTypeSupported(t,a,f=!0){let s=rr.get(je(a)),c=this.mlOpSupportLimitsBySessionId.get(t);return typeof s>"u"?!1:f?!!c?.input.dataTypes.includes(s):!!c?.output.dataTypes.includes(s)}flush(){}}});var Tu,$t,zt,ot,vu,Ma,Et,jt,Vt,Da,Ht,qt,Yt,$r=U(()=>{"use strict";$e();ga();wa();nt();ze();Xt();Jr();Tu=(o,t)=>{G()._OrtInit(o,t)!==0&&W("Can't initialize onnxruntime.")},$t=async o=>{Tu(o.wasm.numThreads,St(o.logLevel))},zt=async(o,t)=>{G().asyncInit?.();let a=o.webgpu.adapter;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(a){if(typeof a.limits!="object"||typeof a.features!="object"||typeof a.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let f=o.webgpu.powerPreference;if(f!==void 0&&f!=="low-power"&&f!=="high-performance")throw new Error(`Invalid powerPreference setting: "${f}"`);let s=o.webgpu.forceFallbackAdapter;if(s!==void 0&&typeof s!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${s}"`);if(a=await navigator.gpu.requestAdapter({powerPreference:f,forceFallbackAdapter:s}),!a)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(t==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(t==="webgpu"&&G().webgpuInit(f=>{o.webgpu.device=f}),t==="webnn"){let f=new(Ca(),Ut(Ba)).WebNNBackend(o);G().webnnInit([f,()=>f.reserveTensorId(),s=>f.releaseTensorId(s),async(s,c,l,d,h)=>f.ensureTensor(s,c,l,d,h),(s,c)=>{f.uploadTensor(s,c)},async(s,c)=>f.downloadTensor(s,c),(s,c)=>f.registerMLContext(s,c),!!o.trace])}},ot=new Map,vu=o=>{let t=G(),a=t.stackSave();try{let f=t.PTR_SIZE,s=t.stackAlloc(2*f);t._OrtGetInputOutputCount(o,s,s+f)!==0&&W("Can't get session input/output count.");let l=f===4?"i32":"i64";return[Number(t.getValue(s,l)),Number(t.getValue(s+f,l))]}finally{t.stackRestore(a)}},Ma=(o,t)=>{let a=G(),f=a.stackSave(),s=0;try{let c=a.PTR_SIZE,l=a.stackAlloc(2*c);a._OrtGetInputOutputMetadata(o,t,l,l+c)!==0&&W("Can't get session input/output metadata.");let h=Number(a.getValue(l,"*"));s=Number(a.getValue(l+c,"*"));let g=a.HEAP32[s/4];if(g===0)return[h,0];let b=a.HEAPU32[s/4+1],y=[];for(let v=0;v<b;v++){let _=Number(a.getValue(s+8+v*c,"*"));y.push(_!==0?a.UTF8ToString(_):Number(a.getValue(s+8+(v+b)*c,"*")))}return[h,g,y]}finally{a.stackRestore(f),s!==0&&a._OrtFree(s)}},Et=o=>{let t=G(),a=t._malloc(o.byteLength);if(a===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${o.byteLength}.`);return t.HEAPU8.set(o,a),[a,o.byteLength]},jt=async(o,t)=>{let a,f,s=G();Array.isArray(o)?[a,f]=o:o.buffer===s.HEAPU8.buffer?[a,f]=[o.byteOffset,o.byteLength]:[a,f]=Et(o);let c=0,l=0,d=0,h=[],g=[],b=[];try{if([l,h]=await ya(t),t?.externalData&&s.mountExternalData){let M=[];for(let P of t.externalData){let Y=typeof P=="string"?P:P.path;M.push(At(typeof P=="string"?P:P.data).then(se=>{s.mountExternalData(Y,se)}))}await Promise.all(M)}for(let M of t?.executionProviders??[])if((typeof M=="string"?M:M.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof M!="string"){let Y=M,se=Y?.context,p=Y?.gpuDevice,ee=Y?.deviceType,te=Y?.powerPreference;se?s.currentContext=se:p?s.currentContext=await s.webnnCreateMLContext(p):s.currentContext=await s.webnnCreateMLContext({deviceType:ee,powerPreference:te})}else s.currentContext=await s.webnnCreateMLContext();break}c=await s._OrtCreateSession(a,f,l),s.webgpuOnCreateSession?.(c),c===0&&W("Can't create a session."),s.jsepOnCreateSession?.(),s.currentContext&&(s.webnnRegisterMLContext(c,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[y,v]=vu(c),_=!!t?.enableGraphCapture,L=[],D=[],$=[],C=[],B=[];for(let M=0;M<y;M++){let[P,Y,se]=Ma(c,M);P===0&&W("Can't get an input name."),g.push(P);let p=s.UTF8ToString(P);L.push(p),$.push(Y===0?{name:p,isTensor:!1}:{name:p,isTensor:!0,type:Zt(Y),shape:se})}for(let M=0;M<v;M++){let[P,Y,se]=Ma(c,M+y);P===0&&W("Can't get an output name."),b.push(P);let p=s.UTF8ToString(P);D.push(p),C.push(Y===0?{name:p,isTensor:!1}:{name:p,isTensor:!0,type:Zt(Y),shape:se});{if(_&&t?.preferredOutputLocation===void 0){B.push("gpu-buffer");continue}let ee=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[p]??"cpu",te=s.webnnIsGraphOutput;if(ee==="cpu"&&te&&te(c,p)){B.push("ml-tensor-cpu-output");continue}if(ee!=="cpu"&&ee!=="cpu-pinned"&&ee!=="gpu-buffer"&&ee!=="ml-tensor")throw new Error(`Not supported preferred output location: ${ee}.`);if(_&&ee!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${ee}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);B.push(ee)}}let j=null;return B.some(M=>M==="gpu-buffer"||M==="ml-tensor"||M==="ml-tensor-cpu-output")&&(d=s._OrtCreateBinding(c),d===0&&W("Can't create IO binding."),j={handle:d,outputPreferredLocations:B,outputPreferredLocationsEncoded:B.map(M=>M==="ml-tensor-cpu-output"?"ml-tensor":M).map(M=>Yr(M))}),ot.set(c,[c,g,b,j,_,!1]),[c,L,D,$,C]}catch(y){throw g.forEach(v=>s._OrtFree(v)),b.forEach(v=>s._OrtFree(v)),d!==0&&s._OrtReleaseBinding(d)!==0&&W("Can't release IO binding."),c!==0&&s._OrtReleaseSession(c)!==0&&W("Can't release session."),y}finally{s._free(a),l!==0&&s._OrtReleaseSessionOptions(l)!==0&&W("Can't release session options."),h.forEach(y=>s._free(y)),s.unmountExternalData?.()}},Vt=o=>{let t=G(),a=ot.get(o);if(!a)throw new Error(`cannot release session. invalid session id: ${o}`);let[f,s,c,l,d]=a;l&&(d&&t._OrtClearBoundOutputs(l.handle)!==0&&W("Can't clear bound outputs."),t._OrtReleaseBinding(l.handle)!==0&&W("Can't release IO binding.")),t.jsepOnReleaseSession?.(o),t.webnnOnReleaseSession?.(o),t.webgpuOnReleaseSession?.(o),s.forEach(h=>t._OrtFree(h)),c.forEach(h=>t._OrtFree(h)),t._OrtReleaseSession(f)!==0&&W("Can't release session."),ot.delete(o)},Da=async(o,t,a,f,s,c,l=!1)=>{if(!o){t.push(0);return}let d=G(),h=d.PTR_SIZE,g=o[0],b=o[1],y=o[3],v=y,_,L;if(g==="string"&&(y==="gpu-buffer"||y==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(l&&y!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${c} when enableGraphCapture is true.`);if(y==="gpu-buffer"){let C=o[2].gpuBuffer;L=lt(je(g),b);{let B=d.webgpuRegisterBuffer;if(!B)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');_=B(C,f)}}else if(y==="ml-tensor"){let C=o[2].mlTensor;L=lt(je(g),b);let B=d.webnnRegisterMLTensor;if(!B)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');_=B(f,C,je(g),b)}else{let C=o[2];if(Array.isArray(C)){L=h*C.length,_=d._malloc(L),a.push(_);for(let B=0;B<C.length;B++){if(typeof C[B]!="string")throw new TypeError(`tensor data at index ${B} is not a string`);d.setValue(_+B*h,pe(C[B],a),"*")}}else{let B=d.webnnIsGraphInput,j=d.webnnIsGraphOutput;if(g!=="string"&&B&&j){let M=d.UTF8ToString(s);if(B(f,M)||j(f,M)){let P=je(g);L=lt(P,b),v="ml-tensor";let Y=d.webnnCreateTemporaryTensor,se=d.webnnUploadTensor;if(!Y||!se)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let p=await Y(f,P,b);se(p,new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),_=p}else L=C.byteLength,_=d._malloc(L),a.push(_),d.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,L),_)}else L=C.byteLength,_=d._malloc(L),a.push(_),d.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,L),_)}}let D=d.stackSave(),$=d.stackAlloc(4*b.length);try{b.forEach((B,j)=>d.setValue($+j*h,B,h===4?"i32":"i64"));let C=d._OrtCreateTensor(je(g),_,L,$,b.length,Yr(v));C===0&&W(`Can't create tensor for input/output. session=${f}, index=${c}.`),t.push(C)}finally{d.stackRestore(D)}},Ht=async(o,t,a,f,s,c)=>{let l=G(),d=l.PTR_SIZE,h=ot.get(o);if(!h)throw new Error(`cannot run inference. invalid session id: ${o}`);let g=h[0],b=h[1],y=h[2],v=h[3],_=h[4],L=h[5],D=t.length,$=f.length,C=0,B=[],j=[],M=[],P=[],Y=[],se=l.stackSave(),p=l.stackAlloc(D*d),ee=l.stackAlloc(D*d),te=l.stackAlloc($*d),Oe=l.stackAlloc($*d);try{[C,B]=ha(c),Fe("wasm prepareInputOutputTensor");for(let E=0;E<D;E++)await Da(a[E],j,P,o,b[t[E]],t[E],_);for(let E=0;E<$;E++)await Da(s[E],M,P,o,y[f[E]],D+f[E],_);Ge("wasm prepareInputOutputTensor");for(let E=0;E<D;E++)l.setValue(p+E*d,j[E],"*"),l.setValue(ee+E*d,b[t[E]],"*");for(let E=0;E<$;E++)l.setValue(te+E*d,M[E],"*"),l.setValue(Oe+E*d,y[f[E]],"*");if(v&&!L){let{handle:E,outputPreferredLocations:S,outputPreferredLocationsEncoded:Pe}=v;if(b.length!==D)throw new Error(`input count from feeds (${D}) is expected to be always equal to model's input count (${b.length}).`);Fe("wasm bindInputsOutputs");for(let F=0;F<D;F++){let J=t[F];await l._OrtBindInput(E,b[J],j[F])!==0&&W(`Can't bind input[${F}] for session=${o}.`)}for(let F=0;F<$;F++){let J=f[F];s[F]?.[3]?(Y.push(M[F]),l._OrtBindOutput(E,y[J],M[F],0)!==0&&W(`Can't bind pre-allocated output[${F}] for session=${o}.`)):l._OrtBindOutput(E,y[J],0,Pe[J])!==0&&W(`Can't bind output[${F}] to ${S[F]} for session=${o}.`)}Ge("wasm bindInputsOutputs"),ot.set(o,[g,b,y,v,_,!0])}l.jsepOnRunStart?.(g),l.webnnOnRunStart?.(g);let R;v?R=await l._OrtRunWithBinding(g,v.handle,$,te,C):R=await l._OrtRun(g,ee,p,D,Oe,$,te,C),R!==0&&W("failed to call OrtRun().");let ie=[],_e=[];Fe("wasm ProcessOutputTensor");for(let E=0;E<$;E++){let S=Number(l.getValue(te+E*d,"*"));if(S===M[E]||Y.includes(M[E])){ie.push(s[E]),S!==M[E]&&l._OrtReleaseTensor(S)!==0&&W("Can't release tensor.");continue}let Pe=l.stackSave(),F=l.stackAlloc(4*d),J=!1,X,Q=0;try{l._OrtGetTensorData(S,F,F+d,F+2*d,F+3*d)!==0&&W(`Can't access output tensor data on index ${E}.`);let st=d===4?"i32":"i64",Ue=Number(l.getValue(F,st));Q=l.getValue(F+d,"*");let Re=l.getValue(F+d*2,"*"),Ve=Number(l.getValue(F+d*3,st)),we=[];for(let Z=0;Z<Ve;Z++)we.push(Number(l.getValue(Re+Z*d,st)));l._OrtFree(Re)!==0&&W("Can't free memory for tensor dims.");let ue=we.reduce((Z,H)=>Z*H,1);X=Zt(Ue);let ke=v?.outputPreferredLocations[f[E]];if(X==="string"){if(ke==="gpu-buffer"||ke==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Z=[];for(let H=0;H<ue;H++){let be=l.getValue(Q+H*d,"*"),Ne=l.getValue(Q+(H+1)*d,"*"),z=H===ue-1?void 0:Ne-be;Z.push(l.UTF8ToString(be,z))}ie.push([X,we,Z,"cpu"])}else if(ke==="gpu-buffer"&&ue>0){let Z=l.webgpuGetBuffer;if(!Z)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let H=Z(Q),be=lt(Ue,ue);if(be===void 0||!Qt(X))throw new Error(`Unsupported data type: ${X}`);J=!0;{l.webgpuRegisterBuffer(H,o,Q);let Ne=l.webgpuCreateDownloader(H,be,o);ie.push([X,we,{gpuBuffer:H,download:async()=>{let z=await Ne();return new(rt(X))(z)},dispose:()=>{l._OrtReleaseTensor(S)!==0&&W("Can't release tensor.")}},"gpu-buffer"])}}else if(ke==="ml-tensor"&&ue>0){let Z=l.webnnEnsureTensor,H=l.webnnIsGraphInputOutputTypeSupported;if(!Z||!H)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(lt(Ue,ue)===void 0||!Kt(X))throw new Error(`Unsupported data type: ${X}`);if(!H(o,X,!1))throw new Error(`preferredLocation "ml-tensor" for ${X} output is not supported by current WebNN Context.`);let Ne=await Z(o,Q,Ue,we,!1);J=!0,ie.push([X,we,{mlTensor:Ne,download:l.webnnCreateMLTensorDownloader(Q,X),dispose:()=>{l.webnnReleaseTensorId(Q),l._OrtReleaseTensor(S)}},"ml-tensor"])}else if(ke==="ml-tensor-cpu-output"&&ue>0){let Z=l.webnnCreateMLTensorDownloader(Q,X)(),H=ie.length;J=!0,_e.push((async()=>{let be=[H,await Z];return l.webnnReleaseTensorId(Q),l._OrtReleaseTensor(S),be})()),ie.push([X,we,[],"cpu"])}else{let Z=rt(X),H=new Z(ue);new Uint8Array(H.buffer,H.byteOffset,H.byteLength).set(l.HEAPU8.subarray(Q,Q+H.byteLength)),ie.push([X,we,H,"cpu"])}}finally{l.stackRestore(Pe),X==="string"&&Q&&l._free(Q),J||l._OrtReleaseTensor(S)}}v&&!_&&(l._OrtClearBoundOutputs(v.handle)!==0&&W("Can't clear bound outputs."),ot.set(o,[g,b,y,v,_,!1]));for(let[E,S]of await Promise.all(_e))ie[E][2]=S;return Ge("wasm ProcessOutputTensor"),ie}finally{l.webnnOnRunEnd?.(g),l.stackRestore(se),a.forEach(R=>{R&&R[3]==="gpu-buffer"&&l.webgpuUnregisterBuffer(R[2].gpuBuffer)}),s.forEach(R=>{R&&R[3]==="gpu-buffer"&&l.webgpuUnregisterBuffer(R[2].gpuBuffer)}),j.forEach(R=>l._OrtReleaseTensor(R)),M.forEach(R=>l._OrtReleaseTensor(R)),P.forEach(R=>l._free(R)),C!==0&&l._OrtReleaseRunOptions(C),B.forEach(R=>l._free(R))}},qt=o=>{let t=G(),a=ot.get(o);if(!a)throw new Error("invalid session id");let f=a[0],s=t._OrtEndProfiling(f);s===0&&W("Can't get an profile file name."),t._OrtFree(s)},Yt=o=>{let t=[];for(let a of o){let f=a[2];!Array.isArray(f)&&"buffer"in f&&t.push(f.buffer)}return t}});var at,ye,It,or,ar,nr,en,tn,pt,dt,_u,Pa,Ua,Ra,ka,Na,Wa,Fa,rn=U(()=>{"use strict";$e();$r();ze();Ft();at=()=>!!q.wasm.proxy&&typeof document<"u",It=!1,or=!1,ar=!1,tn=new Map,pt=(o,t)=>{let a=tn.get(o);a?a.push(t):tn.set(o,[t])},dt=()=>{if(It||!or||ar||!ye)throw new Error("worker not ready")},_u=o=>{switch(o.data.type){case"init-wasm":It=!1,o.data.err?(ar=!0,en[1](o.data.err)):(or=!0,en[0]()),nr&&(URL.revokeObjectURL(nr),nr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=tn.get(o.data.type);o.data.err?t.shift()[1](o.data.err):t.shift()[0](o.data.out);break}default:}},Pa=async()=>{if(!or){if(It)throw new Error("multiple calls to 'initWasm()' detected.");if(ar)throw new Error("previous call to 'initWasm()' failed.");if(It=!0,at())return new Promise((o,t)=>{ye?.terminate(),pa().then(([a,f])=>{try{ye=f,ye.onerror=c=>t(c),ye.onmessage=_u,en=[o,t];let s={type:"init-wasm",in:q};!s.in.wasm.wasmPaths&&(a||jr)&&(s.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jspi.wasm",import.meta.url).href}),ye.postMessage(s),nr=a}catch(s){t(s)}},t)});try{await Gt(q.wasm),await $t(q),or=!0}catch(o){throw ar=!0,o}finally{It=!1}}},Ua=async o=>{if(at())return dt(),new Promise((t,a)=>{pt("init-ep",[t,a]);let f={type:"init-ep",in:{epName:o,env:q}};ye.postMessage(f)});await zt(q,o)},Ra=async o=>at()?(dt(),new Promise((t,a)=>{pt("copy-from",[t,a]);let f={type:"copy-from",in:{buffer:o}};ye.postMessage(f,[o.buffer])})):Et(o),ka=async(o,t)=>{if(at()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return dt(),new Promise((a,f)=>{pt("create",[a,f]);let s={type:"create",in:{model:o,options:{...t}}},c=[];o instanceof Uint8Array&&c.push(o.buffer),ye.postMessage(s,c)})}else return jt(o,t)},Na=async o=>{if(at())return dt(),new Promise((t,a)=>{pt("release",[t,a]);let f={type:"release",in:o};ye.postMessage(f)});Vt(o)},Wa=async(o,t,a,f,s,c)=>{if(at()){if(a.some(l=>l[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(l=>l))throw new Error("pre-allocated output tensor is not supported for proxy.");return dt(),new Promise((l,d)=>{pt("run",[l,d]);let h=a,g={type:"run",in:{sessionId:o,inputIndices:t,inputs:h,outputIndices:f,options:c}};ye.postMessage(g,Yt(h))})}else return Ht(o,t,a,f,s,c)},Fa=async o=>{if(at())return dt(),new Promise((t,a)=>{pt("end-profiling",[t,a]);let f={type:"end-profiling",in:o};ye.postMessage(f)});qt(o)}});var Ga,Su,sr,$a=U(()=>{"use strict";$e();rn();nt();Wt();Jr();Ga=(o,t)=>{switch(o.location){case"cpu":return[o.type,o.dims,o.data,"cpu"];case"gpu-buffer":return[o.type,o.dims,{gpuBuffer:o.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[o.type,o.dims,{mlTensor:o.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${o.location} for ${t()}`)}},Su=o=>{switch(o[3]){case"cpu":return new Ee(o[0],o[2],o[1]);case"gpu-buffer":{let t=o[0];if(!Qt(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:a,download:f,dispose:s}=o[2];return Ee.fromGpuBuffer(a,{dataType:t,dims:o[1],download:f,dispose:s})}case"ml-tensor":{let t=o[0];if(!Kt(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:a,download:f,dispose:s}=o[2];return Ee.fromMLTensor(a,{dataType:t,dims:o[1],download:f,dispose:s})}default:throw new Error(`invalid data location: ${o[3]}`)}},sr=class{async fetchModelAndCopyToWasmMemory(t){return Ra(await At(t))}async loadModel(t,a){Qe();let f;typeof t=="string"?f=await this.fetchModelAndCopyToWasmMemory(t):f=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await ka(f,a),Ke()}async dispose(){return Na(this.sessionId)}async run(t,a,f){Qe();let s=[],c=[];Object.entries(t).forEach(v=>{let _=v[0],L=v[1],D=this.inputNames.indexOf(_);if(D===-1)throw new Error(`invalid input '${_}'`);s.push(L),c.push(D)});let l=[],d=[];Object.entries(a).forEach(v=>{let _=v[0],L=v[1],D=this.outputNames.indexOf(_);if(D===-1)throw new Error(`invalid output '${_}'`);l.push(L),d.push(D)});let h=s.map((v,_)=>Ga(v,()=>`input "${this.inputNames[c[_]]}"`)),g=l.map((v,_)=>v?Ga(v,()=>`output "${this.outputNames[d[_]]}"`):null),b=await Wa(this.sessionId,c,h,d,g,f),y={};for(let v=0;v<b.length;v++)y[this.outputNames[d[v]]]=l[v]??Su(b[v]);return Ke(),y}startProfiling(){}endProfiling(){Fa(this.sessionId)}}});var ja={};Tt(ja,{OnnxruntimeWebAssemblyBackend:()=>ir,initializeFlags:()=>za,wasmBackend:()=>Au});var za,ir,Au,Va=U(()=>{"use strict";$e();rn();$a();za=()=>{(typeof q.wasm.initTimeout!="number"||q.wasm.initTimeout<0)&&(q.wasm.initTimeout=0);let o=q.wasm.simd;if(typeof o!="boolean"&&o!==void 0&&o!=="fixed"&&o!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${o}". Reset it to \`false\` and ignore SIMD feature checking.`),q.wasm.simd=!1),typeof q.wasm.proxy!="boolean"&&(q.wasm.proxy=!1),typeof q.wasm.trace!="boolean"&&(q.wasm.trace=!1),typeof q.wasm.numThreads!="number"||!Number.isInteger(q.wasm.numThreads)||q.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)q.wasm.numThreads=1;else{let t=typeof navigator>"u"?Ur("node:os").cpus().length:navigator.hardwareConcurrency;q.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},ir=class{async init(t){za(),await Pa(),await Ua(t)}async createInferenceSessionHandler(t,a){let f=new sr;return await f.loadModel(t,a),f}},Au=new ir});$e();$e();$e();var Ko="1.24.0-dev.20251116-b39e144322";var Sc=Gr;{let o=(Va(),Ut(ja)).wasmBackend;Xe("webgpu",o,5),Xe("webnn",o,5),Xe("cpu",o,10),Xe("wasm",o,10)}Object.defineProperty(q.versions,"web",{value:Ko,enumerable:!0});export{Ki as InferenceSession,Vo as TRACE,Fe as TRACE_EVENT_BEGIN,Ge as TRACE_EVENT_END,Qe as TRACE_FUNC_BEGIN,Ke as TRACE_FUNC_END,Ee as Tensor,Sc as default,q as env,Xe as registerBackend};
//# sourceMappingURL=ort.jspi.bundle.min.mjs.map
