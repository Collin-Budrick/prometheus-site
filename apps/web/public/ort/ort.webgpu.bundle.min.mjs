/*!
 * ONNX Runtime Web v1.24.0-dev.20251116-b39e144322
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var Yr=Object.defineProperty;var Jf=Object.getOwnPropertyDescriptor;var Xf=Object.getOwnPropertyNames;var Zf=Object.prototype.hasOwnProperty;var qr=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(r,i)=>(typeof require<"u"?require:r)[i]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+a+'" is not supported')});var F=(a,r)=>()=>(a&&(r=a(a=0)),r);var It=(a,r)=>{for(var i in r)Yr(a,i,{get:r[i],enumerable:!0})},Qf=(a,r,i,f)=>{if(r&&typeof r=="object"||typeof r=="function")for(let u of Xf(r))!Zf.call(a,u)&&u!==i&&Yr(a,u,{get:()=>r[u],enumerable:!(f=Jf(r,u))||f.enumerable});return a};var Vt=a=>Qf(Yr({},"__esModule",{value:!0}),a);var jt,Ke,et,Kf,La,Jr=F(()=>{"use strict";jt=new Map,Ke=[],et=(a,r,i)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let f=jt.get(a);if(f===void 0)jt.set(a,{backend:r,priority:i});else{if(f.priority>i)return;if(f.priority===i&&f.backend!==r)throw new Error(`cannot register backend "${a}" using priority ${i}`)}if(i>=0){let u=Ke.indexOf(a);u!==-1&&Ke.splice(u,1);for(let l=0;l<Ke.length;l++)if(jt.get(Ke[l]).priority<=i){Ke.splice(l,0,a);return}Ke.push(a)}return}throw new TypeError("not a valid backend")},Kf=async a=>{let r=jt.get(a);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let i=!!r.initPromise;try{return i||(r.initPromise=r.backend.init(a)),await r.initPromise,r.initialized=!0,r.backend}catch(f){return i||(r.error=`${f}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},La=async a=>{let r=a.executionProviders||[],i=r.map(y=>typeof y=="string"?y:y.name),f=i.length===0?Ke:i,u,l=[],p=new Set;for(let y of f){let w=await Kf(y);typeof w=="string"?l.push({name:y,err:w}):(u||(u=w),u===w&&p.add(y))}if(!u)throw new Error(`no available backend found. ERR: ${l.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:w}of l)i.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${w}`);let m=r.filter(y=>p.has(typeof y=="string"?y:y.name));return[u,new Proxy(a,{get:(y,w)=>w==="executionProviders"?m:Reflect.get(y,w)})]}});var Oa=F(()=>{"use strict";Jr()});var Ba,Ma=F(()=>{"use strict";Ba="1.24.0-dev.20251116-b39e144322"});var Ua,ue,Xr=F(()=>{"use strict";Ma();Ua="warning",ue={wasm:{},webgl:{},webgpu:{},versions:{common:Ba},set logLevel(a){if(a!==void 0){if(typeof a!="string"||["verbose","info","warning","error","fatal"].indexOf(a)===-1)throw new Error(`Unsupported logging level: ${a}`);Ua=a}},get logLevel(){return Ua}};Object.defineProperty(ue,"logLevel",{enumerable:!0})});var te,Ca=F(()=>{"use strict";Xr();te=ue});var Da,Pa,_a=F(()=>{"use strict";Da=(a,r)=>{let i=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=a.dims[3],i.height=a.dims[2];let f=i.getContext("2d");if(f!=null){let u,l;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(u=a.dims[2],l=a.dims[3]):(u=a.dims[3],l=a.dims[2]);let p=r?.format!==void 0?r.format:"RGB",m=r?.norm,y,w;m===void 0||m.mean===void 0?y=[255,255,255,255]:typeof m.mean=="number"?y=[m.mean,m.mean,m.mean,m.mean]:(y=[m.mean[0],m.mean[1],m.mean[2],0],m.mean[3]!==void 0&&(y[3]=m.mean[3])),m===void 0||m.bias===void 0?w=[0,0,0,0]:typeof m.bias=="number"?w=[m.bias,m.bias,m.bias,m.bias]:(w=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(w[3]=m.bias[3]));let v=l*u,g=0,T=v,S=v*2,B=-1;p==="RGBA"?(g=0,T=v,S=v*2,B=v*3):p==="RGB"?(g=0,T=v,S=v*2):p==="RBG"&&(g=0,S=v,T=v*2);for(let _=0;_<l;_++)for(let H=0;H<u;H++){let U=(a.data[g++]-w[0])*y[0],M=(a.data[T++]-w[1])*y[1],J=(a.data[S++]-w[2])*y[2],R=B===-1?255:(a.data[B++]-w[3])*y[3];f.fillStyle="rgba("+U+","+M+","+J+","+R+")",f.fillRect(H,_,1,1)}if("toDataURL"in i)return i.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Pa=(a,r)=>{let i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),f;if(i!=null){let u,l,p;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(u=a.dims[2],l=a.dims[1],p=a.dims[3]):(u=a.dims[3],l=a.dims[2],p=a.dims[1]);let m=r!==void 0&&r.format!==void 0?r.format:"RGB",y=r?.norm,w,v;y===void 0||y.mean===void 0?w=[255,255,255,255]:typeof y.mean=="number"?w=[y.mean,y.mean,y.mean,y.mean]:(w=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(w[3]=y.mean[3])),y===void 0||y.bias===void 0?v=[0,0,0,0]:typeof y.bias=="number"?v=[y.bias,y.bias,y.bias,y.bias]:(v=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(v[3]=y.bias[3]));let g=l*u;if(r!==void 0&&(r.format!==void 0&&p===4&&r.format!=="RGBA"||p===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let T=4,S=0,B=1,_=2,H=3,U=0,M=g,J=g*2,R=-1;m==="RGBA"?(U=0,M=g,J=g*2,R=g*3):m==="RGB"?(U=0,M=g,J=g*2):m==="RBG"&&(U=0,J=g,M=g*2),f=i.createImageData(u,l);for(let j=0;j<l*u;S+=T,B+=T,_+=T,H+=T,j++)f.data[S]=(a.data[U++]-v[0])*w[0],f.data[B]=(a.data[M++]-v[1])*w[1],f.data[_]=(a.data[J++]-v[2])*w[2],f.data[H]=R===-1?255:(a.data[R++]-v[3])*w[3]}else throw new Error("Can not access image data");return f}});var Zr,Ra,Na,Wa,ka,Fa,Ga=F(()=>{"use strict";Ht();Zr=(a,r)=>{if(a===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:i,width:f}=r,u=r.norm??{mean:255,bias:0},l,p;typeof u.mean=="number"?l=[u.mean,u.mean,u.mean,u.mean]:l=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?p=[u.bias,u.bias,u.bias,u.bias]:p=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let m=r.format!==void 0?r.format:"RGBA",y=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",w=i*f,v=y==="RGBA"?new Float32Array(w*4):new Float32Array(w*3),g=4,T=0,S=1,B=2,_=3,H=0,U=w,M=w*2,J=-1;m==="RGB"&&(g=3,T=0,S=1,B=2,_=-1),y==="RGBA"?J=w*3:y==="RBG"?(H=0,M=w,U=w*2):y==="BGR"&&(M=0,U=w,H=w*2);for(let j=0;j<w;j++,T+=g,B+=g,S+=g,_+=g)v[H++]=(a[T]+p[0])/l[0],v[U++]=(a[S]+p[1])/l[1],v[M++]=(a[B]+p[2])/l[2],J!==-1&&_!==-1&&(v[J++]=(a[_]+p[3])/l[3]);return y==="RGBA"?new ce("float32",v,[1,4,i,f]):new ce("float32",v,[1,3,i,f])},Ra=async(a,r)=>{let i=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,f=typeof ImageData<"u"&&a instanceof ImageData,u=typeof ImageBitmap<"u"&&a instanceof ImageBitmap,l=typeof a=="string",p,m=r??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},w=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(i){let v=y();v.width=a.width,v.height=a.height;let g=w(v);if(g!=null){let T=a.height,S=a.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(T=r.resizedHeight,S=r.resizedWidth),r!==void 0){if(m=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");m.tensorFormat="RGBA",m.height=T,m.width=S}else m.tensorFormat="RGBA",m.height=T,m.width=S;g.drawImage(a,0,0),p=g.getImageData(0,0,S,T).data}else throw new Error("Can not access image data")}else if(f){let v,g;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(v=r.resizedHeight,g=r.resizedWidth):(v=a.height,g=a.width),r!==void 0&&(m=r),m.format="RGBA",m.height=v,m.width=g,r!==void 0){let T=y();T.width=g,T.height=v;let S=w(T);if(S!=null)S.putImageData(a,0,0),p=S.getImageData(0,0,g,v).data;else throw new Error("Can not access image data")}else p=a.data}else if(u){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=y();v.width=a.width,v.height=a.height;let g=w(v);if(g!=null){let T=a.height,S=a.width;return g.drawImage(a,0,0,S,T),p=g.getImageData(0,0,S,T).data,m.height=T,m.width=S,Zr(p,m)}else throw new Error("Can not access image data")}else{if(l)return new Promise((v,g)=>{let T=y(),S=w(T);if(!a||!S)return g();let B=new Image;B.crossOrigin="Anonymous",B.src=a,B.onload=()=>{T.width=B.width,T.height=B.height,S.drawImage(B,0,0,T.width,T.height);let _=S.getImageData(0,0,T.width,T.height);m.height=T.height,m.width=T.width,v(Zr(_.data,m))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return Zr(p,m);throw new Error("Input data provided is not supported - aborted tensor creation")},Na=(a,r)=>{let{width:i,height:f,download:u,dispose:l}=r,p=[1,f,i,4];return new ce({location:"texture",type:"float32",texture:a,dims:p,download:u,dispose:l})},Wa=(a,r)=>{let{dataType:i,dims:f,download:u,dispose:l}=r;return new ce({location:"gpu-buffer",type:i??"float32",gpuBuffer:a,dims:f,download:u,dispose:l})},ka=(a,r)=>{let{dataType:i,dims:f,download:u,dispose:l}=r;return new ce({location:"ml-tensor",type:i??"float32",mlTensor:a,dims:f,download:u,dispose:l})},Fa=(a,r,i)=>new ce({location:"cpu-pinned",type:a,data:r,dims:i??[r.length]})});var tt,xt,$a,za,Va=F(()=>{"use strict";tt=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),xt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),$a=!1,za=()=>{if(!$a){$a=!0;let a=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,i=globalThis.Float16Array,f=typeof i<"u"&&i.from;a&&(tt.set("int64",BigInt64Array),xt.set(BigInt64Array,"int64")),r&&(tt.set("uint64",BigUint64Array),xt.set(BigUint64Array,"uint64")),f?(tt.set("float16",i),xt.set(i,"float16")):tt.set("float16",Uint16Array)}}});var ja,Ha,Ya=F(()=>{"use strict";Ht();ja=a=>{let r=1;for(let i=0;i<a.length;i++){let f=a[i];if(typeof f!="number"||!Number.isSafeInteger(f))throw new TypeError(`dims[${i}] must be an integer, got: ${f}`);if(f<0)throw new RangeError(`dims[${i}] must be a non-negative integer, got: ${f}`);r*=f}return r},Ha=(a,r)=>{switch(a.location){case"cpu":return new ce(a.type,a.data,r);case"cpu-pinned":return new ce({location:"cpu-pinned",data:a.data,type:a.type,dims:r});case"texture":return new ce({location:"texture",texture:a.texture,type:a.type,dims:r});case"gpu-buffer":return new ce({location:"gpu-buffer",gpuBuffer:a.gpuBuffer,type:a.type,dims:r});case"ml-tensor":return new ce({location:"ml-tensor",mlTensor:a.mlTensor,type:a.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${a.location} is not supported`)}}});var ce,Ht=F(()=>{"use strict";_a();Ga();Va();Ya();ce=class{constructor(r,i,f){za();let u,l;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,u=r.type,l=r.dims,r.location){case"cpu-pinned":{let m=tt.get(u);if(!m)throw new TypeError(`unsupported type "${u}" to create tensor from pinned buffer`);if(!(r.data instanceof m))throw new TypeError(`buffer should be of type ${m.name}`);this.cpuData=r.data;break}case"texture":{if(u!=="float32")throw new TypeError(`unsupported type "${u}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(u!=="float32"&&u!=="float16"&&u!=="int32"&&u!=="int64"&&u!=="uint32"&&u!=="uint8"&&u!=="bool"&&u!=="uint4"&&u!=="int4")throw new TypeError(`unsupported type "${u}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(u!=="float32"&&u!=="float16"&&u!=="int32"&&u!=="int64"&&u!=="uint32"&&u!=="uint64"&&u!=="int8"&&u!=="uint8"&&u!=="bool"&&u!=="uint4"&&u!=="int4")throw new TypeError(`unsupported type "${u}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let m,y;if(typeof r=="string")if(u=r,y=f,r==="string"){if(!Array.isArray(i))throw new TypeError("A string tensor's data must be a string array.");m=i}else{let w=tt.get(r);if(w===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(i)){if(r==="float16"&&w===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${w.name} as data.`);r==="uint64"||r==="int64"?m=w.from(i,BigInt):m=w.from(i)}else if(i instanceof w)m=i;else if(i instanceof Uint8ClampedArray)if(r==="uint8")m=Uint8Array.from(i);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&i instanceof Uint16Array&&w!==Uint16Array)m=new globalThis.Float16Array(i.buffer,i.byteOffset,i.length);else throw new TypeError(`A ${u} tensor's data must be type of ${w}`)}else if(y=i,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let w=typeof r[0];if(w==="string")u="string",m=r;else if(w==="boolean")u="bool",m=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${w}.`)}else if(r instanceof Uint8ClampedArray)u="uint8",m=Uint8Array.from(r);else{let w=xt.get(r.constructor);if(w===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);u=w,m=r}if(y===void 0)y=[m.length];else if(!Array.isArray(y))throw new TypeError("A tensor's dims must be a number array");l=y,this.cpuData=m,this.dataLocation="cpu"}let p=ja(l);if(this.cpuData&&p!==this.cpuData.length&&!((u==="uint4"||u==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=u,this.dims=l,this.size=p}static async fromImage(r,i){return Ra(r,i)}static fromTexture(r,i){return Na(r,i)}static fromGpuBuffer(r,i){return Wa(r,i)}static fromMLTensor(r,i){return ka(r,i)}static fromPinnedBuffer(r,i,f){return Fa(r,i,f)}toDataURL(r){return Da(this,r)}toImageData(r){return Pa(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let i=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=i,r&&this.disposer&&(this.disposer(),this.disposer=void 0),i}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Ha(this,r)}}});var Le,Qr=F(()=>{"use strict";Ht();Le=ce});var qa,Ja,rt,nt,$e,ze,Kr=F(()=>{"use strict";Xr();qa=(a,r)=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeStamp(`${a}::ORT::${r}`)},Ja=(a,r)=>{let i=new Error().stack?.split(/\r\n|\r|\n/g)||[],f=!1;for(let u=0;u<i.length;u++){if(f&&!i[u].includes("TRACE_FUNC")){let l=`FUNC_${a}::${i[u].trim().split(" ")[1]}`;r&&(l+=`::${r}`),qa("CPU",l);return}i[u].includes("TRACE_FUNC")&&(f=!0)}},rt=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||Ja("BEGIN",a)},nt=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||Ja("END",a)},$e=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.time(`ORT::${a}`)},ze=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeEnd(`ORT::${a}`)}});var Yt,Xa=F(()=>{"use strict";Jr();Qr();Kr();Yt=class a{constructor(r){this.handler=r}async run(r,i,f){rt(),$e("InferenceSession.run");let u={},l={};if(typeof r!="object"||r===null||r instanceof Le||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof i=="object"){if(i===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof Le)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(i.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let w of i){if(typeof w!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(w)===-1)throw new RangeError(`'fetches' contains invalid output name: ${w}.`);u[w]=null}if(typeof f=="object"&&f!==null)l=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else{let w=!1,v=Object.getOwnPropertyNames(i);for(let g of this.outputNames)if(v.indexOf(g)!==-1){let T=i[g];(T===null||T instanceof Le)&&(w=!0,p=!1,u[g]=T)}if(w){if(typeof f=="object"&&f!==null)l=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else l=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let w of this.inputNames)if(typeof r[w]>"u")throw new Error(`input '${w}' is missing in 'feeds'.`);if(p)for(let w of this.outputNames)u[w]=null;let m=await this.handler.run(r,u,l),y={};for(let w in m)if(Object.hasOwnProperty.call(m,w)){let v=m[w];v instanceof Le?y[w]=v:y[w]=new Le(v.type,v.data,v.dims)}return ze("InferenceSession.run"),nt(),y}async release(){return this.handler.dispose()}static async create(r,i,f,u){rt(),$e("InferenceSession.create");let l,p={};if(typeof r=="string"){if(l=r,typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(l=r,typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let v=r,g=0,T=r.byteLength;if(typeof i=="object"&&i!==null)p=i;else if(typeof i=="number"){if(g=i,!Number.isSafeInteger(g))throw new RangeError("'byteOffset' must be an integer.");if(g<0||g>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(T=r.byteLength-g,typeof f=="number"){if(T=f,!Number.isSafeInteger(T))throw new RangeError("'byteLength' must be an integer.");if(T<=0||g+T>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-g}].`);if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof f<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof i<"u")throw new TypeError("'options' must be an object.");l=new Uint8Array(v,g,T)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[m,y]=await La(p),w=await m.createInferenceSessionHandler(l,y);return ze("InferenceSession.create"),nt(),new a(w)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var ec,Za=F(()=>{"use strict";Xa();ec=Yt});var Qa=F(()=>{"use strict"});var Ka=F(()=>{"use strict"});var es=F(()=>{"use strict"});var ts=F(()=>{"use strict"});var en={};It(en,{InferenceSession:()=>ec,TRACE:()=>qa,TRACE_EVENT_BEGIN:()=>$e,TRACE_EVENT_END:()=>ze,TRACE_FUNC_BEGIN:()=>rt,TRACE_FUNC_END:()=>nt,Tensor:()=>Le,env:()=>te,registerBackend:()=>et});var Ve=F(()=>{"use strict";Oa();Ca();Za();Qr();Qa();Ka();Kr();es();ts()});var qt=F(()=>{"use strict"});var as={};It(as,{default:()=>tc});var ns,os,tc,ss=F(()=>{"use strict";tn();je();Jt();ns="ort-wasm-proxy-worker",os=globalThis.self?.name===ns;os&&(self.onmessage=a=>{let{type:r,in:i}=a.data;try{switch(r){case"init-wasm":Xt(i.wasm).then(()=>{Zt(i).then(()=>{postMessage({type:r})},f=>{postMessage({type:r,err:f})})},f=>{postMessage({type:r,err:f})});break;case"init-ep":{let{epName:f,env:u}=i;Qt(u,f).then(()=>{postMessage({type:r})},l=>{postMessage({type:r,err:l})});break}case"copy-from":{let{buffer:f}=i,u=Lt(f);postMessage({type:r,out:u});break}case"create":{let{model:f,options:u}=i;Kt(f,u).then(l=>{postMessage({type:r,out:l})},l=>{postMessage({type:r,err:l})});break}case"release":er(i),postMessage({type:r});break;case"run":{let{sessionId:f,inputIndices:u,inputs:l,outputIndices:p,options:m}=i;tr(f,u,l,p,new Array(p.length).fill(null),m).then(y=>{y.some(w=>w[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:y},nr([...l,...y]))},y=>{postMessage({type:r,err:y})});break}case"end-profiling":rr(i),postMessage({type:r});break;default:}}catch(f){postMessage({type:r,err:f})}});tc=os?null:a=>new Worker(a??we,{type:"module",name:ns})});var us={};It(us,{default:()=>rc});async function is(a={}){var r=a,i=typeof window=="object",f=typeof WorkerGlobalScope<"u",u=f&&self.name?.startsWith("em-pthread");r.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(r.Yc||(r.Yc=new Map)).set(e,t)},r.unmountExternalData=()=>{delete r.Yc};var l=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,Le:!0}).buffer.constructor;let p=()=>{let e=t=>(...n)=>{let s=Be;return n=t(...n),Be!=s?new Promise((o,c)=>{Br={resolve:o,reject:c}}):n};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])r[t]=e(r[t])})(),typeof jsepRunAsync<"u"&&(r._OrtRun=jsepRunAsync(r._OrtRun),r._OrtRunWithBinding=jsepRunAsync(r._OrtRunWithBinding)),p=void 0};r.asyncInit=()=>{p?.()};var m,y,w=(e,t)=>{throw t},v=import.meta.url,g="";if(i||f){try{g=new URL(".",v).href}catch{}f&&(y=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),m=async e=>{if(ne(e))return new Promise((n,s)=>{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=()=>{o.status==200||o.status==0&&o.response?n(o.response):s(o.status)},o.onerror=s,o.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var T,S,B,_,H,U,M,J=console.log.bind(console),R=console.error.bind(console),j=J,V=R,re=!1,ne=e=>e.startsWith("file://");function d(){Se.buffer!=Y.buffer&&We()}if(u){let e=function(t){try{var n=t.data,s=n.Uc;if(s==="load"){let o=[];self.onmessage=c=>o.push(c),M=()=>{postMessage({Uc:"loaded"});for(let c of o)e(c);self.onmessage=e};for(let c of n.ke)r[c]&&!r[c].proxy||(r[c]=(...h)=>{postMessage({Uc:"callHandler",je:c,args:h})},c=="print"&&(j=r[c]),c=="printErr"&&(V=r[c]));Se=n.ue,We(),U(n.Fe)}else if(s==="run"){(function(o){var c=(d(),A)[o+52>>>2>>>0];o=(d(),A)[o+56>>>2>>>0],Ro(c,c-o),C(c)})(n.Rc),zr(n.Rc,0,0,1,0,0),Tn(),Lr(n.Rc),be||(wo(),be=!0);try{Js(n.qe,n.$c)}catch(o){if(o!="unwind")throw o}}else n.target!=="setimmediate"&&(s==="checkMailbox"?be&&Pt():s&&(V(`worker: received unknown command ${s}`),V(n)))}catch(o){throw Uo(),o}};var Lc=e,be=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}var Se,Y,X,Ce,P,x,A,q,ae,$,se,br=!1;function We(){var e=Se.buffer;r.HEAP8=Y=new Int8Array(e),Ce=new Int16Array(e),r.HEAPU8=X=new Uint8Array(e),P=new Uint16Array(e),r.HEAP32=x=new Int32Array(e),r.HEAPU32=A=new Uint32Array(e),q=new Float32Array(e),ae=new Float64Array(e),$=new BigInt64Array(e),se=new BigUint64Array(e)}function Ye(){br=!0,u?M():Ge.cc()}var ct,qe=0,ye=null;function Ae(){if(--qe==0&&ye){var e=ye;ye=null,e()}}function le(e){throw V(e="Aborted("+e+")"),re=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),H?.(e),e}function oe(){return{a:{qa:cf,g:Xs,K:Zs,f:Qs,m:Ks,i:ei,ua:ti,b:ri,da:ni,Ha:xn,n:oi,ea:Mn,Xa:Un,_b:Cn,ac:Dn,Ya:Pn,Va:_n,Oa:Rn,Ua:Nn,oa:Wn,$b:kn,Yb:Fn,Wa:Gn,Zb:$n,bb:ai,Da:ii,Tb:ui,Rb:ci,Ca:li,P:pi,I:mi,Sb:hi,ka:Ei,Ub:Si,Ra:Ai,Wb:Ii,Ia:xi,Ob:Li,Fa:Oi,Qa:Lr,_a:Bi,V:Di,s:Wi,c:Ar,rb:ki,y:Fi,N:Gi,C:$i,o:zi,t:Xn,sb:Xn,J:Vi,U:ji,j:Hi,u:Yi,r:qi,k:Ji,La:Xi,Ma:Zi,Na:Qi,Ja:eo,Ka:to,Qb:ro,db:eu,ab:nu,_:ou,qb:au,la:su,$a:tu,X:iu,Za:uu,Xb:fu,G:Ki,gb:cu,Z:du,pa:kt,Vb:lu,fb:pu,eb:mu,nb:vu,D:Eu,ta:Su,sa:Au,pb:Iu,Y:xu,w:Lu,mb:Ou,lb:Bu,kb:Mu,ob:Uu,jb:Cu,ib:Du,hb:Pu,Sa:co,Ta:lo,Ga:gr,fa:po,na:mo,Pa:ho,ma:yo,Cb:Hf,ya:kf,Db:jf,za:Wf,H:Mf,e:mf,p:lf,x:df,B:Af,Ib:Pf,L:Lf,v:yf,Aa:Rf,ba:Ff,ha:Df,Eb:Vf,Fb:zf,Gb:_f,Ba:Cf,Jb:Uf,O:Of,ca:Nf,d:hf,A:bf,l:pf,Bb:Yf,q:wf,z:Sf,E:Ef,F:gf,M:If,Kb:Bf,T:Gf,ia:xf,aa:$f,Lb:vf,Mb:Tf,h:Ru,a:Se,cb:wr,Hb:Nu,ja:Wu,Q:ku,ra:Fu,Nb:Gu,R:$u,yb:zu,zb:Vu,va:ju,ga:Hu,S:Yu,Ea:qu,wa:Ju,$:Xu,wb:Zu,bc:Qu,W:Ku,Ab:ef,tb:tf,ub:nf,vb:of,xa:af,xb:sf,Pb:uf}}}class Z{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var Ie=e=>{e.terminate(),e.onmessage=()=>{}},De=[],dt=e=>{ke.length==0&&(En(),vn(ke[0]));var t=ke.pop();if(!t)return 6;vt.push(t),Je[e.Rc]=t,t.Rc=e.Rc;var n={Uc:"run",qe:e.pe,$c:e.$c,Rc:e.Rc};return t.postMessage(n,e.ee),0},Q=0,ee=(e,t,...n)=>{for(var s=2*n.length,o=D(),c=zt(8*s),h=c>>>3,b=0;b<n.length;b++){var E=n[b];typeof E=="bigint"?((d(),$)[h+2*b>>>0]=1n,(d(),$)[h+2*b+1>>>0]=E):((d(),$)[h+2*b>>>0]=0n,(d(),ae)[h+2*b+1>>>0]=E)}return e=Co(e,0,s,c,t),C(o),e};function wr(e){if(u)return ee(0,1,e);if(B=e,!(0<Q)){for(var t of vt)Ie(t);for(t of ke)Ie(t);ke=[],vt=[],Je={},re=!0}w(0,new Z(e))}function bn(e){if(u)return ee(1,0,e);gr(e)}var gr=e=>{if(B=e,u)throw bn(e),"unwind";wr(e)},ke=[],vt=[],wn=[],Je={},gn=e=>{var t=e.Rc;delete Je[t],ke.push(e),vt.splice(vt.indexOf(e),1),e.Rc=0,Do(t)};function Tn(){wn.forEach(e=>e())}var vn=e=>new Promise(t=>{e.onmessage=o=>{var c=(o=o.data).Uc;if(o.Zc&&o.Zc!=Nr()){var h=Je[o.Zc];h?h.postMessage(o,o.ee):V(`Internal error! Worker sent a message "${c}" to target pthread ${o.Zc}, but that thread no longer exists!`)}else c==="checkMailbox"?Pt():c==="spawnThread"?dt(o):c==="cleanupThread"?gn(Je[o.re]):c==="loaded"?(e.loaded=!0,t(e)):o.target==="setimmediate"?e.postMessage(o):c==="callHandler"?r[o.je](...o.args):c&&V(`worker sent an unknown command ${c}`)},e.onerror=o=>{throw V(`worker sent an error! ${o.filename}:${o.lineno}: ${o.message}`),o};var n,s=[];for(n of[])r.propertyIsEnumerable(n)&&s.push(n);e.postMessage({Uc:"load",ke:s,ue:Se,Fe:S})});function En(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ke.push(e)}var Js=(e,t)=>{Q=0,e=Hr(e,t),0<Q?B=e:Vr(e)},Ct=[],Dt=0,pe=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function Xs(e){var t=new Tr(e>>>=0);return(d(),Y)[t.Tc+12>>>0]==0&&(Sn(t,!0),Dt--),An(t,!1),Ct.push(t),Wo(e),Fo(e)}var lt=0,Zs=()=>{k(0,0);var e=Ct.pop();No(e.md),lt=0};function Sn(e,t){t=t?1:0,(d(),Y)[e.Tc+12>>>0]=t}function An(e,t){t=t?1:0,(d(),Y)[e.Tc+13>>>0]=t}class Tr{constructor(t){this.md=t,this.Tc=t-24}}var vr=e=>{var t=lt;if(!t)return At(0),0;var n=new Tr(t);(d(),A)[n.Tc+16>>>2>>>0]=t;var s=(d(),A)[n.Tc+4>>>2>>>0];if(!s)return At(0),t;for(var o of e){if(o===0||o===s)break;if(ko(o,s,n.Tc+16))return At(o),t}return At(s),t};function Qs(){return vr([])}function Ks(e){return vr([e>>>0])}function ei(e,t,n,s){return vr([e>>>0,t>>>0,n>>>0,s>>>0])}var ti=()=>{var e=Ct.pop();e||le("no exception to throw");var t=e.md;throw(d(),Y)[e.Tc+13>>>0]==0&&(Ct.push(e),An(e,!0),Sn(e,!1),Dt++),lt=t};function ri(e,t,n){var s=new Tr(e>>>=0);throw t>>>=0,n>>>=0,(d(),A)[s.Tc+16>>>2>>>0]=0,(d(),A)[s.Tc+4>>>2>>>0]=t,(d(),A)[s.Tc+8>>>2>>>0]=n,Dt++,lt=e}var ni=()=>Dt;function In(e,t,n,s){return u?ee(2,1,e,t,n,s):xn(e,t,n,s)}function xn(e,t,n,s){if(e>>>=0,n>>>=0,s>>>=0,l===void 0)return 6;var o=[];return u&&o.length===0?In(e,t>>>=0,n,s):(e={pe:n,Rc:e,$c:s,ee:o},u?(e.Uc="spawnThread",postMessage(e,o),0):dt(e))}function oi(e){throw lt||=e>>>0,lt}var Ln=typeof TextDecoder<"u"?new TextDecoder:void 0,On=(e,t,n,s)=>{if(n=t+n,s)return n;for(;e[t]&&!(t>=n);)++t;return t},Bn=(e,t=0,n,s)=>{if(16<(n=On(e,t>>>=0,n,s))-t&&e.buffer&&Ln)return Ln.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(s="";t<n;){var o=e[t++];if(128&o){var c=63&e[t++];if((224&o)==192)s+=String.fromCharCode((31&o)<<6|c);else{var h=63&e[t++];65536>(o=(240&o)==224?(15&o)<<12|c<<6|h:(7&o)<<18|c<<12|h<<6|63&e[t++])?s+=String.fromCharCode(o):(o-=65536,s+=String.fromCharCode(55296|o>>10,56320|1023&o))}}else s+=String.fromCharCode(o)}return s},pt=(e,t,n)=>(e>>>=0)?Bn((d(),X),e,t,n):"";function Mn(e,t,n){return u?ee(3,1,e,t,n):0}function Un(e,t){if(u)return ee(4,1,e,t)}function Cn(e,t){if(u)return ee(5,1,e,t)}function Dn(e,t,n){if(u)return ee(6,1,e,t,n)}function Pn(e,t,n){return u?ee(7,1,e,t,n):0}function _n(e,t){if(u)return ee(8,1,e,t)}function Rn(e,t,n){if(u)return ee(9,1,e,t,n)}function Nn(e,t,n,s){if(u)return ee(10,1,e,t,n,s)}function Wn(e,t,n,s){if(u)return ee(11,1,e,t,n,s)}function kn(e,t,n,s){if(u)return ee(12,1,e,t,n,s)}function Fn(e){if(u)return ee(13,1,e)}function Gn(e,t){if(u)return ee(14,1,e,t)}function $n(e,t,n){if(u)return ee(15,1,e,t,n)}var ai=()=>le(""),Oe=e=>{e>>>=0;for(var t="";;){var n=(d(),X)[e++>>>0];if(!n)return t;t+=String.fromCharCode(n)}},Er={},Sr={},si={},mt=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Pe(e,t,n={}){return function(s,o,c={}){var h=o.name;if(!s)throw new mt(`type "${h}" must have a positive integer typeid pointer`);if(Sr.hasOwnProperty(s)){if(c.le)return;throw new mt(`Cannot register type '${h}' twice`)}Sr[s]=o,delete si[s],Er.hasOwnProperty(s)&&(o=Er[s],delete Er[s],o.forEach(b=>b()))}(e,t,n)}var zn=(e,t,n)=>{switch(t){case 1:return n?s=>(d(),Y)[s>>>0]:s=>(d(),X)[s>>>0];case 2:return n?s=>(d(),Ce)[s>>>1>>>0]:s=>(d(),P)[s>>>1>>>0];case 4:return n?s=>(d(),x)[s>>>2>>>0]:s=>(d(),A)[s>>>2>>>0];case 8:return n?s=>(d(),$)[s>>>3>>>0]:s=>(d(),se)[s>>>3>>>0];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function ii(e,t,n,s,o){e>>>=0,n>>>=0,t=Oe(t>>>0);let c=h=>h;if(s=s===0n){let h=8*n;c=b=>BigInt.asUintN(h,b),o=c(o)}Pe(e,{name:t,Qc:c,Wc:(h,b)=>(typeof b=="number"&&(b=BigInt(b)),b),Vc:zn(t,n,!s),Xc:null})}function ui(e,t,n,s){Pe(e>>>=0,{name:t=Oe(t>>>0),Qc:function(o){return!!o},Wc:function(o,c){return c?n:s},Vc:function(o){return this.Qc((d(),X)[o>>>0])},Xc:null})}var Vn=[],Xe=[0,1,,1,null,1,!0,1,!1,1];function Ar(e){9<(e>>>=0)&&--Xe[e+1]==0&&(Xe[e]=void 0,Vn.push(e))}var ge=e=>{if(!e)throw new mt(`Cannot use deleted val. handle = ${e}`);return Xe[e]},xe=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Vn.pop()||Xe.length;return Xe[t]=e,Xe[t+1]=1,t}};function Ir(e){return this.Qc((d(),A)[e>>>2>>>0])}var fi={name:"emscripten::val",Qc:e=>{var t=ge(e);return Ar(e),t},Wc:(e,t)=>xe(t),Vc:Ir,Xc:null};function ci(e){return Pe(e>>>0,fi)}var di=(e,t)=>{switch(t){case 4:return function(n){return this.Qc((d(),q)[n>>>2>>>0])};case 8:return function(n){return this.Qc((d(),ae)[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function li(e,t,n){n>>>=0,Pe(e>>>=0,{name:t=Oe(t>>>0),Qc:s=>s,Wc:(s,o)=>o,Vc:di(t,n),Xc:null})}function pi(e,t,n,s,o){e>>>=0,n>>>=0,t=Oe(t>>>0);let c=b=>b;if(s===0){var h=32-8*n;c=b=>b<<h>>>h,o=c(o)}Pe(e,{name:t,Qc:c,Wc:(b,E)=>E,Vc:zn(t,n,s!==0),Xc:null})}function mi(e,t,n){function s(c){var h=(d(),A)[c>>>2>>>0];return c=(d(),A)[c+4>>>2>>>0],new o((d(),Y).buffer,c,h)}var o=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Pe(e>>>=0,{name:n=Oe(n>>>0),Qc:s,Vc:s},{le:!0})}var _e=(e,t,n)=>{var s=(d(),X);if(t>>>=0,0<n){var o=t;n=t+n-1;for(var c=0;c<e.length;++c){var h=e.codePointAt(c);if(127>=h){if(t>=n)break;s[t++>>>0]=h}else if(2047>=h){if(t+1>=n)break;s[t++>>>0]=192|h>>6,s[t++>>>0]=128|63&h}else if(65535>=h){if(t+2>=n)break;s[t++>>>0]=224|h>>12,s[t++>>>0]=128|h>>6&63,s[t++>>>0]=128|63&h}else{if(t+3>=n)break;s[t++>>>0]=240|h>>18,s[t++>>>0]=128|h>>12&63,s[t++>>>0]=128|h>>6&63,s[t++>>>0]=128|63&h,c++}}s[t>>>0]=0,e=t-o}else e=0;return e},Re=e=>{for(var t=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);127>=s?t++:2047>=s?t+=2:55296<=s&&57343>=s?(t+=4,++n):t+=3}return t};function hi(e,t){Pe(e>>>=0,{name:t=Oe(t>>>0),Qc(n){var s=(d(),A)[n>>>2>>>0];return s=pt(n+4,s,!0),Te(n),s},Wc(n,s){s instanceof ArrayBuffer&&(s=new Uint8Array(s));var o=typeof s=="string";if(!(o||ArrayBuffer.isView(s)&&s.BYTES_PER_ELEMENT==1))throw new mt("Cannot pass non-string to std::string");var c=o?Re(s):s.length,h=bt(4+c+1),b=h+4;return(d(),A)[h>>>2>>>0]=c,o?_e(s,b,c+1):(d(),X).set(s,b>>>0),n!==null&&n.push(Te,h),h},Vc:Ir,Xc(n){Te(n)}})}var jn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,yi=(e,t,n)=>{if(e>>>=1,16<(t=On((d(),P),e,t/2,n))-e&&jn)return jn.decode((d(),P).buffer instanceof ArrayBuffer?(d(),P).subarray(e>>>0,t>>>0):(d(),P).slice(e,t));for(n="";e<t;++e){var s=(d(),P)[e>>>0];n+=String.fromCharCode(s)}return n},bi=(e,t,n)=>{if(n??=2147483647,2>n)return 0;var s=t;n=(n-=2)<2*e.length?n/2:e.length;for(var o=0;o<n;++o){var c=e.charCodeAt(o);(d(),Ce)[t>>>1>>>0]=c,t+=2}return(d(),Ce)[t>>>1>>>0]=0,t-s},wi=e=>2*e.length,gi=(e,t,n)=>{var s="";e>>>=2;for(var o=0;!(o>=t/4);o++){var c=(d(),A)[e+o>>>0];if(!c&&!n)break;s+=String.fromCodePoint(c)}return s},Ti=(e,t,n)=>{if(t>>>=0,n??=2147483647,4>n)return 0;var s=t;n=s+n-4;for(var o=0;o<e.length;++o){var c=e.codePointAt(o);if(65535<c&&o++,(d(),x)[t>>>2>>>0]=c,(t+=4)+4>n)break}return(d(),x)[t>>>2>>>0]=0,t-s},vi=e=>{for(var t=0,n=0;n<e.length;++n)65535<e.codePointAt(n)&&n++,t+=4;return t};function Ei(e,t,n){if(e>>>=0,t>>>=0,n=Oe(n>>>=0),t===2)var s=yi,o=bi,c=wi;else s=gi,o=Ti,c=vi;Pe(e,{name:n,Qc:h=>{var b=(d(),A)[h>>>2>>>0];return b=s(h+4,b*t,!0),Te(h),b},Wc:(h,b)=>{if(typeof b!="string")throw new mt(`Cannot pass non-string to C++ string type ${n}`);var E=c(b),I=bt(4+E+t);return(d(),A)[I>>>2>>>0]=E/t,o(b,I+4,E+t),h!==null&&h.push(Te,I),I},Vc:Ir,Xc(h){Te(h)}})}function Si(e,t){Pe(e>>>=0,{me:!0,name:t=Oe(t>>>0),Qc:()=>{},Wc:()=>{}})}function Ai(e){zr(e>>>0,!f,1,!i,131072,!1),Tn()}var xr=e=>{if(!re)try{if(e(),!(0<Q))try{u?Vr(B):gr(B)}catch(t){t instanceof Z||t=="unwind"||w(0,t)}}catch(t){t instanceof Z||t=="unwind"||w(0,t)}};function Lr(e){e>>>=0,typeof Atomics.te=="function"&&(Atomics.te((d(),x),e>>>2,e).value.then(Pt),e+=128,Atomics.store((d(),x),e>>>2,1))}var Pt=()=>{var e=Nr();e&&(Lr(e),xr(_o))};function Ii(e,t){(e>>>=0)==t>>>0?setTimeout(Pt):u?postMessage({Zc:e,Uc:"checkMailbox"}):(e=Je[e])&&e.postMessage({Uc:"checkMailbox"})}var _t=[];function xi(e,t,n,s,o){for(t>>>=0,s/=2,_t.length=s,n=o>>>0>>>3,o=0;o<s;o++)(d(),$)[n+2*o>>>0]?_t[o]=(d(),$)[n+2*o+1>>>0]:_t[o]=(d(),ae)[n+2*o+1>>>0];return(t?_r[t]:ff[e])(..._t)}var Li=()=>{Q=0};function Oi(e){e>>>=0,u?postMessage({Uc:"cleanupThread",re:e}):gn(Je[e])}function Bi(e){}var Rt=e=>{try{e()}catch(t){le(t)}};function Mi(e){var t=(...n)=>{Nt.push(e);try{return e(...n)}finally{re||(Nt.pop(),Be&&Fe===1&&Nt.length===0&&(Fe=0,Q+=1,Rt(Aa),typeof Fibers<"u"&&Fibers.Ne()))}};return qn.set(e,t),t}var Fe=0,Be=null,Hn=0,Nt=[],Or=new Map,Yn=new Map,qn=new Map,Ui=0,Br=null,Ci=[],Jn=e=>function(t){if(!re){if(Fe===0){var n=!1,s=!1;t((o=0)=>{if(!re&&(Hn=o,n=!0,s)){Fe=2,Rt(()=>Ia(Be)),typeof MainLoop<"u"&&MainLoop.ie&&MainLoop.resume(),o=!1;try{var c=function(){var E=(d(),x)[Be+8>>>2>>>0];return E=Yn.get(E),E=qn.get(E),--Q,E()}()}catch(E){c=E,o=!0}var h=!1;if(!Be){var b=Br;b&&(Br=null,(o?b.reject:b.resolve)(c),h=!0)}if(o&&!h)throw c}}),s=!0,n||(Fe=1,Be=function(){var o=bt(65548),c=o+12;if((d(),A)[o>>>2>>>0]=c,(d(),A)[o+4>>>2>>>0]=c+65536,c=Nt[0],!Or.has(c)){var h=Ui++;Or.set(c,h),Yn.set(h,c)}return c=Or.get(c),(d(),x)[o+8>>>2>>>0]=c,o}(),typeof MainLoop<"u"&&MainLoop.ie&&MainLoop.pause(),Rt(()=>Sa(Be)))}else Fe===2?(Fe=0,Rt(xa),Te(Be),Be=null,Ci.forEach(xr)):le(`invalid state: ${Fe}`);return Hn}}(t=>{e().then(t)});function Di(e){return e>>>=0,Jn(async()=>{var t=await ge(e);return xe(t)})}var Mr=[],Pi=e=>{var t=Mr.length;return Mr.push(e),t},_i=(e,t)=>{for(var n=Array(e),s=0;s<e;++s){var o=s,c=(d(),A)[t+4*s>>>2>>>0],h=Sr[c];if(h===void 0)throw e=`parameter ${s}`,c=bo(c),t=Oe(c),Te(c),new mt(`${e} has unknown type ${t}`);n[o]=h}return n},Ri=(e,t,n)=>{var s=[];return e=e(s,n),s.length&&((d(),A)[t>>>2>>>0]=xe(s)),e},Ni={},Wt=e=>{var t=Ni[e];return t===void 0?Oe(e):t};function Wi(e,t,n){var[s,...o]=_i(e,t>>>0);t=s.Wc.bind(s);var c=o.map(E=>E.Vc.bind(E));e--;var h={toValue:ge};switch(e=c.map((E,I)=>{var N=`argFromPtr${I}`;return h[N]=E,`${N}(args${I?"+"+8*I:""})`}),n){case 0:var b="toValue(handle)";break;case 2:b="new (toValue(handle))";break;case 3:b="";break;case 1:h.getStringOrSymbol=Wt,b="toValue(handle)[getStringOrSymbol(methodName)]"}return b+=`(${e})`,s.me||(h.toReturnWire=t,h.emval_returnValue=Ri,b=`return emval_returnValue(toReturnWire, destructorsRef, ${b})`),b=`return function (handle, methodName, destructorsRef, args) {
  ${b}
  }`,n=new Function(Object.keys(h),b)(...Object.values(h)),b=`methodCaller<(${o.map(E=>E.name)}) => ${s.name}>`,Pi(Object.defineProperty(n,"name",{value:b}))}function ki(e,t){return t>>>=0,(e=ge(e>>>0))==ge(t)}function Fi(e){return(e>>>=0)==0?xe(globalThis):(e=Wt(e),xe(globalThis[e]))}function Gi(e){return e=Wt(e>>>0),xe(r[e])}function $i(e,t){return t>>>=0,e=ge(e>>>0),t=ge(t),xe(e[t])}function zi(e){9<(e>>>=0)&&(Xe[e+1]+=1)}function Xn(e,t,n,s,o){return Mr[e>>>0](t>>>0,n>>>0,s>>>0,o>>>0)}function Vi(){return xe([])}function ji(e){e=ge(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return xe(t)}function Hi(e){return xe(Wt(e>>>0))}function Yi(){return xe({})}function qi(e){for(var t=ge(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}Ar(e)}function Ji(e,t,n){t>>>=0,n>>>=0,e=ge(e>>>0),t=ge(t),n=ge(n),e[t]=n}function Xi(e,t){e=pe(e),t>>>=0,e=new Date(1e3*e),(d(),x)[t>>>2>>>0]=e.getUTCSeconds(),(d(),x)[t+4>>>2>>>0]=e.getUTCMinutes(),(d(),x)[t+8>>>2>>>0]=e.getUTCHours(),(d(),x)[t+12>>>2>>>0]=e.getUTCDate(),(d(),x)[t+16>>>2>>>0]=e.getUTCMonth(),(d(),x)[t+20>>>2>>>0]=e.getUTCFullYear()-1900,(d(),x)[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(d(),x)[t+28>>>2>>>0]=e}var Zn=e=>e%4==0&&(e%100!=0||e%400==0),Qn=[0,31,60,91,121,152,182,213,244,274,305,335],Kn=[0,31,59,90,120,151,181,212,243,273,304,334];function Zi(e,t){e=pe(e),t>>>=0,e=new Date(1e3*e),(d(),x)[t>>>2>>>0]=e.getSeconds(),(d(),x)[t+4>>>2>>>0]=e.getMinutes(),(d(),x)[t+8>>>2>>>0]=e.getHours(),(d(),x)[t+12>>>2>>>0]=e.getDate(),(d(),x)[t+16>>>2>>>0]=e.getMonth(),(d(),x)[t+20>>>2>>>0]=e.getFullYear()-1900,(d(),x)[t+24>>>2>>>0]=e.getDay();var n=(Zn(e.getFullYear())?Qn:Kn)[e.getMonth()]+e.getDate()-1|0;(d(),x)[t+28>>>2>>>0]=n,(d(),x)[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var s=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=s&&e.getTimezoneOffset()==Math.min(s,n)),(d(),x)[t+32>>>2>>>0]=e}function Qi(e){e>>>=0;var t=new Date((d(),x)[e+20>>>2>>>0]+1900,(d(),x)[e+16>>>2>>>0],(d(),x)[e+12>>>2>>>0],(d(),x)[e+8>>>2>>>0],(d(),x)[e+4>>>2>>>0],(d(),x)[e>>>2>>>0],0),n=(d(),x)[e+32>>>2>>>0],s=t.getTimezoneOffset(),o=new Date(t.getFullYear(),6,1).getTimezoneOffset(),c=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(c,o);return 0>n?(d(),x)[e+32>>>2>>>0]=+(o!=c&&h==s):0<n!=(h==s)&&(o=Math.max(c,o),t.setTime(t.getTime()+6e4*((0<n?h:o)-s))),(d(),x)[e+24>>>2>>>0]=t.getDay(),n=(Zn(t.getFullYear())?Qn:Kn)[t.getMonth()]+t.getDate()-1|0,(d(),x)[e+28>>>2>>>0]=n,(d(),x)[e>>>2>>>0]=t.getSeconds(),(d(),x)[e+4>>>2>>>0]=t.getMinutes(),(d(),x)[e+8>>>2>>>0]=t.getHours(),(d(),x)[e+12>>>2>>>0]=t.getDate(),(d(),x)[e+16>>>2>>>0]=t.getMonth(),(d(),x)[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function eo(e,t,n,s,o,c,h){return u?ee(16,1,e,t,n,s,o,c,h):-52}function to(e,t,n,s,o,c){if(u)return ee(17,1,e,t,n,s,o,c)}var Et={},Ki=()=>performance.timeOrigin+performance.now();function ro(e,t){if(u)return ee(18,1,e,t);if(Et[e]&&(clearTimeout(Et[e].id),delete Et[e]),!t)return 0;var n=setTimeout(()=>{delete Et[e],xr(()=>Po(e,performance.timeOrigin+performance.now()))},t);return Et[e]={id:n,Me:t},0}function eu(e,t,n,s){e>>>=0,t>>>=0,n>>>=0,s>>>=0;var o=new Date().getFullYear(),c=new Date(o,0,1).getTimezoneOffset();o=new Date(o,6,1).getTimezoneOffset();var h=Math.max(c,o);(d(),A)[e>>>2>>>0]=60*h,(d(),x)[t>>>2>>>0]=+(c!=o),e=(t=b=>{var E=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(E/60)).padStart(2,"0")}${String(E%60).padStart(2,"0")}`})(c),t=t(o),o<c?(_e(e,n,17),_e(t,s,17)):(_e(e,s,17),_e(t,n,17))}var tu=()=>Date.now(),ru=1;function nu(e,t,n){if(n>>>=0,!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!ru)return 52;e=performance.timeOrigin+performance.now()}return e=Math.round(1e6*e),(d(),$)[n>>>3>>>0]=BigInt(e),0}var Ur=[],no=(e,t)=>{Ur.length=0;for(var n;n=(d(),X)[e++>>>0];){var s=n!=105;t+=(s&=n!=112)&&t%8?4:0,Ur.push(n==112?(d(),A)[t>>>2>>>0]:n==106?(d(),$)[t>>>3>>>0]:n==105?(d(),x)[t>>>2>>>0]:(d(),ae)[t>>>3>>>0]),t+=s?8:4}return Ur};function ou(e,t,n){return e>>>=0,t=no(t>>>0,n>>>0),_r[e](...t)}function au(e,t,n){return e>>>=0,t=no(t>>>0,n>>>0),_r[e](...t)}var su=()=>{};function iu(e,t){return V(pt(e>>>0,t>>>0))}var uu=()=>{throw Q+=1,"unwind"};function fu(){return 4294901760}var cu=()=>1,du=()=>navigator.hardwareConcurrency,Ze={},oo=e=>{var t=Re(e)+1,n=bt(t);return n&&_e(e,n,t),n};function kt(e){if(!(2147483648&(e>>>=0)))return le("Cannot use emscripten_pc_get_function on native functions without -sUSE_OFFSET_CONVERTER"),0;if(!(e=Ze[e]))return 0;var t;if(t=/^\s+at (.*) \(.*\)$/.exec(e))e=t[1];else{if(!(t=/^(.+?)@/.exec(e)))return 0;e=t[1]}return Te(kt.$d??0),kt.$d=oo(e),kt.$d}function lu(e){e>>>=0;var t=(d(),X).length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var s=t*(1+.2/n);s=Math.min(s,e+100663296);e:{s=(Math.min(4294901760,65536*Math.ceil(Math.max(e,s)/65536))-Se.buffer.byteLength+65535)/65536|0;try{Se.grow(s),We();var o=1;break e}catch{}o=void 0}if(o)return!0}return!1}var Ft=e=>{var t;if(t=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(e))return+t[1];if(/\bwasm-function\[(\d+)\]:(\d+)/.exec(e))le("Legacy backtrace format detected but -sUSE_OFFSET_CONVERTER not present.");else if(t=/:(\d+):\d+(?:\)|$)/.exec(e))return 2147483648|+t[1];return 0},ao=e=>{e.forEach(t=>{var n=Ft(t);n&&(Ze[n]=t)})};function pu(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),ao(e),Ze.Wd=Ft(e[3]),Ze.oe=e,Ze.Wd}function mu(e,t,n){if(e>>>=0,t>>>=0,Ze.Wd==e)var s=Ze.oe;else(s=Error().stack.toString().split(`
`))[0]=="Error"&&s.shift(),ao(s);for(var o=3;s[o]&&Ft(s[o])!=e;)++o;for(e=0;e<n&&s[e+o];++e)(d(),x)[t+4*e>>>2>>>0]=Ft(s[e+o]);return e}var Me=e=>{var t=Re(e)+1,n=zt(t);return _e(e,n,t),n},Cr=[],me=(e,t)=>{Cr[e>>>=0]=t},Ue=[],Gt=[],ht=(e,t)=>{Gt[e]=new Promise(n=>t.finally(()=>n(e)))},O=e=>{if(e)return Cr[e>>>0]},$t=(e,t,n)=>{(d(),A)[e>>>2>>>0]=t,(d(),A)[e+4>>>2>>>0]=n},so=e=>{var t=(d(),A)[e>>>2>>>0];return e=(d(),A)[e+4>>>2>>>0],pt(t,e)},Ne=e=>{var t=(d(),A)[e>>>2>>>0];return e=(d(),A)[e+4>>>2>>>0],t?pt(t,e):e===0?"":void 0},hu=e=>{var t=Ne(e+4),n=(n=(d(),A)[e+12>>>2>>>0])?O(n):"auto";if(e+=16){var s=O((d(),A)[e+4>>>2>>>0]),o=(d(),A)[e+16>>>2>>>0],c=(d(),A)[e+20>>>2>>>0];if(o){for(var h={},b=0;b<o;++b){var E=c+24*b;h[so(E+4)]=(d(),ae)[E+16>>>3>>>0]}o=h}else o=void 0;e={module:s,constants:o,entryPoint:Ne(e+8)}}else e=void 0;return{label:t,layout:n,compute:e}},io=(e,t)=>{function n(o,c){o=e[o],(d(),x)[t+c>>>2>>>0]=o}function s(o,c){o=e[o],(d(),$)[t+c>>>3>>>0]=BigInt(o)}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),s("maxUniformBufferBindingSize",64),s("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),s("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.Ke!==void 0&&n("maxImmediateSize",148)},yu=[,"validation","out-of-memory","internal"],bu=[,"compatibility","core"],uo={1:"core-features-and-limits",2:"depth-clip-control",3:"depth32float-stencil8",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"timestamp-query",10:"indirect-first-instance",11:"shader-f16",12:"rg11b10ufloat-renderable",13:"bgra8unorm-storage",14:"float32-filterable",15:"float32-blendable",16:"clip-distances",17:"dual-source-blending",18:"subgroups",19:"texture-formats-tier1",20:"texture-formats-tier2",21:"primitive-index",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},wu=[,"low-power","high-performance"],gu=[,"occlusion","timestamp"],Tu={undefined:1,unknown:1,destroyed:2};function vu(e,t,n,s,o,c){t=pe(t),n=pe(n),s>>>=0,o>>>=0,c>>>=0;var h=O(e>>>0);if(e={},c){var b=(d(),A)[c+12>>>2>>>0];if(b){var E=(d(),A)[c+16>>>2>>>0];e.requiredFeatures=Array.from((d(),A).subarray(E>>>2>>>0,E+4*b>>>2>>>0),L=>uo[L])}var I=(d(),A)[c+20>>>2>>>0];if(I){let L=function(ve,ie,Qe=!1){ie=I+ie,(ie=(d(),A)[ie>>>2>>>0])==4294967295||Qe&&ie==0||(N[ve]=ie)},fe=function(ve,ie){ie=I+ie;var Qe=(d(),A)[ie>>>2>>>0],qf=(d(),A)[ie+4>>>2>>>0];Qe==4294967295&&qf==4294967295||(N[ve]=4294967296*(d(),A)[ie+4>>>2>>>0]+(d(),A)[ie>>>2>>>0])};var W=L,K=fe,N={};L("maxTextureDimension1D",4),L("maxTextureDimension2D",8),L("maxTextureDimension3D",12),L("maxTextureArrayLayers",16),L("maxBindGroups",20),L("maxBindGroupsPlusVertexBuffers",24),L("maxDynamicUniformBuffersPerPipelineLayout",32),L("maxDynamicStorageBuffersPerPipelineLayout",36),L("maxSampledTexturesPerShaderStage",40),L("maxSamplersPerShaderStage",44),L("maxStorageBuffersPerShaderStage",48),L("maxStorageTexturesPerShaderStage",52),L("maxUniformBuffersPerShaderStage",56),L("minUniformBufferOffsetAlignment",80),L("minStorageBufferOffsetAlignment",84),fe("maxUniformBufferBindingSize",64),fe("maxStorageBufferBindingSize",72),L("maxVertexBuffers",88),fe("maxBufferSize",96),L("maxVertexAttributes",104),L("maxVertexBufferArrayStride",108),L("maxInterStageShaderVariables",112),L("maxColorAttachments",116),L("maxColorAttachmentBytesPerSample",120),L("maxComputeWorkgroupStorageSize",124),L("maxComputeInvocationsPerWorkgroup",128),L("maxComputeWorkgroupSizeX",132),L("maxComputeWorkgroupSizeY",136),L("maxComputeWorkgroupSizeZ",140),L("maxComputeWorkgroupsPerDimension",144),L("maxImmediateSize",148,!0),e.requiredLimits=N}(b=(d(),A)[c+24>>>2>>>0])&&(b={label:Ne(b+4)},e.defaultQueue=b),e.label=Ne(c+4)}Q+=1,ht(t,h.requestDevice(e).then(L=>{--Q,me(o,L.queue),me(s,L),n&&(Q+=1,ht(n,L.lost.then(fe=>{--Q,L.onuncapturederror=()=>{};var ve=D(),ie=Me(fe.message);kr(n,Tu[fe.reason],ie),C(ve)}))),L.onuncapturederror=fe=>{var ve=5;fe.error instanceof GPUValidationError?ve=2:fe.error instanceof GPUOutOfMemoryError?ve=3:fe.error instanceof GPUInternalError&&(ve=4);var ie=D();fe=Me(fe.error.message),Mo(s,ve,fe),C(ie)},"adapterInfo"in L||(L.adapterInfo=h.info),$r(t,1,s,0)},L=>{--Q;var fe=D();L=Me(L.message),$r(t,3,s,L),n&&kr(n,4,L),C(fe)}))}function Eu(e){var t=O(e>>>=0),n=Ue[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Ue[e]}t.destroy()}var yt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";yt.dd||(yt.dd={}),yt.dd[e]||(yt.dd[e]=1,V(e))};function Su(e,t,n){t>>>=0,n>>>=0;var s=O(e>>>=0);n===0&&yt(),n==4294967295&&(n=void 0);try{var o=s.getMappedRange(t,n)}catch{return 0}var c=jr(16,o.byteLength);return(d(),X).set(new Uint8Array(o),c>>>0),Ue[e].push(()=>Te(c)),c}function Au(e,t,n){t>>>=0,n>>>=0;var s=O(e>>>=0);n===0&&yt(),n==4294967295&&(n=void 0);try{var o=s.getMappedRange(t,n)}catch{return 0}var c=jr(16,o.byteLength);return(d(),X).fill(0,c,o.byteLength),Ue[e].push(()=>{new Uint8Array(o).set((d(),X).subarray(c>>>0,c+o.byteLength>>>0)),Te(c)}),c}function Iu(e,t,n,s,o){e>>>=0,t=pe(t),n=pe(n),o>>>=0;var c=O(e);Ue[e]=[],o==4294967295&&(o=void 0),Q+=1,ht(t,c.mapAsync(n,s>>>0,o).then(()=>{--Q,Fr(t,1,0)},h=>{--Q,D();var b=Me(h.message);Fr(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,b),delete Ue[e]}))}function xu(e){var t=O(e>>>=0),n=Ue[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Ue[e],t.unmap()}}function Lu(e){delete Cr[e>>>0]}function Ou(e,t,n){e>>>=0,t>>>=0,n>>>=0;var s=!!(d(),A)[t+32>>>2>>>0];t={label:Ne(t+4),usage:(d(),A)[t+16>>>2>>>0],size:4294967296*(d(),A)[t+28>>>2>>>0]+(d(),A)[t+24>>>2>>>0],mappedAtCreation:s},e=O(e);try{var o=e.createBuffer(t)}catch{return!1}return me(n,o),s&&(Ue[n]=[]),!0}function Bu(e,t,n,s){e>>>=0,t=pe(t),s>>>=0,n=hu(n>>>0),e=O(e),Q+=1,ht(t,e.createComputePipelineAsync(n).then(o=>{--Q,me(s,o),Wr(t,1,s,0)},o=>{--Q;var c=D(),h=Me(o.message);Wr(t,o.reason==="validation"?3:o.reason==="internal"?4:0,s,h),C(c)}))}function Mu(e,t,n){e>>>=0,t>>>=0,n>>>=0;var s=(d(),A)[t>>>2>>>0],o=(d(),A)[s+4>>>2>>>0];t={label:Ne(t+4),code:""},o===2&&(t.code=so(s+8)),me(n,O(e).createShaderModule(t))}var Uu=e=>{(e=O(e)).onuncapturederror=null,e.destroy()};function Cu(e,t){t=pe(t),e=O(e>>>0),Q+=1,ht(t,e.popErrorScope().then(n=>{--Q;var s=5;n?n instanceof GPUValidationError?s=2:n instanceof GPUOutOfMemoryError?s=3:n instanceof GPUInternalError&&(s=4):s=1;var o=D();n=n?Me(n.message):0,Gr(t,1,s,n),C(o)},n=>{--Q;var s=D();n=Me(n.message),Gr(t,1,5,n),C(s)}))}function Du(e,t,n,s){if(t=pe(t),s>>>=0,n>>>=0){var o=(d(),A)[n+4>>>2>>>0];o={featureLevel:bu[o],powerPreference:wu[(d(),A)[n+8>>>2>>>0]],forceFallbackAdapter:!!(d(),A)[n+12>>>2>>>0]},(n=(d(),A)[n>>>2>>>0])!==0&&(d(),o.Pe=!!(d(),A)[n+8>>>2>>>0])}"gpu"in navigator?(Q+=1,ht(t,navigator.gpu.requestAdapter(o).then(c=>{if(--Q,c)me(s,c),St(t,1,s,0);else{c=D();var h=Me("WebGPU not available on this browser (requestAdapter returned null)");St(t,3,s,h),C(c)}},c=>{--Q;var h=D();c=Me(c.message),St(t,4,s,c),C(h)}))):(n=D(),o=Me("WebGPU not available on this browser (navigator.gpu is not available)"),St(t,3,s,o),C(n))}function Pu(e,t,n){return e>>>=0,t>>>=0,n>>>=0,Jn(async()=>{var s=[];if(n){var o=(d(),x)[n>>>2>>>0];s.length=t+1,s[t]=new Promise(b=>setTimeout(b,o,0))}else s.length=t;for(var c=0;c<t;++c){var h=4294967296*(d(),A)[e+8*c+4>>>2>>>0]+(d(),A)[e+8*c>>>2>>>0];if(!(h in Gt))return h;s[c]=Gt[h]}return s=await Promise.race(s),delete Gt[s],s})}var Dr,Pr={},fo=()=>{if(!Dr){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Pr)Pr[e]===void 0?delete t[e]:t[e]=Pr[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);Dr=n}return Dr};function co(e,t){if(u)return ee(19,1,e,t);e>>>=0,t>>>=0;var n,s=0,o=0;for(n of fo()){var c=t+s;(d(),A)[e+o>>>2>>>0]=c,s+=_e(n,c,1/0)+1,o+=4}return 0}function lo(e,t){if(u)return ee(20,1,e,t);e>>>=0,t>>>=0;var n=fo();for(var s of((d(),A)[e>>>2>>>0]=n.length,e=0,n))e+=Re(s)+1;return(d(),A)[t>>>2>>>0]=e,0}function po(e){return u?ee(21,1,e):52}function mo(e,t,n,s){return u?ee(22,1,e,t,n,s):52}function ho(e,t,n,s){return u?ee(23,1,e,t,n,s):70}var _u=[null,[],[]];function yo(e,t,n,s){if(u)return ee(24,1,e,t,n,s);t>>>=0,n>>>=0,s>>>=0;for(var o=0,c=0;c<n;c++){var h=(d(),A)[t>>>2>>>0],b=(d(),A)[t+4>>>2>>>0];t+=8;for(var E=0;E<b;E++){var I=e,N=(d(),X)[h+E>>>0],W=_u[I];N===0||N===10?((I===1?j:V)(Bn(W)),W.length=0):W.push(N)}o+=b}return(d(),A)[s>>>2>>>0]=o,0}function Ru(e){return e>>>0}function Nu(e,t){return io(O(e>>>0).limits,t>>>0),1}function Wu(e,t){return O(e>>>0).features.has(uo[t])}function ku(e){return BigInt(O(e>>>0).size)}function Fu(e){return BigInt(O(e>>>0).usage)}function Gu(e,t){if(e>>>=0,t>>>=0){var n=Ne(t+4);n={label:n,timestampWrites:t=(t=(d(),A)[t+12>>>2>>>0])!==0?{querySet:O((d(),A)[t+4>>>2>>>0]),beginningOfPassWriteIndex:(d(),A)[t+8>>>2>>>0],endOfPassWriteIndex:(d(),A)[t+12>>>2>>>0]}:void 0}}return e=O(e),t=Io(0),me(t,e.beginComputePass(n)),t}function $u(e,t,n,s,o,c){n=pe(n),o=pe(o),c=pe(c),O(e>>>0).copyBufferToBuffer(O(t>>>0),n,O(s>>>0),o,c)}function zu(e){e=O(e>>>0);var t=So(0);return me(t,e.finish()),t}function Vu(e,t,n,s,o,c){c=pe(c),O(e>>>0).resolveQuerySet(O(t>>>0),n,s,O(o>>>0),c)}function ju(e,t,n,s){O(e>>>0).dispatchWorkgroups(t,n,s)}function Hu(e,t,n){n=pe(n),O(e>>>0).dispatchWorkgroupsIndirect(O(t>>>0),n)}function Yu(e){O(e>>>0).end()}function qu(e,t,n,s,o){s>>>=0,o>>>=0,e=O(e>>>0),n=O(n>>>0),s==0?e.setBindGroup(t,n):e.setBindGroup(t,n,(d(),A),o>>>2,s)}function Ju(e,t){O(e>>>0).setPipeline(O(t>>>0))}function Xu(e,t,n){O(e>>>0).Oe(O(t>>>0),n)}function Zu(e,t){e=O(e>>>0);var n=Eo(0);return me(n,e.getBindGroupLayout(t)),n}function Qu(e,t){e>>>=0;var n=Ne(4+(t>>>=0)),s=O((d(),A)[t+12>>>2>>>0]),o=(d(),A)[t+16>>>2>>>0];t=(d(),A)[t+20>>>2>>>0];for(var c=[],h=0;h<o;++h){var b=c,E=b.push,I=t+40*h,N=(d(),A)[I+8>>>2>>>0],W=(d(),A)[I+32>>>2>>>0],K=(d(),A)[I+36>>>2>>>0],L=(d(),A)[I+4>>>2>>>0];N?(W=I+24,(W=(d(),A)[W>>>2>>>0]+4294967296*(d(),x)[W+4>>>2>>>0])==-1&&(W=void 0),I={binding:L,resource:{buffer:O(N),offset:4294967296*(d(),A)[I+4+16>>>2>>>0]+(d(),A)[I+16>>>2>>>0],size:W}}):I=W?{binding:L,resource:O(W)}:{binding:L,resource:O(K)},E.call(b,I)}return n={label:n,layout:s,entries:c},e=O(e),s=vo(0),me(s,e.createBindGroup(n)),s}function Ku(e,t){var n;return e>>>=0,(t>>>=0)&&(n={label:Ne(t+4)}),e=O(e),t=Ao(0),me(t,e.createCommandEncoder(n)),t}function ef(e,t){e>>>=0,t>>>=0,t={type:gu[(d(),A)[t+12>>>2>>>0]],count:(d(),A)[t+16>>>2>>>0]},e=O(e);var n=xo(0);return me(n,e.createQuerySet(t)),n}function tf(e,t){e=O(e>>>0).adapterInfo,t>>>=0,(d(),x)[t+52>>>2>>>0]=e.subgroupMinSize,(d(),x)[t+56>>>2>>>0]=e.subgroupMaxSize;var n=oo(e.vendor+e.architecture+e.device+e.description),s=Re(e.vendor);return $t(t+4,n,s),n+=s,s=Re(e.architecture),$t(t+12,n,s),n+=s,s=Re(e.device),$t(t+20,n,s),$t(t+28,n+s,Re(e.description)),(d(),x)[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,(d(),x)[t+40>>>2>>>0]=e,(d(),x)[t+44>>>2>>>0]=0,(d(),x)[t+48>>>2>>>0]=0,1}var rf={"core-features-and-limits":1,"depth-clip-control":2,"depth32float-stencil8":3,"texture-compression-bc":4,"texture-compression-bc-sliced-3d":5,"texture-compression-etc2":6,"texture-compression-astc":7,"texture-compression-astc-sliced-3d":8,"timestamp-query":9,"indirect-first-instance":10,"shader-f16":11,"rg11b10ufloat-renderable":12,"bgra8unorm-storage":13,"float32-filterable":14,"float32-blendable":15,"clip-distances":16,"dual-source-blending":17,subgroups:18,"texture-formats-tier1":19,"texture-formats-tier2":20,"primitive-index":21,"chromium-experimental-unorm16-texture-formats":327692,"chromium-experimental-snorm16-texture-formats":327693,"chromium-experimental-multi-draw-indirect":327732};function nf(e,t){t>>>=0,e=O(e>>>0);var n=bt(4*e.features.size),s=0,o=0;e.features.forEach(c=>{0<=(c=rf[c])&&((d(),x)[n+s>>>2>>>0]=c,s+=4,o++)}),(d(),A)[t+4>>>2>>>0]=n,(d(),A)[t>>>2>>>0]=o}function of(e,t){return io(O(e>>>0).limits,t>>>0),1}function af(e,t){O(e>>>0).pushErrorScope(yu[t])}function sf(e,t,n){t>>>=0,n>>>=0,e=O(e>>>0),t=Array.from((d(),x).subarray(n>>>2>>>0,n+4*t>>>2>>>0),s=>O(s)),e.submit(t)}function uf(e,t,n,s,o){n=pe(n),s>>>=0,o>>>=0,e=O(e>>>0),t=O(t>>>0),s=(d(),X).subarray(s>>>0,s+o>>>0),e.writeBuffer(t,n,s,0,o)}u||function(){for(var e=r.numThreads-1;e--;)En();De.push(()=>{qe++,function(t){u?t():Promise.all(ke.map(vn)).then(t)}(()=>Ae())})}(),u||(Se=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),We()),r.wasmBinary&&(T=r.wasmBinary),r.stackSave=()=>D(),r.stackRestore=e=>C(e),r.stackAlloc=e=>zt(e),r.setValue=function(e,t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":(d(),Y)[e>>>0]=t;break;case"i16":(d(),Ce)[e>>>1>>>0]=t;break;case"i32":(d(),x)[e>>>2>>>0]=t;break;case"i64":(d(),$)[e>>>3>>>0]=BigInt(t);break;case"float":(d(),q)[e>>>2>>>0]=t;break;case"double":(d(),ae)[e>>>3>>>0]=t;break;case"*":(d(),A)[e>>>2>>>0]=t;break;default:le(`invalid type for setValue: ${n}`)}},r.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return(d(),Y)[e>>>0];case"i16":return(d(),Ce)[e>>>1>>>0];case"i32":return(d(),x)[e>>>2>>>0];case"i64":return(d(),$)[e>>>3>>>0];case"float":return(d(),q)[e>>>2>>>0];case"double":return(d(),ae)[e>>>3>>>0];case"*":return(d(),A)[e>>>2>>>0];default:le(`invalid type for getValue: ${t}`)}},r.UTF8ToString=pt,r.stringToUTF8=_e,r.lengthBytesUTF8=Re;var ff=[wr,bn,In,Mn,Un,Cn,Dn,Pn,_n,Rn,Nn,Wn,kn,Fn,Gn,$n,eo,to,ro,co,lo,po,mo,ho,yo],_r={1077100:(e,t,n,s,o)=>{if(r===void 0||!r.Yc)return 1;if((e=pt(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=r.Yc.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),s=Number(s>>>0),t+n>e.byteLength)return 3;try{let c=e.subarray(t,t+n);switch(o){case 0:(d(),X).set(c,s>>>0);break;case 1:r.fe?r.fe(s,c):r.Je(s,c);break;default:return 4}return 0}catch{return 4}},1077924:(e,t,n)=>{r.he(e,(d(),X).subarray(t>>>0,t+n>>>0))},1077988:()=>r.He(),1078030:e=>{r.ge(e)},1078067:()=>typeof wasmOffsetConverter<"u"};function cf(){return typeof wasmOffsetConverter<"u"}var bo,wo,Rr,Nr,Te,bt,go,To,vo,Eo,So,Ao,Io,xo,Lo,Oo,Bo,Wr,kr,Fr,Gr,St,$r,Mo,zr,Uo,Co,Do,Vr,Po,_o,jr,k,At,Ro,C,zt,D,No,Wo,ko,Fo,Go,Hr,$o,zo,Vo,jo,Ho,Yo,qo,Jo,Xo,Zo,Qo,Ko,ea,ta,ra,na,oa,aa,sa,ia,ua,fa,ca,da,la,pa,ma,ha,ya,ba,wa,ga,Ta,va,Ea,Sa,Aa,Ia,xa,Ge=await async function(){function e(s,o){var c=Ge=s.exports;s={};for(let[h,b]of Object.entries(c))typeof b=="function"?(c=Mi(b),s[h]=c):s[h]=b;return Ge=s,Ge=function(){var h=Ge,b=I=>N=>I(N)>>>0,E=I=>()=>I()>>>0;return(h=Object.assign({},h)).dc=b(h.dc),h.Gc=E(h.Gc),h.Ic=b(h.Ic),h.ud=(I=>(N,W)=>I(N,W)>>>0)(h.ud),h.zd=b(h.zd),h.Ad=E(h.Ad),h.Ed=b(h.Ed),h}(),wn.push(Ge.ld),S=o,bo=(o=Ge).dc,wo=o.ec,r._OrtInit=o.fc,r._OrtGetLastError=o.gc,r._OrtCreateSessionOptions=o.hc,r._OrtAppendExecutionProvider=o.ic,r._OrtAddFreeDimensionOverride=o.jc,r._OrtAddSessionConfigEntry=o.kc,r._OrtReleaseSessionOptions=o.lc,r._OrtCreateSession=o.mc,r._OrtReleaseSession=o.nc,r._OrtGetInputOutputCount=o.oc,r._OrtGetInputOutputMetadata=o.pc,r._OrtFree=o.qc,r._OrtCreateTensor=o.rc,r._OrtGetTensorData=o.sc,r._OrtReleaseTensor=o.tc,r._OrtCreateRunOptions=o.uc,r._OrtAddRunConfigEntry=o.vc,r._OrtReleaseRunOptions=o.wc,r._OrtCreateBinding=o.xc,r._OrtBindInput=o.yc,r._OrtBindOutput=o.zc,r._OrtClearBoundOutputs=o.Ac,r._OrtReleaseBinding=o.Bc,r._OrtRunWithBinding=o.Cc,r._OrtRun=o.Dc,r._OrtEndProfiling=o.Ec,r._OrtGetWebGpuDevice=Rr=o.Fc,Nr=o.Gc,r._free=Te=o.Hc,r._malloc=bt=o.Ic,r._wgpuBufferRelease=go=o.Jc,r._wgpuCreateInstance=To=o.Kc,vo=o.Lc,Eo=o.Mc,So=o.Nc,Ao=o.Oc,Io=o.Pc,xo=o.Sc,Lo=o.ad,Oo=o.bd,Bo=o.cd,Wr=o.ed,kr=o.fd,Fr=o.gd,Gr=o.hd,St=o.id,$r=o.jd,Mo=o.kd,zr=o.nd,Uo=o.od,Co=o.pd,Do=o.qd,Vr=o.rd,Po=o.sd,_o=o.td,jr=o.ud,k=o.vd,At=o.wd,Ro=o.xd,C=o.yd,zt=o.zd,D=o.Ad,No=o.Bd,Wo=o.Cd,ko=o.Dd,Fo=o.Ed,Go=o.Fd,Hr=o.Gd,$o=o.Hd,zo=o.Id,Vo=o.Jd,jo=o.Kd,Ho=o.Ld,Yo=o.Md,qo=o.Nd,Jo=o.Od,Xo=o.Pd,Zo=o.Qd,Qo=o.Rd,Ko=o.Sd,ea=o.Td,ta=o.Ud,ra=o.Vd,na=o.Xd,oa=o.Yd,aa=o.Zd,sa=o._d,ia=o.ae,ua=o.be,fa=o.ce,ca=o.de,da=o.ne,la=o.se,pa=o.ve,ma=o.we,ha=o.xe,ya=o.ye,ba=o.ze,wa=o.Ae,ga=o.Be,Ta=o.Ce,va=o.De,Ea=o.Ee,Sa=o.df,Aa=o.ef,Ia=o.ff,xa=o.gf,Ae(),Ge}qe++;var t,n=oe();return r.instantiateWasm?new Promise(s=>{r.instantiateWasm(n,(o,c)=>{s(e(o,c))})}):u?new Promise(s=>{U=o=>{var c=new WebAssembly.Instance(o,oe());s(e(c,o))}}):(ct??=r.locateFile?r.locateFile?r.locateFile("ort-wasm-simd-threaded.asyncify.wasm",g):g+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href,t=await async function(s){var o=ct;if(!T&&typeof WebAssembly.instantiateStreaming=="function"&&!ne(o))try{var c=fetch(o,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(c,s)}catch(h){V(`wasm streaming compile failed: ${h}`),V("falling back to ArrayBuffer instantiation")}return async function(h,b){try{var E=await async function(I){if(!T)try{var N=await m(I);return new Uint8Array(N)}catch{}if(I==ct&&T)I=new Uint8Array(T);else{if(!y)throw"both async and sync fetching of the wasm failed";I=y(I)}return I}(h);return await WebAssembly.instantiate(E,b)}catch(I){V(`failed to asynchronously prepare wasm: ${I}`),le(I)}}(o,s)}(n),e(t.instance,t.module))}();function df(e,t,n,s){var o=D();try{return Yo(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}function lf(e,t,n){var s=D();try{return Ho(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;k(1,0)}}function pf(e,t,n){var s=D();try{Go(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;k(1,0)}}function mf(e,t){var n=D();try{return Hr(e,t)}catch(s){if(C(n),s!==s+0)throw s;k(1,0)}}function hf(e){var t=D();try{$o(e)}catch(n){if(C(t),n!==n+0)throw n;k(1,0)}}function yf(e,t,n,s,o,c,h){var b=D();try{return jo(e,t,n,s,o,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function bf(e,t){var n=D();try{Xo(e,t)}catch(s){if(C(n),s!==s+0)throw s;k(1,0)}}function wf(e,t,n,s){var o=D();try{Jo(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}function gf(e,t,n,s,o,c,h){var b=D();try{Qo(e,t,n,s,o,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function Tf(e,t,n,s,o,c,h){var b=D();try{Ko(e,t,n,s,o,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function vf(e,t,n,s,o,c,h,b){var E=D();try{ia(e,t,n,s,o,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function Ef(e,t,n,s,o,c){var h=D();try{zo(e,t,n,s,o,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Sf(e,t,n,s,o){var c=D();try{Vo(e,t,n,s,o)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function Af(e,t,n,s,o){var c=D();try{return Zo(e,t,n,s,o)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function If(e,t,n,s,o,c,h,b){var E=D();try{ua(e,t,n,s,o,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function xf(e,t,n,s,o,c,h,b,E,I,N,W){var K=D();try{ea(e,t,n,s,o,c,h,b,E,I,N,W)}catch(L){if(C(K),L!==L+0)throw L;k(1,0)}}function Lf(e,t,n,s,o,c){var h=D();try{return fa(e,t,n,s,o,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Of(e,t,n){var s=D();try{return oa(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;return k(1,0),0n}}function Bf(e,t,n,s,o,c,h,b,E){var I=D();try{qo(e,t,n,s,o,c,h,b,E)}catch(N){if(C(I),N!==N+0)throw N;k(1,0)}}function Mf(e){var t=D();try{return ra(e)}catch(n){if(C(t),n!==n+0)throw n;k(1,0)}}function Uf(e,t){var n=D();try{return Ea(e,t)}catch(s){if(C(n),s!==s+0)throw s;return k(1,0),0n}}function Cf(e){var t=D();try{return ta(e)}catch(n){if(C(t),n!==n+0)throw n;return k(1,0),0n}}function Df(e,t,n,s,o,c){var h=D();try{return pa(e,t,n,s,o,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Pf(e,t,n,s,o,c){var h=D();try{return ma(e,t,n,s,o,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function _f(e,t,n){var s=D();try{return ha(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;k(1,0)}}function Rf(e,t,n,s,o,c,h,b){var E=D();try{return ca(e,t,n,s,o,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function Nf(e,t,n,s,o){var c=D();try{return ya(e,t,n,s,o)}catch(h){if(C(c),h!==h+0)throw h;return k(1,0),0n}}function Wf(e,t,n,s){var o=D();try{return ba(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}function kf(e,t,n,s){var o=D();try{return wa(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}function Ff(e,t,n,s,o,c,h,b,E,I,N,W){var K=D();try{return ga(e,t,n,s,o,c,h,b,E,I,N,W)}catch(L){if(C(K),L!==L+0)throw L;k(1,0)}}function Gf(e,t,n,s,o,c,h,b,E,I,N){var W=D();try{da(e,t,n,s,o,c,h,b,E,I,N)}catch(K){if(C(W),K!==K+0)throw K;k(1,0)}}function $f(e,t,n,s,o,c,h,b,E,I,N,W,K,L,fe,ve){var ie=D();try{la(e,t,n,s,o,c,h,b,E,I,N,W,K,L,fe,ve)}catch(Qe){if(C(ie),Qe!==Qe+0)throw Qe;k(1,0)}}function zf(e,t,n,s){var o=D();try{return Ta(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}function Vf(e,t,n,s,o){var c=D();try{return va(e,t,n,s,o)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function jf(e,t,n){var s=D();try{return na(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;k(1,0)}}function Hf(e,t,n){var s=D();try{return aa(e,t,n)}catch(o){if(C(s),o!==o+0)throw o;k(1,0)}}function Yf(e,t,n,s){var o=D();try{sa(e,t,n,s)}catch(c){if(C(o),c!==c+0)throw c;k(1,0)}}return function e(){if(0<qe)ye=e;else if(u)_?.(r),Ye();else{for(;0<De.length;)De.shift()(r);0<qe?ye=e:(r.calledRun=!0,re||(Ye(),_?.(r)))}}(),r.PTR_SIZE=4,r.webgpuInit=e=>{let t=new WeakMap,n,s,o=1;r.webgpuRegisterDevice=b=>{if(s!==void 0)throw Error("another WebGPU EP inference session is being created.");if(b){var E=t.get(b);if(!E){let I=((N,W=0)=>{var K=Bo(W);return W=Oo(W,K),me(K,N.queue),me(W,N),W})(b,E=To(0));E=[o++,E,I],t.set(b,E)}return n=b,s=E[0],E}n=void 0,s=0};let c=new Map;r.webgpuOnCreateSession=b=>{if(s!==void 0){var E=s;if(s=void 0,b){let I=Rr(E);c.set(b,I),E===0&&e(n??O(I))}n=void 0}},r.webgpuOnReleaseSession=b=>{c.delete(b)};let h=Symbol("gpuBufferMetadata");r.webgpuRegisterBuffer=(b,E,I)=>{if(I)return b[h]=[I,NaN],I;if(I=b[h])return I[1]++,I[0];if((E=c.get(E))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return E=((N,W=0)=>(N.mapState!="pending"||le(),W=Lo(W,N.mapState=="mapped"?3:1),me(W,N),N.mapState=="mapped"&&(Ue[W]=[]),W))(b,E),b[h]=[E,1],E},r.webgpuUnregisterBuffer=b=>{let E=b[h];if(!E)throw Error("Buffer is not registered");E[1]--,E[1]===0&&(go(E[0]),delete b[h])},r.webgpuGetBuffer=b=>O(b),r.webgpuCreateDownloader=(b,E,I)=>{if((I=c.get(I))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let N=O(I),W=16*Math.ceil(Number(E)/16);return async()=>{let K=N.createBuffer({size:W,usage:9});try{let L=N.createCommandEncoder();return L.copyBufferToBuffer(b,0,K,0,W),N.queue.submit([L.finish()]),await K.mapAsync(GPUMapMode.READ),K.getMappedRange().slice(0,E)}finally{K.destroy()}}},r.fe=(b,E)=>{var I=E.buffer;let N=E.byteOffset,W=E.byteLength;if(E=16*Math.ceil(Number(W)/16),b=O(b),!n){var K=Rr(s);n=O(K)}let L=(K=n.createBuffer({mappedAtCreation:!0,size:E,usage:6})).getMappedRange();new Uint8Array(L).set(new Uint8Array(I,N,W)),K.unmap(),(I=n.createCommandEncoder()).copyBufferToBuffer(K,0,b,0,E),n.queue.submit([I.finish()]),K.destroy()}},r.webnnInit=e=>{let t=e[0];[r.He,r.ge,r.webnnEnsureTensor,r.he,r.webnnDownloadTensor,r.Ge,r.webnnEnableTraceEvent]=e.slice(1),r.webnnReleaseTensorId=r.ge,r.webnnUploadTensor=r.he,r.webnnRegisterMLContext=r.Ge,r.webnnOnRunStart=n=>t.onRunStart(n),r.webnnOnRunEnd=t.onRunEnd.bind(t),r.webnnOnReleaseSession=n=>{t.onReleaseSession(n)},r.webnnCreateMLTensorDownloader=(n,s)=>t.createMLTensorDownloader(n,s),r.webnnRegisterMLTensor=(n,s,o,c)=>t.registerMLTensor(n,s,o,c),r.webnnCreateMLContext=n=>t.createMLContext(n),r.webnnRegisterMLConstant=(n,s,o,c,h,b)=>t.registerMLConstant(n,s,o,c,h,r.Yc,b),r.webnnRegisterGraphInput=t.registerGraphInput.bind(t),r.webnnIsGraphInput=t.isGraphInput.bind(t),r.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),r.webnnIsGraphOutput=t.isGraphOutput.bind(t),r.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),r.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},br?r:new Promise((e,t)=>{_=e,H=t})}var rc,nc,fs=F(()=>{"use strict";rc=is,nc=globalThis.self?.name?.startsWith("em-pthread");nc&&is()});var ls,nn,oc,we,ps,rn,ac,sc,ms,ic,cs,hs,ds,ys,Jt=F(()=>{"use strict";qt();ls=typeof location>"u"?void 0:location.origin,nn=import.meta.url>"file:"&&import.meta.url<"file;",oc=()=>{if(!!1){if(nn){let a=URL;return new URL(new a("ort.webgpu.bundle.min.mjs",import.meta.url).href,ls).href}return import.meta.url}},we=oc(),ps=()=>{if(we&&!we.startsWith("blob:"))return we.substring(0,we.lastIndexOf("/")+1)},rn=(a,r)=>{try{let i=r??we;return(i?new URL(a,i):new URL(a)).origin===ls}catch{return!1}},ac=(a,r)=>{let i=r??we;try{return(i?new URL(a,i):new URL(a)).href}catch{return}},sc=(a,r)=>`${r??"./"}${a}`,ms=async a=>{let i=await(await fetch(a,{credentials:"same-origin"})).blob();return URL.createObjectURL(i)},ic=async a=>(await import(/*webpackIgnore:true*/ /*@vite-ignore*/a)).default,cs=(ss(),Vt(as)).default,hs=async()=>{if(!we)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(rn(we))return[void 0,cs()];let a=await ms(we);return[a,cs(a)]},ds=(fs(),Vt(us)).default,ys=async(a,r,i,f)=>{let u=ds&&!(a||r);if(u)if(we)u=rn(we);else if(f&&!i)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,ds];{let l="ort-wasm-simd-threaded.asyncify.mjs",p=a??ac(l,r),m=!!1&&i&&p&&!rn(p,r),y=m?await ms(p):p??sc(l,r);return[m?y:void 0,await ic(y)]}}});var on,an,or,bs,uc,fc,cc,Xt,z,je=F(()=>{"use strict";Jt();an=!1,or=!1,bs=!1,uc=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},cc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Xt=async a=>{if(an)return Promise.resolve();if(or)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(bs)throw new Error("previous call to 'initializeWebAssembly()' failed.");or=!0;let r=a.initTimeout,i=a.numThreads;if(a.simd!==!1){if(a.simd==="relaxed"){if(!cc())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!fc())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let f=uc();i>1&&!f&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),a.numThreads=i=1);let u=a.wasmPaths,l=typeof u=="string"?u:void 0,p=u?.mjs,m=p?.href??p,y=u?.wasm,w=y?.href??y,v=a.wasmBinary,[g,T]=await ys(m,l,i>1,!!v||!!w),S=!1,B=[];if(r>0&&B.push(new Promise(_=>{setTimeout(()=>{S=!0,_()},r)})),B.push(new Promise((_,H)=>{let U={numThreads:i};if(v)U.wasmBinary=v;else if(w||l)U.locateFile=M=>w??l+M;else if(m&&m.indexOf("blob:")!==0)U.locateFile=M=>new URL(M,m).href;else if(g){let M=ps();M&&(U.locateFile=J=>M+J)}T(U).then(M=>{or=!1,an=!0,on=M,_(),g&&URL.revokeObjectURL(g)},M=>{or=!1,bs=!0,H(M)})})),await Promise.race(B),S)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},z=()=>{if(an&&on)return on;throw new Error("WebAssembly is not initialized yet.")}});var he,Ot,G,ar=F(()=>{"use strict";je();he=(a,r)=>{let i=z(),f=i.lengthBytesUTF8(a)+1,u=i._malloc(f);return i.stringToUTF8(a,u,f),r.push(u),u},Ot=(a,r,i,f)=>{if(typeof a=="object"&&a!==null){if(i.has(a))throw new Error("Circular reference in options");i.add(a)}Object.entries(a).forEach(([u,l])=>{let p=r?r+u:u;if(typeof l=="object")Ot(l,p+".",i,f);else if(typeof l=="string"||typeof l=="number")f(p,l.toString());else if(typeof l=="boolean")f(p,l?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof l}`)})},G=a=>{let r=z(),i=r.stackSave();try{let f=r.PTR_SIZE,u=r.stackAlloc(2*f);r._OrtGetLastError(u,u+f);let l=Number(r.getValue(u,f===4?"i32":"i64")),p=r.getValue(u+f,"*"),m=p?r.UTF8ToString(p):"";throw new Error(`${a} ERROR_CODE: ${l}, ERROR_MESSAGE: ${m}`)}finally{r.stackRestore(i)}}});var ws,gs=F(()=>{"use strict";je();ar();ws=a=>{let r=z(),i=0,f=[],u=a||{};try{if(a?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof a.logSeverityLevel!="number"||!Number.isInteger(a.logSeverityLevel)||a.logSeverityLevel<0||a.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${a.logSeverityLevel}`);if(a?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof a.logVerbosityLevel!="number"||!Number.isInteger(a.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${a.logVerbosityLevel}`);a?.terminate===void 0&&(u.terminate=!1);let l=0;return a?.tag!==void 0&&(l=he(a.tag,f)),i=r._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,l),i===0&&G("Can't create run options."),a?.extra!==void 0&&Ot(a.extra,"",new WeakSet,(p,m)=>{let y=he(p,f),w=he(m,f);r._OrtAddRunConfigEntry(i,y,w)!==0&&G(`Can't set a run config entry: ${p} - ${m}.`)}),[i,f]}catch(l){throw i!==0&&r._OrtReleaseRunOptions(i),f.forEach(p=>r._free(p)),l}}});var dc,lc,pc,sn,at,mc,Ts,vs=F(()=>{"use strict";je();ar();dc=a=>{switch(a){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${a}`)}},lc=a=>{switch(a){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${a}`)}},pc=a=>{a.extra||(a.extra={}),a.extra.session||(a.extra.session={});let r=a.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),a.executionProviders&&a.executionProviders.some(i=>(typeof i=="string"?i:i.name)==="webgpu")&&(a.enableMemPattern=!1)},sn=(a,r,i,f)=>{let u=he(r,f),l=he(i,f);z()._OrtAddSessionConfigEntry(a,u,l)!==0&&G(`Can't set a session config entry: ${r} - ${i}.`)},at=(a,r,i,f)=>{let u=he(r,f),l=he(i,f);a.push([u,l])},mc=async(a,r,i)=>{let f=r.executionProviders;for(let u of f){let l=typeof u=="string"?u:u.name,p=[];switch(l){case"webnn":if(l="WEBNN",typeof u!="string"){let T=u?.deviceType;T&&sn(a,"deviceType",T,i)}break;case"webgpu":{l="WebGPU";let g;if(typeof u!="string"){let S=u;if(S.device)if(typeof GPUDevice<"u"&&S.device instanceof GPUDevice)g=S.device;else throw new Error("Invalid GPU device set in WebGPU EP options.");let{enableGraphCapture:B}=r;if(typeof B=="boolean"&&B&&at(p,"enableGraphCapture","1",i),typeof S.preferredLayout=="string"&&at(p,"preferredLayout",S.preferredLayout,i),S.forceCpuNodeNames){let _=Array.isArray(S.forceCpuNodeNames)?S.forceCpuNodeNames:[S.forceCpuNodeNames];at(p,"forceCpuNodeNames",_.join(`
`),i)}S.validationMode&&at(p,"validationMode",S.validationMode,i)}let T=z().webgpuRegisterDevice(g);if(T){let[S,B,_]=T;at(p,"deviceId",S.toString(),i),at(p,"webgpuInstance",B.toString(),i),at(p,"webgpuDevice",_.toString(),i)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${l}`)}let m=he(l,i),y=p.length,w=0,v=0;if(y>0){w=z()._malloc(y*z().PTR_SIZE),i.push(w),v=z()._malloc(y*z().PTR_SIZE),i.push(v);for(let g=0;g<y;g++)z().setValue(w+g*z().PTR_SIZE,p[g][0],"*"),z().setValue(v+g*z().PTR_SIZE,p[g][1],"*")}await z()._OrtAppendExecutionProvider(a,m,w,v,y)!==0&&G(`Can't append execution provider: ${l}.`)}},Ts=async a=>{let r=z(),i=0,f=[],u=a||{};pc(u);try{let l=dc(u.graphOptimizationLevel??"all"),p=lc(u.executionMode??"sequential"),m=typeof u.logId=="string"?he(u.logId,f):0,y=u.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let w=u.logVerbosityLevel??0;if(!Number.isInteger(w)||w<0||w>4)throw new Error(`log verbosity level is not valid: ${w}`);let v=typeof u.optimizedModelFilePath=="string"?he(u.optimizedModelFilePath,f):0;if(i=r._OrtCreateSessionOptions(l,!!u.enableCpuMemArena,!!u.enableMemPattern,p,!!u.enableProfiling,0,m,y,w,v),i===0&&G("Can't create session options."),u.executionProviders&&await mc(i,u,f),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);sn(i,"enableGraphCapture",u.enableGraphCapture.toString(),f)}if(u.freeDimensionOverrides)for(let[g,T]of Object.entries(u.freeDimensionOverrides)){if(typeof g!="string")throw new Error(`free dimension override name must be a string: ${g}`);if(typeof T!="number"||!Number.isInteger(T)||T<0)throw new Error(`free dimension override value must be a non-negative integer: ${T}`);let S=he(g,f);r._OrtAddFreeDimensionOverride(i,S,T)!==0&&G(`Can't set a free dimension override: ${g} - ${T}.`)}return u.extra!==void 0&&Ot(u.extra,"",new WeakSet,(g,T)=>{sn(i,g,T,f)}),[i,f]}catch(l){throw i!==0&&r._OrtReleaseSessionOptions(i)!==0&&G("Can't release session options."),f.forEach(p=>r._free(p)),l}}});var He,sr,wt,st,Bt,ir,ur,un,it=F(()=>{"use strict";He=a=>{switch(a){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${a}`)}},sr=a=>{switch(a){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${a}`)}},wt=(a,r)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][a],f=typeof r=="number"?r:r.reduce((u,l)=>u*l,1);return i>0?Math.ceil(f*i):void 0},st=a=>{switch(a){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${a}`)}},Bt=a=>{switch(a){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${a}`)}},ir=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",ur=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint64"||a==="int8"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",un=a=>{switch(a){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${a}`)}}});var Mt,fn=F(()=>{"use strict";qt();Mt=async a=>{if(typeof a=="string")if(!1)try{let{readFile:r}=qr("node:fs/promises");return new Uint8Array(await r(a))}catch(r){if(r.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:i}=qr("node:fs"),f=i(a),u=[];for await(let l of f)u.push(l);return new Uint8Array(Buffer.concat(u))}throw r}else{let r=await fetch(a);if(!r.ok)throw new Error(`failed to load external data file: ${a}`);let i=r.headers.get("Content-Length"),f=i?parseInt(i,10):0;if(f<1073741824)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw new Error(`failed to load external data file: ${a}, no response body.`);let u=r.body.getReader(),l;try{l=new ArrayBuffer(f)}catch(m){if(m instanceof RangeError){let y=Math.ceil(f/65536);l=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw m}let p=0;for(;;){let{done:m,value:y}=await u.read();if(m)break;let w=y.byteLength;new Uint8Array(l,p,w).set(y),p+=w}return new Uint8Array(l,0,f)}}else return a instanceof Blob?new Uint8Array(await a.arrayBuffer()):a instanceof Uint8Array?a:new Uint8Array(a)}});var Es,Ss=F(()=>{"use strict";it();Es=(a,r)=>new(st(r))(a)});var hc,yc,As,Is,xs,bc,de,cn=F(()=>{"use strict";it();hc=["V","I","W","E","F"],yc=(a,r)=>{console.log(`[${hc[a]},${new Date().toISOString()}]${r}`)},xs=(a,r)=>{As=a,Is=r},bc=(a,r)=>{let i=Bt(a),f=Bt(As);i>=f&&yc(i,typeof r=="function"?r():r)},de=(...a)=>{Is&&bc(...a)}});var Os,ln,Bs,wc,Ls,gc,Ms,fr,cr,dn,Us,Cs=F(()=>{"use strict";it();cn();Os=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),ln=(a,r)=>{if(r==="int32")return a;let i=Os.get(r);if(!i)throw new Error(`WebNN backend does not support data type: ${r}`);let f=i/8;if(a.byteLength%f!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${f}.`);let u=a.byteLength/f,l=new(st(r))(a.buffer,a.byteOffset,u);switch(r){case"int64":case"uint64":{let p=new Int32Array(u);for(let m=0;m<u;m++){let y=l[m];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[m]=Number(y)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(r==="uint32"&&l.some(m=>m>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(l,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${r} to 'int32'`)}},Bs=(a,r)=>{if(r==="int32")return a;if(a.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let i=a.byteLength/4,f=new Int32Array(a.buffer,a.byteOffset,i);switch(r){case"int64":{let u=BigInt64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(f.some(l=>l<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(f.some(l=>l<-128||l>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(f,Number);return new Uint8Array(u.buffer)}case"uint8":{if(f.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(f,Number)}case"uint32":{if(f.some(l=>l<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(f,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${r}`)}},wc=1,Ls=()=>wc++,gc=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ms=(a,r)=>{let i=Os.get(a);if(!i)throw new Error(`WebNN backend does not support data type: ${a}`);return r.length>0?Math.ceil(r.reduce((f,u)=>f*u)*i/8):0},fr=class{constructor(r){this.isDataConverted=!1;let{sessionId:i,context:f,tensor:u,dataType:l,shape:p,fallbackDataType:m}=r;this.sessionId=i,this.mlContext=f,this.mlTensor=u,this.dataType=l,this.tensorShape=p,this.fallbackDataType=m}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ms(this.dataType,this.tensorShape)}destroy(){de("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(r){this.mlContext.writeTensor(this.mlTensor,r)}async read(r){if(this.fallbackDataType){let i=await this.mlContext.readTensor(this.mlTensor),f=Bs(new Uint8Array(i),this.dataType);if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(f);return}else return f.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(r,i,f){return this.mlContext===r&&this.dataType===i&&this.tensorShape.length===f.length&&this.tensorShape.every((u,l)=>u===f[l])}setIsDataConverted(r){this.isDataConverted=r}},cr=class{constructor(r,i){this.tensorManager=r;this.wrapper=i}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(r,i,f,u){let l=this.tensorManager.getMLContext(r),p=this.tensorManager.getMLOpSupportLimits(r),m;if(!p?.input.dataTypes.includes(i)){if(m=gc.get(i),!m||p?.input.dataTypes.includes(m))throw new Error(`WebNN backend does not support data type: ${i}`);de("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${i} to ${m}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(l,i,f))return this.wrapper.tensor;if(u){if(this.wrapper.byteLength!==Ms(i,f))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let y=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(r,i,f,y,!0,!0,m),u&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(r){let i=r;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")i=ln(r,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(r.byteLength===this.wrapper.byteLength){this.wrapper.write(i);return}else de("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(i):this.activeUpload=new Uint8Array(i)}async download(r){if(this.activeUpload){let i=this.wrapper?.isDataConverted?Bs(this.activeUpload,this.wrapper?.type):this.activeUpload;if(r){r instanceof ArrayBuffer?new Uint8Array(r).set(i):new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(i);return}else return i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return r?this.wrapper.read(r):this.wrapper.read()}},dn=class{constructor(r){this.backend=r;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(r){let i=this.backend.getMLContext(r);if(!i)throw new Error("MLContext not found for session.");return i}getMLOpSupportLimits(r){return this.backend.getMLOpSupportLimits(r)}reserveTensorId(){let r=Ls();return this.tensorTrackersById.set(r,new cr(this)),r}releaseTensorId(r){let i=this.tensorTrackersById.get(r);i&&(this.tensorTrackersById.delete(r),i.tensorWrapper&&this.releaseTensor(i.tensorWrapper))}async ensureTensor(r,i,f,u,l){de("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${i}, dataType: ${f}, shape: ${u}, copyOld: ${l}}`);let p=this.tensorTrackersById.get(i);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(r,f,u,l)}upload(r,i){let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");f.upload(i)}async download(r,i){de("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${r}, dstBuffer: ${i?.byteLength}}`);let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");return f.download(i)}releaseTensorsForSession(r){for(let i of this.freeTensors)i.sessionId===r&&i.destroy();this.freeTensors=this.freeTensors.filter(i=>i.sessionId!==r)}registerTensor(r,i,f,u){let l=this.getMLContext(r),p=Ls(),m=new fr({sessionId:r,context:l,tensor:i,dataType:f,shape:u});return this.tensorTrackersById.set(p,new cr(this,m)),this.externalTensors.add(m),p}async getCachedTensor(r,i,f,u,l,p,m){let y=this.getMLContext(r);for(let[v,g]of this.freeTensors.entries())if(g.canReuseTensor(y,i,f)){de("verbose",()=>`[WebNN] Reusing tensor {dataType: ${i}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}`);let T=this.freeTensors.splice(v,1)[0];return T.sessionId=r,T}de("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${i}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}}`);let w=await y.createTensor({dataType:m??i,shape:f,dimensions:f,usage:u,writable:l,readable:p});return new fr({sessionId:r,context:y,tensor:w,dataType:i,shape:f,fallbackDataType:m})}releaseTensor(r){this.externalTensors.has(r)&&this.externalTensors.delete(r),this.freeTensors.push(r)}},Us=(...a)=>new dn(...a)});var Ds={};It(Ds,{WebNNBackend:()=>pn});var dr,Tc,pn,Ps=F(()=>{"use strict";it();je();Ss();Cs();cn();dr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Tc=(a,r)=>{if(a===r)return!0;if(a===void 0||r===void 0)return!1;let i=Object.keys(a).sort(),f=Object.keys(r).sort();return i.length===f.length&&i.every((u,l)=>u===f[l]&&a[u]===r[u])},pn=class{constructor(r){this.tensorManager=Us(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;this.mlOpSupportLimitsBySessionId=new Map;xs(r.logLevel,!!r.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(r){de("verbose",()=>`[WebNN] onRunStart {sessionId: ${r}}`),this.activeSessionId=r}onRunEnd(r){de("verbose",()=>`[WebNN] onRunEnd {sessionId: ${r}}`);let i=this.temporarySessionTensorIds.get(r);if(i){for(let f of i)de("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${f}}`),this.tensorManager.releaseTensorId(f);this.temporarySessionTensorIds.delete(r),this.activeSessionId=void 0}}async createMLContext(r){if(r instanceof GPUDevice){let f=this.mlContextCache.findIndex(u=>u.gpuDevice===r);if(f!==-1)return this.mlContextCache[f].mlContext;{let u=await navigator.ml.createContext(r);return this.mlContextCache.push({gpuDevice:r,mlContext:u}),u}}else if(r===void 0){let f=this.mlContextCache.findIndex(u=>u.options===void 0&&u.gpuDevice===void 0);if(f!==-1)return this.mlContextCache[f].mlContext;{let u=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:u}),u}}let i=this.mlContextCache.findIndex(f=>Tc(f.options,r));if(i!==-1)return this.mlContextCache[i].mlContext;{let f=await navigator.ml.createContext(r);return this.mlContextCache.push({options:r,mlContext:f}),f}}registerMLContext(r,i){this.mlContextBySessionId.set(r,i);let f=this.sessionIdsByMLContext.get(i);f||(f=new Set,this.sessionIdsByMLContext.set(i,f)),f.add(r),this.mlOpSupportLimitsBySessionId.has(r)||this.mlOpSupportLimitsBySessionId.set(r,i.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(r,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(r,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(r){this.sessionGraphInputs.delete(r),this.sessionGraphOutputs.delete(r);let i=this.mlContextBySessionId.get(r);if(!i)return;this.tensorManager.releaseTensorsForSession(r),this.mlContextBySessionId.delete(r),this.mlOpSupportLimitsBySessionId.delete(r);let f=this.sessionIdsByMLContext.get(i);if(f.delete(r),f.size===0){this.sessionIdsByMLContext.delete(i);let u=this.mlContextCache.findIndex(l=>l.mlContext===i);u!==-1&&this.mlContextCache.splice(u,1)}}getMLContext(r){return this.mlContextBySessionId.get(r)}getMLOpSupportLimits(r){return this.mlOpSupportLimitsBySessionId.get(r)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(r){de("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r)}async ensureTensor(r,i,f,u,l){let p=dr.get(f);if(!p)throw new Error(`Unsupported ONNX data type: ${f}`);return this.tensorManager.ensureTensor(r??this.currentSessionId,i,p,u,l)}async createTemporaryTensor(r,i,f){de("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${i}, shape: ${f}}`);let u=dr.get(i);if(!u)throw new Error(`Unsupported ONNX data type: ${i}`);let l=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(r,l,u,f,!1);let p=this.temporarySessionTensorIds.get(r);return p?p.push(l):this.temporarySessionTensorIds.set(r,[l]),l}uploadTensor(r,i){if(!z().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");de("verbose",()=>`[WebNN] uploadTensor {tensorId: ${r}, data: ${i.byteLength}}`),this.tensorManager.upload(r,i)}async downloadTensor(r,i){return this.tensorManager.download(r,i)}createMLTensorDownloader(r,i){return async()=>{let f=await this.tensorManager.download(r);return Es(f,i)}}registerMLTensor(r,i,f,u){let l=dr.get(f);if(!l)throw new Error(`Unsupported ONNX data type: ${f}`);let p=this.tensorManager.registerTensor(r,i,l,u);return de("verbose",()=>`[WebNN] registerMLTensor {tensor: ${i}, dataType: ${l}, dimensions: ${u}} -> {tensorId: ${p}}`),p}registerMLConstant(r,i,f,u,l,p,m=!1){if(!p)throw new Error("External mounted files are not available.");let y=r;r.startsWith("./")&&(y=r.substring(2));let w=p.get(y);if(!w)throw new Error(`File with name ${y} not found in preloaded files.`);if(i+f>w.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let v=w.slice(i,i+f).buffer,g;switch(l.dataType){case"float32":g=new Float32Array(v);break;case"float16":g=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(v):new Uint16Array(v);break;case"int32":g=new Int32Array(v);break;case"uint32":g=new Uint32Array(v);break;case"int64":if(m){let T=ln(new Uint8Array(v),"int64");g=new Int32Array(T.buffer),l.dataType="int32"}else g=new BigInt64Array(v);break;case"uint64":g=new BigUint64Array(v);break;case"int8":g=new Int8Array(v);break;case"int4":case"uint4":case"uint8":g=new Uint8Array(v);break;default:throw new Error(`Unsupported data type: ${l.dataType} in creating WebNN Constant from external data.`)}return de("verbose",()=>`[WebNN] registerMLConstant {dataType: ${l.dataType}, shape: ${l.shape}}} ${m?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),u.constant(l,g)}registerGraphInput(r){this.temporaryGraphInputs.push(r)}registerGraphOutput(r){this.temporaryGraphOutputs.push(r)}isGraphInput(r,i){let f=this.sessionGraphInputs.get(r);return f?f.includes(i):!1}isGraphOutput(r,i){let f=this.sessionGraphOutputs.get(r);return f?f.includes(i):!1}isGraphInputOutputTypeSupported(r,i,f=!0){let u=dr.get(He(i)),l=this.mlOpSupportLimitsBySessionId.get(r);return typeof u>"u"?!1:f?!!l?.input.dataTypes.includes(u):!!l?.output.dataTypes.includes(u)}flush(){}}});var vc,Zt,Qt,ut,Ec,_s,Lt,Kt,er,Rs,tr,rr,nr,tn=F(()=>{"use strict";Ve();gs();vs();it();je();ar();fn();vc=(a,r)=>{z()._OrtInit(a,r)!==0&&G("Can't initialize onnxruntime.")},Zt=async a=>{vc(a.wasm.numThreads,Bt(a.logLevel))},Qt=async(a,r)=>{z().asyncInit?.();let i=a.webgpu.adapter;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(i){if(typeof i.limits!="object"||typeof i.features!="object"||typeof i.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let f=a.webgpu.powerPreference;if(f!==void 0&&f!=="low-power"&&f!=="high-performance")throw new Error(`Invalid powerPreference setting: "${f}"`);let u=a.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(i=await navigator.gpu.requestAdapter({powerPreference:f,forceFallbackAdapter:u}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(r==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(r==="webgpu"&&z().webgpuInit(f=>{a.webgpu.device=f}),r==="webnn"){let f=new(Ps(),Vt(Ds)).WebNNBackend(a);z().webnnInit([f,()=>f.reserveTensorId(),u=>f.releaseTensorId(u),async(u,l,p,m,y)=>f.ensureTensor(u,l,p,m,y),(u,l)=>{f.uploadTensor(u,l)},async(u,l)=>f.downloadTensor(u,l),(u,l)=>f.registerMLContext(u,l),!!a.trace])}},ut=new Map,Ec=a=>{let r=z(),i=r.stackSave();try{let f=r.PTR_SIZE,u=r.stackAlloc(2*f);r._OrtGetInputOutputCount(a,u,u+f)!==0&&G("Can't get session input/output count.");let p=f===4?"i32":"i64";return[Number(r.getValue(u,p)),Number(r.getValue(u+f,p))]}finally{r.stackRestore(i)}},_s=(a,r)=>{let i=z(),f=i.stackSave(),u=0;try{let l=i.PTR_SIZE,p=i.stackAlloc(2*l);i._OrtGetInputOutputMetadata(a,r,p,p+l)!==0&&G("Can't get session input/output metadata.");let y=Number(i.getValue(p,"*"));u=Number(i.getValue(p+l,"*"));let w=i.HEAP32[u/4];if(w===0)return[y,0];let v=i.HEAPU32[u/4+1],g=[];for(let T=0;T<v;T++){let S=Number(i.getValue(u+8+T*l,"*"));g.push(S!==0?i.UTF8ToString(S):Number(i.getValue(u+8+(T+v)*l,"*")))}return[y,w,g]}finally{i.stackRestore(f),u!==0&&i._OrtFree(u)}},Lt=a=>{let r=z(),i=r._malloc(a.byteLength);if(i===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${a.byteLength}.`);return r.HEAPU8.set(a,i),[i,a.byteLength]},Kt=async(a,r)=>{let i,f,u=z();Array.isArray(a)?[i,f]=a:a.buffer===u.HEAPU8.buffer?[i,f]=[a.byteOffset,a.byteLength]:[i,f]=Lt(a);let l=0,p=0,m=0,y=[],w=[],v=[];try{if([p,y]=await Ts(r),r?.externalData&&u.mountExternalData){let R=[];for(let j of r.externalData){let V=typeof j=="string"?j:j.path;R.push(Mt(typeof j=="string"?j:j.data).then(re=>{u.mountExternalData(V,re)}))}await Promise.all(R)}for(let R of r?.executionProviders??[])if((typeof R=="string"?R:R.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof R!="string"){let V=R,re=V?.context,ne=V?.gpuDevice,d=V?.deviceType,be=V?.powerPreference;re?u.currentContext=re:ne?u.currentContext=await u.webnnCreateMLContext(ne):u.currentContext=await u.webnnCreateMLContext({deviceType:d,powerPreference:be})}else u.currentContext=await u.webnnCreateMLContext();break}l=await u._OrtCreateSession(i,f,p),u.webgpuOnCreateSession?.(l),l===0&&G("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(l,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[g,T]=Ec(l),S=!!r?.enableGraphCapture,B=[],_=[],H=[],U=[],M=[];for(let R=0;R<g;R++){let[j,V,re]=_s(l,R);j===0&&G("Can't get an input name."),w.push(j);let ne=u.UTF8ToString(j);B.push(ne),H.push(V===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:sr(V),shape:re})}for(let R=0;R<T;R++){let[j,V,re]=_s(l,R+g);j===0&&G("Can't get an output name."),v.push(j);let ne=u.UTF8ToString(j);_.push(ne),U.push(V===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:sr(V),shape:re});{if(S&&r?.preferredOutputLocation===void 0){M.push("gpu-buffer");continue}let d=typeof r?.preferredOutputLocation=="string"?r.preferredOutputLocation:r?.preferredOutputLocation?.[ne]??"cpu",be=u.webnnIsGraphOutput;if(d==="cpu"&&be&&be(l,ne)){M.push("ml-tensor-cpu-output");continue}if(d!=="cpu"&&d!=="cpu-pinned"&&d!=="gpu-buffer"&&d!=="ml-tensor")throw new Error(`Not supported preferred output location: ${d}.`);if(S&&d!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${d}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);M.push(d)}}let J=null;return M.some(R=>R==="gpu-buffer"||R==="ml-tensor"||R==="ml-tensor-cpu-output")&&(m=u._OrtCreateBinding(l),m===0&&G("Can't create IO binding."),J={handle:m,outputPreferredLocations:M,outputPreferredLocationsEncoded:M.map(R=>R==="ml-tensor-cpu-output"?"ml-tensor":R).map(R=>un(R))}),ut.set(l,[l,w,v,J,S,!1]),[l,B,_,H,U]}catch(g){throw w.forEach(T=>u._OrtFree(T)),v.forEach(T=>u._OrtFree(T)),m!==0&&u._OrtReleaseBinding(m)!==0&&G("Can't release IO binding."),l!==0&&u._OrtReleaseSession(l)!==0&&G("Can't release session."),g}finally{u._free(i),p!==0&&u._OrtReleaseSessionOptions(p)!==0&&G("Can't release session options."),y.forEach(g=>u._free(g)),u.unmountExternalData?.()}},er=a=>{let r=z(),i=ut.get(a);if(!i)throw new Error(`cannot release session. invalid session id: ${a}`);let[f,u,l,p,m]=i;p&&(m&&r._OrtClearBoundOutputs(p.handle)!==0&&G("Can't clear bound outputs."),r._OrtReleaseBinding(p.handle)!==0&&G("Can't release IO binding.")),r.jsepOnReleaseSession?.(a),r.webnnOnReleaseSession?.(a),r.webgpuOnReleaseSession?.(a),u.forEach(y=>r._OrtFree(y)),l.forEach(y=>r._OrtFree(y)),r._OrtReleaseSession(f)!==0&&G("Can't release session."),ut.delete(a)},Rs=async(a,r,i,f,u,l,p=!1)=>{if(!a){r.push(0);return}let m=z(),y=m.PTR_SIZE,w=a[0],v=a[1],g=a[3],T=g,S,B;if(w==="string"&&(g==="gpu-buffer"||g==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&g!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${l} when enableGraphCapture is true.`);if(g==="gpu-buffer"){let U=a[2].gpuBuffer;B=wt(He(w),v);{let M=m.webgpuRegisterBuffer;if(!M)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');S=M(U,f)}}else if(g==="ml-tensor"){let U=a[2].mlTensor;B=wt(He(w),v);let M=m.webnnRegisterMLTensor;if(!M)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');S=M(f,U,He(w),v)}else{let U=a[2];if(Array.isArray(U)){B=y*U.length,S=m._malloc(B),i.push(S);for(let M=0;M<U.length;M++){if(typeof U[M]!="string")throw new TypeError(`tensor data at index ${M} is not a string`);m.setValue(S+M*y,he(U[M],i),"*")}}else{let M=m.webnnIsGraphInput,J=m.webnnIsGraphOutput;if(w!=="string"&&M&&J){let R=m.UTF8ToString(u);if(M(f,R)||J(f,R)){let j=He(w);B=wt(j,v),T="ml-tensor";let V=m.webnnCreateTemporaryTensor,re=m.webnnUploadTensor;if(!V||!re)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ne=await V(f,j,v);re(ne,new Uint8Array(U.buffer,U.byteOffset,U.byteLength)),S=ne}else B=U.byteLength,S=m._malloc(B),i.push(S),m.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,B),S)}else B=U.byteLength,S=m._malloc(B),i.push(S),m.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,B),S)}}let _=m.stackSave(),H=m.stackAlloc(4*v.length);try{v.forEach((M,J)=>m.setValue(H+J*y,M,y===4?"i32":"i64"));let U=m._OrtCreateTensor(He(w),S,B,H,v.length,un(T));U===0&&G(`Can't create tensor for input/output. session=${f}, index=${l}.`),r.push(U)}finally{m.stackRestore(_)}},tr=async(a,r,i,f,u,l)=>{let p=z(),m=p.PTR_SIZE,y=ut.get(a);if(!y)throw new Error(`cannot run inference. invalid session id: ${a}`);let w=y[0],v=y[1],g=y[2],T=y[3],S=y[4],B=y[5],_=r.length,H=f.length,U=0,M=[],J=[],R=[],j=[],V=[],re=p.stackSave(),ne=p.stackAlloc(_*m),d=p.stackAlloc(_*m),be=p.stackAlloc(H*m),Se=p.stackAlloc(H*m);try{[U,M]=ws(l),$e("wasm prepareInputOutputTensor");for(let P=0;P<_;P++)await Rs(i[P],J,j,a,v[r[P]],r[P],S);for(let P=0;P<H;P++)await Rs(u[P],R,j,a,g[f[P]],_+f[P],S);ze("wasm prepareInputOutputTensor");for(let P=0;P<_;P++)p.setValue(ne+P*m,J[P],"*"),p.setValue(d+P*m,v[r[P]],"*");for(let P=0;P<H;P++)p.setValue(be+P*m,R[P],"*"),p.setValue(Se+P*m,g[f[P]],"*");if(T&&!B){let{handle:P,outputPreferredLocations:x,outputPreferredLocationsEncoded:A}=T;if(v.length!==_)throw new Error(`input count from feeds (${_}) is expected to be always equal to model's input count (${v.length}).`);$e("wasm bindInputsOutputs");for(let q=0;q<_;q++){let ae=r[q];await p._OrtBindInput(P,v[ae],J[q])!==0&&G(`Can't bind input[${q}] for session=${a}.`)}for(let q=0;q<H;q++){let ae=f[q];u[q]?.[3]?(V.push(R[q]),p._OrtBindOutput(P,g[ae],R[q],0)!==0&&G(`Can't bind pre-allocated output[${q}] for session=${a}.`)):p._OrtBindOutput(P,g[ae],0,A[ae])!==0&&G(`Can't bind output[${q}] to ${x[q]} for session=${a}.`)}ze("wasm bindInputsOutputs"),ut.set(a,[w,v,g,T,S,!0])}p.jsepOnRunStart?.(w),p.webnnOnRunStart?.(w);let Y;T?Y=await p._OrtRunWithBinding(w,T.handle,H,be,U):Y=await p._OrtRun(w,d,ne,_,Se,H,be,U),Y!==0&&G("failed to call OrtRun().");let X=[],Ce=[];$e("wasm ProcessOutputTensor");for(let P=0;P<H;P++){let x=Number(p.getValue(be+P*m,"*"));if(x===R[P]||V.includes(R[P])){X.push(u[P]),x!==R[P]&&p._OrtReleaseTensor(x)!==0&&G("Can't release tensor.");continue}let A=p.stackSave(),q=p.stackAlloc(4*m),ae=!1,$,se=0;try{p._OrtGetTensorData(x,q,q+m,q+2*m,q+3*m)!==0&&G(`Can't access output tensor data on index ${P}.`);let We=m===4?"i32":"i64",Ye=Number(p.getValue(q,We));se=p.getValue(q+m,"*");let ct=p.getValue(q+m*2,"*"),qe=Number(p.getValue(q+m*3,We)),ye=[];for(let oe=0;oe<qe;oe++)ye.push(Number(p.getValue(ct+oe*m,We)));p._OrtFree(ct)!==0&&G("Can't free memory for tensor dims.");let Ae=ye.reduce((oe,Z)=>oe*Z,1);$=sr(Ye);let le=T?.outputPreferredLocations[f[P]];if($==="string"){if(le==="gpu-buffer"||le==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let oe=[];for(let Z=0;Z<Ae;Z++){let Ie=p.getValue(se+Z*m,"*"),De=p.getValue(se+(Z+1)*m,"*"),dt=Z===Ae-1?void 0:De-Ie;oe.push(p.UTF8ToString(Ie,dt))}X.push([$,ye,oe,"cpu"])}else if(le==="gpu-buffer"&&Ae>0){let oe=p.webgpuGetBuffer;if(!oe)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Z=oe(se),Ie=wt(Ye,Ae);if(Ie===void 0||!ir($))throw new Error(`Unsupported data type: ${$}`);ae=!0;{p.webgpuRegisterBuffer(Z,a,se);let De=p.webgpuCreateDownloader(Z,Ie,a);X.push([$,ye,{gpuBuffer:Z,download:async()=>{let dt=await De();return new(st($))(dt)},dispose:()=>{p._OrtReleaseTensor(x)!==0&&G("Can't release tensor.")}},"gpu-buffer"])}}else if(le==="ml-tensor"&&Ae>0){let oe=p.webnnEnsureTensor,Z=p.webnnIsGraphInputOutputTypeSupported;if(!oe||!Z)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(wt(Ye,Ae)===void 0||!ur($))throw new Error(`Unsupported data type: ${$}`);if(!Z(a,$,!1))throw new Error(`preferredLocation "ml-tensor" for ${$} output is not supported by current WebNN Context.`);let De=await oe(a,se,Ye,ye,!1);ae=!0,X.push([$,ye,{mlTensor:De,download:p.webnnCreateMLTensorDownloader(se,$),dispose:()=>{p.webnnReleaseTensorId(se),p._OrtReleaseTensor(x)}},"ml-tensor"])}else if(le==="ml-tensor-cpu-output"&&Ae>0){let oe=p.webnnCreateMLTensorDownloader(se,$)(),Z=X.length;ae=!0,Ce.push((async()=>{let Ie=[Z,await oe];return p.webnnReleaseTensorId(se),p._OrtReleaseTensor(x),Ie})()),X.push([$,ye,[],"cpu"])}else{let oe=st($),Z=new oe(Ae);new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength).set(p.HEAPU8.subarray(se,se+Z.byteLength)),X.push([$,ye,Z,"cpu"])}}finally{p.stackRestore(A),$==="string"&&se&&p._free(se),ae||p._OrtReleaseTensor(x)}}T&&!S&&(p._OrtClearBoundOutputs(T.handle)!==0&&G("Can't clear bound outputs."),ut.set(a,[w,v,g,T,S,!1]));for(let[P,x]of await Promise.all(Ce))X[P][2]=x;return ze("wasm ProcessOutputTensor"),X}finally{p.webnnOnRunEnd?.(w),p.stackRestore(re),i.forEach(Y=>{Y&&Y[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Y[2].gpuBuffer)}),u.forEach(Y=>{Y&&Y[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Y[2].gpuBuffer)}),J.forEach(Y=>p._OrtReleaseTensor(Y)),R.forEach(Y=>p._OrtReleaseTensor(Y)),j.forEach(Y=>p._free(Y)),U!==0&&p._OrtReleaseRunOptions(U),M.forEach(Y=>p._free(Y))}},rr=a=>{let r=z(),i=ut.get(a);if(!i)throw new Error("invalid session id");let f=i[0],u=r._OrtEndProfiling(f);u===0&&G("Can't get an profile file name."),r._OrtFree(u)},nr=a=>{let r=[];for(let i of a){let f=i[2];!Array.isArray(f)&&"buffer"in f&&r.push(f.buffer)}return r}});var ft,Ee,Ut,pr,mr,lr,mn,hn,gt,Tt,Ac,Ns,Ws,ks,Fs,Gs,$s,zs,yn=F(()=>{"use strict";Ve();tn();je();Jt();ft=()=>!!te.wasm.proxy&&typeof document<"u",Ut=!1,pr=!1,mr=!1,hn=new Map,gt=(a,r)=>{let i=hn.get(a);i?i.push(r):hn.set(a,[r])},Tt=()=>{if(Ut||!pr||mr||!Ee)throw new Error("worker not ready")},Ac=a=>{switch(a.data.type){case"init-wasm":Ut=!1,a.data.err?(mr=!0,mn[1](a.data.err)):(pr=!0,mn[0]()),lr&&(URL.revokeObjectURL(lr),lr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=hn.get(a.data.type);a.data.err?r.shift()[1](a.data.err):r.shift()[0](a.data.out);break}default:}},Ns=async()=>{if(!pr){if(Ut)throw new Error("multiple calls to 'initWasm()' detected.");if(mr)throw new Error("previous call to 'initWasm()' failed.");if(Ut=!0,ft())return new Promise((a,r)=>{Ee?.terminate(),hs().then(([i,f])=>{try{Ee=f,Ee.onerror=l=>r(l),Ee.onmessage=Ac,mn=[a,r];let u={type:"init-wasm",in:te};!u.in.wasm.wasmPaths&&(i||nn)&&(u.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),Ee.postMessage(u),lr=i}catch(u){r(u)}},r)});try{await Xt(te.wasm),await Zt(te),pr=!0}catch(a){throw mr=!0,a}finally{Ut=!1}}},Ws=async a=>{if(ft())return Tt(),new Promise((r,i)=>{gt("init-ep",[r,i]);let f={type:"init-ep",in:{epName:a,env:te}};Ee.postMessage(f)});await Qt(te,a)},ks=async a=>ft()?(Tt(),new Promise((r,i)=>{gt("copy-from",[r,i]);let f={type:"copy-from",in:{buffer:a}};Ee.postMessage(f,[a.buffer])})):Lt(a),Fs=async(a,r)=>{if(ft()){if(r?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Tt(),new Promise((i,f)=>{gt("create",[i,f]);let u={type:"create",in:{model:a,options:{...r}}},l=[];a instanceof Uint8Array&&l.push(a.buffer),Ee.postMessage(u,l)})}else return Kt(a,r)},Gs=async a=>{if(ft())return Tt(),new Promise((r,i)=>{gt("release",[r,i]);let f={type:"release",in:a};Ee.postMessage(f)});er(a)},$s=async(a,r,i,f,u,l)=>{if(ft()){if(i.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return Tt(),new Promise((p,m)=>{gt("run",[p,m]);let y=i,w={type:"run",in:{sessionId:a,inputIndices:r,inputs:y,outputIndices:f,options:l}};Ee.postMessage(w,nr(y))})}else return tr(a,r,i,f,u,l)},zs=async a=>{if(ft())return Tt(),new Promise((r,i)=>{gt("end-profiling",[r,i]);let f={type:"end-profiling",in:a};Ee.postMessage(f)});rr(a)}});var Vs,Ic,hr,js=F(()=>{"use strict";Ve();yn();it();qt();fn();Vs=(a,r)=>{switch(a.location){case"cpu":return[a.type,a.dims,a.data,"cpu"];case"gpu-buffer":return[a.type,a.dims,{gpuBuffer:a.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[a.type,a.dims,{mlTensor:a.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${a.location} for ${r()}`)}},Ic=a=>{switch(a[3]){case"cpu":return new Le(a[0],a[2],a[1]);case"gpu-buffer":{let r=a[0];if(!ir(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:i,download:f,dispose:u}=a[2];return Le.fromGpuBuffer(i,{dataType:r,dims:a[1],download:f,dispose:u})}case"ml-tensor":{let r=a[0];if(!ur(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:i,download:f,dispose:u}=a[2];return Le.fromMLTensor(i,{dataType:r,dims:a[1],download:f,dispose:u})}default:throw new Error(`invalid data location: ${a[3]}`)}},hr=class{async fetchModelAndCopyToWasmMemory(r){return ks(await Mt(r))}async loadModel(r,i){rt();let f;typeof r=="string"?f=await this.fetchModelAndCopyToWasmMemory(r):f=r,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Fs(f,i),nt()}async dispose(){return Gs(this.sessionId)}async run(r,i,f){rt();let u=[],l=[];Object.entries(r).forEach(T=>{let S=T[0],B=T[1],_=this.inputNames.indexOf(S);if(_===-1)throw new Error(`invalid input '${S}'`);u.push(B),l.push(_)});let p=[],m=[];Object.entries(i).forEach(T=>{let S=T[0],B=T[1],_=this.outputNames.indexOf(S);if(_===-1)throw new Error(`invalid output '${S}'`);p.push(B),m.push(_)});let y=u.map((T,S)=>Vs(T,()=>`input "${this.inputNames[l[S]]}"`)),w=p.map((T,S)=>T?Vs(T,()=>`output "${this.outputNames[m[S]]}"`):null),v=await $s(this.sessionId,l,y,m,w,f),g={};for(let T=0;T<v.length;T++)g[this.outputNames[m[T]]]=p[T]??Ic(v[T]);return nt(),g}startProfiling(){}endProfiling(){zs(this.sessionId)}}});var Ys={};It(Ys,{OnnxruntimeWebAssemblyBackend:()=>yr,initializeFlags:()=>Hs,wasmBackend:()=>xc});var Hs,yr,xc,qs=F(()=>{"use strict";Ve();yn();js();Hs=()=>{(typeof te.wasm.initTimeout!="number"||te.wasm.initTimeout<0)&&(te.wasm.initTimeout=0);let a=te.wasm.simd;if(typeof a!="boolean"&&a!==void 0&&a!=="fixed"&&a!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${a}". Reset it to \`false\` and ignore SIMD feature checking.`),te.wasm.simd=!1),typeof te.wasm.proxy!="boolean"&&(te.wasm.proxy=!1),typeof te.wasm.trace!="boolean"&&(te.wasm.trace=!1),typeof te.wasm.numThreads!="number"||!Number.isInteger(te.wasm.numThreads)||te.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)te.wasm.numThreads=1;else{let r=typeof navigator>"u"?qr("node:os").cpus().length:navigator.hardwareConcurrency;te.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},yr=class{async init(r){Hs(),await Ns(),await Ws(r)}async createInferenceSessionHandler(r,i){let f=new hr;return await f.loadModel(r,i),f}},xc=new yr});Ve();Ve();Ve();var rs="1.24.0-dev.20251116-b39e144322";var Il=en;{let a=(qs(),Vt(Ys)).wasmBackend;et("webgpu",a,5),et("webnn",a,5),et("cpu",a,10),et("wasm",a,10)}Object.defineProperty(te.versions,"web",{value:rs,enumerable:!0});export{ec as InferenceSession,qa as TRACE,$e as TRACE_EVENT_BEGIN,ze as TRACE_EVENT_END,rt as TRACE_FUNC_BEGIN,nt as TRACE_FUNC_END,Le as Tensor,Il as default,te as env,et as registerBackend};
//# sourceMappingURL=ort.webgpu.bundle.min.mjs.map
