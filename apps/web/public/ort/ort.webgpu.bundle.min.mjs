/*!
 * ONNX Runtime Web v1.24.0-dev.20251227-38355ba07c
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var Yr=Object.defineProperty;var Jf=Object.getOwnPropertyDescriptor;var Xf=Object.getOwnPropertyNames;var Zf=Object.prototype.hasOwnProperty;var qr=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(r,s)=>(typeof require<"u"?require:r)[s]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+a+'" is not supported')});var F=(a,r)=>()=>(a&&(r=a(a=0)),r);var At=(a,r)=>{for(var s in r)Yr(a,s,{get:r[s],enumerable:!0})},Qf=(a,r,s,f)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Xf(r))!Zf.call(a,i)&&i!==s&&Yr(a,i,{get:()=>r[i],enumerable:!(f=Jf(r,i))||f.enumerable});return a};var Ht=a=>Qf(Yr({},"__esModule",{value:!0}),a);var Yt,Qe,Ke,Kf,xa,Jr=F(()=>{"use strict";Yt=new Map,Qe=[],Ke=(a,r,s)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let f=Yt.get(a);if(f===void 0)Yt.set(a,{backend:r,priority:s});else{if(f.priority>s)return;if(f.priority===s&&f.backend!==r)throw new Error(`cannot register backend "${a}" using priority ${s}`)}if(s>=0){let i=Qe.indexOf(a);i!==-1&&Qe.splice(i,1);for(let d=0;d<Qe.length;d++)if(Yt.get(Qe[d]).priority<=s){Qe.splice(d,0,a);return}Qe.push(a)}return}throw new TypeError("not a valid backend")},Kf=async a=>{let r=Yt.get(a);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let s=!!r.initPromise;try{return s||(r.initPromise=r.backend.init(a)),await r.initPromise,r.initialized=!0,r.backend}catch(f){return s||(r.error=`${f}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},xa=async a=>{let r=a.executionProviders||[],s=r.map(y=>typeof y=="string"?y:y.name),f=s.length===0?Qe:s,i,d=[],p=new Set;for(let y of f){let w=await Kf(y);typeof w=="string"?d.push({name:y,err:w}):(i||(i=w),i===w&&p.add(y))}if(!i)throw new Error(`no available backend found. ERR: ${d.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:w}of d)s.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${w}`);let m=r.filter(y=>p.has(typeof y=="string"?y:y.name));return[i,new Proxy(a,{get:(y,w)=>w==="executionProviders"?m:Reflect.get(y,w)})]}});var La=F(()=>{"use strict";Jr()});var Ba,Oa=F(()=>{"use strict";Ba="1.24.0-dev.20251116-b39e144322"});var Ma,ue,Xr=F(()=>{"use strict";Oa();Ma="warning",ue={wasm:{},webgl:{},webgpu:{},versions:{common:Ba},set logLevel(a){if(a!==void 0){if(typeof a!="string"||["verbose","info","warning","error","fatal"].indexOf(a)===-1)throw new Error(`Unsupported logging level: ${a}`);Ma=a}},get logLevel(){return Ma}};Object.defineProperty(ue,"logLevel",{enumerable:!0})});var ee,Ua=F(()=>{"use strict";Xr();ee=ue});var Ca,Da,Pa=F(()=>{"use strict";Ca=(a,r)=>{let s=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);s.width=a.dims[3],s.height=a.dims[2];let f=s.getContext("2d");if(f!=null){let i,d;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(i=a.dims[2],d=a.dims[3]):(i=a.dims[3],d=a.dims[2]);let p=r?.format!==void 0?r.format:"RGB",m=r?.norm,y,w;m===void 0||m.mean===void 0?y=[255,255,255,255]:typeof m.mean=="number"?y=[m.mean,m.mean,m.mean,m.mean]:(y=[m.mean[0],m.mean[1],m.mean[2],0],m.mean[3]!==void 0&&(y[3]=m.mean[3])),m===void 0||m.bias===void 0?w=[0,0,0,0]:typeof m.bias=="number"?w=[m.bias,m.bias,m.bias,m.bias]:(w=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(w[3]=m.bias[3]));let T=d*i,g=0,v=T,S=T*2,M=-1;p==="RGBA"?(g=0,v=T,S=T*2,M=T*3):p==="RGB"?(g=0,v=T,S=T*2):p==="RBG"&&(g=0,S=T,v=T*2);for(let R=0;R<d;R++)for(let H=0;H<i;H++){let P=(a.data[g++]-w[0])*y[0],U=(a.data[v++]-w[1])*y[1],Y=(a.data[S++]-w[2])*y[2],B=M===-1?255:(a.data[M++]-w[3])*y[3];f.fillStyle="rgba("+P+","+U+","+Y+","+B+")",f.fillRect(H,R,1,1)}if("toDataURL"in s)return s.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Da=(a,r)=>{let s=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),f;if(s!=null){let i,d,p;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(i=a.dims[2],d=a.dims[1],p=a.dims[3]):(i=a.dims[3],d=a.dims[2],p=a.dims[1]);let m=r!==void 0&&r.format!==void 0?r.format:"RGB",y=r?.norm,w,T;y===void 0||y.mean===void 0?w=[255,255,255,255]:typeof y.mean=="number"?w=[y.mean,y.mean,y.mean,y.mean]:(w=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(w[3]=y.mean[3])),y===void 0||y.bias===void 0?T=[0,0,0,0]:typeof y.bias=="number"?T=[y.bias,y.bias,y.bias,y.bias]:(T=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(T[3]=y.bias[3]));let g=d*i;if(r!==void 0&&(r.format!==void 0&&p===4&&r.format!=="RGBA"||p===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let v=4,S=0,M=1,R=2,H=3,P=0,U=g,Y=g*2,B=-1;m==="RGBA"?(P=0,U=g,Y=g*2,B=g*3):m==="RGB"?(P=0,U=g,Y=g*2):m==="RBG"&&(P=0,Y=g,U=g*2),f=s.createImageData(i,d);for(let G=0;G<d*i;S+=v,M+=v,R+=v,H+=v,G++)f.data[S]=(a.data[P++]-T[0])*w[0],f.data[M]=(a.data[U++]-T[1])*w[1],f.data[R]=(a.data[Y++]-T[2])*w[2],f.data[H]=B===-1?255:(a.data[B++]-T[3])*w[3]}else throw new Error("Can not access image data");return f}});var Zr,_a,Ra,Na,Wa,ka,Fa=F(()=>{"use strict";qt();Zr=(a,r)=>{if(a===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:s,width:f}=r,i=r.norm??{mean:255,bias:0},d,p;typeof i.mean=="number"?d=[i.mean,i.mean,i.mean,i.mean]:d=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?p=[i.bias,i.bias,i.bias,i.bias]:p=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let m=r.format!==void 0?r.format:"RGBA",y=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",w=s*f,T=y==="RGBA"?new Float32Array(w*4):new Float32Array(w*3),g=4,v=0,S=1,M=2,R=3,H=0,P=w,U=w*2,Y=-1;m==="RGB"&&(g=3,v=0,S=1,M=2,R=-1),y==="RGBA"?Y=w*3:y==="RBG"?(H=0,U=w,P=w*2):y==="BGR"&&(U=0,P=w,H=w*2);for(let G=0;G<w;G++,v+=g,M+=g,S+=g,R+=g)T[H++]=(a[v]+p[0])/d[0],T[P++]=(a[S]+p[1])/d[1],T[U++]=(a[M]+p[2])/d[2],Y!==-1&&R!==-1&&(T[Y++]=(a[R]+p[3])/d[3]);return y==="RGBA"?new ce("float32",T,[1,4,s,f]):new ce("float32",T,[1,3,s,f])},_a=async(a,r)=>{let s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,f=typeof ImageData<"u"&&a instanceof ImageData,i=typeof ImageBitmap<"u"&&a instanceof ImageBitmap,d=typeof a=="string",p,m=r??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},w=T=>typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||T instanceof OffscreenCanvas?T.getContext("2d"):null;if(s){let T=y();T.width=a.width,T.height=a.height;let g=w(T);if(g!=null){let v=a.height,S=a.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(v=r.resizedHeight,S=r.resizedWidth),r!==void 0){if(m=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");m.tensorFormat="RGBA",m.height=v,m.width=S}else m.tensorFormat="RGBA",m.height=v,m.width=S;g.drawImage(a,0,0),p=g.getImageData(0,0,S,v).data}else throw new Error("Can not access image data")}else if(f){let T,g;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(T=r.resizedHeight,g=r.resizedWidth):(T=a.height,g=a.width),r!==void 0&&(m=r),m.format="RGBA",m.height=T,m.width=g,r!==void 0){let v=y();v.width=g,v.height=T;let S=w(v);if(S!=null)S.putImageData(a,0,0),p=S.getImageData(0,0,g,T).data;else throw new Error("Can not access image data")}else p=a.data}else if(i){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let T=y();T.width=a.width,T.height=a.height;let g=w(T);if(g!=null){let v=a.height,S=a.width;return g.drawImage(a,0,0,S,v),p=g.getImageData(0,0,S,v).data,m.height=v,m.width=S,Zr(p,m)}else throw new Error("Can not access image data")}else{if(d)return new Promise((T,g)=>{let v=y(),S=w(v);if(!a||!S)return g();let M=new Image;M.crossOrigin="Anonymous",M.src=a,M.onload=()=>{v.width=M.width,v.height=M.height,S.drawImage(M,0,0,v.width,v.height);let R=S.getImageData(0,0,v.width,v.height);m.height=v.height,m.width=v.width,T(Zr(R.data,m))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return Zr(p,m);throw new Error("Input data provided is not supported - aborted tensor creation")},Ra=(a,r)=>{let{width:s,height:f,download:i,dispose:d}=r,p=[1,f,s,4];return new ce({location:"texture",type:"float32",texture:a,dims:p,download:i,dispose:d})},Na=(a,r)=>{let{dataType:s,dims:f,download:i,dispose:d}=r;return new ce({location:"gpu-buffer",type:s??"float32",gpuBuffer:a,dims:f,download:i,dispose:d})},Wa=(a,r)=>{let{dataType:s,dims:f,download:i,dispose:d}=r;return new ce({location:"ml-tensor",type:s??"float32",mlTensor:a,dims:f,download:i,dispose:d})},ka=(a,r,s)=>new ce({location:"cpu-pinned",type:a,data:r,dims:s??[r.length]})});var et,It,Ga,$a,za=F(()=>{"use strict";et=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),It=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ga=!1,$a=()=>{if(!Ga){Ga=!0;let a=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,s=globalThis.Float16Array,f=typeof s<"u"&&s.from;a&&(et.set("int64",BigInt64Array),It.set(BigInt64Array,"int64")),r&&(et.set("uint64",BigUint64Array),It.set(BigUint64Array,"uint64")),f?(et.set("float16",s),It.set(s,"float16")):et.set("float16",Uint16Array)}}});var Va,ja,Ha=F(()=>{"use strict";qt();Va=a=>{let r=1;for(let s=0;s<a.length;s++){let f=a[s];if(typeof f!="number"||!Number.isSafeInteger(f))throw new TypeError(`dims[${s}] must be an integer, got: ${f}`);if(f<0)throw new RangeError(`dims[${s}] must be a non-negative integer, got: ${f}`);r*=f}return r},ja=(a,r)=>{switch(a.location){case"cpu":return new ce(a.type,a.data,r);case"cpu-pinned":return new ce({location:"cpu-pinned",data:a.data,type:a.type,dims:r});case"texture":return new ce({location:"texture",texture:a.texture,type:a.type,dims:r});case"gpu-buffer":return new ce({location:"gpu-buffer",gpuBuffer:a.gpuBuffer,type:a.type,dims:r});case"ml-tensor":return new ce({location:"ml-tensor",mlTensor:a.mlTensor,type:a.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${a.location} is not supported`)}}});var ce,qt=F(()=>{"use strict";Pa();Fa();za();Ha();ce=class{constructor(r,s,f){$a();let i,d;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,i=r.type,d=r.dims,r.location){case"cpu-pinned":{let m=et.get(i);if(!m)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(r.data instanceof m))throw new TypeError(`buffer should be of type ${m.name}`);this.cpuData=r.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let m,y;if(typeof r=="string")if(i=r,y=f,r==="string"){if(!Array.isArray(s))throw new TypeError("A string tensor's data must be a string array.");m=s}else{let w=et.get(r);if(w===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(s)){if(r==="float16"&&w===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${w.name} as data.`);r==="uint64"||r==="int64"?m=w.from(s,BigInt):m=w.from(s)}else if(s instanceof w)m=s;else if(s instanceof Uint8ClampedArray)if(r==="uint8")m=Uint8Array.from(s);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&s instanceof Uint16Array&&w!==Uint16Array)m=new globalThis.Float16Array(s.buffer,s.byteOffset,s.length);else throw new TypeError(`A ${i} tensor's data must be type of ${w}`)}else if(y=s,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let w=typeof r[0];if(w==="string")i="string",m=r;else if(w==="boolean")i="bool",m=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${w}.`)}else if(r instanceof Uint8ClampedArray)i="uint8",m=Uint8Array.from(r);else{let w=It.get(r.constructor);if(w===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);i=w,m=r}if(y===void 0)y=[m.length];else if(!Array.isArray(y))throw new TypeError("A tensor's dims must be a number array");d=y,this.cpuData=m,this.dataLocation="cpu"}let p=Va(d);if(this.cpuData&&p!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=d,this.size=p}static async fromImage(r,s){return _a(r,s)}static fromTexture(r,s){return Ra(r,s)}static fromGpuBuffer(r,s){return Na(r,s)}static fromMLTensor(r,s){return Wa(r,s)}static fromPinnedBuffer(r,s,f){return ka(r,s,f)}toDataURL(r){return Ca(this,r)}toImageData(r){return Da(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let s=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=s,r&&this.disposer&&(this.disposer(),this.disposer=void 0),s}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ja(this,r)}}});var xe,Qr=F(()=>{"use strict";qt();xe=ce});var Ya,qa,tt,rt,Ge,$e,Kr=F(()=>{"use strict";Xr();Ya=(a,r)=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeStamp(`${a}::ORT::${r}`)},qa=(a,r)=>{let s=new Error().stack?.split(/\r\n|\r|\n/g)||[],f=!1;for(let i=0;i<s.length;i++){if(f&&!s[i].includes("TRACE_FUNC")){let d=`FUNC_${a}::${s[i].trim().split(" ")[1]}`;r&&(d+=`::${r}`),Ya("CPU",d);return}s[i].includes("TRACE_FUNC")&&(f=!0)}},tt=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||qa("BEGIN",a)},rt=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||qa("END",a)},Ge=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.time(`ORT::${a}`)},$e=a=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeEnd(`ORT::${a}`)}});var Jt,Ja=F(()=>{"use strict";Jr();Qr();Kr();Jt=class a{constructor(r){this.handler=r}async run(r,s,f){tt(),Ge("InferenceSession.run");let i={},d={};if(typeof r!="object"||r===null||r instanceof xe||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof xe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let w of s){if(typeof w!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(w)===-1)throw new RangeError(`'fetches' contains invalid output name: ${w}.`);i[w]=null}if(typeof f=="object"&&f!==null)d=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else{let w=!1,T=Object.getOwnPropertyNames(s);for(let g of this.outputNames)if(T.indexOf(g)!==-1){let v=s[g];(v===null||v instanceof xe)&&(w=!0,p=!1,i[g]=v)}if(w){if(typeof f=="object"&&f!==null)d=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else d=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let w of this.inputNames)if(typeof r[w]>"u")throw new Error(`input '${w}' is missing in 'feeds'.`);if(p)for(let w of this.outputNames)i[w]=null;let m=await this.handler.run(r,i,d),y={};for(let w in m)if(Object.hasOwnProperty.call(m,w)){let T=m[w];T instanceof xe?y[w]=T:y[w]=new xe(T.type,T.data,T.dims)}return $e("InferenceSession.run"),rt(),y}async release(){return this.handler.dispose()}static async create(r,s,f,i){tt(),Ge("InferenceSession.create");let d,p={};if(typeof r=="string"){if(d=r,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(d=r,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let T=r,g=0,v=r.byteLength;if(typeof s=="object"&&s!==null)p=s;else if(typeof s=="number"){if(g=s,!Number.isSafeInteger(g))throw new RangeError("'byteOffset' must be an integer.");if(g<0||g>=T.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${T.byteLength}).`);if(v=r.byteLength-g,typeof f=="number"){if(v=f,!Number.isSafeInteger(v))throw new RangeError("'byteLength' must be an integer.");if(v<=0||g+v>T.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${T.byteLength-g}].`);if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof f<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof s<"u")throw new TypeError("'options' must be an object.");d=new Uint8Array(T,g,v)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[m,y]=await xa(p),w=await m.createInferenceSessionHandler(d,y);return $e("InferenceSession.create"),rt(),new a(w)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var ec,Xa=F(()=>{"use strict";Ja();ec=Jt});var Za=F(()=>{"use strict"});var Qa=F(()=>{"use strict"});var Ka=F(()=>{"use strict"});var es=F(()=>{"use strict"});var en={};At(en,{InferenceSession:()=>ec,TRACE:()=>Ya,TRACE_EVENT_BEGIN:()=>Ge,TRACE_EVENT_END:()=>$e,TRACE_FUNC_BEGIN:()=>tt,TRACE_FUNC_END:()=>rt,Tensor:()=>xe,env:()=>ee,registerBackend:()=>Ke});var ze=F(()=>{"use strict";La();Ua();Xa();Qr();Za();Qa();Kr();Ka();es()});var Xt=F(()=>{"use strict"});var os={};At(os,{default:()=>tc});var rs,ns,tc,as=F(()=>{"use strict";tn();Ve();Zt();rs="ort-wasm-proxy-worker",ns=globalThis.self?.name===rs;ns&&(self.onmessage=a=>{let{type:r,in:s}=a.data;try{switch(r){case"init-wasm":Qt(s.wasm).then(()=>{Kt(s).then(()=>{postMessage({type:r})},f=>{postMessage({type:r,err:f})})},f=>{postMessage({type:r,err:f})});break;case"init-ep":{let{epName:f,env:i}=s;er(i,f).then(()=>{postMessage({type:r})},d=>{postMessage({type:r,err:d})});break}case"copy-from":{let{buffer:f}=s,i=xt(f);postMessage({type:r,out:i});break}case"create":{let{model:f,options:i}=s;tr(f,i).then(d=>{postMessage({type:r,out:d})},d=>{postMessage({type:r,err:d})});break}case"release":rr(s),postMessage({type:r});break;case"run":{let{sessionId:f,inputIndices:i,inputs:d,outputIndices:p,options:m}=s;nr(f,i,d,p,new Array(p.length).fill(null),m).then(y=>{y.some(w=>w[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:y},ar([...d,...y]))},y=>{postMessage({type:r,err:y})});break}case"end-profiling":or(s),postMessage({type:r});break;default:}}catch(f){postMessage({type:r,err:f})}});tc=ns?null:a=>new Worker(a??be,{type:"module",name:rs})});var is={};At(is,{default:()=>rc});async function ss(a={}){var r=a,s=!!globalThis.window,f=!!globalThis.WorkerGlobalScope,i=f&&self.name?.startsWith("em-pthread");r.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(r.Yc||(r.Yc=new Map)).set(e,t)},r.unmountExternalData=()=>{delete r.Yc},globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,Ke:!0}).buffer.constructor;let d=()=>{let e=t=>(...n)=>{let o=Oe;return n=t(...n),Oe!=o?new Promise((u,c)=>{Mr={resolve:u,reject:c}}):n};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])r[t]=e(r[t])})(),typeof jsepRunAsync<"u"&&(r._OrtRun=jsepRunAsync(r._OrtRun),r._OrtRunWithBinding=jsepRunAsync(r._OrtRunWithBinding)),d=void 0};r.asyncInit=()=>{d?.()};var p,m,y=(e,t)=>{throw t},w=import.meta.url,T="";if(s||f){try{T=new URL(".",w).href}catch{}f&&(m=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=async e=>{if(oe(e))return new Promise((n,o)=>{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=()=>{u.status==200||u.status==0&&u.response?n(u.response):o(u.status)},u.onerror=o,u.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var g,v,S,M,R,H,P=console.log.bind(console),U=console.error.bind(console),Y=P,B=U,G=!1,oe=e=>e.startsWith("file://");function l(){ke.buffer!=Z.buffer&&se()}if(i){let e=function(t){try{var n=t.data,o=n.Tc;if(o==="load"){let u=[];self.onmessage=c=>u.push(c),H=()=>{postMessage({Tc:"loaded"});for(let c of u)e(c);self.onmessage=e};for(let c of n.ke)r[c]&&!r[c].proxy||(r[c]=(...h)=>{postMessage({Tc:"callHandler",je:c,args:h})},c=="print"&&(Y=r[c]),c=="printErr"&&(B=r[c]));ke=n.te,se(),v=n.ue,wt(),jt()}else if(o==="run"){(function(u){var c=(l(),A)[u+52>>>2>>>0];u=(l(),A)[u+56>>>2>>>0],_o(c,c-u),C(c)})(n.Rc),$r(n.Rc,0,0,1,0,0),gn(),Br(n.Rc),ne||(bo(),ne=!0);try{qs(n.qe,n.$c)}catch(u){if(u!="unwind")throw u}}else n.target!=="setimmediate"&&(o==="checkMailbox"?ne&&Pt():o&&(B(`worker: received unknown command ${o}`),B(n)))}catch(u){throw Mo(),u}};var Lc=e,ne=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}var Z,J,Ce,Q,x,A,_,ae,le,q,ye,re=!1;function se(){var e=ke.buffer;r.HEAP8=Z=new Int8Array(e),Ce=new Int16Array(e),r.HEAPU8=J=new Uint8Array(e),Q=new Uint16Array(e),r.HEAP32=x=new Int32Array(e),r.HEAPU32=A=new Uint32Array(e),_=new Float32Array(e),ae=new Float64Array(e),le=new BigInt64Array(e),q=new BigUint64Array(e)}function gr(){re=!0,i?H():Ne.cc()}function we(e){throw B(e="Aborted("+e+")"),G=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),R?.(e),e}function He(){return{a:{ra:cf,g:Js,K:Xs,f:Zs,o:Qs,i:Ks,va:ei,b:ti,da:ri,Ha:Bn,n:ni,ea:On,Xa:Mn,_b:Un,ac:Cn,Ya:Dn,Va:Pn,Oa:_n,Ua:Rn,pa:Nn,$b:Wn,Yb:kn,Wa:Fn,Zb:Gn,bb:oi,Da:si,Tb:ii,Rb:fi,Ca:di,P:li,I:pi,Sb:mi,la:vi,Ub:Ei,Ra:Si,Wb:Ii,Ia:xi,Ob:Li,Fa:Bi,Qa:Br,_a:Oi,V:Di,q:Wi,c:xr,rb:ki,y:Fi,N:Gi,C:$i,m:zi,s:Jn,sb:Jn,J:Vi,U:ji,j:Hi,u:Yi,p:qi,k:Ji,La:Xi,Ma:Zi,Na:Qi,Ja:Kn,Ka:eo,Pb:to,db:eu,ab:nu,_:ou,qb:au,ma:su,$a:tu,X:iu,Za:uu,Xb:fu,G:Ki,gb:cu,Z:du,qa:Ft,Vb:pu,fb:lu,eb:mu,nb:vu,E:Eu,ua:Su,ta:Au,pb:Iu,Y:xu,w:Lu,mb:Bu,lb:Ou,kb:Mu,ob:Uu,jb:Cu,ib:Du,hb:Pu,Sa:fo,Ta:co,Ga:vr,fa:lo,oa:po,Pa:mo,na:ho,Cb:Hf,ya:kf,Db:jf,za:Wf,H:Mf,e:mf,t:lf,x:df,A:Af,Hb:Pf,L:Lf,v:yf,Aa:Rf,ba:Ff,ia:Df,Eb:Vf,Fb:zf,Gb:_f,Ba:Cf,Jb:Uf,O:Bf,ca:Nf,d:hf,B:bf,l:pf,Bb:Yf,r:wf,z:Sf,D:Ef,F:gf,M:If,Kb:Of,T:Gf,ja:xf,aa:$f,Lb:vf,Mb:Tf,h:Ru,a:ke,cb:Ye,Ib:Nu,ka:Wu,Q:ku,sa:Fu,Nb:Gu,R:$u,yb:zu,zb:Vu,wa:ju,ga:Hu,S:Yu,Ea:qu,xa:Ju,$:Xu,wb:Zu,bc:Qu,W:Ku,Ab:ef,tb:tf,ub:nf,vb:of,ha:af,xb:sf,Qb:uf}}}async function wt(){function e(o,u){var c=Ne=o.exports;o={};for(let[h,b]of Object.entries(c))typeof b=="function"?(c=Mi(b),o[h]=c):o[h]=b;return Ne=o,Ne=function(){var h=Ne,b=I=>N=>I(N)>>>0,E=I=>()=>I()>>>0;return(h=Object.assign({},h)).dc=b(h.dc),h.Gc=E(h.Gc),h.Ic=b(h.Ic),h.ud=(I=>(N,W)=>I(N,W)>>>0)(h.ud),h.zd=b(h.zd),h.Ad=E(h.Ad),h.Ed=b(h.Ed),h}(),bn.push(Ne.ld),yo=(o=Ne).dc,bo=o.ec,r._OrtInit=o.fc,r._OrtGetLastError=o.gc,r._OrtCreateSessionOptions=o.hc,r._OrtAppendExecutionProvider=o.ic,r._OrtAddFreeDimensionOverride=o.jc,r._OrtAddSessionConfigEntry=o.kc,r._OrtReleaseSessionOptions=o.lc,r._OrtCreateSession=o.mc,r._OrtReleaseSession=o.nc,r._OrtGetInputOutputCount=o.oc,r._OrtGetInputOutputMetadata=o.pc,r._OrtFree=o.qc,r._OrtCreateTensor=o.rc,r._OrtGetTensorData=o.sc,r._OrtReleaseTensor=o.tc,r._OrtCreateRunOptions=o.uc,r._OrtAddRunConfigEntry=o.vc,r._OrtReleaseRunOptions=o.wc,r._OrtCreateBinding=o.xc,r._OrtBindInput=o.yc,r._OrtBindOutput=o.zc,r._OrtClearBoundOutputs=o.Ac,r._OrtReleaseBinding=o.Bc,r._OrtRunWithBinding=o.Cc,r._OrtRun=o.Dc,r._OrtEndProfiling=o.Ec,Rr=r._OrtGetWebGpuDevice=o.Fc,zt=o.Gc,Te=r._free=o.Hc,mt=r._malloc=o.Ic,wo=r._wgpuBufferRelease=o.Jc,go=r._wgpuCreateInstance=o.Kc,To=o.Lc,vo=o.Mc,Eo=o.Nc,So=o.Oc,Ao=o.Pc,Io=o.Sc,xo=o.ad,Lo=o.bd,Bo=o.cd,Nr=o.ed,Wr=o.fd,kr=o.gd,Fr=o.hd,Et=o.id,Gr=o.jd,Oo=o.kd,$r=o.nd,Mo=o.od,Uo=o.pd,Co=o.qd,zr=o.rd,Do=o.sd,Po=o.td,Vr=o.ud,k=o.vd,St=o.wd,_o=o.xd,C=o.yd,Vt=o.zd,D=o.Ad,Ro=o.Bd,No=o.Cd,Wo=o.Dd,ko=o.Ed,Fo=o.Fd,jr=o.Gd,Go=o.Hd,$o=o.Id,zo=o.Jd,Vo=o.Kd,jo=o.Ld,Ho=o.Md,Yo=o.Nd,qo=o.Od,Jo=o.Pd,Xo=o.Qd,Zo=o.Rd,Qo=o.Sd,Ko=o.Td,ea=o.Ud,ta=o.Vd,ra=o.Xd,na=o.Yd,oa=o.Zd,aa=o._d,sa=o.ae,ia=o.be,ua=o.ce,fa=o.de,ca=o.ne,da=o.se,la=o.ve,pa=o.we,ma=o.xe,ha=o.ye,ya=o.ze,ba=o.Ae,wa=o.Be,ga=o.Ce,Ta=o.De,va=o.Ee,Ea=o.df,Sa=o.ef,Aa=o.ff,Ia=o.gf,v=u,Ne}var t,n=He();return r.instantiateWasm?new Promise(o=>{r.instantiateWasm(n,(u,c)=>{o(e(u,c))})}):i?e(new WebAssembly.Instance(v,He()),v):(ye??=r.locateFile?r.locateFile?r.locateFile("ort-wasm-simd-threaded.asyncify.wasm",T):T+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href,t=await async function(o){var u=ye;if(!g&&!oe(u))try{var c=fetch(u,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(c,o)}catch(h){B(`wasm streaming compile failed: ${h}`),B("falling back to ArrayBuffer instantiation")}return async function(h,b){try{var E=await async function(I){if(!g)try{var N=await p(I);return new Uint8Array(N)}catch{}if(I==ye&&g)I=new Uint8Array(g);else{if(!m)throw"both async and sync fetching of the wasm failed";I=m(I)}return I}(h);return await WebAssembly.instantiate(E,b)}catch(I){B(`failed to asynchronously prepare wasm: ${I}`),we(I)}}(u,o)}(n),e(t.instance,t.module))}class gt{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var Se=e=>{e.terminate(),e.onmessage=()=>{}},Ae=[],Le=0,te=null,K=e=>{We.length==0&&(vn(),Tn(We[0]));var t=We.pop();if(!t)return 6;Tt.push(t),qe[e.Rc]=t,t.Rc=e.Rc;var n={Tc:"run",qe:e.pe,$c:e.$c,Rc:e.Rc};return t.postMessage(n,e.ee),0},$=0,j=(e,t,...n)=>{for(var o=2*n.length,u=D(),c=Vt(8*o),h=c>>>3,b=0;b<n.length;b++){var E=n[b];typeof E=="bigint"?((l(),le)[h+2*b>>>0]=1n,(l(),le)[h+2*b+1>>>0]=E):((l(),le)[h+2*b>>>0]=0n,(l(),ae)[h+2*b+1>>>0]=E)}return e=Uo(e,0,o,c,t),C(u),e};function Ye(e){if(i)return j(0,1,e);if(S=e,!(0<$)){for(var t of Tt)Se(t);for(t of We)Se(t);We=[],Tt=[],qe={},G=!0}y(0,new gt(e))}function Tr(e){if(i)return j(1,0,e);vr(e)}var vr=e=>{if(S=e,i)throw Tr(e),"unwind";Ye(e)},We=[],Tt=[],bn=[],qe={},wn=e=>{var t=e.Rc;delete qe[t],We.push(e),Tt.splice(Tt.indexOf(e),1),e.Rc=0,Co(t)};function gn(){bn.forEach(e=>e())}var Tn=e=>new Promise(t=>{e.onmessage=u=>{var c=u.data;if(u=c.Tc,c.Zc&&c.Zc!=zt()){var h=qe[c.Zc];h?h.postMessage(c,c.ee):B(`Internal error! Worker sent a message "${u}" to target pthread ${c.Zc}, but that thread no longer exists!`)}else u==="checkMailbox"?Pt():u==="spawnThread"?K(c):u==="cleanupThread"?Dt(()=>{wn(qe[c.re])}):u==="loaded"?(e.loaded=!0,t(e)):c.target==="setimmediate"?e.postMessage(c):u==="uncaughtException"?e.onerror(c.error):u==="callHandler"?r[c.je](...c.args):u&&B(`worker sent an unknown command ${u}`)},e.onerror=u=>{throw B(`worker sent an error! ${u.filename}:${u.lineno}: ${u.message}`),u};var n,o=[];for(n of[])r.propertyIsEnumerable(n)&&o.push(n);e.postMessage({Tc:"load",ke:o,te:ke,ue:v})});function vn(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});We.push(e)}var ke,qs=(e,t)=>{$=0,e=jr(e,t),0<$?S=e:zr(e)},pe=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e),En=globalThis.TextDecoder&&new TextDecoder,Sn=(e,t,n,o)=>{if(n=t+n,o)return n;for(;e[t]&&!(t>=n);)++t;return t},An=(e,t=0,n,o)=>{if(16<(n=Sn(e,t>>>=0,n,o))-t&&e.buffer&&En)return En.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(o="";t<n;){var u=e[t++];if(128&u){var c=63&e[t++];if((224&u)==192)o+=String.fromCharCode((31&u)<<6|c);else{var h=63&e[t++];65536>(u=(240&u)==224?(15&u)<<12|c<<6|h:(7&u)<<18|c<<12|h<<6|63&e[t++])?o+=String.fromCharCode(u):(u-=65536,o+=String.fromCharCode(55296|u>>10,56320|1023&u))}}else o+=String.fromCharCode(u)}return o},ft=(e,t,n)=>(e>>>=0)?An((l(),J),e,t,n):"",Ut=[],Ct=0;function Js(e){var t=new Er(e>>>=0);return(l(),Z)[t.Uc+12>>>0]==0&&(In(t,!0),Ct--),xn(t,!1),Ut.push(t),No(e),ko(e)}var ct=0,Xs=()=>{k(0,0);var e=Ut.pop();Ro(e.md),ct=0};function In(e,t){t=t?1:0,(l(),Z)[e.Uc+12>>>0]=t}function xn(e,t){t=t?1:0,(l(),Z)[e.Uc+13>>>0]=t}class Er{constructor(t){this.md=t,this.Uc=t-24}}var Sr=e=>{var t=ct;if(!t)return St(0),0;var n=new Er(t);(l(),A)[n.Uc+16>>>2>>>0]=t;var o=(l(),A)[n.Uc+4>>>2>>>0];if(!o)return St(0),t;for(var u of e){if(u===0||u===o)break;if(Wo(u,o,n.Uc+16))return St(u),t}return St(o),t};function Zs(){return Sr([])}function Qs(e){return Sr([e>>>0])}function Ks(e,t,n,o){return Sr([e>>>0,t>>>0,n>>>0,o>>>0])}var ei=()=>{var e=Ut.pop();e||we("no exception to throw");var t=e.md;throw(l(),Z)[e.Uc+13>>>0]==0&&(Ut.push(e),xn(e,!0),In(e,!1),Ct++),ct=t};function ti(e,t,n){var o=new Er(e>>>=0);throw t>>>=0,n>>>=0,(l(),A)[o.Uc+16>>>2>>>0]=0,(l(),A)[o.Uc+4>>>2>>>0]=t,(l(),A)[o.Uc+8>>>2>>>0]=n,Ct++,ct=e}var ri=()=>Ct;function Ln(e,t,n,o){return i?j(2,1,e,t,n,o):Bn(e,t,n,o)}function Bn(e,t,n,o){if(e>>>=0,t>>>=0,n>>>=0,o>>>=0,!globalThis.SharedArrayBuffer)return 6;var u=[];return i&&u.length===0?Ln(e,t,n,o):(e={pe:n,Rc:e,$c:o,ee:u},i?(e.Tc="spawnThread",postMessage(e,u),0):K(e))}function ni(e){throw ct||=e>>>0,ct}function On(e,t,n){return i?j(3,1,e,t,n):0}function Mn(e,t){if(i)return j(4,1,e,t)}function Un(e,t){if(i)return j(5,1,e,t)}function Cn(e,t,n){if(i)return j(6,1,e,t,n)}function Dn(e,t,n){return i?j(7,1,e,t,n):0}function Pn(e,t){if(i)return j(8,1,e,t)}function _n(e,t,n){if(i)return j(9,1,e,t,n)}function Rn(e,t,n,o){if(i)return j(10,1,e,t,n,o)}function Nn(e,t,n,o){if(i)return j(11,1,e,t,n,o)}function Wn(e,t,n,o){if(i)return j(12,1,e,t,n,o)}function kn(e){if(i)return j(13,1,e)}function Fn(e,t){if(i)return j(14,1,e,t)}function Gn(e,t,n){if(i)return j(15,1,e,t,n)}var oi=()=>we(""),Be=e=>{e>>>=0;for(var t="";;){var n=(l(),J)[e++>>>0];if(!n)return t;t+=String.fromCharCode(n)}},Ar={},Ir={},ai={},dt=class extends Error{constructor(e){super(e),this.name="BindingError"}};function De(e,t,n={}){return function(o,u,c={}){var h=u.name;if(!o)throw new dt(`type "${h}" must have a positive integer typeid pointer`);if(Ir.hasOwnProperty(o)){if(c.le)return;throw new dt(`Cannot register type '${h}' twice`)}Ir[o]=u,delete ai[o],Ar.hasOwnProperty(o)&&(u=Ar[o],delete Ar[o],u.forEach(b=>b()))}(e,t,n)}var $n=(e,t,n)=>{switch(t){case 1:return n?o=>(l(),Z)[o>>>0]:o=>(l(),J)[o>>>0];case 2:return n?o=>(l(),Ce)[o>>>1>>>0]:o=>(l(),Q)[o>>>1>>>0];case 4:return n?o=>(l(),x)[o>>>2>>>0]:o=>(l(),A)[o>>>2>>>0];case 8:return n?o=>(l(),le)[o>>>3>>>0]:o=>(l(),q)[o>>>3>>>0];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function si(e,t,n,o,u){e>>>=0,n>>>=0,t=Be(t>>>0);let c=h=>h;if(o=o===0n){let h=8*n;c=b=>BigInt.asUintN(h,b),u=c(u)}De(e,{name:t,Qc:c,Wc:(h,b)=>(typeof b=="number"&&(b=BigInt(b)),b),Vc:$n(t,n,!o),Xc:null})}function ii(e,t,n,o){De(e>>>=0,{name:t=Be(t>>>0),Qc:function(u){return!!u},Wc:function(u,c){return c?n:o},Vc:function(u){return this.Qc((l(),J)[u>>>0])},Xc:null})}var zn=[],Je=[0,1,,1,null,1,!0,1,!1,1];function xr(e){9<(e>>>=0)&&--Je[e+1]==0&&(Je[e]=void 0,zn.push(e))}var ge=e=>{if(!e)throw new dt(`Cannot use deleted val. handle = ${e}`);return Je[e]},Ie=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=zn.pop()||Je.length;return Je[t]=e,Je[t+1]=1,t}};function Lr(e){return this.Qc((l(),A)[e>>>2>>>0])}var ui={name:"emscripten::val",Qc:e=>{var t=ge(e);return xr(e),t},Wc:(e,t)=>Ie(t),Vc:Lr,Xc:null};function fi(e){return De(e>>>0,ui)}var ci=(e,t)=>{switch(t){case 4:return function(n){return this.Qc((l(),_)[n>>>2>>>0])};case 8:return function(n){return this.Qc((l(),ae)[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function di(e,t,n){n>>>=0,De(e>>>=0,{name:t=Be(t>>>0),Qc:o=>o,Wc:(o,u)=>u,Vc:ci(t,n),Xc:null})}function li(e,t,n,o,u){e>>>=0,n>>>=0,t=Be(t>>>0);let c=b=>b;if(o===0){var h=32-8*n;c=b=>b<<h>>>h,u=c(u)}De(e,{name:t,Qc:c,Wc:(b,E)=>E,Vc:$n(t,n,o!==0),Xc:null})}function pi(e,t,n){function o(c){var h=(l(),A)[c>>>2>>>0];return c=(l(),A)[c+4>>>2>>>0],new u((l(),Z).buffer,c,h)}var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];De(e>>>=0,{name:n=Be(n>>>0),Qc:o,Vc:o},{le:!0})}var Pe=(e,t,n)=>{var o=(l(),J);if(t>>>=0,0<n){var u=t;n=t+n-1;for(var c=0;c<e.length;++c){var h=e.codePointAt(c);if(127>=h){if(t>=n)break;o[t++>>>0]=h}else if(2047>=h){if(t+1>=n)break;o[t++>>>0]=192|h>>6,o[t++>>>0]=128|63&h}else if(65535>=h){if(t+2>=n)break;o[t++>>>0]=224|h>>12,o[t++>>>0]=128|h>>6&63,o[t++>>>0]=128|63&h}else{if(t+3>=n)break;o[t++>>>0]=240|h>>18,o[t++>>>0]=128|h>>12&63,o[t++>>>0]=128|h>>6&63,o[t++>>>0]=128|63&h,c++}}o[t>>>0]=0,e=t-u}else e=0;return e},_e=e=>{for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++n):t+=3}return t};function mi(e,t){De(e>>>=0,{name:t=Be(t>>>0),Qc(n){var o=(l(),A)[n>>>2>>>0];return o=ft(n+4,o,!0),Te(n),o},Wc(n,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var u=typeof o=="string";if(!(u||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new dt("Cannot pass non-string to std::string");var c=u?_e(o):o.length,h=mt(4+c+1),b=h+4;return(l(),A)[h>>>2>>>0]=c,u?Pe(o,b,c+1):(l(),J).set(o,b>>>0),n!==null&&n.push(Te,h),h},Vc:Lr,Xc(n){Te(n)}})}var Vn=globalThis.TextDecoder?new TextDecoder("utf-16le"):void 0,hi=(e,t,n)=>{if(e>>>=1,16<(t=Sn((l(),Q),e,t/2,n))-e&&Vn)return Vn.decode((l(),Q).slice(e,t));for(n="";e<t;++e){var o=(l(),Q)[e>>>0];n+=String.fromCharCode(o)}return n},yi=(e,t,n)=>{if(n??=2147483647,2>n)return 0;var o=t;n=(n-=2)<2*e.length?n/2:e.length;for(var u=0;u<n;++u){var c=e.charCodeAt(u);(l(),Ce)[t>>>1>>>0]=c,t+=2}return(l(),Ce)[t>>>1>>>0]=0,t-o},bi=e=>2*e.length,wi=(e,t,n)=>{var o="";e>>>=2;for(var u=0;!(u>=t/4);u++){var c=(l(),A)[e+u>>>0];if(!c&&!n)break;o+=String.fromCodePoint(c)}return o},gi=(e,t,n)=>{if(t>>>=0,n??=2147483647,4>n)return 0;var o=t;n=o+n-4;for(var u=0;u<e.length;++u){var c=e.codePointAt(u);if(65535<c&&u++,(l(),x)[t>>>2>>>0]=c,(t+=4)+4>n)break}return(l(),x)[t>>>2>>>0]=0,t-o},Ti=e=>{for(var t=0,n=0;n<e.length;++n)65535<e.codePointAt(n)&&n++,t+=4;return t};function vi(e,t,n){if(e>>>=0,t>>>=0,n=Be(n>>>=0),t===2)var o=hi,u=yi,c=bi;else o=wi,u=gi,c=Ti;De(e,{name:n,Qc:h=>{var b=(l(),A)[h>>>2>>>0];return b=o(h+4,b*t,!0),Te(h),b},Wc:(h,b)=>{if(typeof b!="string")throw new dt(`Cannot pass non-string to C++ string type ${n}`);var E=c(b),I=mt(4+E+t);return(l(),A)[I>>>2>>>0]=E/t,u(b,I+4,E+t),h!==null&&h.push(Te,I),I},Vc:Lr,Xc(h){Te(h)}})}function Ei(e,t){De(e>>>=0,{me:!0,name:t=Be(t>>>0),Qc:()=>{},Wc:()=>{}})}function Si(e){$r(e>>>0,!f,1,!s,131072,!1),gn()}var Dt=e=>{if(!G)try{if(e(),!(0<$))try{i?zt()&&zr(S):vr(S)}catch(t){t instanceof gt||t=="unwind"||y(0,t)}}catch(t){t instanceof gt||t=="unwind"||y(0,t)}},Ai=!Atomics.waitAsync||globalThis.navigator?.userAgent&&91>Number((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)||[])[2]);function Br(e){e>>>=0,Ai||(Atomics.waitAsync((l(),x),e>>>2,e).value.then(Pt),e+=128,Atomics.store((l(),x),e>>>2,1))}var Pt=()=>Dt(()=>{var e=zt();e&&(Br(e),Po())});function Ii(e,t){(e>>>=0)==t>>>0?setTimeout(Pt):i?postMessage({Zc:e,Tc:"checkMailbox"}):(e=qe[e])&&e.postMessage({Tc:"checkMailbox"})}var _t=[];function xi(e,t,n,o,u){for(t>>>=0,o/=2,_t.length=o,n=u>>>0>>>3,u=0;u<o;u++)(l(),le)[n+2*u>>>0]?_t[u]=(l(),le)[n+2*u+1>>>0]:_t[u]=(l(),ae)[n+2*u+1>>>0];return(t?Hr[t]:ff[e])(..._t)}var Li=()=>{$=0};function Bi(e){e>>>=0,i?postMessage({Tc:"cleanupThread",re:e}):wn(qe[e])}function Oi(e){}var Rt=e=>{try{e()}catch(t){we(t)}};function Mi(e){var t=(...n)=>{Nt.push(e);try{return e(...n)}finally{G||(Nt.pop(),Oe&&Fe===1&&Nt.length===0&&(Fe=0,$+=1,Rt(Sa),typeof Fibers<"u"&&Fibers.Me()))}};return Yn.set(e,t),t}var Fe=0,Oe=null,jn=0,Nt=[],Or=new Map,Hn=new Map,Yn=new Map,Ui=0,Mr=null,Ci=[],qn=e=>function(t){if(!G){if(Fe===0){var n=!1,o=!1;t((u=0)=>{if(!G&&(jn=u,n=!0,o)){Fe=2,Rt(()=>Aa(Oe)),typeof MainLoop<"u"&&MainLoop.ie&&MainLoop.resume(),u=!1;try{var c=function(){var E=(l(),x)[Oe+8>>>2>>>0];return E=Hn.get(E),E=Yn.get(E),--$,E()}()}catch(E){c=E,u=!0}var h=!1;if(!Oe){var b=Mr;b&&(Mr=null,(u?b.reject:b.resolve)(c),h=!0)}if(u&&!h)throw c}}),o=!0,n||(Fe=1,Oe=function(){var u=mt(65548),c=u+12;if((l(),A)[u>>>2>>>0]=c,(l(),A)[u+4>>>2>>>0]=c+65536,c=Nt[0],!Or.has(c)){var h=Ui++;Or.set(c,h),Hn.set(h,c)}return c=Or.get(c),(l(),x)[u+8>>>2>>>0]=c,u}(),typeof MainLoop<"u"&&MainLoop.ie&&MainLoop.pause(),Rt(()=>Ea(Oe)))}else Fe===2?(Fe=0,Rt(Ia),Te(Oe),Oe=null,Ci.forEach(Dt)):we(`invalid state: ${Fe}`);return jn}}(t=>{e().then(t)});function Di(e){return e>>>=0,qn(async()=>{var t=await ge(e);return Ie(t)})}var Ur=[],Pi=e=>{var t=Ur.length;return Ur.push(e),t},_i=(e,t)=>{for(var n=Array(e),o=0;o<e;++o){var u=o,c=(l(),A)[t+4*o>>>2>>>0],h=Ir[c];if(h===void 0)throw e=`parameter ${o}`,c=yo(c),t=Be(c),Te(c),new dt(`${e} has unknown type ${t}`);n[u]=h}return n},Ri=(e,t,n)=>{var o=[];return e=e(o,n),o.length&&((l(),A)[t>>>2>>>0]=Ie(o)),e},Ni={},Wt=e=>{var t=Ni[e];return t===void 0?Be(e):t};function Wi(e,t,n){var[o,...u]=_i(e,t>>>0);t=o.Wc.bind(o);var c=u.map(E=>E.Vc.bind(E));e--;var h={toValue:ge};switch(e=c.map((E,I)=>{var N=`argFromPtr${I}`;return h[N]=E,`${N}(args${I?"+"+8*I:""})`}),n){case 0:var b="toValue(handle)";break;case 2:b="new (toValue(handle))";break;case 3:b="";break;case 1:h.getStringOrSymbol=Wt,b="toValue(handle)[getStringOrSymbol(methodName)]"}return b+=`(${e})`,o.me||(h.toReturnWire=t,h.emval_returnValue=Ri,b=`return emval_returnValue(toReturnWire, destructorsRef, ${b})`),b=`return function (handle, methodName, destructorsRef, args) {
  ${b}
  }`,n=new Function(Object.keys(h),b)(...Object.values(h)),b=`methodCaller<(${u.map(E=>E.name)}) => ${o.name}>`,Pi(Object.defineProperty(n,"name",{value:b}))}function ki(e,t){return t>>>=0,(e=ge(e>>>0))==ge(t)}function Fi(e){return(e>>>=0)?(e=Wt(e),Ie(globalThis[e])):Ie(globalThis)}function Gi(e){return e=Wt(e>>>0),Ie(r[e])}function $i(e,t){return t>>>=0,e=ge(e>>>0),t=ge(t),Ie(e[t])}function zi(e){9<(e>>>=0)&&(Je[e+1]+=1)}function Jn(e,t,n,o,u){return Ur[e>>>0](t>>>0,n>>>0,o>>>0,u>>>0)}function Vi(){return Ie([])}function ji(e){e=ge(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return Ie(t)}function Hi(e){return Ie(Wt(e>>>0))}function Yi(){return Ie({})}function qi(e){for(var t=ge(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}xr(e)}function Ji(e,t,n){t>>>=0,n>>>=0,e=ge(e>>>0),t=ge(t),n=ge(n),e[t]=n}function Xi(e,t){e=pe(e),t>>>=0,e=new Date(1e3*e),(l(),x)[t>>>2>>>0]=e.getUTCSeconds(),(l(),x)[t+4>>>2>>>0]=e.getUTCMinutes(),(l(),x)[t+8>>>2>>>0]=e.getUTCHours(),(l(),x)[t+12>>>2>>>0]=e.getUTCDate(),(l(),x)[t+16>>>2>>>0]=e.getUTCMonth(),(l(),x)[t+20>>>2>>>0]=e.getUTCFullYear()-1900,(l(),x)[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(l(),x)[t+28>>>2>>>0]=e}var Xn=e=>e%4==0&&(e%100!=0||e%400==0),Zn=[0,31,60,91,121,152,182,213,244,274,305,335],Qn=[0,31,59,90,120,151,181,212,243,273,304,334];function Zi(e,t){e=pe(e),t>>>=0,e=new Date(1e3*e),(l(),x)[t>>>2>>>0]=e.getSeconds(),(l(),x)[t+4>>>2>>>0]=e.getMinutes(),(l(),x)[t+8>>>2>>>0]=e.getHours(),(l(),x)[t+12>>>2>>>0]=e.getDate(),(l(),x)[t+16>>>2>>>0]=e.getMonth(),(l(),x)[t+20>>>2>>>0]=e.getFullYear()-1900,(l(),x)[t+24>>>2>>>0]=e.getDay();var n=(Xn(e.getFullYear())?Zn:Qn)[e.getMonth()]+e.getDate()-1|0;(l(),x)[t+28>>>2>>>0]=n,(l(),x)[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=o&&e.getTimezoneOffset()==Math.min(o,n)),(l(),x)[t+32>>>2>>>0]=e}function Qi(e){e>>>=0;var t=new Date((l(),x)[e+20>>>2>>>0]+1900,(l(),x)[e+16>>>2>>>0],(l(),x)[e+12>>>2>>>0],(l(),x)[e+8>>>2>>>0],(l(),x)[e+4>>>2>>>0],(l(),x)[e>>>2>>>0],0),n=(l(),x)[e+32>>>2>>>0],o=t.getTimezoneOffset(),u=new Date(t.getFullYear(),6,1).getTimezoneOffset(),c=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(c,u);return 0>n?(l(),x)[e+32>>>2>>>0]=+(u!=c&&h==o):0<n!=(h==o)&&(u=Math.max(c,u),t.setTime(t.getTime()+6e4*((0<n?h:u)-o))),(l(),x)[e+24>>>2>>>0]=t.getDay(),n=(Xn(t.getFullYear())?Zn:Qn)[t.getMonth()]+t.getDate()-1|0,(l(),x)[e+28>>>2>>>0]=n,(l(),x)[e>>>2>>>0]=t.getSeconds(),(l(),x)[e+4>>>2>>>0]=t.getMinutes(),(l(),x)[e+8>>>2>>>0]=t.getHours(),(l(),x)[e+12>>>2>>>0]=t.getDate(),(l(),x)[e+16>>>2>>>0]=t.getMonth(),(l(),x)[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Kn(e,t,n,o,u,c,h){return i?j(16,1,e,t,n,o,u,c,h):-52}function eo(e,t,n,o,u,c){if(i)return j(17,1,e,t,n,o,u,c)}var vt={},Ki=()=>performance.timeOrigin+performance.now();function to(e,t){if(i)return j(18,1,e,t);if(vt[e]&&(clearTimeout(vt[e].id),delete vt[e]),!t)return 0;var n=setTimeout(()=>{delete vt[e],Dt(()=>Do(e,performance.timeOrigin+performance.now()))},t);return vt[e]={id:n,Le:t},0}function eu(e,t,n,o){e>>>=0,t>>>=0,n>>>=0,o>>>=0;var u=new Date().getFullYear(),c=new Date(u,0,1).getTimezoneOffset();u=new Date(u,6,1).getTimezoneOffset();var h=Math.max(c,u);(l(),A)[e>>>2>>>0]=60*h,(l(),x)[t>>>2>>>0]=+(c!=u),e=(t=b=>{var E=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(E/60)).padStart(2,"0")}${String(E%60).padStart(2,"0")}`})(c),t=t(u),u<c?(Pe(e,n,17),Pe(t,o,17)):(Pe(e,o,17),Pe(t,n,17))}var tu=()=>Date.now(),ru=1;function nu(e,t,n){if(n>>>=0,!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!ru)return 52;e=performance.timeOrigin+performance.now()}return e=Math.round(1e6*e),(l(),le)[n>>>3>>>0]=BigInt(e),0}var Cr=[],ro=(e,t)=>{Cr.length=0;for(var n;n=(l(),J)[e++>>>0];){var o=n!=105;t+=(o&=n!=112)&&t%8?4:0,Cr.push(n==112?(l(),A)[t>>>2>>>0]:n==106?(l(),le)[t>>>3>>>0]:n==105?(l(),x)[t>>>2>>>0]:(l(),ae)[t>>>3>>>0]),t+=o?8:4}return Cr};function ou(e,t,n){return e>>>=0,t=ro(t>>>0,n>>>0),Hr[e](...t)}function au(e,t,n){return e>>>=0,t=ro(t>>>0,n>>>0),Hr[e](...t)}var su=()=>{};function iu(e,t){return B(ft(e>>>0,t>>>0))}var uu=()=>{throw $+=1,"unwind"};function fu(){return 4294901760}var cu=()=>1,du=()=>navigator.hardwareConcurrency,Xe={},no=e=>{var t=_e(e)+1,n=mt(t);return n&&Pe(e,n,t),n},kt=e=>{var t;return(t=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(e))?+t[1]:(t=/:(\d+):\d+(?:\)|$)/.exec(e))?2147483648|+t[1]:0},oo=e=>{for(var t of e)(e=kt(t))&&(Xe[e]=t)};function lu(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),oo(e),Xe.Wd=kt(e[3]),Xe.oe=e,Xe.Wd}function Ft(e){if(!(e=Xe[e>>>0]))return 0;var t;if(t=/^\s+at .*\.wasm\.(.*) \(.*\)$/.exec(e))e=t[1];else if(t=/^\s+at (.*) \(.*\)$/.exec(e))e=t[1];else{if(!(t=/^(.+?)@/.exec(e)))return 0;e=t[1]}return Te(Ft.$d??0),Ft.$d=no(e),Ft.$d}function pu(e){e>>>=0;var t=(l(),J).length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var o=t*(1+.2/n);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-ke.buffer.byteLength+65535)/65536|0;try{ke.grow(o),se();var u=1;break e}catch{}u=void 0}if(u)return!0}return!1}function mu(e,t,n){if(e>>>=0,t>>>=0,Xe.Wd==e)var o=Xe.oe;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),oo(o);for(var u=3;o[u]&&kt(o[u])!=e;)++u;for(e=0;e<n&&o[e+u];++e)(l(),x)[t+4*e>>>2>>>0]=kt(o[e+u]);return e}var Me=e=>{var t=_e(e)+1,n=Vt(t);return Pe(e,n,t),n},Dr=[],me=(e,t)=>{Dr[e>>>=0]=t},Ue=[],Gt=[],lt=(e,t)=>{Gt[e]=new Promise(n=>t.finally(()=>n(e)))},O=e=>{if(e)return Dr[e>>>0]},$t=(e,t,n)=>{(l(),A)[e>>>2>>>0]=t,(l(),A)[e+4>>>2>>>0]=n},ao=e=>{var t=(l(),A)[e>>>2>>>0];return e=(l(),A)[e+4>>>2>>>0],ft(t,e)},Re=e=>{var t=(l(),A)[e>>>2>>>0];return e=(l(),A)[e+4>>>2>>>0],t?ft(t,e):e===0?"":void 0},hu=e=>{var t=Re(e+4),n=(n=(l(),A)[e+12>>>2>>>0])?O(n):"auto";if(e+=16){var o=O((l(),A)[e+4>>>2>>>0]),u=(l(),A)[e+16>>>2>>>0],c=(l(),A)[e+20>>>2>>>0];if(u){for(var h={},b=0;b<u;++b){var E=c+24*b;h[ao(E+4)]=(l(),ae)[E+16>>>3>>>0]}u=h}else u=void 0;e={module:o,constants:u,entryPoint:Re(e+8)}}else e=void 0;return{label:t,layout:n,compute:e}},so=(e,t)=>{function n(u,c){u=e[u],(l(),x)[t+c>>>2>>>0]=u}function o(u,c){u=e[u],(l(),le)[t+c>>>3>>>0]=BigInt(u)}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),o("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.Je!==void 0&&n("maxImmediateSize",148)},yu=[,"validation","out-of-memory","internal"],bu=[,"compatibility","core"],io={1:"core-features-and-limits",2:"depth-clip-control",3:"depth32float-stencil8",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"timestamp-query",10:"indirect-first-instance",11:"shader-f16",12:"rg11b10ufloat-renderable",13:"bgra8unorm-storage",14:"float32-filterable",15:"float32-blendable",16:"clip-distances",17:"dual-source-blending",18:"subgroups",19:"texture-formats-tier1",20:"texture-formats-tier2",21:"primitive-index",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},wu=[,"low-power","high-performance"],gu=[,"occlusion","timestamp"],Tu={undefined:1,unknown:1,destroyed:2};function vu(e,t,n,o,u,c){t=pe(t),n=pe(n),o>>>=0,u>>>=0,c>>>=0;var h=O(e>>>0);if(e={},c){var b=(l(),A)[c+12>>>2>>>0];if(b){var E=(l(),A)[c+16>>>2>>>0];e.requiredFeatures=Array.from((l(),A).subarray(E>>>2>>>0,E+4*b>>>2>>>0),L=>io[L])}var I=(l(),A)[c+20>>>2>>>0];if(I){let L=function(ve,ie,Ze=!1){ie=I+ie,(ie=(l(),A)[ie>>>2>>>0])==4294967295||Ze&&ie==0||(N[ve]=ie)},fe=function(ve,ie){ie=I+ie;var Ze=(l(),A)[ie>>>2>>>0],qf=(l(),A)[ie+4>>>2>>>0];Ze==4294967295&&qf==4294967295||(N[ve]=4294967296*(l(),A)[ie+4>>>2>>>0]+(l(),A)[ie>>>2>>>0])};var W=L,X=fe,N={};L("maxTextureDimension1D",4),L("maxTextureDimension2D",8),L("maxTextureDimension3D",12),L("maxTextureArrayLayers",16),L("maxBindGroups",20),L("maxBindGroupsPlusVertexBuffers",24),L("maxDynamicUniformBuffersPerPipelineLayout",32),L("maxDynamicStorageBuffersPerPipelineLayout",36),L("maxSampledTexturesPerShaderStage",40),L("maxSamplersPerShaderStage",44),L("maxStorageBuffersPerShaderStage",48),L("maxStorageTexturesPerShaderStage",52),L("maxUniformBuffersPerShaderStage",56),L("minUniformBufferOffsetAlignment",80),L("minStorageBufferOffsetAlignment",84),fe("maxUniformBufferBindingSize",64),fe("maxStorageBufferBindingSize",72),L("maxVertexBuffers",88),fe("maxBufferSize",96),L("maxVertexAttributes",104),L("maxVertexBufferArrayStride",108),L("maxInterStageShaderVariables",112),L("maxColorAttachments",116),L("maxColorAttachmentBytesPerSample",120),L("maxComputeWorkgroupStorageSize",124),L("maxComputeInvocationsPerWorkgroup",128),L("maxComputeWorkgroupSizeX",132),L("maxComputeWorkgroupSizeY",136),L("maxComputeWorkgroupSizeZ",140),L("maxComputeWorkgroupsPerDimension",144),L("maxImmediateSize",148,!0),e.requiredLimits=N}(b=(l(),A)[c+24>>>2>>>0])&&(b={label:Re(b+4)},e.defaultQueue=b),e.label=Re(c+4)}$+=1,lt(t,h.requestDevice(e).then(L=>{--$,me(u,L.queue),me(o,L),n&&($+=1,lt(n,L.lost.then(fe=>{--$,L.onuncapturederror=()=>{};var ve=D(),ie=Me(fe.message);Wr(n,Tu[fe.reason],ie),C(ve)}))),L.onuncapturederror=fe=>{var ve=5;fe.error instanceof GPUValidationError?ve=2:fe.error instanceof GPUOutOfMemoryError?ve=3:fe.error instanceof GPUInternalError&&(ve=4);var ie=D();fe=Me(fe.error.message),Oo(o,ve,fe),C(ie)},"adapterInfo"in L||(L.adapterInfo=h.info),Gr(t,1,o,0)},L=>{--$;var fe=D();L=Me(L.message),Gr(t,3,o,L),n&&Wr(n,4,L),C(fe)}))}function Eu(e){var t=O(e>>>=0),n=Ue[e];if(n){for(var o=0;o<n.length;++o)n[o]();delete Ue[e]}t.destroy()}var pt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";pt.dd||(pt.dd={}),pt.dd[e]||(pt.dd[e]=1,B(e))};function Su(e,t,n){t>>>=0,n>>>=0;var o=O(e>>>=0);n===0&&pt(),n==4294967295&&(n=void 0);try{var u=o.getMappedRange(t,n)}catch{return 0}var c=Vr(16,u.byteLength);return(l(),J).set(new Uint8Array(u),c>>>0),Ue[e].push(()=>Te(c)),c}function Au(e,t,n){t>>>=0,n>>>=0;var o=O(e>>>=0);n===0&&pt(),n==4294967295&&(n=void 0);try{var u=o.getMappedRange(t,n)}catch{return 0}var c=Vr(16,u.byteLength);return(l(),J).fill(0,c,u.byteLength),Ue[e].push(()=>{new Uint8Array(u).set((l(),J).subarray(c>>>0,c+u.byteLength>>>0)),Te(c)}),c}function Iu(e,t,n,o,u){e>>>=0,t=pe(t),n=pe(n),u>>>=0;var c=O(e);Ue[e]=[],u==4294967295&&(u=void 0),$+=1,lt(t,c.mapAsync(n,o>>>0,u).then(()=>{--$,kr(t,1,0)},h=>{--$,D();var b=Me(h.message);kr(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,b),delete Ue[e]}))}function xu(e){var t=O(e>>>=0),n=Ue[e];if(n){for(var o=0;o<n.length;++o)n[o]();delete Ue[e],t.unmap()}}function Lu(e){delete Dr[e>>>0]}function Bu(e,t,n){e>>>=0,t>>>=0,n>>>=0;var o=!!(l(),A)[t+32>>>2>>>0];t={label:Re(t+4),usage:(l(),A)[t+16>>>2>>>0],size:4294967296*(l(),A)[t+28>>>2>>>0]+(l(),A)[t+24>>>2>>>0],mappedAtCreation:o},e=O(e);try{var u=e.createBuffer(t)}catch{return!1}return me(n,u),o&&(Ue[n]=[]),!0}function Ou(e,t,n,o){e>>>=0,t=pe(t),o>>>=0,n=hu(n>>>0),e=O(e),$+=1,lt(t,e.createComputePipelineAsync(n).then(u=>{--$,me(o,u),Nr(t,1,o,0)},u=>{--$;var c=D(),h=Me(u.message);Nr(t,u.reason==="validation"?3:u.reason==="internal"?4:0,o,h),C(c)}))}function Mu(e,t,n){e>>>=0,t>>>=0,n>>>=0;var o=(l(),A)[t>>>2>>>0],u=(l(),A)[o+4>>>2>>>0];t={label:Re(t+4),code:""},u===2&&(t.code=ao(o+8)),me(n,O(e).createShaderModule(t))}var Uu=e=>{(e=O(e)).onuncapturederror=null,e.destroy()};function Cu(e,t){t=pe(t),e=O(e>>>0),$+=1,lt(t,e.popErrorScope().then(n=>{--$;var o=5;n?n instanceof GPUValidationError?o=2:n instanceof GPUOutOfMemoryError?o=3:n instanceof GPUInternalError&&(o=4):o=1;var u=D();n=n?Me(n.message):0,Fr(t,1,o,n),C(u)},n=>{--$;var o=D();n=Me(n.message),Fr(t,1,5,n),C(o)}))}function Du(e,t,n,o){if(t=pe(t),o>>>=0,n>>>=0){var u=(l(),A)[n+4>>>2>>>0];u={featureLevel:bu[u],powerPreference:wu[(l(),A)[n+8>>>2>>>0]],forceFallbackAdapter:!!(l(),A)[n+12>>>2>>>0]},(n=(l(),A)[n>>>2>>>0])!==0&&(l(),u.Oe=!!(l(),A)[n+8>>>2>>>0])}"gpu"in navigator?($+=1,lt(t,navigator.gpu.requestAdapter(u).then(c=>{if(--$,c)me(o,c),Et(t,1,o,0);else{c=D();var h=Me("WebGPU not available on this browser (requestAdapter returned null)");Et(t,3,o,h),C(c)}},c=>{--$;var h=D();c=Me(c.message),Et(t,4,o,c),C(h)}))):(n=D(),u=Me("WebGPU not available on this browser (navigator.gpu is not available)"),Et(t,3,o,u),C(n))}function Pu(e,t,n){return e>>>=0,t>>>=0,n>>>=0,qn(async()=>{var o=[];if(n){var u=(l(),x)[n>>>2>>>0];o.length=t+1,o[t]=new Promise(b=>setTimeout(b,u,0))}else o.length=t;for(var c=0;c<t;++c){var h=4294967296*(l(),A)[e+8*c+4>>>2>>>0]+(l(),A)[e+8*c>>>2>>>0];if(!(h in Gt))return h;o[c]=Gt[h]}return o=await Promise.race(o),delete Gt[o],o})}var Pr,_r={},uo=()=>{if(!Pr){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in _r)_r[e]===void 0?delete t[e]:t[e]=_r[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);Pr=n}return Pr};function fo(e,t){if(i)return j(19,1,e,t);e>>>=0,t>>>=0;var n,o=0,u=0;for(n of uo()){var c=t+o;(l(),A)[e+u>>>2>>>0]=c,o+=Pe(n,c,1/0)+1,u+=4}return 0}function co(e,t){if(i)return j(20,1,e,t);e>>>=0,t>>>=0;var n=uo();for(var o of((l(),A)[e>>>2>>>0]=n.length,e=0,n))e+=_e(o)+1;return(l(),A)[t>>>2>>>0]=e,0}function lo(e){return i?j(21,1,e):52}function po(e,t,n,o){return i?j(22,1,e,t,n,o):52}function mo(e,t,n,o){return i?j(23,1,e,t,n,o):70}var _u=[null,[],[]];function ho(e,t,n,o){if(i)return j(24,1,e,t,n,o);t>>>=0,n>>>=0,o>>>=0;for(var u=0,c=0;c<n;c++){var h=(l(),A)[t>>>2>>>0],b=(l(),A)[t+4>>>2>>>0];t+=8;for(var E=0;E<b;E++){var I=e,N=(l(),J)[h+E>>>0],W=_u[I];N===0||N===10?((I===1?Y:B)(An(W)),W.length=0):W.push(N)}u+=b}return(l(),A)[o>>>2>>>0]=u,0}function Ru(e){return e>>>0}function Nu(e,t){return so(O(e>>>0).limits,t>>>0),1}function Wu(e,t){return O(e>>>0).features.has(io[t])}function ku(e){return BigInt(O(e>>>0).size)}function Fu(e){return BigInt(O(e>>>0).usage)}function Gu(e,t){if(e>>>=0,t>>>=0){var n=Re(t+4);n={label:n,timestampWrites:t=(t=(l(),A)[t+12>>>2>>>0])!==0?{querySet:O((l(),A)[t+4>>>2>>>0]),beginningOfPassWriteIndex:(l(),A)[t+8>>>2>>>0],endOfPassWriteIndex:(l(),A)[t+12>>>2>>>0]}:void 0}}return e=O(e),t=Ao(0),me(t,e.beginComputePass(n)),t}function $u(e,t,n,o,u,c){n=pe(n),u=pe(u),c=pe(c),O(e>>>0).copyBufferToBuffer(O(t>>>0),n,O(o>>>0),u,c)}function zu(e){e=O(e>>>0);var t=Eo(0);return me(t,e.finish()),t}function Vu(e,t,n,o,u,c){c=pe(c),O(e>>>0).resolveQuerySet(O(t>>>0),n,o,O(u>>>0),c)}function ju(e,t,n,o){O(e>>>0).dispatchWorkgroups(t,n,o)}function Hu(e,t,n){n=pe(n),O(e>>>0).dispatchWorkgroupsIndirect(O(t>>>0),n)}function Yu(e){O(e>>>0).end()}function qu(e,t,n,o,u){o>>>=0,u>>>=0,e=O(e>>>0),n=O(n>>>0),o==0?e.setBindGroup(t,n):e.setBindGroup(t,n,(l(),A),u>>>2,o)}function Ju(e,t){O(e>>>0).setPipeline(O(t>>>0))}function Xu(e,t,n){O(e>>>0).Ne(O(t>>>0),n)}function Zu(e,t){e=O(e>>>0);var n=vo(0);return me(n,e.getBindGroupLayout(t)),n}function Qu(e,t){e>>>=0;var n=Re(4+(t>>>=0)),o=O((l(),A)[t+12>>>2>>>0]),u=(l(),A)[t+16>>>2>>>0];t=(l(),A)[t+20>>>2>>>0];for(var c=[],h=0;h<u;++h){var b=c,E=b.push,I=t+40*h,N=(l(),A)[I+8>>>2>>>0],W=(l(),A)[I+32>>>2>>>0],X=(l(),A)[I+36>>>2>>>0],L=(l(),A)[I+4>>>2>>>0];N?(W=I+24,(W=(l(),A)[W>>>2>>>0]+4294967296*(l(),x)[W+4>>>2>>>0])==-1&&(W=void 0),I={binding:L,resource:{buffer:O(N),offset:4294967296*(l(),A)[I+4+16>>>2>>>0]+(l(),A)[I+16>>>2>>>0],size:W}}):I=W?{binding:L,resource:O(W)}:{binding:L,resource:O(X)},E.call(b,I)}return n={label:n,layout:o,entries:c},e=O(e),o=To(0),me(o,e.createBindGroup(n)),o}function Ku(e,t){var n;return e>>>=0,(t>>>=0)&&(n={label:Re(t+4)}),e=O(e),t=So(0),me(t,e.createCommandEncoder(n)),t}function ef(e,t){e>>>=0,t>>>=0,t={type:gu[(l(),A)[t+12>>>2>>>0]],count:(l(),A)[t+16>>>2>>>0]},e=O(e);var n=Io(0);return me(n,e.createQuerySet(t)),n}function tf(e,t){e=O(e>>>0).adapterInfo,t>>>=0,(l(),x)[t+52>>>2>>>0]=e.subgroupMinSize,(l(),x)[t+56>>>2>>>0]=e.subgroupMaxSize;var n=no(e.vendor+e.architecture+e.device+e.description),o=_e(e.vendor);return $t(t+4,n,o),n+=o,o=_e(e.architecture),$t(t+12,n,o),n+=o,o=_e(e.device),$t(t+20,n,o),$t(t+28,n+o,_e(e.description)),(l(),x)[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,(l(),x)[t+40>>>2>>>0]=e,(l(),x)[t+44>>>2>>>0]=0,(l(),x)[t+48>>>2>>>0]=0,1}var rf={"core-features-and-limits":1,"depth-clip-control":2,"depth32float-stencil8":3,"texture-compression-bc":4,"texture-compression-bc-sliced-3d":5,"texture-compression-etc2":6,"texture-compression-astc":7,"texture-compression-astc-sliced-3d":8,"timestamp-query":9,"indirect-first-instance":10,"shader-f16":11,"rg11b10ufloat-renderable":12,"bgra8unorm-storage":13,"float32-filterable":14,"float32-blendable":15,"clip-distances":16,"dual-source-blending":17,subgroups:18,"texture-formats-tier1":19,"texture-formats-tier2":20,"primitive-index":21,"chromium-experimental-unorm16-texture-formats":327692,"chromium-experimental-snorm16-texture-formats":327693,"chromium-experimental-multi-draw-indirect":327732};function nf(e,t){t>>>=0,e=O(e>>>0);var n=mt(4*e.features.size),o=0,u=0;e.features.forEach(c=>{0<=(c=rf[c])&&((l(),x)[n+o>>>2>>>0]=c,o+=4,u++)}),(l(),A)[t+4>>>2>>>0]=n,(l(),A)[t>>>2>>>0]=u}function of(e,t){return so(O(e>>>0).limits,t>>>0),1}function af(e,t){O(e>>>0).pushErrorScope(yu[t])}function sf(e,t,n){t>>>=0,n>>>=0,e=O(e>>>0),t=Array.from((l(),x).subarray(n>>>2>>>0,n+4*t>>>2>>>0),o=>O(o)),e.submit(t)}function uf(e,t,n,o,u){n=pe(n),o>>>=0,u>>>=0,e=O(e>>>0),t=O(t>>>0),o=(l(),J).subarray(o>>>0,o+u>>>0),e.writeBuffer(t,n,o,0,u)}i||function(){for(var e=r.numThreads-1;e--;)vn();Ae.push(async()=>{var t=async function(){if(!i)return Promise.all(We.map(Tn))}();Le++,await t,--Le==0&&te&&(t=te,te=null,t())})}(),i||(ke=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),se()),r.wasmBinary&&(g=r.wasmBinary),r.stackSave=()=>D(),r.stackRestore=e=>C(e),r.stackAlloc=e=>Vt(e),r.setValue=function(e,t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":(l(),Z)[e>>>0]=t;break;case"i16":(l(),Ce)[e>>>1>>>0]=t;break;case"i32":(l(),x)[e>>>2>>>0]=t;break;case"i64":(l(),le)[e>>>3>>>0]=BigInt(t);break;case"float":(l(),_)[e>>>2>>>0]=t;break;case"double":(l(),ae)[e>>>3>>>0]=t;break;case"*":(l(),A)[e>>>2>>>0]=t;break;default:we(`invalid type for setValue: ${n}`)}},r.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return(l(),Z)[e>>>0];case"i16":return(l(),Ce)[e>>>1>>>0];case"i32":return(l(),x)[e>>>2>>>0];case"i64":return(l(),le)[e>>>3>>>0];case"float":return(l(),_)[e>>>2>>>0];case"double":return(l(),ae)[e>>>3>>>0];case"*":return(l(),A)[e>>>2>>>0];default:we(`invalid type for getValue: ${t}`)}},r.UTF8ToString=ft,r.stringToUTF8=Pe,r.lengthBytesUTF8=_e;var yo,bo,Rr,zt,Te,mt,wo,go,To,vo,Eo,So,Ao,Io,xo,Lo,Bo,Nr,Wr,kr,Fr,Et,Gr,Oo,$r,Mo,Uo,Co,zr,Do,Po,Vr,k,St,_o,C,Vt,D,Ro,No,Wo,ko,Fo,jr,Go,$o,zo,Vo,jo,Ho,Yo,qo,Jo,Xo,Zo,Qo,Ko,ea,ta,ra,na,oa,aa,sa,ia,ua,fa,ca,da,la,pa,ma,ha,ya,ba,wa,ga,Ta,va,Ea,Sa,Aa,Ia,Ne,ff=[Ye,Tr,Ln,On,Mn,Un,Cn,Dn,Pn,_n,Rn,Nn,Wn,kn,Fn,Gn,Kn,eo,to,fo,co,lo,po,mo,ho],Hr={1097884:(e,t,n,o,u)=>{if(r===void 0||!r.Yc)return 1;if((e=ft(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=r.Yc.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),o=Number(o>>>0),t+n>e.byteLength)return 3;try{let c=e.subarray(t,t+n);switch(u){case 0:(l(),J).set(c,o>>>0);break;case 1:r.fe?r.fe(o,c):r.Ie(o,c);break;default:return 4}return 0}catch{return 4}},1098708:(e,t,n)=>{r.he(e,(l(),J).subarray(t>>>0,t+n>>>0))},1098772:()=>r.Ge(),1098814:e=>{r.ge(e)},1098851:()=>typeof wasmOffsetConverter<"u"};function cf(){return typeof wasmOffsetConverter<"u"}function df(e,t,n,o){var u=D();try{return Ho(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function lf(e,t,n){var o=D();try{return jo(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;k(1,0)}}function pf(e,t,n){var o=D();try{Fo(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;k(1,0)}}function mf(e,t){var n=D();try{return jr(e,t)}catch(o){if(C(n),o!==o+0)throw o;k(1,0)}}function hf(e){var t=D();try{Go(e)}catch(n){if(C(t),n!==n+0)throw n;k(1,0)}}function yf(e,t,n,o,u,c,h){var b=D();try{return Vo(e,t,n,o,u,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function bf(e,t){var n=D();try{Jo(e,t)}catch(o){if(C(n),o!==o+0)throw o;k(1,0)}}function wf(e,t,n,o){var u=D();try{qo(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function gf(e,t,n,o,u,c,h){var b=D();try{Zo(e,t,n,o,u,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function Tf(e,t,n,o,u,c,h){var b=D();try{Qo(e,t,n,o,u,c,h)}catch(E){if(C(b),E!==E+0)throw E;k(1,0)}}function vf(e,t,n,o,u,c,h,b){var E=D();try{sa(e,t,n,o,u,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function Ef(e,t,n,o,u,c){var h=D();try{$o(e,t,n,o,u,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Sf(e,t,n,o,u){var c=D();try{zo(e,t,n,o,u)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function Af(e,t,n,o,u){var c=D();try{return Xo(e,t,n,o,u)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function If(e,t,n,o,u,c,h,b){var E=D();try{ia(e,t,n,o,u,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function xf(e,t,n,o,u,c,h,b,E,I,N,W){var X=D();try{Ko(e,t,n,o,u,c,h,b,E,I,N,W)}catch(L){if(C(X),L!==L+0)throw L;k(1,0)}}function Lf(e,t,n,o,u,c){var h=D();try{return ua(e,t,n,o,u,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Bf(e,t,n){var o=D();try{return na(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;return k(1,0),0n}}function Of(e,t,n,o,u,c,h,b,E){var I=D();try{Yo(e,t,n,o,u,c,h,b,E)}catch(N){if(C(I),N!==N+0)throw N;k(1,0)}}function Mf(e){var t=D();try{return ta(e)}catch(n){if(C(t),n!==n+0)throw n;k(1,0)}}function Uf(e,t){var n=D();try{return va(e,t)}catch(o){if(C(n),o!==o+0)throw o;return k(1,0),0n}}function Cf(e){var t=D();try{return ea(e)}catch(n){if(C(t),n!==n+0)throw n;return k(1,0),0n}}function Df(e,t,n,o,u,c){var h=D();try{return la(e,t,n,o,u,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function Pf(e,t,n,o,u,c){var h=D();try{return pa(e,t,n,o,u,c)}catch(b){if(C(h),b!==b+0)throw b;k(1,0)}}function _f(e,t,n){var o=D();try{return ma(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;k(1,0)}}function Rf(e,t,n,o,u,c,h,b){var E=D();try{return fa(e,t,n,o,u,c,h,b)}catch(I){if(C(E),I!==I+0)throw I;k(1,0)}}function Nf(e,t,n,o,u){var c=D();try{return ha(e,t,n,o,u)}catch(h){if(C(c),h!==h+0)throw h;return k(1,0),0n}}function Wf(e,t,n,o){var u=D();try{return ya(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function kf(e,t,n,o){var u=D();try{return ba(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function Ff(e,t,n,o,u,c,h,b,E,I,N,W){var X=D();try{return wa(e,t,n,o,u,c,h,b,E,I,N,W)}catch(L){if(C(X),L!==L+0)throw L;k(1,0)}}function Gf(e,t,n,o,u,c,h,b,E,I,N){var W=D();try{ca(e,t,n,o,u,c,h,b,E,I,N)}catch(X){if(C(W),X!==X+0)throw X;k(1,0)}}function $f(e,t,n,o,u,c,h,b,E,I,N,W,X,L,fe,ve){var ie=D();try{da(e,t,n,o,u,c,h,b,E,I,N,W,X,L,fe,ve)}catch(Ze){if(C(ie),Ze!==Ze+0)throw Ze;k(1,0)}}function zf(e,t,n,o){var u=D();try{return ga(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function Vf(e,t,n,o,u){var c=D();try{return Ta(e,t,n,o,u)}catch(h){if(C(c),h!==h+0)throw h;k(1,0)}}function jf(e,t,n){var o=D();try{return ra(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;k(1,0)}}function Hf(e,t,n){var o=D();try{return oa(e,t,n)}catch(u){if(C(o),u!==u+0)throw u;k(1,0)}}function Yf(e,t,n,o){var u=D();try{aa(e,t,n,o)}catch(c){if(C(u),c!==c+0)throw c;k(1,0)}}function jt(){if(0<Le)te=jt;else if(i)M?.(r),gr();else{for(var e=Ae;0<e.length;)e.shift()(r);0<Le?te=jt:(r.calledRun=!0,G||(gr(),M?.(r)))}}return i||(Ne=await wt(),jt()),r.PTR_SIZE=4,r.webgpuInit=e=>{let t=new WeakMap,n,o,u=1;r.webgpuRegisterDevice=b=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(b){var E=t.get(b);if(!E){let I=((N,W=0)=>{var X=Bo(W);return W=Lo(W,X),me(X,N.queue),me(W,N),W})(b,E=go(0));E=[u++,E,I],t.set(b,E)}return n=b,o=E[0],E}n=void 0,o=0};let c=new Map;r.webgpuOnCreateSession=b=>{if(o!==void 0){var E=o;if(o=void 0,b){let I=Rr(E);c.set(b,I),E===0&&e(n??O(I))}n=void 0}},r.webgpuOnReleaseSession=b=>{c.delete(b)};let h=Symbol("gpuBufferMetadata");r.webgpuRegisterBuffer=(b,E,I)=>{if(I)return b[h]=[I,NaN],I;if(I=b[h])return I[1]++,I[0];if((E=c.get(E))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return E=((N,W=0)=>(N.mapState!="pending"||we(),W=xo(W,N.mapState=="mapped"?3:1),me(W,N),N.mapState=="mapped"&&(Ue[W]=[]),W))(b,E),b[h]=[E,1],E},r.webgpuUnregisterBuffer=b=>{let E=b[h];if(!E)throw Error("Buffer is not registered");E[1]--,E[1]===0&&(wo(E[0]),delete b[h])},r.webgpuGetBuffer=b=>O(b),r.webgpuCreateDownloader=(b,E,I)=>{if((I=c.get(I))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let N=O(I),W=16*Math.ceil(Number(E)/16);return async()=>{let X=N.createBuffer({size:W,usage:9});try{let L=N.createCommandEncoder();return L.copyBufferToBuffer(b,0,X,0,W),N.queue.submit([L.finish()]),await X.mapAsync(GPUMapMode.READ),X.getMappedRange().slice(0,E)}finally{X.destroy()}}},r.fe=(b,E)=>{var I=E.buffer;let N=E.byteOffset,W=E.byteLength;if(E=16*Math.ceil(Number(W)/16),b=O(b),!n){var X=Rr(o);n=O(X)}let L=(X=n.createBuffer({mappedAtCreation:!0,size:E,usage:6})).getMappedRange();new Uint8Array(L).set(new Uint8Array(I,N,W)),X.unmap(),(I=n.createCommandEncoder()).copyBufferToBuffer(X,0,b,0,E),n.queue.submit([I.finish()]),X.destroy()}},r.webnnInit=e=>{let t=e[0];[r.Ge,r.ge,r.webnnEnsureTensor,r.he,r.webnnDownloadTensor,r.Fe,r.webnnEnableTraceEvent]=e.slice(1),r.webnnReleaseTensorId=r.ge,r.webnnUploadTensor=r.he,r.webnnRegisterMLContext=r.Fe,r.webnnOnRunStart=n=>t.onRunStart(n),r.webnnOnRunEnd=t.onRunEnd.bind(t),r.webnnOnReleaseSession=n=>{t.onReleaseSession(n)},r.webnnCreateMLTensorDownloader=(n,o)=>t.createMLTensorDownloader(n,o),r.webnnRegisterMLTensor=(n,o,u,c)=>t.registerMLTensor(n,o,u,c),r.webnnCreateMLContext=n=>t.createMLContext(n),r.webnnRegisterMLConstant=(n,o,u,c,h,b)=>t.registerMLConstant(n,o,u,c,h,r.Yc,b),r.webnnRegisterGraphInput=t.registerGraphInput.bind(t),r.webnnIsGraphInput=t.isGraphInput.bind(t),r.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),r.webnnIsGraphOutput=t.isGraphOutput.bind(t),r.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),r.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},re?r:new Promise((e,t)=>{M=e,R=t})}var rc,nc,us=F(()=>{"use strict";rc=ss,nc=globalThis.self?.name?.startsWith("em-pthread");nc&&ss()});var ds,nn,oc,be,ls,rn,ac,sc,ps,ic,fs,ms,cs,hs,Zt=F(()=>{"use strict";Xt();ds=typeof location>"u"?void 0:location.origin,nn=import.meta.url>"file:"&&import.meta.url<"file;",oc=()=>{if(!!1){if(nn){let a=URL;return new URL(new a("ort.webgpu.bundle.min.mjs",import.meta.url).href,ds).href}return import.meta.url}},be=oc(),ls=()=>{if(be&&!be.startsWith("blob:"))return be.substring(0,be.lastIndexOf("/")+1)},rn=(a,r)=>{try{let s=r??be;return(s?new URL(a,s):new URL(a)).origin===ds}catch{return!1}},ac=(a,r)=>{let s=r??be;try{return(s?new URL(a,s):new URL(a)).href}catch{return}},sc=(a,r)=>`${r??"./"}${a}`,ps=async a=>{let s=await(await fetch(a,{credentials:"same-origin"})).blob();return URL.createObjectURL(s)},ic=async a=>(await import(/*webpackIgnore:true*/ /*@vite-ignore*/a)).default,fs=(as(),Ht(os)).default,ms=async()=>{if(!be)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(rn(be))return[void 0,fs()];let a=await ps(be);return[a,fs(a)]},cs=(us(),Ht(is)).default,hs=async(a,r,s,f)=>{let i=cs&&!(a||r);if(i)if(be)i=rn(be);else if(f&&!s)i=!0;else throw new Error("cannot determine the script source URL.");if(i)return[void 0,cs];{let d="ort-wasm-simd-threaded.asyncify.mjs",p=a??ac(d,r),m=!!1&&s&&p&&!rn(p,r),y=m?await ps(p):p??sc(d,r);return[m?y:void 0,await ic(y)]}}});var on,an,sr,ys,uc,fc,cc,Qt,V,Ve=F(()=>{"use strict";Zt();an=!1,sr=!1,ys=!1,uc=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},cc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Qt=async a=>{if(an)return Promise.resolve();if(sr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(ys)throw new Error("previous call to 'initializeWebAssembly()' failed.");sr=!0;let r=a.initTimeout,s=a.numThreads;if(a.simd!==!1){if(a.simd==="relaxed"){if(!cc())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!fc())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let f=uc();s>1&&!f&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+s+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),a.numThreads=s=1);let i=a.wasmPaths,d=typeof i=="string"?i:void 0,p=i?.mjs,m=p?.href??p,y=i?.wasm,w=y?.href??y,T=a.wasmBinary,[g,v]=await hs(m,d,s>1,!!T||!!w),S=!1,M=[];if(r>0&&M.push(new Promise(R=>{setTimeout(()=>{S=!0,R()},r)})),M.push(new Promise((R,H)=>{let P={numThreads:s};if(T)P.wasmBinary=T;else if(w||d)P.locateFile=U=>w??d+U;else if(m&&m.indexOf("blob:")!==0)P.locateFile=U=>new URL(U,m).href;else if(g){let U=ls();U&&(P.locateFile=Y=>U+Y)}v(P).then(U=>{sr=!1,an=!0,on=U,R(),g&&URL.revokeObjectURL(g)},U=>{sr=!1,ys=!0,H(U)})})),await Promise.race(M),S)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},V=()=>{if(an&&on)return on;throw new Error("WebAssembly is not initialized yet.")}});var he,Lt,z,ir=F(()=>{"use strict";Ve();he=(a,r)=>{let s=V(),f=s.lengthBytesUTF8(a)+1,i=s._malloc(f);return s.stringToUTF8(a,i,f),r.push(i),i},Lt=(a,r,s,f)=>{if(typeof a=="object"&&a!==null){if(s.has(a))throw new Error("Circular reference in options");s.add(a)}Object.entries(a).forEach(([i,d])=>{let p=r?r+i:i;if(typeof d=="object")Lt(d,p+".",s,f);else if(typeof d=="string"||typeof d=="number")f(p,d.toString());else if(typeof d=="boolean")f(p,d?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof d}`)})},z=a=>{let r=V(),s=r.stackSave();try{let f=r.PTR_SIZE,i=r.stackAlloc(2*f);r._OrtGetLastError(i,i+f);let d=Number(r.getValue(i,f===4?"i32":"i64")),p=r.getValue(i+f,"*"),m=p?r.UTF8ToString(p):"";throw new Error(`${a} ERROR_CODE: ${d}, ERROR_MESSAGE: ${m}`)}finally{r.stackRestore(s)}}});var bs,ws=F(()=>{"use strict";Ve();ir();bs=a=>{let r=V(),s=0,f=[],i=a||{};try{if(a?.logSeverityLevel===void 0)i.logSeverityLevel=2;else if(typeof a.logSeverityLevel!="number"||!Number.isInteger(a.logSeverityLevel)||a.logSeverityLevel<0||a.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${a.logSeverityLevel}`);if(a?.logVerbosityLevel===void 0)i.logVerbosityLevel=0;else if(typeof a.logVerbosityLevel!="number"||!Number.isInteger(a.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${a.logVerbosityLevel}`);a?.terminate===void 0&&(i.terminate=!1);let d=0;return a?.tag!==void 0&&(d=he(a.tag,f)),s=r._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,d),s===0&&z("Can't create run options."),a?.extra!==void 0&&Lt(a.extra,"",new WeakSet,(p,m)=>{let y=he(p,f),w=he(m,f);r._OrtAddRunConfigEntry(s,y,w)!==0&&z(`Can't set a run config entry: ${p} - ${m}.`)}),[s,f]}catch(d){throw s!==0&&r._OrtReleaseRunOptions(s),f.forEach(p=>r._free(p)),d}}});var dc,lc,pc,sn,ot,mc,gs,Ts=F(()=>{"use strict";Ve();ir();dc=a=>{switch(a){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${a}`)}},lc=a=>{switch(a){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${a}`)}},pc=a=>{a.extra||(a.extra={}),a.extra.session||(a.extra.session={});let r=a.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),a.executionProviders&&a.executionProviders.some(s=>(typeof s=="string"?s:s.name)==="webgpu")&&(a.enableMemPattern=!1)},sn=(a,r,s,f)=>{let i=he(r,f),d=he(s,f);V()._OrtAddSessionConfigEntry(a,i,d)!==0&&z(`Can't set a session config entry: ${r} - ${s}.`)},ot=(a,r,s,f)=>{let i=he(r,f),d=he(s,f);a.push([i,d])},mc=async(a,r,s)=>{let f=r.executionProviders;for(let i of f){let d=typeof i=="string"?i:i.name,p=[];switch(d){case"webnn":if(d="WEBNN",typeof i!="string"){let v=i?.deviceType;v&&sn(a,"deviceType",v,s)}break;case"webgpu":{d="WebGPU";let g;if(typeof i!="string"){let S=i;if(S.device)if(typeof GPUDevice<"u"&&S.device instanceof GPUDevice)g=S.device;else throw new Error("Invalid GPU device set in WebGPU EP options.");let{enableGraphCapture:M}=r;if(typeof M=="boolean"&&M&&ot(p,"enableGraphCapture","1",s),typeof S.preferredLayout=="string"&&ot(p,"preferredLayout",S.preferredLayout,s),S.forceCpuNodeNames){let R=Array.isArray(S.forceCpuNodeNames)?S.forceCpuNodeNames:[S.forceCpuNodeNames];ot(p,"forceCpuNodeNames",R.join(`
`),s)}S.validationMode&&ot(p,"validationMode",S.validationMode,s)}let v=V().webgpuRegisterDevice(g);if(v){let[S,M,R]=v;ot(p,"deviceId",S.toString(),s),ot(p,"webgpuInstance",M.toString(),s),ot(p,"webgpuDevice",R.toString(),s)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${d}`)}let m=he(d,s),y=p.length,w=0,T=0;if(y>0){w=V()._malloc(y*V().PTR_SIZE),s.push(w),T=V()._malloc(y*V().PTR_SIZE),s.push(T);for(let g=0;g<y;g++)V().setValue(w+g*V().PTR_SIZE,p[g][0],"*"),V().setValue(T+g*V().PTR_SIZE,p[g][1],"*")}await V()._OrtAppendExecutionProvider(a,m,w,T,y)!==0&&z(`Can't append execution provider: ${d}.`)}},gs=async a=>{let r=V(),s=0,f=[],i=a||{};pc(i);try{let d=dc(i.graphOptimizationLevel??"all"),p=lc(i.executionMode??"sequential"),m=typeof i.logId=="string"?he(i.logId,f):0,y=i.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let w=i.logVerbosityLevel??0;if(!Number.isInteger(w)||w<0||w>4)throw new Error(`log verbosity level is not valid: ${w}`);let T=typeof i.optimizedModelFilePath=="string"?he(i.optimizedModelFilePath,f):0;if(s=r._OrtCreateSessionOptions(d,!!i.enableCpuMemArena,!!i.enableMemPattern,p,!!i.enableProfiling,0,m,y,w,T),s===0&&z("Can't create session options."),i.executionProviders&&await mc(s,i,f),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);sn(s,"enableGraphCapture",i.enableGraphCapture.toString(),f)}if(i.freeDimensionOverrides)for(let[g,v]of Object.entries(i.freeDimensionOverrides)){if(typeof g!="string")throw new Error(`free dimension override name must be a string: ${g}`);if(typeof v!="number"||!Number.isInteger(v)||v<0)throw new Error(`free dimension override value must be a non-negative integer: ${v}`);let S=he(g,f);r._OrtAddFreeDimensionOverride(s,S,v)!==0&&z(`Can't set a free dimension override: ${g} - ${v}.`)}return i.extra!==void 0&&Lt(i.extra,"",new WeakSet,(g,v)=>{sn(s,g,v,f)}),[s,f]}catch(d){throw s!==0&&r._OrtReleaseSessionOptions(s)!==0&&z("Can't release session options."),f.forEach(p=>r._free(p)),d}}});var je,ur,ht,at,Bt,fr,cr,un,st=F(()=>{"use strict";je=a=>{switch(a){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${a}`)}},ur=a=>{switch(a){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${a}`)}},ht=(a,r)=>{let s=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][a],f=typeof r=="number"?r:r.reduce((i,d)=>i*d,1);return s>0?Math.ceil(f*s):void 0},at=a=>{switch(a){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${a}`)}},Bt=a=>{switch(a){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${a}`)}},fr=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",cr=a=>a==="float32"||a==="float16"||a==="int32"||a==="int64"||a==="uint32"||a==="uint64"||a==="int8"||a==="uint8"||a==="bool"||a==="uint4"||a==="int4",un=a=>{switch(a){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${a}`)}}});var Ot,fn=F(()=>{"use strict";Xt();Ot=async a=>{if(typeof a=="string")if(!1)try{let{readFile:r}=qr("node:fs/promises");return new Uint8Array(await r(a))}catch(r){if(r.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:s}=qr("node:fs"),f=s(a),i=[];for await(let d of f)i.push(d);return new Uint8Array(Buffer.concat(i))}throw r}else{let r=await fetch(a);if(!r.ok)throw new Error(`failed to load external data file: ${a}`);let s=r.headers.get("Content-Length"),f=s?parseInt(s,10):0;if(f<1073741824)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw new Error(`failed to load external data file: ${a}, no response body.`);let i=r.body.getReader(),d;try{d=new ArrayBuffer(f)}catch(m){if(m instanceof RangeError){let y=Math.ceil(f/65536);d=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw m}let p=0;for(;;){let{done:m,value:y}=await i.read();if(m)break;let w=y.byteLength;new Uint8Array(d,p,w).set(y),p+=w}return new Uint8Array(d,0,f)}}else return a instanceof Blob?new Uint8Array(await a.arrayBuffer()):a instanceof Uint8Array?a:new Uint8Array(a)}});var vs,Es=F(()=>{"use strict";st();vs=(a,r)=>new(at(r))(a)});var hc,yc,Ss,As,Is,bc,de,cn=F(()=>{"use strict";st();hc=["V","I","W","E","F"],yc=(a,r)=>{console.log(`[${hc[a]},${new Date().toISOString()}]${r}`)},Is=(a,r)=>{Ss=a,As=r},bc=(a,r)=>{let s=Bt(a),f=Bt(Ss);s>=f&&yc(s,typeof r=="function"?r():r)},de=(...a)=>{As&&bc(...a)}});var Ls,ln,Bs,wc,xs,gc,Os,dr,lr,dn,Ms,Us=F(()=>{"use strict";st();cn();Ls=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),ln=(a,r)=>{if(r==="int32")return a;let s=Ls.get(r);if(!s)throw new Error(`WebNN backend does not support data type: ${r}`);let f=s/8;if(a.byteLength%f!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${f}.`);let i=a.byteLength/f,d=new(at(r))(a.buffer,a.byteOffset,i);switch(r){case"int64":case"uint64":{let p=new Int32Array(i);for(let m=0;m<i;m++){let y=d[m];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[m]=Number(y)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(r==="uint32"&&d.some(m=>m>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(d,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${r} to 'int32'`)}},Bs=(a,r)=>{if(r==="int32")return a;if(a.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let s=a.byteLength/4,f=new Int32Array(a.buffer,a.byteOffset,s);switch(r){case"int64":{let i=BigInt64Array.from(f,BigInt);return new Uint8Array(i.buffer)}case"uint64":{if(f.some(d=>d<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let i=BigUint64Array.from(f,BigInt);return new Uint8Array(i.buffer)}case"int8":{if(f.some(d=>d<-128||d>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let i=Int8Array.from(f,Number);return new Uint8Array(i.buffer)}case"uint8":{if(f.some(i=>i<0||i>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(f,Number)}case"uint32":{if(f.some(d=>d<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let i=Uint32Array.from(f,Number);return new Uint8Array(i.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${r}`)}},wc=1,xs=()=>wc++,gc=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Os=(a,r)=>{let s=Ls.get(a);if(!s)throw new Error(`WebNN backend does not support data type: ${a}`);return r.length>0?Math.ceil(r.reduce((f,i)=>f*i)*s/8):0},dr=class{constructor(r){this.isDataConverted=!1;let{sessionId:s,context:f,tensor:i,dataType:d,shape:p,fallbackDataType:m}=r;this.sessionId=s,this.mlContext=f,this.mlTensor=i,this.dataType=d,this.tensorShape=p,this.fallbackDataType=m}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Os(this.dataType,this.tensorShape)}destroy(){de("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(r){this.mlContext.writeTensor(this.mlTensor,r)}async read(r){if(this.fallbackDataType){let s=await this.mlContext.readTensor(this.mlTensor),f=Bs(new Uint8Array(s),this.dataType);if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(f);return}else return f.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(r,s,f){return this.mlContext===r&&this.dataType===s&&this.tensorShape.length===f.length&&this.tensorShape.every((i,d)=>i===f[d])}setIsDataConverted(r){this.isDataConverted=r}},lr=class{constructor(r,s){this.tensorManager=r;this.wrapper=s}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(r,s,f,i){let d=this.tensorManager.getMLContext(r),p=this.tensorManager.getMLOpSupportLimits(r),m;if(!p?.input.dataTypes.includes(s)){if(m=gc.get(s),!m||p?.input.dataTypes.includes(m))throw new Error(`WebNN backend does not support data type: ${s}`);de("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${s} to ${m}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(d,s,f))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==Os(s,f))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let y=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(r,s,f,y,!0,!0,m),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(r){let s=r;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")s=ln(r,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(r.byteLength===this.wrapper.byteLength){this.wrapper.write(s);return}else de("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(s):this.activeUpload=new Uint8Array(s)}async download(r){if(this.activeUpload){let s=this.wrapper?.isDataConverted?Bs(this.activeUpload,this.wrapper?.type):this.activeUpload;if(r){r instanceof ArrayBuffer?new Uint8Array(r).set(s):new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(s);return}else return s.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return r?this.wrapper.read(r):this.wrapper.read()}},dn=class{constructor(r){this.backend=r;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(r){let s=this.backend.getMLContext(r);if(!s)throw new Error("MLContext not found for session.");return s}getMLOpSupportLimits(r){return this.backend.getMLOpSupportLimits(r)}reserveTensorId(){let r=xs();return this.tensorTrackersById.set(r,new lr(this)),r}releaseTensorId(r){let s=this.tensorTrackersById.get(r);s&&(this.tensorTrackersById.delete(r),s.tensorWrapper&&this.releaseTensor(s.tensorWrapper))}async ensureTensor(r,s,f,i,d){de("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${s}, dataType: ${f}, shape: ${i}, copyOld: ${d}}`);let p=this.tensorTrackersById.get(s);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(r,f,i,d)}upload(r,s){let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");f.upload(s)}async download(r,s){de("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${r}, dstBuffer: ${s?.byteLength}}`);let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");return f.download(s)}releaseTensorsForSession(r){for(let s of this.freeTensors)s.sessionId===r&&s.destroy();this.freeTensors=this.freeTensors.filter(s=>s.sessionId!==r)}registerTensor(r,s,f,i){let d=this.getMLContext(r),p=xs(),m=new dr({sessionId:r,context:d,tensor:s,dataType:f,shape:i});return this.tensorTrackersById.set(p,new lr(this,m)),this.externalTensors.add(m),p}async getCachedTensor(r,s,f,i,d,p,m){let y=this.getMLContext(r);for(let[T,g]of this.freeTensors.entries())if(g.canReuseTensor(y,s,f)){de("verbose",()=>`[WebNN] Reusing tensor {dataType: ${s}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}`);let v=this.freeTensors.splice(T,1)[0];return v.sessionId=r,v}de("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${s}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}}`);let w=await y.createTensor({dataType:m??s,shape:f,dimensions:f,usage:i,writable:d,readable:p});return new dr({sessionId:r,context:y,tensor:w,dataType:s,shape:f,fallbackDataType:m})}releaseTensor(r){this.externalTensors.has(r)&&this.externalTensors.delete(r),this.freeTensors.push(r)}},Ms=(...a)=>new dn(...a)});var Cs={};At(Cs,{WebNNBackend:()=>pn});var pr,Tc,pn,Ds=F(()=>{"use strict";st();Ve();Es();Us();cn();pr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Tc=(a,r)=>{if(a===r)return!0;if(a===void 0||r===void 0)return!1;let s=Object.keys(a).sort(),f=Object.keys(r).sort();return s.length===f.length&&s.every((i,d)=>i===f[d]&&a[i]===r[i])},pn=class{constructor(r){this.tensorManager=Ms(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;this.mlOpSupportLimitsBySessionId=new Map;Is(r.logLevel,!!r.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(r){de("verbose",()=>`[WebNN] onRunStart {sessionId: ${r}}`),this.activeSessionId=r}onRunEnd(r){de("verbose",()=>`[WebNN] onRunEnd {sessionId: ${r}}`);let s=this.temporarySessionTensorIds.get(r);if(s){for(let f of s)de("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${f}}`),this.tensorManager.releaseTensorId(f);this.temporarySessionTensorIds.delete(r),this.activeSessionId=void 0}}async createMLContext(r){if(r instanceof GPUDevice){let f=this.mlContextCache.findIndex(i=>i.gpuDevice===r);if(f!==-1)return this.mlContextCache[f].mlContext;{let i=await navigator.ml.createContext(r);return this.mlContextCache.push({gpuDevice:r,mlContext:i}),i}}else if(r===void 0){let f=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(f!==-1)return this.mlContextCache[f].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let s=this.mlContextCache.findIndex(f=>Tc(f.options,r));if(s!==-1)return this.mlContextCache[s].mlContext;{let f=await navigator.ml.createContext(r);return this.mlContextCache.push({options:r,mlContext:f}),f}}registerMLContext(r,s){this.mlContextBySessionId.set(r,s);let f=this.sessionIdsByMLContext.get(s);f||(f=new Set,this.sessionIdsByMLContext.set(s,f)),f.add(r),this.mlOpSupportLimitsBySessionId.has(r)||this.mlOpSupportLimitsBySessionId.set(r,s.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(r,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(r,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(r){this.sessionGraphInputs.delete(r),this.sessionGraphOutputs.delete(r);let s=this.mlContextBySessionId.get(r);if(!s)return;this.tensorManager.releaseTensorsForSession(r),this.mlContextBySessionId.delete(r),this.mlOpSupportLimitsBySessionId.delete(r);let f=this.sessionIdsByMLContext.get(s);if(f.delete(r),f.size===0){this.sessionIdsByMLContext.delete(s);let i=this.mlContextCache.findIndex(d=>d.mlContext===s);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(r){return this.mlContextBySessionId.get(r)}getMLOpSupportLimits(r){return this.mlOpSupportLimitsBySessionId.get(r)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(r){de("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r)}async ensureTensor(r,s,f,i,d){let p=pr.get(f);if(!p)throw new Error(`Unsupported ONNX data type: ${f}`);return this.tensorManager.ensureTensor(r??this.currentSessionId,s,p,i,d)}async createTemporaryTensor(r,s,f){de("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${s}, shape: ${f}}`);let i=pr.get(s);if(!i)throw new Error(`Unsupported ONNX data type: ${s}`);let d=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(r,d,i,f,!1);let p=this.temporarySessionTensorIds.get(r);return p?p.push(d):this.temporarySessionTensorIds.set(r,[d]),d}uploadTensor(r,s){if(!V().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");de("verbose",()=>`[WebNN] uploadTensor {tensorId: ${r}, data: ${s.byteLength}}`),this.tensorManager.upload(r,s)}async downloadTensor(r,s){return this.tensorManager.download(r,s)}createMLTensorDownloader(r,s){return async()=>{let f=await this.tensorManager.download(r);return vs(f,s)}}registerMLTensor(r,s,f,i){let d=pr.get(f);if(!d)throw new Error(`Unsupported ONNX data type: ${f}`);let p=this.tensorManager.registerTensor(r,s,d,i);return de("verbose",()=>`[WebNN] registerMLTensor {tensor: ${s}, dataType: ${d}, dimensions: ${i}} -> {tensorId: ${p}}`),p}registerMLConstant(r,s,f,i,d,p,m=!1){if(!p)throw new Error("External mounted files are not available.");let y=r;r.startsWith("./")&&(y=r.substring(2));let w=p.get(y);if(!w)throw new Error(`File with name ${y} not found in preloaded files.`);if(s+f>w.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let T=w.slice(s,s+f).buffer,g;switch(d.dataType){case"float32":g=new Float32Array(T);break;case"float16":g=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(T):new Uint16Array(T);break;case"int32":g=new Int32Array(T);break;case"uint32":g=new Uint32Array(T);break;case"int64":if(m){let v=ln(new Uint8Array(T),"int64");g=new Int32Array(v.buffer),d.dataType="int32"}else g=new BigInt64Array(T);break;case"uint64":g=new BigUint64Array(T);break;case"int8":g=new Int8Array(T);break;case"int4":case"uint4":case"uint8":g=new Uint8Array(T);break;default:throw new Error(`Unsupported data type: ${d.dataType} in creating WebNN Constant from external data.`)}return de("verbose",()=>`[WebNN] registerMLConstant {dataType: ${d.dataType}, shape: ${d.shape}}} ${m?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(d,g)}registerGraphInput(r){this.temporaryGraphInputs.push(r)}registerGraphOutput(r){this.temporaryGraphOutputs.push(r)}isGraphInput(r,s){let f=this.sessionGraphInputs.get(r);return f?f.includes(s):!1}isGraphOutput(r,s){let f=this.sessionGraphOutputs.get(r);return f?f.includes(s):!1}isGraphInputOutputTypeSupported(r,s,f=!0){let i=pr.get(je(s)),d=this.mlOpSupportLimitsBySessionId.get(r);return typeof i>"u"?!1:f?!!d?.input.dataTypes.includes(i):!!d?.output.dataTypes.includes(i)}flush(){}}});var vc,Kt,er,it,Ec,Ps,xt,tr,rr,_s,nr,or,ar,tn=F(()=>{"use strict";ze();ws();Ts();st();Ve();ir();fn();vc=(a,r)=>{V()._OrtInit(a,r)!==0&&z("Can't initialize onnxruntime.")},Kt=async a=>{vc(a.wasm.numThreads,Bt(a.logLevel))},er=async(a,r)=>{V().asyncInit?.();let s=a.webgpu.adapter;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(s){if(typeof s.limits!="object"||typeof s.features!="object"||typeof s.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let f=a.webgpu.powerPreference;if(f!==void 0&&f!=="low-power"&&f!=="high-performance")throw new Error(`Invalid powerPreference setting: "${f}"`);let i=a.webgpu.forceFallbackAdapter;if(i!==void 0&&typeof i!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${i}"`);if(s=await navigator.gpu.requestAdapter({powerPreference:f,forceFallbackAdapter:i}),!s)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(r==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(r==="webgpu"&&V().webgpuInit(f=>{a.webgpu.device=f}),r==="webnn"){let f=new(Ds(),Ht(Cs)).WebNNBackend(a);V().webnnInit([f,()=>f.reserveTensorId(),i=>f.releaseTensorId(i),async(i,d,p,m,y)=>f.ensureTensor(i,d,p,m,y),(i,d)=>{f.uploadTensor(i,d)},async(i,d)=>f.downloadTensor(i,d),(i,d)=>f.registerMLContext(i,d),!!a.trace])}},it=new Map,Ec=a=>{let r=V(),s=r.stackSave();try{let f=r.PTR_SIZE,i=r.stackAlloc(2*f);r._OrtGetInputOutputCount(a,i,i+f)!==0&&z("Can't get session input/output count.");let p=f===4?"i32":"i64";return[Number(r.getValue(i,p)),Number(r.getValue(i+f,p))]}finally{r.stackRestore(s)}},Ps=(a,r)=>{let s=V(),f=s.stackSave(),i=0;try{let d=s.PTR_SIZE,p=s.stackAlloc(2*d);s._OrtGetInputOutputMetadata(a,r,p,p+d)!==0&&z("Can't get session input/output metadata.");let y=Number(s.getValue(p,"*"));i=Number(s.getValue(p+d,"*"));let w=s.HEAP32[i/4];if(w===0)return[y,0];let T=s.HEAPU32[i/4+1],g=[];for(let v=0;v<T;v++){let S=Number(s.getValue(i+8+v*d,"*"));g.push(S!==0?s.UTF8ToString(S):Number(s.getValue(i+8+(v+T)*d,"*")))}return[y,w,g]}finally{s.stackRestore(f),i!==0&&s._OrtFree(i)}},xt=a=>{let r=V(),s=r._malloc(a.byteLength);if(s===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${a.byteLength}.`);return r.HEAPU8.set(a,s),[s,a.byteLength]},tr=async(a,r)=>{let s,f,i=V();Array.isArray(a)?[s,f]=a:a.buffer===i.HEAPU8.buffer?[s,f]=[a.byteOffset,a.byteLength]:[s,f]=xt(a);let d=0,p=0,m=0,y=[],w=[],T=[];try{if([p,y]=await gs(r),r?.externalData&&i.mountExternalData){let B=[];for(let G of r.externalData){let oe=typeof G=="string"?G:G.path;B.push(Ot(typeof G=="string"?G:G.data).then(l=>{i.mountExternalData(oe,l)}))}await Promise.all(B)}for(let B of r?.executionProviders??[])if((typeof B=="string"?B:B.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof B!="string"){let oe=B,l=oe?.context,ne=oe?.gpuDevice,Z=oe?.deviceType,J=oe?.powerPreference;l?i.currentContext=l:ne?i.currentContext=await i.webnnCreateMLContext(ne):i.currentContext=await i.webnnCreateMLContext({deviceType:Z,powerPreference:J})}else i.currentContext=await i.webnnCreateMLContext();break}d=await i._OrtCreateSession(s,f,p),i.webgpuOnCreateSession?.(d),d===0&&z("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(d,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[g,v]=Ec(d),S=!!r?.enableGraphCapture,M=[],R=[],H=[],P=[],U=[];for(let B=0;B<g;B++){let[G,oe,l]=Ps(d,B);G===0&&z("Can't get an input name."),w.push(G);let ne=i.UTF8ToString(G);M.push(ne),H.push(oe===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:ur(oe),shape:l})}for(let B=0;B<v;B++){let[G,oe,l]=Ps(d,B+g);G===0&&z("Can't get an output name."),T.push(G);let ne=i.UTF8ToString(G);R.push(ne),P.push(oe===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:ur(oe),shape:l});{if(S&&r?.preferredOutputLocation===void 0){U.push("gpu-buffer");continue}let Z=typeof r?.preferredOutputLocation=="string"?r.preferredOutputLocation:r?.preferredOutputLocation?.[ne]??"cpu",J=i.webnnIsGraphOutput;if(Z==="cpu"&&J&&J(d,ne)){U.push("ml-tensor-cpu-output");continue}if(Z!=="cpu"&&Z!=="cpu-pinned"&&Z!=="gpu-buffer"&&Z!=="ml-tensor")throw new Error(`Not supported preferred output location: ${Z}.`);if(S&&Z!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${Z}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);U.push(Z)}}let Y=null;return U.some(B=>B==="gpu-buffer"||B==="ml-tensor"||B==="ml-tensor-cpu-output")&&(m=i._OrtCreateBinding(d),m===0&&z("Can't create IO binding."),Y={handle:m,outputPreferredLocations:U,outputPreferredLocationsEncoded:U.map(B=>B==="ml-tensor-cpu-output"?"ml-tensor":B).map(B=>un(B))}),it.set(d,[d,w,T,Y,S,!1]),[d,M,R,H,P]}catch(g){throw w.forEach(v=>i._OrtFree(v)),T.forEach(v=>i._OrtFree(v)),m!==0&&i._OrtReleaseBinding(m)!==0&&z("Can't release IO binding."),d!==0&&i._OrtReleaseSession(d)!==0&&z("Can't release session."),g}finally{i._free(s),p!==0&&i._OrtReleaseSessionOptions(p)!==0&&z("Can't release session options."),y.forEach(g=>i._free(g)),i.unmountExternalData?.()}},rr=a=>{let r=V(),s=it.get(a);if(!s)throw new Error(`cannot release session. invalid session id: ${a}`);let[f,i,d,p,m]=s;p&&(m&&r._OrtClearBoundOutputs(p.handle)!==0&&z("Can't clear bound outputs."),r._OrtReleaseBinding(p.handle)!==0&&z("Can't release IO binding.")),r.jsepOnReleaseSession?.(a),r.webnnOnReleaseSession?.(a),r.webgpuOnReleaseSession?.(a),i.forEach(y=>r._OrtFree(y)),d.forEach(y=>r._OrtFree(y)),r._OrtReleaseSession(f)!==0&&z("Can't release session."),it.delete(a)},_s=async(a,r,s,f,i,d,p=!1)=>{if(!a){r.push(0);return}let m=V(),y=m.PTR_SIZE,w=a[0],T=a[1],g=a[3],v=g,S,M;if(w==="string"&&(g==="gpu-buffer"||g==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&g!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${d} when enableGraphCapture is true.`);if(g==="gpu-buffer"){let P=a[2].gpuBuffer;M=ht(je(w),T);{let U=m.webgpuRegisterBuffer;if(!U)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');S=U(P,f)}}else if(g==="ml-tensor"){let P=a[2].mlTensor;M=ht(je(w),T);let U=m.webnnRegisterMLTensor;if(!U)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');S=U(f,P,je(w),T)}else{let P=a[2];if(Array.isArray(P)){M=y*P.length,S=m._malloc(M),s.push(S);for(let U=0;U<P.length;U++){if(typeof P[U]!="string")throw new TypeError(`tensor data at index ${U} is not a string`);m.setValue(S+U*y,he(P[U],s),"*")}}else{let U=m.webnnIsGraphInput,Y=m.webnnIsGraphOutput;if(w!=="string"&&U&&Y){let B=m.UTF8ToString(i);if(U(f,B)||Y(f,B)){let G=je(w);M=ht(G,T),v="ml-tensor";let oe=m.webnnCreateTemporaryTensor,l=m.webnnUploadTensor;if(!oe||!l)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ne=await oe(f,G,T);l(ne,new Uint8Array(P.buffer,P.byteOffset,P.byteLength)),S=ne}else M=P.byteLength,S=m._malloc(M),s.push(S),m.HEAPU8.set(new Uint8Array(P.buffer,P.byteOffset,M),S)}else M=P.byteLength,S=m._malloc(M),s.push(S),m.HEAPU8.set(new Uint8Array(P.buffer,P.byteOffset,M),S)}}let R=m.stackSave(),H=m.stackAlloc(4*T.length);try{T.forEach((U,Y)=>m.setValue(H+Y*y,U,y===4?"i32":"i64"));let P=m._OrtCreateTensor(je(w),S,M,H,T.length,un(v));P===0&&z(`Can't create tensor for input/output. session=${f}, index=${d}.`),r.push(P)}finally{m.stackRestore(R)}},nr=async(a,r,s,f,i,d)=>{let p=V(),m=p.PTR_SIZE,y=it.get(a);if(!y)throw new Error(`cannot run inference. invalid session id: ${a}`);let w=y[0],T=y[1],g=y[2],v=y[3],S=y[4],M=y[5],R=r.length,H=f.length,P=0,U=[],Y=[],B=[],G=[],oe=[],l=p.stackSave(),ne=p.stackAlloc(R*m),Z=p.stackAlloc(R*m),J=p.stackAlloc(H*m),Ce=p.stackAlloc(H*m);try{[P,U]=bs(d),Ge("wasm prepareInputOutputTensor");for(let _=0;_<R;_++)await _s(s[_],Y,G,a,T[r[_]],r[_],S);for(let _=0;_<H;_++)await _s(i[_],B,G,a,g[f[_]],R+f[_],S);$e("wasm prepareInputOutputTensor");for(let _=0;_<R;_++)p.setValue(ne+_*m,Y[_],"*"),p.setValue(Z+_*m,T[r[_]],"*");for(let _=0;_<H;_++)p.setValue(J+_*m,B[_],"*"),p.setValue(Ce+_*m,g[f[_]],"*");if(v&&!M){let{handle:_,outputPreferredLocations:ae,outputPreferredLocationsEncoded:le}=v;if(T.length!==R)throw new Error(`input count from feeds (${R}) is expected to be always equal to model's input count (${T.length}).`);Ge("wasm bindInputsOutputs");for(let q=0;q<R;q++){let ye=r[q];await p._OrtBindInput(_,T[ye],Y[q])!==0&&z(`Can't bind input[${q}] for session=${a}.`)}for(let q=0;q<H;q++){let ye=f[q];i[q]?.[3]?(oe.push(B[q]),p._OrtBindOutput(_,g[ye],B[q],0)!==0&&z(`Can't bind pre-allocated output[${q}] for session=${a}.`)):p._OrtBindOutput(_,g[ye],0,le[ye])!==0&&z(`Can't bind output[${q}] to ${ae[q]} for session=${a}.`)}$e("wasm bindInputsOutputs"),it.set(a,[w,T,g,v,S,!0])}p.jsepOnRunStart?.(w),p.webnnOnRunStart?.(w);let Q;v?Q=await p._OrtRunWithBinding(w,v.handle,H,J,P):Q=await p._OrtRun(w,Z,ne,R,Ce,H,J,P),Q!==0&&z("failed to call OrtRun().");let x=[],A=[];Ge("wasm ProcessOutputTensor");for(let _=0;_<H;_++){let ae=Number(p.getValue(J+_*m,"*"));if(ae===B[_]||oe.includes(B[_])){x.push(i[_]),ae!==B[_]&&p._OrtReleaseTensor(ae)!==0&&z("Can't release tensor.");continue}let le=p.stackSave(),q=p.stackAlloc(4*m),ye=!1,re,se=0;try{p._OrtGetTensorData(ae,q,q+m,q+2*m,q+3*m)!==0&&z(`Can't access output tensor data on index ${_}.`);let we=m===4?"i32":"i64",He=Number(p.getValue(q,we));se=p.getValue(q+m,"*");let wt=p.getValue(q+m*2,"*"),gt=Number(p.getValue(q+m*3,we)),Se=[];for(let te=0;te<gt;te++)Se.push(Number(p.getValue(wt+te*m,we)));p._OrtFree(wt)!==0&&z("Can't free memory for tensor dims.");let Ae=Se.reduce((te,K)=>te*K,1);re=ur(He);let Le=v?.outputPreferredLocations[f[_]];if(re==="string"){if(Le==="gpu-buffer"||Le==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let te=[];for(let K=0;K<Ae;K++){let $=p.getValue(se+K*m,"*"),j=p.getValue(se+(K+1)*m,"*"),Ye=K===Ae-1?void 0:j-$;te.push(p.UTF8ToString($,Ye))}x.push([re,Se,te,"cpu"])}else if(Le==="gpu-buffer"&&Ae>0){let te=p.webgpuGetBuffer;if(!te)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let K=te(se),$=ht(He,Ae);if($===void 0||!fr(re))throw new Error(`Unsupported data type: ${re}`);ye=!0;{p.webgpuRegisterBuffer(K,a,se);let j=p.webgpuCreateDownloader(K,$,a);x.push([re,Se,{gpuBuffer:K,download:async()=>{let Ye=await j();return new(at(re))(Ye)},dispose:()=>{p._OrtReleaseTensor(ae)!==0&&z("Can't release tensor.")}},"gpu-buffer"])}}else if(Le==="ml-tensor"&&Ae>0){let te=p.webnnEnsureTensor,K=p.webnnIsGraphInputOutputTypeSupported;if(!te||!K)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ht(He,Ae)===void 0||!cr(re))throw new Error(`Unsupported data type: ${re}`);if(!K(a,re,!1))throw new Error(`preferredLocation "ml-tensor" for ${re} output is not supported by current WebNN Context.`);let j=await te(a,se,He,Se,!1);ye=!0,x.push([re,Se,{mlTensor:j,download:p.webnnCreateMLTensorDownloader(se,re),dispose:()=>{p.webnnReleaseTensorId(se),p._OrtReleaseTensor(ae)}},"ml-tensor"])}else if(Le==="ml-tensor-cpu-output"&&Ae>0){let te=p.webnnCreateMLTensorDownloader(se,re)(),K=x.length;ye=!0,A.push((async()=>{let $=[K,await te];return p.webnnReleaseTensorId(se),p._OrtReleaseTensor(ae),$})()),x.push([re,Se,[],"cpu"])}else{let te=at(re),K=new te(Ae);new Uint8Array(K.buffer,K.byteOffset,K.byteLength).set(p.HEAPU8.subarray(se,se+K.byteLength)),x.push([re,Se,K,"cpu"])}}finally{p.stackRestore(le),re==="string"&&se&&p._free(se),ye||p._OrtReleaseTensor(ae)}}v&&!S&&(p._OrtClearBoundOutputs(v.handle)!==0&&z("Can't clear bound outputs."),it.set(a,[w,T,g,v,S,!1]));for(let[_,ae]of await Promise.all(A))x[_][2]=ae;return $e("wasm ProcessOutputTensor"),x}finally{p.webnnOnRunEnd?.(w),p.stackRestore(l),s.forEach(Q=>{Q&&Q[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Q[2].gpuBuffer)}),i.forEach(Q=>{Q&&Q[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Q[2].gpuBuffer)}),Y.forEach(Q=>p._OrtReleaseTensor(Q)),B.forEach(Q=>p._OrtReleaseTensor(Q)),G.forEach(Q=>p._free(Q)),P!==0&&p._OrtReleaseRunOptions(P),U.forEach(Q=>p._free(Q))}},or=a=>{let r=V(),s=it.get(a);if(!s)throw new Error("invalid session id");let f=s[0],i=r._OrtEndProfiling(f);i===0&&z("Can't get an profile file name."),r._OrtFree(i)},ar=a=>{let r=[];for(let s of a){let f=s[2];!Array.isArray(f)&&"buffer"in f&&r.push(f.buffer)}return r}});var ut,Ee,Mt,hr,yr,mr,mn,hn,yt,bt,Ac,Rs,Ns,Ws,ks,Fs,Gs,$s,yn=F(()=>{"use strict";ze();tn();Ve();Zt();ut=()=>!!ee.wasm.proxy&&typeof document<"u",Mt=!1,hr=!1,yr=!1,hn=new Map,yt=(a,r)=>{let s=hn.get(a);s?s.push(r):hn.set(a,[r])},bt=()=>{if(Mt||!hr||yr||!Ee)throw new Error("worker not ready")},Ac=a=>{switch(a.data.type){case"init-wasm":Mt=!1,a.data.err?(yr=!0,mn[1](a.data.err)):(hr=!0,mn[0]()),mr&&(URL.revokeObjectURL(mr),mr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=hn.get(a.data.type);a.data.err?r.shift()[1](a.data.err):r.shift()[0](a.data.out);break}default:}},Rs=async()=>{if(!hr){if(Mt)throw new Error("multiple calls to 'initWasm()' detected.");if(yr)throw new Error("previous call to 'initWasm()' failed.");if(Mt=!0,ut())return new Promise((a,r)=>{Ee?.terminate(),ms().then(([s,f])=>{try{Ee=f,Ee.onerror=d=>r(d),Ee.onmessage=Ac,mn=[a,r];let i={type:"init-wasm",in:ee};!i.in.wasm.wasmPaths&&(s||nn)&&(i.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),Ee.postMessage(i),mr=s}catch(i){r(i)}},r)});try{await Qt(ee.wasm),await Kt(ee),hr=!0}catch(a){throw yr=!0,a}finally{Mt=!1}}},Ns=async a=>{if(ut())return bt(),new Promise((r,s)=>{yt("init-ep",[r,s]);let f={type:"init-ep",in:{epName:a,env:ee}};Ee.postMessage(f)});await er(ee,a)},Ws=async a=>ut()?(bt(),new Promise((r,s)=>{yt("copy-from",[r,s]);let f={type:"copy-from",in:{buffer:a}};Ee.postMessage(f,[a.buffer])})):xt(a),ks=async(a,r)=>{if(ut()){if(r?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return bt(),new Promise((s,f)=>{yt("create",[s,f]);let i={type:"create",in:{model:a,options:{...r}}},d=[];a instanceof Uint8Array&&d.push(a.buffer),Ee.postMessage(i,d)})}else return tr(a,r)},Fs=async a=>{if(ut())return bt(),new Promise((r,s)=>{yt("release",[r,s]);let f={type:"release",in:a};Ee.postMessage(f)});rr(a)},Gs=async(a,r,s,f,i,d)=>{if(ut()){if(s.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return bt(),new Promise((p,m)=>{yt("run",[p,m]);let y=s,w={type:"run",in:{sessionId:a,inputIndices:r,inputs:y,outputIndices:f,options:d}};Ee.postMessage(w,ar(y))})}else return nr(a,r,s,f,i,d)},$s=async a=>{if(ut())return bt(),new Promise((r,s)=>{yt("end-profiling",[r,s]);let f={type:"end-profiling",in:a};Ee.postMessage(f)});or(a)}});var zs,Ic,br,Vs=F(()=>{"use strict";ze();yn();st();Xt();fn();zs=(a,r)=>{switch(a.location){case"cpu":return[a.type,a.dims,a.data,"cpu"];case"gpu-buffer":return[a.type,a.dims,{gpuBuffer:a.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[a.type,a.dims,{mlTensor:a.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${a.location} for ${r()}`)}},Ic=a=>{switch(a[3]){case"cpu":return new xe(a[0],a[2],a[1]);case"gpu-buffer":{let r=a[0];if(!fr(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:s,download:f,dispose:i}=a[2];return xe.fromGpuBuffer(s,{dataType:r,dims:a[1],download:f,dispose:i})}case"ml-tensor":{let r=a[0];if(!cr(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:s,download:f,dispose:i}=a[2];return xe.fromMLTensor(s,{dataType:r,dims:a[1],download:f,dispose:i})}default:throw new Error(`invalid data location: ${a[3]}`)}},br=class{async fetchModelAndCopyToWasmMemory(r){return Ws(await Ot(r))}async loadModel(r,s){tt();let f;typeof r=="string"?f=await this.fetchModelAndCopyToWasmMemory(r):f=r,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await ks(f,s),rt()}async dispose(){return Fs(this.sessionId)}async run(r,s,f){tt();let i=[],d=[];Object.entries(r).forEach(v=>{let S=v[0],M=v[1],R=this.inputNames.indexOf(S);if(R===-1)throw new Error(`invalid input '${S}'`);i.push(M),d.push(R)});let p=[],m=[];Object.entries(s).forEach(v=>{let S=v[0],M=v[1],R=this.outputNames.indexOf(S);if(R===-1)throw new Error(`invalid output '${S}'`);p.push(M),m.push(R)});let y=i.map((v,S)=>zs(v,()=>`input "${this.inputNames[d[S]]}"`)),w=p.map((v,S)=>v?zs(v,()=>`output "${this.outputNames[m[S]]}"`):null),T=await Gs(this.sessionId,d,y,m,w,f),g={};for(let v=0;v<T.length;v++)g[this.outputNames[m[v]]]=p[v]??Ic(T[v]);return rt(),g}startProfiling(){}endProfiling(){$s(this.sessionId)}}});var Hs={};At(Hs,{OnnxruntimeWebAssemblyBackend:()=>wr,initializeFlags:()=>js,wasmBackend:()=>xc});var js,wr,xc,Ys=F(()=>{"use strict";ze();yn();Vs();js=()=>{(typeof ee.wasm.initTimeout!="number"||ee.wasm.initTimeout<0)&&(ee.wasm.initTimeout=0);let a=ee.wasm.simd;if(typeof a!="boolean"&&a!==void 0&&a!=="fixed"&&a!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${a}". Reset it to \`false\` and ignore SIMD feature checking.`),ee.wasm.simd=!1),typeof ee.wasm.proxy!="boolean"&&(ee.wasm.proxy=!1),typeof ee.wasm.trace!="boolean"&&(ee.wasm.trace=!1),typeof ee.wasm.numThreads!="number"||!Number.isInteger(ee.wasm.numThreads)||ee.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)ee.wasm.numThreads=1;else{let r=typeof navigator>"u"?qr("node:os").cpus().length:navigator.hardwareConcurrency;ee.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},wr=class{async init(r){js(),await Rs(),await Ns(r)}async createInferenceSessionHandler(r,s){let f=new br;return await f.loadModel(r,s),f}},xc=new wr});ze();ze();ze();var ts="1.24.0-dev.20251227-38355ba07c";var Il=en;{let a=(Ys(),Ht(Hs)).wasmBackend;Ke("webgpu",a,5),Ke("webnn",a,5),Ke("cpu",a,10),Ke("wasm",a,10)}Object.defineProperty(ee.versions,"web",{value:ts,enumerable:!0});export{ec as InferenceSession,Ya as TRACE,Ge as TRACE_EVENT_BEGIN,$e as TRACE_EVENT_END,tt as TRACE_FUNC_BEGIN,rt as TRACE_FUNC_END,xe as Tensor,Il as default,ee as env,Ke as registerBackend};
//# sourceMappingURL=ort.webgpu.bundle.min.mjs.map
