import{t as ge}from"./q-B9iggP75.js";import{C as fi,D as Ve,E as V,O as Ue,S as H,T as Te,_ as m,a as mi,b as pi,c as bt,d as Ht,f as Je,g as O,h as se,i as Gt,k as Yt,l as gi,m as ce,n as yi,o as bi,p as Xt,r as vi,s as wi,t as qt,u as Si,v as Se,w as _,x as ne,y as te}from"./q-ek54JT9S.js";import{partytownSnippet as Pi}from"@builder.io/partytown/integration";import Ke from"postgres";import{numeric as xi,pgTable as Zt,serial as er,text as lt,timestamp as tr}from"drizzle-orm/pg-core";const ut=["en","ko"],vt={en:"English",ko:"한국어"};let Xe="en",ve,rr=()=>{if(ve)return ve;if(typeof document<"u"){const e=document.documentElement.lang;e&&e in vt&&(ve=e)}return ve||(ve=Xe),ve};var $i=e=>vt[e]?e:(console.error(`unknown locale ${e}`),Xe);const Ti=e=>{rr=()=>ve=$i(e())};var Ci=(e,t=[])=>{for(let r=0;typeof e=="object";r++){let i=e[t[r]]??e["*"];typeof i=="number"&&(i=e[i]),e=i}return typeof e=="string"?e.replace(/\$([\d$])/g,(r,i)=>i==="$"?"$":String(t[Number(i)-1]??"")):""},Ni=e=>e.map((t,r)=>`${r}${t.replace(/\$/g,()=>"$$")}`).join("$").slice(1);const _i="English",Ai={"Performance Lab":"Performance Lab",Home:"Home",Store:"Store",Chat:"Chat",AI:"AI","Performance first":"Performance first","Microscopic first load, big capability":"Microscopic first load, big capability","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.","- Ultra-thin home route with immutable caching":"- Ultra-thin home route with immutable caching","- Lazy feature routes for store, chat, and AI":"- Lazy feature routes for store, chat, and AI","- Optional Partytown for third-party isolation":"- Optional Partytown for third-party isolation","Latency budget":"Latency budget","Server render: sub-50ms target with streaming enabled":"Server render: sub-50ms target with streaming enabled","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny","Speculative nav: prerender store, prefetch chat":"Speculative nav: prerender store, prefetch chat","Sample adapter (offline)":"Sample adapter (offline)","Edge cache pack (offline)":"Edge cache pack (offline)","Invalid id.":"Invalid id.","Item not found.":"Item not found.","Unable to delete item right now.":"Unable to delete item right now.","Name and positive price required.":"Name and positive price required.","Unable to create item right now.":"Unable to create item right now.","Database offline: showing fallback inventory.":"Database offline: showing fallback inventory.","Unable to load inventory right now.":"Unable to load inventory right now.","Fast browsing with tiny payloads":"Fast browsing with tiny payloads",cached:"cached","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.",Inventory:"Inventory",Refresh:"Refresh","Showing fallback data while the database is unavailable.":"Showing fallback data while the database is unavailable.","Inventory loads once this section is visible.":"Inventory loads once this section is visible.","SKU $1":"SKU $1","Delete $1":"Delete $1",Delete:"Delete","No items yet.":"No items yet.","Load more":"Load more","Loading...":"Loading...","Add an item":"Add an item",Name:"Name","Lightweight widget":"Lightweight widget",Price:"Price","Saving...":"Saving...","Create item":"Create item","Added $1.":"Added $1.",Realtime:"Realtime","WebSocket chat via Valkey pub/sub":"WebSocket chat via Valkey pub/sub",websocket:"websocket","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.",Connected:"Connected","Connect to chat":"Connect to chat","No socket opened until you opt in.":"No socket opened until you opt in.","No messages yet.":"No messages yet.","Say something quick":"Say something quick",Send:"Send","AI tools":"AI tools","Edge-friendly utilities":"Edge-friendly utilities","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.","Type a quick prompt":"Type a quick prompt","Send to API":"Send to API","Response: $1":"Response: $1","Prometheus | Ultra-fast starter":"Prometheus | Ultra-fast starter","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey performance stack starter.","Store | Prometheus":"Store | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.","Chat | Prometheus":"Chat | Prometheus","WebSocket chat backed by Valkey pub/sub.":"WebSocket chat backed by Valkey pub/sub.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Minimal AI utility route hitting Bun API."};var Li={locale:"en",name:_i,translations:Ai};const Bi="한국어",qi={"Performance Lab":"퍼포먼스 랩",Home:"홈",Store:"스토어",Chat:"채팅",AI:"AI","Performance first":"성능 우선","Microscopic first load, big capability":"초소형 첫 로드, 큰 역량","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR은 셸을 가볍게 유지합니다. 브라우저가 View Transitions와 Speculation Rules를 지원하면 탐색이 강화되고, 서드파티 스크립트는 메인 스레드를 벗어납니다.","- Ultra-thin home route with immutable caching":"- 초경량 홈 라우트와 불변 캐싱","- Lazy feature routes for store, chat, and AI":"- 스토어, 채팅, AI를 위한 지연 로드 기능 라우트","- Optional Partytown for third-party isolation":"- 서드파티 격리를 위한 Partytown 선택 옵션","Latency budget":"레이턴시 예산","Server render: sub-50ms target with streaming enabled":"서버 렌더링: 스트리밍 사용 시 50ms 미만 목표","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"크리티컬 CSS: UnoCSS + Lightning CSS로 페이로드를 최소화","Speculative nav: prerender store, prefetch chat":"추측 탐색: 스토어 프리렌더, 채팅 프리패치","Sample adapter (offline)":"샘플 어댑터(오프라인)","Edge cache pack (offline)":"엣지 캐시 팩(오프라인)","Invalid id.":"유효하지 않은 ID입니다.","Item not found.":"항목을 찾을 수 없습니다.","Unable to delete item right now.":"지금은 항목을 삭제할 수 없습니다.","Name and positive price required.":"이름과 양수 가격이 필요합니다.","Unable to create item right now.":"지금은 항목을 생성할 수 없습니다.","Database offline: showing fallback inventory.":"데이터베이스 오프라인: 대체 인벤토리를 표시합니다.","Unable to load inventory right now.":"지금은 인벤토리를 불러올 수 없습니다.","Fast browsing with tiny payloads":"초소형 페이로드로 빠른 탐색",cached:"캐시됨","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"항목은 Drizzle을 통해 Postgres에서 직접 스트리밍되며, 응답을 가볍게 유지하기 위해 커서 페이지네이션을 사용합니다. 데이터는 라우트가 보일 때만 깨어나 초기 페이로드를 극소화합니다.",Inventory:"인벤토리",Refresh:"새로고침","Showing fallback data while the database is unavailable.":"데이터베이스를 사용할 수 없어 대체 데이터를 표시합니다.","Inventory loads once this section is visible.":"이 섹션이 보일 때 인벤토리가 로드됩니다.","SKU $1":"SKU $1","Delete $1":"$1 삭제",Delete:"삭제","No items yet.":"아직 항목이 없습니다.","Load more":"더 불러오기","Loading...":"로딩 중...","Add an item":"항목 추가",Name:"이름","Lightweight widget":"경량 위젯",Price:"가격","Saving...":"저장 중...","Create item":"항목 만들기","Added $1.":"$1 추가됨.",Realtime:"실시간","WebSocket chat via Valkey pub/sub":"Valkey pub/sub 기반 WebSocket 채팅",websocket:"웹소켓","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"클라이언트는 홈 라우트를 극소화하기 위해 탐색 후에만 로드됩니다. 실시간이 필요할 때까지 bfcache 자격을 유지하도록 필요 시 연결합니다. 메시지는 API의 Valkey 채널을 통해 브로드캐스트됩니다.",Connected:"연결됨","Connect to chat":"채팅에 연결","No socket opened until you opt in.":"동의하기 전에는 소켓을 열지 않습니다.","No messages yet.":"메시지가 아직 없습니다.","Say something quick":"간단히 입력하세요",Send:"보내기","AI tools":"AI 도구","Edge-friendly utilities":"엣지 친화적 유틸리티","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"이 라우트는 상호작용을 단순하게 유지합니다. 추가 클라이언트 번들을 보내지 않고 Bun + Elysia를 테스트하는 왕복 에코 API입니다.","Type a quick prompt":"간단한 프롬프트를 입력하세요","Send to API":"API로 보내기","Response: $1":"응답: $1","Prometheus | Ultra-fast starter":"Prometheus | 초고속 스타터","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey 성능 스택 스타터.","Store | Prometheus":"스토어 | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle 기반 스토어로 Postgres에서 커서 페이지네이션과 지연 로드를 사용해 불러옵니다.","Chat | Prometheus":"채팅 | Prometheus","WebSocket chat backed by Valkey pub/sub.":"Valkey pub/sub 기반 WebSocket 채팅.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Bun API를 호출하는 최소 AI 유틸리티 라우트."};var Qi={locale:"ko",fallback:"en",name:Bi,translations:qi},Ii={en:Li,ko:Qi},ki=(e,t,r)=>{let i,s;do i=Ii[e],s=i.translations[t];while(!s&&(e=i.fallback));return s||(s=t),Ci(s,r)},ji=(e,...t)=>ki(rr(),typeof e=="string"?e:Ni(e),t),y=ji,ct=e=>{if(!e)return;const t=e.trim();if(!t)return;const r=t.replace(/_/g,"-").toLowerCase(),i=r==="kr"?"ko":r,s=ut.find(o=>o.toLowerCase()===i);if(s)return s;const n=i.split("-")[0];if(n)return ut.find(o=>o.toLowerCase()===n)},Di=e=>{if(!e)return;const t=e.split(",");for(const r of t){const i=r.split(";")[0],s=ct(i);if(s)return s}};const wt=({queryLocale:e,cookieLocale:t,acceptLanguage:r})=>ct(e)||ct(t)||Di(r)||Xe;var Oi=ge({onRequest:()=>zi},1);const zi=({query:e,cookie:t,headers:r,locale:i})=>{const s=wt({queryLocale:e.get("locale"),cookieLocale:t.get("locale")?.value,acceptLanguage:r.get("accept-language")});e.has("locale")&&(t.delete("locale"),t.set("locale",s,{})),i(s)};var Fi=new Set(["style","font"]);const Vi=(e,t,r)=>{const i=new Set;return Array.from(e??[]).filter(s=>{if(s.rel!=="preload")return!0;if(t)return!1;const n=s.href,o=s.as;return typeof n!="string"||n.trim().length===0||r&&!r.has(n)||typeof o!="string"||!Fi.has(o)||i.has(n)?!1:(i.add(n),!0)})};var Ei=[];const Ri=(e,t)=>[],Mi=new Set(Ei.flatMap(({links:e})=>e.map(t=>t.href)));var Ui=()=>{const e=bt(),t=wt({queryLocale:e.url.searchParams.get("locale"),cookieLocale:typeof document<"u"?document.cookie.split(";").map(i=>i.trim()).find(i=>i.startsWith("locale="))?.split("=")[1]:void 0,acceptLanguage:typeof navigator<"u"?navigator.languages?.join(",")||navigator.language:void 0}),r=i=>{const s=new URLSearchParams(e.url.search);s.set("locale",i);const n=s.toString();return`${e.url.pathname}${n?`?${n}`:""}`};return m("div",null,{class:"flex items-center gap-1 text-xs"},ut.map(i=>{const s=i===t;return m("a",{href:r(i),"aria-disabled":s,class:["rounded-full border px-2 py-1 transition-colors",s?"border-emerald-500/40 bg-emerald-500/10 text-emerald-200 pointer-events-none":"border-slate-700 text-slate-300 hover:text-emerald-200 hover:border-emerald-500/40"].join(" ")},null,vt[i]??i.toUpperCase(),1,i)}),1,"mU_0")};const Ji=H(_(Ui,"s_00eYrYyi6VA"));var Ki=(e,t)=>e===void 0?t:typeof e=="boolean"?e:e==="1"||e.toLowerCase()==="true",st=(e,t)=>Ki(e,t&&!0);const ke={speculationRules:st(void 0,!0),viewTransitions:st(void 0,!0),partytown:st(void 0,!0)};var nt=e=>{const t=typeof import.meta<"u"&&{BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!0}[e];if(t!==void 0)return t;if(typeof process<"u")return process.env?.[e]??process.env?.[e.replace(/^VITE_/,"")]},Y={gaId:nt("VITE_GTAG_ID"),adsClient:nt("VITE_ADSENSE_CLIENT"),supportWidgetSrc:nt("VITE_SUPPORT_WIDGET_SRC")},ir=[{id:"gtag",label:"Google Analytics 4",category:"analytics",src:Y.gaId?`https://www.googletagmanager.com/gtag/js?id=${Y.gaId}`:void 0,inline:Y.gaId?`window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', '${Y.gaId}', { transport_type: 'beacon', send_page_view: true });`:void 0,forward:["dataLayer.push","gtag"],attributes:{async:!0,"data-gtm-id":Y.gaId},budgetKb:90,load:"defer",partytown:!0,fallback:"Falls back to async tag when Partytown is disabled.",when:!!Y.gaId},{id:"adsense",label:"Google AdSense",category:"ads",src:Y.adsClient?`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${Y.adsClient}`:void 0,forward:["adsbygoogle.push"],attributes:{async:!0,"data-ad-client":Y.adsClient,crossOrigin:"anonymous"},budgetKb:95,load:"idle",partytown:!0,fallback:"Loads on idle/timeout when Partytown is off to avoid blocking hydration.",when:!!Y.adsClient},{id:"support-widget",label:"Support chat widget",category:"widget",src:Y.supportWidgetSrc,budgetKb:120,load:"interaction",partytown:!1,fallback:"Injected after user input, idle callback, or 5s timeout.",when:!!Y.supportWidgetSrc}];const Me=ir.filter(e=>e.when),Bl=Array.from(new Set(ir.flatMap(e=>e.forward??[])));var Wi=(e,t)=>`(()=>{const url='${t}';let loaded=false;const load=()=>{if(loaded||!url)return;loaded=true;const s=document.createElement('script');s.src=url;s.async=true;s.dataset.thirdParty='${e}';document.body.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>events.forEach((event)=>window.removeEventListener(event,prime,opts));const events=['pointerdown','keydown','touchstart','focusin'];const opts={once:true,passive:true};events.forEach((event)=>window.addEventListener(event,prime,opts));if('requestIdleCallback'in window){requestIdleCallback(()=>prime(),{timeout:5000});}else{setTimeout(prime,5000);}setTimeout(load,8000);})();`,Hi=()=>{const e=Me.some(r=>r.partytown),t=ke.partytown?Array.from(new Set(Me.flatMap(r=>r.forward??[]))):[];return Me.length?O(Je,{children:[ke.partytown&&e&&m("script",{dangerouslySetInnerHTML:Pi({lib:"/~partytown/",forward:t})},null,null,3,"dH_0"),Me.map(r=>{if(!r.src&&!r.inline)return null;const i=r.attributes??{};if(r.partytown&&ke.partytown)return O(Je,{children:[r.src&&Se("script",{type:"text/partytown",...i,get src(){return r.src},src:ne(r,"src")},{type:ce},0,"dH_1"),r.inline&&Se("script",{type:"text/partytown",...i,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:ne(r,"inline")},{type:ce},0,"dH_2")]},1,r.id);if(r.load==="interaction"&&r.src)return m("script",{dangerouslySetInnerHTML:Wi(r.id,r.src)},null,null,3,`${r.id}-loader`);const s=r.load==="defer"?{defer:!0}:{async:!0};return O(Je,{children:[r.src&&Se("script",{...i,...s,get src(){return r.src},src:ne(r,"src")},null,0,"dH_3"),r.inline&&Se("script",{...i,...s,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:ne(r,"inline")},null,0,"dH_4")]},1,r.id)})]},1,"dH_5"):null};const Gi=H(_(Hi,"s_mLjU5QE56DA"));var Yi=".route-transition{view-transition-name:route;contain:paint}",Xi=`:root {
  color-scheme: light dark;
}

:root[data-theme='light'],
:root.light {
  color-scheme: light;
}

:root[data-theme='dark'],
:root.dark {
  color-scheme: dark;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background-color: #020617;
  color: #e2e8f0;
  min-height: 100vh;
}
`,Zi=ge({RouterHead:()=>nr,_auto_speculationCandidates:()=>St,_auto_toSpeculationRules:()=>sr,default:()=>rs},1),St=[{url:"/store",action:"prerender"},{url:"/chat",action:"prefetch"}],sr=e=>{const t=St.filter(({url:r})=>r!==e).reduce((r,i)=>(r[i.action].push({source:"list",urls:[i.url]}),r),{prefetch:[],prerender:[]});return t.prefetch.length||t.prerender.length?t:null},es=()=>{const e=wi(),t=bt(),r=ke.speculationRules&&!0,i=r?sr(t.url.pathname):null,s=Ri(t.url.pathname,!1),n=new Set([...Mi,...s.map(c=>c.href)]),o=Vi([...e.links,...s],!1,n),l=!1,d=r&&i?`(()=>{try{if(navigator.connection?.saveData)return;if(!HTMLScriptElement.supports?.('speculationrules'))return;const payload=${JSON.stringify(i)};const script=document.createElement('script');script.type='speculationrules';script.textContent=JSON.stringify(payload);document.head.append(script);}catch{}})();`:void 0;return O(Je,{children:[m("title",null,null,e.title||"Prometheus",1,null),m("meta",null,{name:"viewport",content:"width=device-width, initial-scale=1, viewport-fit=cover"},null,3,null),m("link",null,{rel:"canonical",href:se(c=>c.url.href,[t],"p0.url.href")},null,3,null),m("style",null,{"data-critical":!0,dangerouslySetInnerHTML:Xi},null,3,null),e.meta.map(c=>Se("meta",{...c},null,0,c.key)),o.map(c=>Se("link",{...c},null,0,c.key)),r&&St.filter(({url:c})=>c!==t.url.pathname).map(({url:c,action:p})=>m("link",{rel:p,href:c},null,null,3,`${p}:${c}`)),e.styles.map(c=>Se("style",{...c.props,get dangerouslySetInnerHTML(){return c.style},dangerouslySetInnerHTML:ne(c,"style")},null,0,c.key)),d&&m("script",{dangerouslySetInnerHTML:d},null,null,3,"qG_0"),ke.viewTransitions&&m("script",null,{dangerouslySetInnerHTML:"if ('startViewTransition' in document) {document.documentElement.classList.add('supports-view-transition');}"},null,3,"qG_1"),O(Gi,null,3,"qG_2"),l]},1,"qG_4")};const nr=H(_(es,"s_0ZAFccQi4aM"));var ts=()=>(Ve(_(Yi,"s_ovuN5RMiUy0")),m("div",null,{class:"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950"},[m("header",null,{class:"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/80 backdrop-blur"},m("nav",null,{class:"mx-auto flex max-w-5xl items-center justify-between px-4 py-3 text-sm font-medium"},[m("div",null,{class:"flex items-center gap-2"},[m("span",null,{class:"rounded-full bg-emerald-500/10 px-3 py-1 text-emerald-300"},"Prometheus",3,null),m("span",null,{class:"text-slate-400"},y`Performance Lab`,1,null)],1,null),m("div",null,{class:"flex items-center gap-4 text-slate-200"},[m("a",null,{href:"/",class:"hover:text-emerald-300 transition-colors"},y`Home`,1,null),m("a",null,{href:"/store","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors"},y`Store`,1,null),m("a",null,{href:"/chat","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors"},y`Chat`,1,null),m("a",null,{href:"/ai",class:"hover:text-emerald-300 transition-colors"},y`AI`,1,null),O(Ji,null,3,"qG_5")],1,null)],1,null),1,null),m("main",null,{class:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-10 route-transition"},O(Xt,null,3,"qG_6"),1,null)],1,"qG_7")),rs=H(_(ts,"s_wqKL2Up903o")),is=".home-grid{gap:1.5rem;display:grid}@media (width>=768px){.home-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}",ss=ge({default:()=>or,head:()=>lr,onGet:()=>ar},1);const ar=({cacheControl:e})=>{e({public:!0,maxAge:900})};var ns=()=>(Ve(_(is,"s_RIE80aAOC7Q")),m("section",null,{class:"home-grid"},[m("div",null,{class:"p-6 surface"},[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Performance first`,1,null),m("h1",null,{class:"mt-2 font-semibold text-slate-50 text-3xl"},y`Microscopic first load, big capability`,1,null),m("p",null,{class:"mt-4 text-slate-300"},y`Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.`,1,null),m("div",null,{class:"gap-3 grid mt-6 text-slate-200 text-sm"},[m("div",null,{class:"flex items-center gap-2"},y`- Ultra-thin home route with immutable caching`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Lazy feature routes for store, chat, and AI`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Optional Partytown for third-party isolation`,1,null)],1,null)],1,null),m("div",null,{class:"p-6 text-slate-200 text-sm surface"},[m("h2",null,{class:"font-semibold text-slate-50 text-lg"},y`Latency budget`,1,null),m("ul",null,{class:"space-y-2 mt-3"},[m("li",null,null,y`Server render: sub-50ms target with streaming enabled`,1,null),m("li",null,null,y`Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny`,1,null),m("li",null,null,y`Speculative nav: prerender store, prefetch chat`,1,null)],1,null)],1,null)],1,"FW_0")),or=H(_(ns,"s_e7mxYERDQJw"));const lr=({withLocale:e})=>e(()=>({title:y`Prometheus | Ultra-fast starter`,meta:[{name:"description",content:y`Qwik City + Bun + Valkey performance stack starter.`}]}));var as=ge({default:()=>or,head:()=>lr,onGet:()=>ar},1),os=".ai-island{margin-top:1rem}",ls=async()=>{const[e,t]=Te();if(!e.value)return;const r=await fetch("/api/ai/echo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.value})});if(r.ok){const{echo:i}=await r.json();t.value=i}},us=()=>{const e=V(""),t=V(""),r=_(ls,"s_rGtr6P02y5w",[e,t]);return m("div",null,{class:"ai-island space-y-3 text-sm text-slate-200"},[m("textarea",null,{value:se(i=>i.value,[e],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2",placeholder:y`Type a quick prompt`,rows:4,onInput$:te("s_YrRlW66gD5Y",[e])},null,3,null),m("div",null,{class:"flex items-center gap-2"},[m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:r},y`Send to API`,1,null),t.value&&m("span",null,{class:"text-emerald-300"},y`Response: ${t.value}`,1,"9W_0")],1,null)],1,"9W_1")};const cs=H(_(us,"s_6AcQXlwaGPM"));var ds=ge({default:()=>fs,head:()=>ms},1),hs=()=>(Ve(_(os,"s_S5uQY9BGXbM")),m("section",null,{class:"surface p-6"},[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`AI tools`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`Edge-friendly utilities`,1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.`,1,null),m("div",null,{onQVisible$:te("s_08qeP0eGH6U")},O(cs,null,3,"gn_0"),1,null)],1,"gn_1")),fs=H(_(hs,"s_X8xIQqUjebE"));const ms=({withLocale:e})=>e(()=>({title:y`AI | Prometheus`,meta:[{name:"description",content:y`Minimal AI utility route hitting Bun API.`}]}));var ps=".chat-island{margin-top:1.25rem}.chat-messages{max-height:16rem}",gs=({cleanup:e})=>{const[t,r,i]=Te()},ys=()=>{const[e,t]=Te();!e.value||!t.value||(t.value.send(JSON.stringify({type:"chat",text:e.value})),e.value="")},bs=()=>{const e=V([]),t=V(null),r=V(""),i=V(!1);Ue(_(gs,"s_QOX90pOt9sA",[e,i,t]),{eagerness:"visible"});const s=_(ys,"s_0P85XrqKCfY",[r,t]);return m("div",null,{class:"chat-island"},[m("div",null,{class:"mt-4 flex items-center gap-3"},[m("button",null,{type:"button",class:"rounded-lg bg-slate-800 px-3 py-2 text-sm text-slate-100 ring-1 ring-slate-700 transition hover:bg-slate-700",disabled:se(n=>n.value,[i],"p0.value"),onClick$:te("s_DoKYoyvM41g",[i])},i.value?y`Connected`:y`Connect to chat`,1,null),!i.value&&m("span",null,{class:"text-xs text-slate-400"},y`No socket opened until you opt in.`,1,"Ki_0")],1,null),m("div",null,{class:"mt-5 space-y-3 text-sm text-slate-200"},[m("div",null,{class:"surface chat-messages overflow-auto p-4"},[e.value.length===0&&m("p",null,{class:"text-slate-500"},y`No messages yet.`,1,"Ki_1"),e.value.map(n=>m("div",null,{class:"py-1"},[m("span",null,{class:"text-slate-400"},[ne(n,"from"),":"],1,null)," ",m("span",null,null,ne(n,"text"),1,null)],1,n.id))],1,null),m("div",null,{class:"flex gap-2"},[m("input",null,{value:se(n=>n.value,[r],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100",placeholder:y`Say something quick`,onInput$:te("s_hgk47q7YSmg",[r])},null,3,null),m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:s},y`Send`,1,null)],1,null)],1,null)],1,"Ki_2")};const vs=H(_(bs,"s_54i2tFOIwmo"));var ws=ge({default:()=>Ps,head:()=>xs},1),Ss=()=>(Ve(_(ps,"s_hNgJ6QruKFA")),m("section",null,{class:"surface p-6"},[m("div",null,{class:"flex items-center justify-between gap-2"},[m("div",null,null,[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`Realtime`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`WebSocket chat via Valkey pub/sub`,1,null)],1,null),m("span",null,{class:"rounded-full bg-slate-800 px-3 py-1 text-xs text-slate-200"},y`websocket`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.`,1,null),m("div",null,{onQVisible$:te("s_ELa2ERJwGkM")},O(vs,null,3,"TX_0"),1,null)],1,"TX_1")),Ps=H(_(Ss,"s_uFxaifyy6KQ"));const xs=({withLocale:e})=>e(()=>({title:y`Chat | Prometheus`,meta:[{name:"description",content:y`WebSocket chat backed by Valkey pub/sub.`}]}));var Pt=Symbol.for("drizzle:OriginalColumn"),u=Symbol.for("drizzle:entityKind"),ql=Symbol.for("drizzle:hasOwnEntityKind");function h(e,t){if(!e||typeof e!="object")return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,u))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(e).constructor;if(r)for(;r;){if(u in r&&r[u]===t[u])return!0;r=Object.getPrototypeOf(r)}return!1}var L=class{static[u]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;length;isLengthExact;isAlias;config;table;onInit(){}constructor(e,t){this.config=t,this.onInit(),this.table=e,this.name=t.name,this.isAlias=!1,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity,this.length=t.length,this.isLengthExact=t.isLengthExact}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}[Pt](){return this}},$s=class{static[u]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}},he=Symbol.for("drizzle:Name"),Ts=class{static[u]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{const{name:r,columns:i,foreignColumns:s}=e();return{name:r,columns:i,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Cs(e,this)}},Cs=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[u]="PgForeignKey";reference;onUpdate;onDelete;name;getName(){const{name:e,columns:t,foreignColumns:r}=this.reference(),i=t.map(o=>o.name),s=r.map(o=>o.name),n=[this.table[he],...i,r[0].table[he],...s];return e??`${n.join("_")}_fk`}isNameExplicit(){return!!this.reference().name}};function Ns(e,...t){return e(...t)}function Qt(e,t,r){for(let i=t;i<e.length;i++){const s=e[i];if(s==="\\"){i++;continue}if(s==='"')return[e.slice(t,i).replace(/\\/g,""),i+1];if(!r&&(s===","||s==="}"))return[e.slice(t,i).replace(/\\/g,""),i]}return[e.slice(t).replace(/\\/g,""),e.length]}function ur(e,t=0){const r=[];let i=t,s=!1;for(;i<e.length;){const n=e[i];if(n===","){(s||i===t)&&r.push(""),s=!0,i++;continue}if(s=!1,n==="\\"){i+=2;continue}if(n==='"'){const[d,c]=Qt(e,i+1,!0);r.push(d),i=c;continue}if(n==="}")return[r,i+1];if(n==="{"){const[d,c]=ur(e,i+1);r.push(d),i=c;continue}const[o,l]=Qt(e,i,!1);r.push(o),i=l}return[r,i]}function It(e){const[t]=ur(e,1);return t}function cr(e){return`{${e.map(t=>Array.isArray(t)?cr(t):typeof t=="string"?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}var $=class extends $s{foreignKeyConfigs=[];static[u]="PgColumnBuilder";array(e){return new As(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,config:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,config:i})=>Ns((s,n)=>{const o=new Ts(()=>{const l=s();return{name:n.name,columns:[e],foreignColumns:[l]}});return n.onUpdate&&o.onUpdate(n.onUpdate),n.onDelete&&o.onDelete(n.onDelete),o.build(t)},r,i))}buildExtraConfigColumn(e){return new _s(e,this.config)}},S=class extends L{static[u]="PgColumn";table;constructor(e,t){super(e,t),this.table=e}},_s=class extends S{static[u]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Ql=class{static[u]="IndexedColumn";constructor(e,t,r,i){this.name=e,this.keyAsName=t,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},As=class extends ${static[u]="PgArrayBuilder";constructor(e,t,r){super(e,"array basecolumn","PgArray"),this.config.baseBuilder=t,this.config.length=r}build(e){const t=this.config.baseBuilder.build(e);return new dr(e,this.config,t)}},dr=class hr extends S{constructor(t,r,i,s){super(t,r),this.baseColumn=i,this.range=s}static[u]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.length=="number"?this.length:""}]`}mapFromDriverValue(t){return typeof t=="string"&&(t=It(t)),t.map(r=>this.baseColumn.mapFromDriverValue(r))}mapFromJsonValue(t){typeof t=="string"&&(t=It(t));const r=this.baseColumn;return"mapFromJsonValue"in r?t.map(i=>r.mapFromJsonValue(i)):t.map(i=>r.mapFromDriverValue(i))}mapToDriverValue(t,r=!1){const i=t.map(s=>s===null?null:h(this.baseColumn,hr)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return r?i:cr(i)}},Il=class extends ${static[u]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumObjectColumn"),this.config.enum=t}build(e){return new Ls(e,this.config)}},Ls=class extends S{static[u]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},kt=Symbol.for("drizzle:isPgEnum");function Bs(e){return!!e&&typeof e=="function"&&kt in e&&e[kt]===!0}var kl=class extends ${static[u]="PgEnumColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumColumn"),this.config.enum=t}build(e){return new qs(e,this.config)}},qs=class extends S{static[u]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},E=class{static[u]="Subquery";constructor(e,t,r,i=!1,s=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:i,usedTables:s}}},fr=class extends E{static[u]="WithSubquery"},B={startActiveSpan(e,t){return t()}},q=Symbol.for("drizzle:ViewBaseConfig"),oe=Symbol.for("drizzle:Schema"),me=Symbol.for("drizzle:Columns"),jt=Symbol.for("drizzle:ExtraConfigColumns"),je=Symbol.for("drizzle:OriginalName"),at=Symbol.for("drizzle:BaseName"),Le=Symbol.for("drizzle:IsAlias"),Dt=Symbol.for("drizzle:ExtraConfigBuilder"),Qs=Symbol.for("drizzle:IsDrizzleTable"),v=class{static[u]="Table";static Symbol={Name:he,Schema:oe,OriginalName:je,Columns:me,ExtraConfigColumns:jt,BaseName:at,IsAlias:Le,ExtraConfigBuilder:Dt};[he];[je];[oe];[me];[jt];[at];[Le]=!1;[Qs]=!0;[Dt]=void 0;constructor(e,t,r){this[he]=this[je]=e,this[oe]=t,this[at]=r}};function ae(e){return e[he]}function ze(e){return`${e[oe]??"public"}.${e[he]}`}var jl=class{static[u]="FakePrimitiveParam"};function xt(e){return e!=null&&typeof e.getSQL=="function"}function Is(e){const t={sql:"",params:[]};for(const r of e)t.sql+=r.sql,t.params.push(...r.params),r.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}var F=class{static[u]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new w([this])}},w=class Qe{constructor(t){this.queryChunks=t;for(const r of t)if(h(r,v)){const i=r[v.Symbol.Schema];this.usedTables.push(i===void 0?r[v.Symbol.Name]:i+"."+r[v.Symbol.Name])}}static[u]="SQL";decoder=$t;shouldInlineParams=!1;usedTables=[];append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return B.startActiveSpan("drizzle.buildSQL",r=>{const i=this.buildQueryFromSourceParams(this.queryChunks,t);return r?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(t,r){const i=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:s,escapeName:n,escapeParam:o,prepareTyping:l,inlineParams:d,paramStartIndex:c,invokeSource:p}=i;return Is(t.map(f=>{if(h(f,F))return{sql:f.value.join(""),params:[]};if(h(f,dt))return{sql:n(f.value),params:[]};if(f===void 0)return{sql:"",params:[]};if(Array.isArray(f)){const g=[new F("(")];for(const[b,A]of f.entries())g.push(A),b<f.length-1&&g.push(new F(", "));return g.push(new F(")")),this.buildQueryFromSourceParams(g,i)}if(h(f,Qe))return this.buildQueryFromSourceParams(f.queryChunks,{...i,inlineParams:d||f.shouldInlineParams});if(h(f,v)){const g=f[v.Symbol.Schema],b=f[v.Symbol.Name];return p==="mssql-view-with-schemabinding"?{sql:n(g===void 0?"dbo":g)+"."+n(b),params:[]}:{sql:g===void 0||f[Le]?n(b):n(g)+"."+n(b),params:[]}}if(h(f,L)){const g=s.getColumnCasing(f);if(r.invokeSource==="indexes")return{sql:n(g),params:[]};const b=p==="mssql-check"?void 0:f.table[v.Symbol.Schema];return{sql:f.isAlias?n(f.name):f.table[Le]||b===void 0?n(f.table[v.Symbol.Name])+"."+n(g):n(b)+"."+n(f.table[v.Symbol.Name])+"."+n(g),params:[]}}if(h(f,ye)){const g=f[q].schema,b=f[q].name;return{sql:g===void 0||f[q].isAlias?n(b):n(g)+"."+n(b),params:[]}}if(h(f,pe)){if(h(f.value,xe))return{sql:o(c.value++,f),params:[f],typings:["none"]};const g=f.value===null?null:f.encoder.mapToDriverValue(f.value);if(h(g,Qe))return this.buildQueryFromSourceParams([g],i);if(d)return{sql:this.mapInlineParam(g,i),params:[]};let b=["none"];return l&&(b=[l(f.encoder)]),{sql:o(c.value++,g),params:[g],typings:b}}return h(f,xe)?{sql:o(c.value++,f),params:[f],typings:["none"]}:h(f,Qe.Aliased)&&f.fieldAlias!==void 0?{sql:n(f.fieldAlias),params:[]}:h(f,E)?f._.isWith?{sql:n(f._.alias),params:[]}:this.buildQueryFromSourceParams([new F("("),f._.sql,new F(") "),new dt(f._.alias)],i):Bs(f)?f.schema?{sql:n(f.schema)+"."+n(f.enumName),params:[]}:{sql:n(f.enumName),params:[]}:xt(f)?f.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([f.getSQL()],i):this.buildQueryFromSourceParams([new F("("),f.getSQL(),new F(")")],i):d?{sql:this.mapInlineParam(f,i),params:[]}:{sql:o(c.value++,f),params:[f],typings:["none"]}}))}mapInlineParam(t,{escapeString:r}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(typeof t=="string")return r(t);if(typeof t=="object"){const i=t.toString();return r(i==="[object Object]"?JSON.stringify(t):i)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new Qe.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}},dt=class{constructor(e){this.value=e}static[u]="Name";brand;getSQL(){return new w([this])}};function ks(e){return typeof e=="object"&&e!==null&&"mapToDriverValue"in e&&typeof e.mapToDriverValue=="function"}var $t={mapFromDriverValue:e=>e},mr={mapToDriverValue:e=>e},Dl={...$t,...mr},pe=class{constructor(e,t=mr){this.value=e,this.encoder=t}static[u]="Param";brand;getSQL(){return new w([this])}};function a(e,...t){const r=[];(t.length>0||e.length>0&&e[0]!=="")&&r.push(new F(e[0]));for(const[i,s]of t.entries())r.push(s,new F(e[i+1]));return new w(r)}(e=>{function t(){return new w([])}e.empty=t;function r(d){return new w(d)}e.fromList=r;function i(d){return new w([new F(d)])}e.raw=i;function s(d,c){const p=[];for(const[f,g]of d.entries())f>0&&c!==void 0&&p.push(c),p.push(g);return new w(p)}e.join=s;function n(d){return new dt(d)}e.identifier=n;function o(d){return new xe(d)}e.placeholder=o;function l(d,c){return new pe(d,c)}e.param=l})(a||(a={}));(e=>{class t{constructor(i,s){this.sql=i,this.fieldAlias=s}static[u]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new t(this.sql,this.fieldAlias)}}e.Aliased=t})(w||(w={}));var xe=class{constructor(e){this.name=e}static[u]="Placeholder";getSQL(){return new w([this])}};function ot(e,t){return e.map(r=>{if(h(r,xe)){if(!(r.name in t))throw new Error(`No value for placeholder "${r.name}" was provided`);return t[r.name]}if(h(r,pe)&&h(r.value,xe)){if(!(r.value.name in t))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(t[r.value.name])}return r})}var js=Symbol.for("drizzle:IsDrizzleView"),ye=class{static[u]="View";[q];[js]=!0;get[he](){return this[q].name}get[oe](){return this[q].schema}get[Le](){return this[q].isAlias}get[je](){return this[q].originalName}get[me](){return this[q].selectedFields}constructor({name:e,schema:t,selectedFields:r,query:i}){this[q]={name:e,originalName:e,schema:t,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}};L.prototype.getSQL=function(){return new w([this])};E.prototype.getSQL=function(){return new w([this])};var Ge=class{constructor(e,t){this.table=e,this.ignoreColumnAlias=t}static[u]="ColumnTableAliasProxyHandler";get(e,t){return t==="table"?this.table:t==="isAlias"&&this.ignoreColumnAlias?!1:e[t]}},Tt=class{constructor(e,t,r){this.alias=e,this.replaceOriginalName=t,this.ignoreColumnAlias=r}static[u]="TableAliasProxyHandler";get(e,t){if(t===v.Symbol.IsAlias)return!0;if(t===v.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===v.Symbol.OriginalName)return this.alias;if(t===q)return{...e[q],name:this.alias,isAlias:!0};if(t===v.Symbol.Columns){const i=e[v.Symbol.Columns];if(!i)return i;const s={};return Object.keys(i).map(n=>{s[n]=new Proxy(i[n],new Ge(new Proxy(e,this),this.ignoreColumnAlias))}),s}const r=e[t];return h(r,L)?new Proxy(r,new Ge(new Proxy(e,this),this.ignoreColumnAlias)):r}},Ds=class{constructor(e){this.alias=e}static[u]="ColumnAliasProxyHandler";get(e,t){return t==="isAlias"?!0:t==="name"?this.alias:t==="keyAsName"?!1:t===Pt?()=>e:e[t]}},Ol=class{constructor(e){this.alias=e}static[u]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?ie(e.sourceTable,this.alias):e[t]}};function ie(e,t){return new Proxy(e,new Tt(t,!1,!1))}function Os(e,t){return new Proxy(e,new Ds(t))}function re(e,t){return new Proxy(e,new Ge(new Proxy(e.table,new Tt(t,!1,!1)),!1))}function pr(e,t){return new w.Aliased(Ye(e.sql,t),e.fieldAlias)}function Ye(e,t){return a.join(e.queryChunks.map(r=>h(r,L)?re(r,t):h(r,w)?Ye(r,t):h(r,w.Aliased)?pr(r,t):r))}L.prototype.as=function(e){return Os(this,e)};function Ot(e){return e[Pt]()}var De=class extends Error{static[u]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Ce=class gr extends Error{constructor(t,r,i){super(`Failed query: ${t}
params: ${r}`),this.query=t,this.params=r,this.cause=i,Error.captureStackTrace(this,gr),i&&(this.cause=i)}static[u]="DrizzleQueryError"},zs=class extends De{static[u]="TransactionRollbackError";constructor(){super({message:"Rollback"})}},Fs=class{static[u]="ConsoleLogWriter";write(e){console.log(e)}},Vs=class{static[u]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Fs}logQuery(e,t){const r=t.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},Es=class{static[u]="NoopLogger";logQuery(){}},be=class{static[u]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};function Q(e,t){return ks(t)&&!xt(e)&&!h(e,pe)&&!h(e,xe)&&!h(e,L)&&!h(e,v)&&!h(e,ye)?new pe(e,t):e}var fe=(e,t)=>a`${e} = ${Q(t,e)}`,yr=(e,t)=>a`${e} <> ${Q(t,e)}`;function W(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new w(t):new w([new F("("),a.join(t,new F(" and ")),new F(")")])}function Ze(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new w(t):new w([new F("("),a.join(t,new F(" or ")),new F(")")])}function et(e){return a`not ${e}`}var tt=(e,t)=>a`${e} > ${Q(t,e)}`,br=(e,t)=>a`${e} >= ${Q(t,e)}`,vr=(e,t)=>a`${e} < ${Q(t,e)}`,wr=(e,t)=>a`${e} <= ${Q(t,e)}`;function Sr(e,t){return Array.isArray(t)?t.length===0?a`false`:a`${e} in ${t.map(r=>Q(r,e))}`:a`${e} in ${Q(t,e)}`}function Pr(e,t){return Array.isArray(t)?t.length===0?a`true`:a`${e} not in ${t.map(r=>Q(r,e))}`:a`${e} not in ${Q(t,e)}`}function xr(e){return a`(${e} is null)`}function $r(e){return a`(${e} is not null)`}function Ct(e){return a`exists ${e}`}function Nt(e){return a`not exists ${e}`}function Tr(e,t,r){return a`${e} between ${Q(t,e)} and ${Q(r,e)}`}function Cr(e,t,r){return a`${e} not between ${Q(t,e)} and ${Q(r,e)}`}function Nr(e,t){return a`${e} like ${t}`}function _r(e,t){return a`${e} not like ${t}`}function Ar(e,t){return a`${e} ilike ${t}`}function Lr(e,t){return a`${e} not ilike ${t}`}function Rs(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContains requires at least one value");return a`${e} @> ${a`${Q(t,e)}`}`}return a`${e} @> ${Q(t,e)}`}function Ms(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContained requires at least one value");return a`${e} <@ ${a`${Q(t,e)}`}`}return a`${e} <@ ${Q(t,e)}`}function Us(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayOverlaps requires at least one value");return a`${e} && ${a`${Q(t,e)}`}`}return a`${e} && ${Q(t,e)}`}function Oe(e){return a`${e} asc`}function _t(e){return a`${e} desc`}var Br=class{constructor(e,t){this.targetTableName=t,this.targetTable=e}static[u]="RelationV2";fieldName;sourceColumns;targetColumns;alias;where;sourceTable;targetTable;through;throughTable;isReversed;sourceColumnTableNames=[];targetColumnTableNames=[]},qr=class extends Br{static[u]="OneV2";relationType="one";optional;constructor(e,t,r,i){super(t,r),this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)}),this.optional=i?.optional??!0}},Js=class extends Br{constructor(e,t,r,i){super(t,r),this.config=i,this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)})}static[u]="ManyV2";relationType="many"},Ks=class{static[u]="AggregatedField";table;onTable(e){return this.table=e,this}},Ws=class extends Ks{static[u]="AggregatedFieldCount";query;getSQL(){if(!this.query){if(!this.table)throw new Error("Table must be set before building aggregate field");this.query=a`select count(*) as ${a.identifier("r")} from ${Ae(this.table)}`.mapWith(Number)}return this.query}},_e={and:W,between:Tr,eq:fe,exists:Ct,gt:tt,gte:br,ilike:Ar,inArray:Sr,arrayContains:Rs,arrayContained:Ms,arrayOverlaps:Us,isNull:xr,isNotNull:$r,like:Nr,lt:vr,lte:wr,ne:yr,not:et,notBetween:Cr,notExists:Nt,notLike:_r,notIlike:Lr,notInArray:Pr,or:Ze,sql:a},Hs={sql:a,asc:Oe,desc:_t};function ht(e,t,r=o=>o,i=!1,s=!1,n){for(const o of t){if(o.selection){const p=`${n?`${n}.`:""}${o.key}`;if(e[o.key]===null||i&&(e[o.key]=JSON.parse(e[o.key]),e[o.key]===null))continue;if(s&&typeof e[o.key]=="string"&&(e[o.key]=JSON.parse(e[o.key])),o.isArray){for(const f of e[o.key])ht(f,o.selection,r,!1,s,p);continue}ht(e[o.key],o.selection,r,!1,s,p);continue}const l=o.field,d=r(e[o.key]);if(d===null)continue;let c;h(l,L)?c=l:h(l,w)?c=l.decoder:h(l,w.Aliased)?c=l.sql.decoder:h(l,v)||h(l,ye)?c=$t:c=l.getSQL().decoder,e[o.key]="mapFromJsonValue"in c?c.mapFromJsonValue(d):c.mapFromDriverValue(d)}return e}var zl=class{static[u]="RelationsBuilderTable";_;constructor(e,t){this._={name:t,table:e}}},Fl=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r){this._={tableName:t,column:e,key:r}}through(e){return new Gs(this._.column,this._.tableName,this._.key,e)}},Gs=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r,i){this._={tableName:t,column:e,through:i,key:r}}},Vl=class{static[u]="RelationsHelperStatic";_;constructor(e){this._={tables:e};const t={},r={};for(const[i,s]of Object.entries(e))t[i]=n=>new qr(e,s,i,n),r[i]=n=>new Js(e,s,i,n);this.one=t,this.many=r}one;many;aggs={count(){return new Ws}}};function Qr(e,t){const r=e[me][t];return r?h(r,L)?r:h(r,w.Aliased)?a`${e}.${a.identifier(r.fieldAlias)}`:a`${e}.${a.identifier(t)}`:a`${e}.${a.identifier(t)}`}function We(e,t){if(typeof t!="object"||h(t,xe))return fe(e,t);const r=Object.entries(t);if(!r.length)return;const i=[];for(const[s,n]of r)if(n!==void 0)switch(s){case"NOT":{const o=We(e,n);if(!o)continue;i.push(et(o));continue}case"OR":if(!n.length)continue;i.push(Ze(...n.map(o=>We(e,o))));continue;case"AND":if(!n.length)continue;i.push(W(...n.map(o=>We(e,o))));continue;case"isNotNull":case"isNull":if(!n)continue;i.push(_e[s](e));continue;case"in":i.push(_e.inArray(e,n));continue;case"notIn":i.push(_e.notInArray(e,n));continue;default:i.push(_e[s](e,n));continue}if(i.length)return W(...i)}function de(e,t,r={},i={},s,n=0){const o=Object.entries(t);if(!o.length)return;const l=[];for(const[d,c]of o)if(c!==void 0)switch(d){case"RAW":{const p=typeof c=="function"?c(e,_e):c.getSQL();l.push(p);continue}case"OR":if(!c?.length)continue;l.push(Ze(...c.map(p=>de(e,p,r,i,s,n))));continue;case"AND":if(!c?.length)continue;l.push(W(...c.map(p=>de(e,p,r,i,s,n))));continue;case"NOT":{if(c===void 0)continue;const p=de(e,c,r,i,s,n);if(!p)continue;l.push(et(p));continue}default:{if(e[me][d]){const N=We(Qr(e,d),c);N&&l.push(N);continue}const p=r[d];if(!p)throw new De({message:`Unknown relational filter field: "${d}"`});const f=ie(p.targetTable,`f${n}`),g=p.throughTable?ie(p.throughTable,`ft${n}`):void 0,b=i[p.targetTableName],{filter:A,joinCondition:x}=Ir(s,p,e,f,g),C=W(A,typeof c=="boolean"?void 0:de(f,c,b.relations,i,s,n+1)),k=g?a`(select * from ${Ae(f)} inner join ${Ae(g)} on ${x}${a` where ${C}`.if(C)} limit 1)`:a`(select * from ${Ae(f)}${a` where ${C}`.if(C)} limit 1)`;C&&l.push((c?Ct:Nt)(k))}}return W(...l)}function Ys(e,t){if(typeof t=="function"){const i=t(e,Hs);return h(i,w)?i:Array.isArray(i)?i.length?a.join(i.map(s=>h(s,w)?s:Oe(s)),a`, `):void 0:h(i,L)?Oe(i):void 0}const r=Object.entries(t).filter(([i,s])=>s);if(r.length)return a.join(r.map(([i,s])=>(s==="asc"?Oe:_t)(Qr(e,i))),a`, `)}function Xs(e,t){const r=[],i=[];for(const[s,n]of Object.entries(t)){if(!n)continue;const o=typeof n=="function"?n(e,{sql:_e.sql}):n,l=a`(${o.getSQL()}) as ${a.identifier(s)}`;l.decoder=o.getSQL().decoder,r.push(l),i.push({key:s,field:l})}return{sql:r.length?a.join(r,a`, `):void 0,selection:i}}function Ir(e,t,r,i,s){if(t.through){const n=t.sourceColumns.map((l,d)=>{const c=t.through.source[d];return fe(a`${r}.${a.identifier(e.getColumnCasing(l))}`,a`${s}.${a.identifier(h(c._.column,L)?e.getColumnCasing(c._.column):c._.key)}`)}),o=t.targetColumns.map((l,d)=>{const c=t.through.target[d];return fe(a`${s}.${a.identifier(h(c._.column,L)?e.getColumnCasing(c._.column):c._.key)}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)});return{filter:W(t.where?de(t.isReversed?r:i,t.where):void 0,...n),joinCondition:W(...o)}}return{filter:W(...t.sourceColumns.map((n,o)=>{const l=t.targetColumns[o];return fe(a`${r}.${a.identifier(e.getColumnCasing(n))}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)}),t.where?de(t.isReversed?r:i,t.where):void 0)}}function Ae(e){return a`${e[Le]?a`${a`${a.identifier(e[oe]??"")}.`.if(e[oe])}${a.identifier(e[je])} as ${e}`:e}`}function Zs(e,t,r){const i={},s=e.reduce((n,{path:o,field:l},d)=>{let c;h(l,L)?c=l:h(l,w)?c=l.decoder:h(l,E)?c=l._.sql.decoder:c=l.sql.decoder;let p=n;for(const[f,g]of o.entries())if(f<o.length-1)g in p||(p[g]={}),p=p[g];else{const b=t[d],A=p[g]=b===null?null:c.mapFromDriverValue(b);if(r&&h(l,L)&&o.length===2){const x=o[0];x in i?typeof i[x]=="string"&&i[x]!==ae(l.table)&&(i[x]=!1):i[x]=A===null?ae(l.table):!1}}return n},{});if(r&&Object.keys(i).length>0)for(const[n,o]of Object.entries(i))typeof o=="string"&&!r[o]&&(s[n]=null);return s}function $e(e,t){return Object.entries(e).reduce((r,[i,s])=>{if(typeof i!="string")return r;const n=t?[...t,i]:[i];return h(s,L)||h(s,w)||h(s,w.Aliased)||h(s,E)?r.push({path:n,field:s}):h(s,v)?r.push(...$e(s[v.Symbol.Columns],n)):r.push(...$e(s,n)),r},[])}function At(e,t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const[s,n]of r.entries())if(n!==i[s])return!1;return!0}function kr(e,t){const r=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,s])=>h(s,w)||h(s,L)?[i,s]:[i,new pe(s,e[v.Symbol.Columns][i])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function en(e,t){for(const r of t)for(const i of Object.getOwnPropertyNames(r.prototype))i!=="constructor"&&Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(r.prototype,i)||Object.create(null))}function tn(e){return e[v.Symbol.Columns]}function we(e){return h(e,E)?e._.alias:h(e,ye)?e[q].name:h(e,w)?void 0:e[v.Symbol.IsAlias]?e[v.Symbol.Name]:e[v.Symbol.BaseName]}function z(e,t){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:t}}var El=typeof TextDecoder>"u"?null:new TextDecoder,Ee=class extends ${static[u]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}},rn=class extends Ee{static[u]="PgBigInt53Builder";constructor(e){super(e,"number int53","PgBigInt53")}build(e){return new sn(e,this.config)}},sn=class extends S{static[u]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},nn=class extends Ee{static[u]="PgBigInt64Builder";constructor(e){super(e,"bigint int64","PgBigInt64")}build(e){return new an(e,this.config)}},an=class extends S{static[u]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}},on=class extends Ee{static[u]="PgBigIntStringBuilder";constructor(e){super(e,"string int64","PgBigIntString")}build(e){return new ln(e,this.config)}},ln=class extends S{static[u]="PgBigIntString";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}};function un(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new rn(r):i.mode==="string"?new on(r):new nn(r)}var cn=class extends ${static[u]="PgBigSerial53Builder";constructor(e){super(e,"number int53","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new dn(e,this.config)}},dn=class extends S{static[u]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},hn=class extends ${static[u]="PgBigSerial64Builder";constructor(e){super(e,"bigint int64","PgBigSerial64"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new fn(e,this.config)}},fn=class extends S{static[u]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function mn(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new cn(r):new hn(r)}var pn=class extends ${static[u]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new gn(e,this.config)}},gn=class extends S{static[u]="PgBoolean";getSQLType(){return"boolean"}};function yn(e){return new pn(e??"")}var bn=class extends ${static[u]="PgCharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgChar"),this.config.length=t.length??1,this.config.setLength=t.length!==void 0,this.config.enumValues=t.enum}build(e){return new vn(e,this.config)}},vn=class extends S{static[u]="PgChar";enumValues=this.config.enumValues;getSQLType(){return this.config.setLength?`char(${this.length})`:"char"}};function wn(e,t={}){const{name:r,config:i}=z(e,t);return new bn(r,i)}var Sn=class extends ${static[u]="PgCidrBuilder";constructor(e){super(e,"string cidr","PgCidr")}build(e){return new Pn(e,this.config)}},Pn=class extends S{static[u]="PgCidr";getSQLType(){return"cidr"}};function xn(e){return new Sn(e??"")}var $n=class extends ${static[u]="PgCustomColumnBuilder";constructor(e,t,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=r}build(e){return new Tn(e,this.config)}},Tn=class extends S{static[u]="PgCustomColumn";sqlName;mapTo;mapFrom;mapJson;forJsonSelect;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver,this.mapJson=t.customTypeParams.fromJson,this.forJsonSelect=t.customTypeParams.forJsonSelect}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapFromJsonValue(e){return typeof this.mapJson=="function"?this.mapJson(e):this.mapFromDriverValue(e)}jsonSelectIdentifier(e,t,r){if(typeof this.forJsonSelect=="function")return this.forJsonSelect(e,t,r);const i=this.getSQLType().toLowerCase(),s=i.indexOf("(");switch(s+1?i.slice(0,s):i){case"bytea":case"geometry":case"timestamp":case"numeric":case"bigint":{const n="[]".repeat(r??0);return t`${e}::text${t.raw(n).if(r)}`}default:return e}}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Cn(e){return(t,r)=>{const{name:i,config:s}=z(t,r);return new $n(i,s,e)}}var Re=class extends ${static[u]="PgDateColumnBaseBuilder";defaultNow(){return this.default(a`now()`)}},Nn=class extends Re{static[u]="PgDateBuilder";constructor(e){super(e,"object date","PgDate")}build(e){return new jr(e,this.config)}},jr=class extends S{static[u]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?new Date(e):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},_n=class extends Re{static[u]="PgDateStringBuilder";constructor(e){super(e,"string date","PgDateString")}build(e){return new Dr(e,this.config)}},Dr=class extends S{static[u]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?e:e.toISOString().slice(0,-14)}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function An(e,t){const{name:r,config:i}=z(e,t);return i?.mode==="date"?new Nn(r):new _n(r)}var Ln=class extends ${static[u]="PgDoublePrecisionBuilder";constructor(e){super(e,"number double","PgDoublePrecision")}build(e){return new Bn(e,this.config)}},Bn=class extends S{static[u]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function qn(e){return new Ln(e??"")}var Qn=class extends ${static[u]="PgInetBuilder";constructor(e){super(e,"string inet","PgInet")}build(e){return new In(e,this.config)}},In=class extends S{static[u]="PgInet";getSQLType(){return"inet"}};function kn(e){return new Qn(e??"")}var jn=class extends Ee{static[u]="PgIntegerBuilder";constructor(e){super(e,"number int32","PgInteger")}build(e){return new Dn(e,this.config)}},Dn=class extends S{static[u]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function On(e){return new jn(e??"")}var zn=class extends ${static[u]="PgIntervalBuilder";constructor(e,t){super(e,"string interval","PgInterval"),this.config.intervalConfig=t}build(e){return new Fn(e,this.config)}},Fn=class extends S{static[u]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){return`interval${this.fields?` ${this.fields}`:""}${this.precision?`(${this.precision})`:""}`}};function Vn(e,t={}){const{name:r,config:i}=z(e,t);return new zn(r,i)}var En=class extends ${static[u]="PgJsonBuilder";constructor(e){super(e,"object json","PgJson")}build(e){return new Or(e,this.config)}},Or=class extends S{static[u]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Rn(e){return new En(e??"")}var Mn=class extends ${static[u]="PgJsonbBuilder";constructor(e){super(e,"object json","PgJsonb")}build(e){return new zr(e,this.config)}},zr=class extends S{static[u]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Un(e){return new Mn(e??"")}var Jn=class extends ${static[u]="PgLineBuilder";constructor(e){super(e,"array line","PgLine")}build(e){return new Kn(e,this.config)}},Kn=class extends S{static[u]="PgLine";mode="tuple";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Wn=class extends ${static[u]="PgLineABCBuilder";constructor(e){super(e,"object line","PgLineABC")}build(e){return new Hn(e,this.config)}},Hn=class extends S{static[u]="PgLineABC";mode="abc";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Gn(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new Jn(r):new Wn(r)}var Yn=class extends ${static[u]="PgMacaddrBuilder";constructor(e){super(e,"string macaddr","PgMacaddr")}build(e){return new Xn(e,this.config)}},Xn=class extends S{static[u]="PgMacaddr";getSQLType(){return"macaddr"}};function Zn(e){return new Yn(e??"")}var ea=class extends ${static[u]="PgMacaddr8Builder";constructor(e){super(e,"string macaddr8","PgMacaddr8")}build(e){return new ta(e,this.config)}},ta=class extends S{static[u]="PgMacaddr8";getSQLType(){return"macaddr8"}};function ra(e){return new ea(e??"")}var ia=class extends ${static[u]="PgNumericBuilder";constructor(e,t,r){super(e,"string numeric","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new Fr(e,this.config)}},Fr=class extends S{static[u]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},sa=class extends ${static[u]="PgNumericNumberBuilder";constructor(e,t,r){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=r}build(e){return new na(e,this.config)}},na=class extends S{static[u]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},aa=class extends ${static[u]="PgNumericBigIntBuilder";constructor(e,t,r){super(e,"bigint int64","PgNumericBigInt"),this.config.precision=t,this.config.scale=r}build(e){return new oa(e,this.config)}},oa=class extends S{static[u]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function la(e,t){const{name:r,config:i}=z(e,t),s=i?.mode;return s==="number"?new sa(r,i?.precision,i?.scale):s==="bigint"?new aa(r,i?.precision,i?.scale):new ia(r,i?.precision,i?.scale)}var ua=class extends ${static[u]="PgPointTupleBuilder";constructor(e){super(e,"array point","PgPointTuple")}build(e){return new ca(e,this.config)}},ca=class extends S{static[u]="PgPointTuple";mode="tuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},da=class extends ${static[u]="PgPointObjectBuilder";constructor(e){super(e,"object point","PgPointObject")}build(e){return new ha(e,this.config)}},ha=class extends S{static[u]="PgPointObject";mode="xy";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function fa(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new ua(r):new da(r)}function ma(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(Number.parseInt(e.slice(r,r+2),16));return new Uint8Array(t)}function zt(e,t){const r=new ArrayBuffer(8),i=new DataView(r);for(let s=0;s<8;s++)i.setUint8(s,e[t+s]);return i.getFloat64(0,!0)}function Vr(e){const t=ma(e);let r=0;const i=t[r];r+=1;const s=new DataView(t.buffer),n=s.getUint32(r,i===1);r+=4;let o;if(n&536870912&&(o=s.getUint32(r,i===1),r+=4),(n&65535)===1){const l=zt(t,r);r+=8;const d=zt(t,r);return r+=8,{srid:o,point:[l,d]}}throw new Error("Unsupported geometry type")}var pa=class extends ${static[u]="PgGeometryBuilder";constructor(e,t){super(e,"array geometry","PgGeometry"),this.config.srid=t}build(e){return new ga(e,this.config)}},ga=class extends S{static[u]="PgGeometry";srid=this.config.srid;mode="tuple";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){return typeof e!="string"?e:Vr(e).point}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},ya=class extends ${static[u]="PgGeometryObjectBuilder";constructor(e,t){super(e,"object geometry","PgGeometryObject"),this.config.srid=t}build(e){return new ba(e,this.config)}},ba=class extends S{static[u]="PgGeometryObject";srid=this.config.srid;mode="object";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){const t=Vr(e);return{x:t.point[0],y:t.point[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function va(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new pa(r,i?.srid):new ya(r,i?.srid)}var wa=class extends ${static[u]="PgRealBuilder";constructor(e,t){super(e,"number float","PgReal"),this.config.length=t}build(e){return new Sa(e,this.config)}},Sa=class extends S{static[u]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function Pa(e){return new wa(e??"")}var xa=class extends ${static[u]="PgSerialBuilder";constructor(e){super(e,"number int32","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new $a(e,this.config)}},$a=class extends S{static[u]="PgSerial";getSQLType(){return"serial"}};function Ta(e){return new xa(e??"")}var Ca=class extends Ee{static[u]="PgSmallIntBuilder";constructor(e){super(e,"number int16","PgSmallInt")}build(e){return new Na(e,this.config)}},Na=class extends S{static[u]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function _a(e){return new Ca(e??"")}var Aa=class extends ${static[u]="PgSmallSerialBuilder";constructor(e){super(e,"number int16","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new La(e,this.config)}},La=class extends S{static[u]="PgSmallSerial";getSQLType(){return"smallserial"}};function Ba(e){return new Aa(e??"")}var qa=class extends ${static[u]="PgTextBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgText"),this.config.enumValues=t.enum}build(e){return new Qa(e,this.config,this.config.enumValues)}},Qa=class extends S{static[u]="PgText";enumValues;constructor(e,t,r){super(e,t),this.enumValues=r}getSQLType(){return"text"}};function Ia(e,t={}){const{name:r,config:i}=z(e,t);return new qa(r,i)}var ka=class extends Re{constructor(e,t,r){super(e,"string time","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}static[u]="PgTimeBuilder";build(e){return new Er(e,this.config)}},Er=class extends S{static[u]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function ja(e,t={}){const{name:r,config:i}=z(e,t);return new ka(r,i.withTimezone??!1,i.precision)}var Da=class extends Re{static[u]="PgTimestampBuilder";constructor(e,t,r){super(e,"object date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Rr(e,this.config)}},Rr=class extends S{static[u]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){return typeof e=="string"?new Date(this.withTimezone?e:e+"+0000"):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},Oa=class extends Re{static[u]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string timestamp","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Mr(e,this.config)}},Mr=class extends S{static[u]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){if(typeof e=="string")return e;const t=e.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){const r=e.getTimezoneOffset();return`${t}${r<=0?"+":"-"}${Math.floor(Math.abs(r)/60).toString().padStart(2,"0")}`}return t}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function za(e,t={}){const{name:r,config:i}=z(e,t);return i?.mode==="string"?new Oa(r,i.withTimezone??!1,i.precision):new Da(r,i?.withTimezone??!1,i?.precision)}var Fa=class extends ${static[u]="PgUUIDBuilder";constructor(e){super(e,"string uuid","PgUUID")}defaultRandom(){return this.default(a`gen_random_uuid()`)}build(e){return new Ur(e,this.config)}},Ur=class extends S{static[u]="PgUUID";getSQLType(){return"uuid"}};function Va(e){return new Fa(e??"")}var Ea=class extends ${static[u]="PgVarcharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Ra(e,this.config)}},Ra=class extends S{static[u]="PgVarchar";enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function Ma(e,t={}){const{name:r,config:i}=z(e,t);return new Ea(r,i)}var Ua=class extends ${static[u]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string binary","PgBinaryVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new Ja(e,this.config)}},Ja=class extends S{static[u]="PgBinaryVector";getSQLType(){return`bit(${this.length})`}};function Ka(e,t){const{name:r,config:i}=z(e,t);return new Ua(r,i)}var Wa=class extends ${static[u]="PgHalfVectorBuilder";constructor(e,t){super(e,"array halfvector","PgHalfVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new Ha(e,this.config)}},Ha=class extends S{static[u]="PgHalfVector";getSQLType(){return`halfvec(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function Ga(e,t){const{name:r,config:i}=z(e,t);return new Wa(r,i)}var Ya=class extends ${static[u]="PgSparseVectorBuilder";constructor(e,t){super(e,"string sparsevec","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new Xa(e,this.config)}},Xa=class extends S{static[u]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function Za(e,t){const{name:r,config:i}=z(e,t);return new Ya(r,i)}var eo=class extends ${static[u]="PgVectorBuilder";constructor(e,t){super(e,"array vector","PgVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new to(e,this.config)}},to=class extends S{static[u]="PgVector";getSQLType(){return`vector(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function ro(e,t){const{name:r,config:i}=z(e,t);return new eo(r,i)}function io(){return{bigint:un,bigserial:mn,boolean:yn,char:wn,cidr:xn,customType:Cn,date:An,doublePrecision:qn,inet:kn,integer:On,interval:Vn,json:Rn,jsonb:Un,line:Gn,macaddr:Zn,macaddr8:ra,numeric:la,point:fa,geometry:va,real:Pa,serial:Ta,smallint:_a,smallserial:Ba,text:Ia,time:ja,timestamp:za,uuid:Va,varchar:Ma,bit:Ka,halfvec:Ga,sparsevec:Za,vector:ro}}var ft=Symbol.for("drizzle:PgInlineForeignKeys"),mt=Symbol.for("drizzle:EnableRLS"),M=class extends v{static[u]="PgTable";static Symbol=Object.assign({},v.Symbol,{InlineForeignKeys:ft,EnableRLS:mt});[ft]=[];[mt]=!1;[v.Symbol.ExtraConfigBuilder]=void 0;[v.Symbol.ExtraConfigColumns]={}};function Jr(e,t,r,i,s=e){const n=new M(e,i,s),o=typeof t=="function"?t(io()):t,l=Object.fromEntries(Object.entries(o).map(([p,f])=>{const g=f;g.setName(p);const b=g.build(n);return n[ft].push(...g.buildForeignKeys(b,n)),[p,b]})),d=Object.fromEntries(Object.entries(o).map(([p,f])=>{const g=f;return g.setName(p),[p,g.buildExtraConfigColumn(n)]})),c=Object.assign(n,l);return c[v.Symbol.Columns]=l,c[v.Symbol.ExtraConfigColumns]=d,r&&(c[M.Symbol.ExtraConfigBuilder]=r),Object.assign(c,{enableRLS:()=>(c[M.Symbol.EnableRLS]=!0,c)})}var so=(e,t,r)=>Jr(e,t,r,void 0),no=(e,t,r)=>{const i=Jr(e,t,r,void 0);return i[mt]=!0,i},Rl=Object.assign(so,{withRLS:no}),ao=class{static[u]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new oo(e,this.columns,this.name)}},oo=class{constructor(e,t,r){this.table=e,this.columns=t,this.name=r,this.isNameExplicit=!!r}static[u]="PgPrimaryKey";columns;name;isNameExplicit;getName(){return this.name??`${this.table[M.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}},Kr=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[v.Symbol.Name]}static[u]="Relation";referencedTableName;fieldName},lo=class{constructor(e,t){this.table=e,this.config=t}static[u]="Relations"},Fe=class Wr extends Kr{constructor(t,r,i,s){super(t,r,i?.relationName),this.config=i,this.isNullable=s}static[u]="One";withFieldName(t){const r=new Wr(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=t,r}},Hr=class Gr extends Kr{constructor(t,r,i){super(t,r,i?.relationName),this.config=i}static[u]="Many";withFieldName(t){const r=new Gr(this.sourceTable,this.referencedTable,this.config);return r.fieldName=t,r}};function uo(){return{and:W,between:Tr,eq:fe,exists:Ct,gt:tt,gte:br,ilike:Ar,inArray:Sr,isNull:xr,isNotNull:$r,like:Nr,lt:vr,lte:wr,ne:yr,not:et,notBetween:Cr,notExists:Nt,notLike:_r,notIlike:Lr,notInArray:Pr,or:Ze,sql:a}}function co(){return{sql:a,asc:Oe,desc:_t}}function ho(e,t){Object.keys(e).length===1&&"default"in e&&!h(e.default,v)&&(e=e.default);const r={},i={},s={};for(const[n,o]of Object.entries(e))if(h(o,v)){const l=ze(o),d=i[l];r[l]=n,s[n]={tsName:n,dbName:o[v.Symbol.Name],schema:o[v.Symbol.Schema],columns:o[v.Symbol.Columns],relations:d?.relations??{},primaryKey:d?.primaryKey??[]};for(const p of Object.values(o[v.Symbol.Columns]))p.primary&&s[n].primaryKey.push(p);const c=o[v.Symbol.ExtraConfigBuilder]?.(o[v.Symbol.ExtraConfigColumns]);if(c)for(const p of Object.values(c))h(p,ao)&&s[n].primaryKey.push(...p.columns)}else if(h(o,lo)){const l=ze(o.table),d=r[l],c=o.config(t(o.table));for(const[p,f]of Object.entries(c))if(d){const g=s[d];g.relations[p]=f}else l in i||(i[l]={relations:{}}),i[l].relations[p]=f}return{tables:s,tableNamesMap:r}}function fo(e){return function(r,i){return new Fe(e,r,i,i?.fields.reduce((s,n)=>s&&n.notNull,!0)??!1)}}function mo(e){return function(r,i){return new Hr(e,r,i)}}function po(e,t,r){if(h(r,Fe)&&r.config)return{fields:r.config.fields,references:r.config.references};const i=t[ze(r.referencedTable)];if(!i)throw new Error(`Table "${r.referencedTable[v.Symbol.Name]}" not found in schema`);const s=e[i];if(!s)throw new Error(`Table "${i}" not found in schema`);const n=r.sourceTable,o=t[ze(n)];if(!o)throw new Error(`Table "${n[v.Symbol.Name]}" not found in schema`);const l=[];for(const d of Object.values(s.relations))(r.relationName&&r!==d&&d.relationName===r.relationName||!r.relationName&&d.referencedTable===r.sourceTable)&&l.push(d);if(l.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${i}"`):new Error(`There are multiple relations between "${i}" and "${r.sourceTable[v.Symbol.Name]}". Please specify relation name`);if(l[0]&&h(l[0],Fe)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${r.fieldName}"`)}function go(e){return{one:fo(e),many:mo(e)}}function pt(e,t,r,i,s=n=>n){const n={};for(const[o,l]of i.entries())if(l.isJson){const d=t.relations[l.tsKey],c=r[o],p=typeof c=="string"?JSON.parse(c):c;n[l.tsKey]=h(d,Fe)?p&&pt(e,e[l.relationTableTsKey],p,l.selection,s):p.map(f=>pt(e,e[l.relationTableTsKey],f,l.selection,s))}else{const d=s(r[o]),c=l.field;let p;h(c,L)?p=c:h(c,w)?p=c.decoder:p=c.sql.decoder,n[l.tsKey]=d===null?null:p.mapFromDriverValue(d)}return n}var U=class Yr{static[u]="SelectionProxyHandler";config;constructor(t){this.config={...t}}get(t,r){if(r==="_")return{...t._,selectedFields:new Proxy(t._.selectedFields,this)};if(r===q)return{...t[q],selectedFields:new Proxy(t[q].selectedFields,this)};if(typeof r=="symbol")return t[r];const i=(h(t,E)?t._.selectedFields:h(t,ye)?t[q].selectedFields:t)[r];if(h(i,w.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;const s=i.clone();return s.isSelectionField=!0,s}if(h(i,w)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return h(i,L)?this.config.alias?new Proxy(i,new Ge(new Proxy(i.table,new Tt(this.config.alias,this.config.replaceOriginalName??!1,!0)),!0)):i:typeof i!="object"||i===null?i:new Proxy(i,new Yr(this.config))}};function Pe(e){return h(e,M)?[e[oe]?`${e[oe]}.${e[v.Symbol.BaseName]}`:e[v.Symbol.BaseName]]:h(e,E)?e._.usedTables??[]:h(e,w)?e.usedTables??[]:[]}var Ft=class extends be{constructor(e,t,r,i){super(),this.session=t,this.dialect=r,this.config={table:e,withList:i}}static[u]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[v.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=$e(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:Pe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function yo(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function bo(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,r,i)=>t+(i===0?r.toLowerCase():`${r[0].toUpperCase()}${r.slice(1)}`),"")}function vo(e){return e}var wo=class{static[u]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?yo:e==="camelCase"?bo:vo}getColumnCasing(e){if(!e.keyAsName)return e.name;const t=`${e.table[v.Symbol.Schema]??"public"}.${e.table[v.Symbol.OriginalName]}.${e.name}`;return this.cache[t]||this.cacheTable(e.table),this.cache[t]}cacheTable(e){const t=`${e[v.Symbol.Schema]??"public"}.${e[v.Symbol.OriginalName]}`;if(!this.cachedTables[t]){for(const r of Object.values(e[v.Symbol.Columns])){if(!h(r,L))continue;const i=`${t}.${r.name}`;this.cache[i]=this.convert(r.name)}this.cachedTables[t]=!0}}clearCache(){this.cache={},this.cachedTables={}}},Xr=class extends ye{static[u]="PgViewBase"},He=class{static[u]="PgDialect";casing;constructor(e){this.casing=new wo(e?.casing)}async migrate(e,t,r){const i=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",s=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",n=a`
			CREATE TABLE IF NOT EXISTS ${a.identifier(s)}.${a.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(a`CREATE SCHEMA IF NOT EXISTS ${a.identifier(s)}`),await t.execute(n);const o=await t.all(a`select id, hash, created_at from ${a.identifier(s)}.${a.identifier(i)} order by created_at desc limit 1`);if(typeof r=="object"&&r.init){if(o.length)return{exitCode:"databaseMigrations"};if(e.length>1)return{exitCode:"localMigrations"};const[d]=e;if(!d)return;await t.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${d.hash}, ${d.folderMillis})`);return}const l=o[0];await t.transaction(async d=>{for await(const c of e)if(!l||Number(l.created_at)<c.folderMillis){for(const p of c.sql)await d.execute(a.raw(p));await d.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;const t=[a`with `];for(const[r,i]of e.entries())t.push(a`${a.identifier(i._.alias)} as (${i._.sql})`),r<e.length-1&&t.push(a`, `);return t.push(a` `),a.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:i}){const s=this.buildWithCTE(i),n=r?a` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0;return a`${s}delete from ${e}${t?a` where ${t}`:void 0}${n}`}buildUpdateSet(e,t){const r=e[v.Symbol.Columns],i=Object.keys(r).filter(n=>t[n]!==void 0||r[n]?.onUpdateFn!==void 0),s=i.length;return a.join(i.flatMap((n,o)=>{const l=r[n],d=l.onUpdateFn?.(),c=t[n]??(h(d,w)?d:a.param(d,l)),p=a`${a.identifier(this.casing.getColumnCasing(l))} = ${c}`;return o<s-1?[p,a.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:t,where:r,returning:i,withList:s,from:n,joins:o}){const l=this.buildWithCTE(s),d=e[M.Symbol.Name],c=e[M.Symbol.Schema],p=e[M.Symbol.OriginalName],f=d===p?void 0:d,g=a`${c?a`${a.identifier(c)}.`:void 0}${a.identifier(p)}${f&&a` ${a.identifier(f)}`}`,b=this.buildUpdateSet(e,t),A=n&&a.join([a.raw(" from "),this.buildFromTable(n)]),x=this.buildJoins(o),C=i?a` returning ${this.buildSelection(i,{isSingleTable:!n})}`:void 0;return a`${l}update ${g} set ${b}${A}${x}${r?a` where ${r}`:void 0}${C}`}buildSelection(e,{isSingleTable:t=!1}={}){const r=e.length,i=e.flatMap(({field:s},n)=>{const o=[];if(h(s,w.Aliased)&&s.isSelectionField)o.push(a.identifier(s.fieldAlias));else if(h(s,w.Aliased)||h(s,w)){const l=h(s,w.Aliased)?s.sql:s;t?o.push(new w(l.queryChunks.map(d=>h(d,S)?a.identifier(this.casing.getColumnCasing(d)):d))):o.push(l),h(s,w.Aliased)&&o.push(a` as ${a.identifier(s.fieldAlias)}`)}else if(h(s,L))t?o.push(s.isAlias?a`${a.identifier(this.casing.getColumnCasing(Ot(s)))} as ${s}`:a.identifier(this.casing.getColumnCasing(s))):o.push(s.isAlias?a`${Ot(s)} as ${s}`:s);else if(h(s,E)){const l=Object.entries(s._.selectedFields);if(l.length===1){const d=l[0][1],c=h(d,w)?d.decoder:h(d,L)?{mapFromDriverValue:p=>d.mapFromDriverValue(p)}:d.sql.decoder;c&&(s._.sql.decoder=c)}o.push(s)}return n<r-1&&o.push(a`, `),o});return a.join(i)}buildJoins(e){if(!e||e.length===0)return;const t=[];for(const[r,i]of e.entries()){r===0&&t.push(a` `);const s=i.table,n=i.lateral?a` lateral`:void 0,o=i.on?a` on ${i.on}`:void 0;if(h(s,M)){const l=s[M.Symbol.Name],d=s[M.Symbol.Schema],c=s[M.Symbol.OriginalName],p=l===c?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(c)}${p&&a` ${a.identifier(p)}`}${o}`)}else if(h(s,ye)){const l=s[q].name,d=s[q].schema,c=s[q].originalName,p=l===c?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(c)}${p&&a` ${a.identifier(p)}`}${o}`)}else t.push(a`${a.raw(i.joinType)} join${n} ${s}${o}`);r<e.length-1&&t.push(a` `)}return a.join(t)}buildFromTable(e){if(h(e,v)&&e[v.Symbol.IsAlias]){let t=a`${a.identifier(e[v.Symbol.OriginalName])}`;return e[v.Symbol.Schema]&&(t=a`${a.identifier(e[v.Symbol.Schema])}.${t}`),a`${t} ${a.identifier(e[v.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:i,having:s,table:n,joins:o,orderBy:l,groupBy:d,limit:c,offset:p,lockingClause:f,distinct:g,setOperators:b}){const A=r??$e(t);for(const D of A)if(h(D.field,L)&&ae(D.field.table)!==(h(n,E)?n._.alias:h(n,Xr)?n[q].name:h(n,w)?void 0:ae(n))&&!(ee=>o?.some(({alias:qe})=>qe===(ee[v.Symbol.IsAlias]?ae(ee):ee[v.Symbol.BaseName])))(D.field.table)){const ee=ae(D.field.table);throw new Error(`Your "${D.path.join("->")}" field references a column "${ee}"."${D.field.name}", but the table "${ee}" is not part of the query! Did you forget to join it?`)}const x=!o||o.length===0,C=this.buildWithCTE(e);let k;g&&(k=g===!0?a` distinct`:a` distinct on (${a.join(g.on,a`, `)})`);const N=this.buildSelection(A,{isSingleTable:x}),J=this.buildFromTable(n),I=this.buildJoins(o),R=i?a` where ${i}`:void 0,P=s?a` having ${s}`:void 0;let T;l&&l.length>0&&(T=a` order by ${a.join(l,a`, `)}`);let j;d&&d.length>0&&(j=a` group by ${a.join(d,a`, `)}`);const Z=typeof c=="object"||typeof c=="number"&&c>=0?a` limit ${c}`:void 0,K=p?a` offset ${p}`:void 0,G=a.empty();if(f){const D=a` for ${a.raw(f.strength)}`;f.config.of&&D.append(a` of ${a.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],a`, `)}`),f.config.noWait?D.append(a` nowait`):f.config.skipLocked&&D.append(a` skip locked`),G.append(D)}const ue=a`${C}select${k} ${N} from ${J}${I}${R}${j}${P}${T}${Z}${K}${G}`;return b.length>0?this.buildSetOperations(ue,b):ue}buildSetOperations(e,t){const[r,...i]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:i,limit:s,orderBy:n,offset:o}}){const l=a`(${e.getSQL()}) `,d=a`(${i.getSQL()})`;let c;if(n&&n.length>0){const b=[];for(const A of n)if(h(A,S))b.push(a.identifier(A.name));else if(h(A,w)){for(let x=0;x<A.queryChunks.length;x++){const C=A.queryChunks[x];h(C,S)&&(A.queryChunks[x]=a.identifier(C.name))}b.push(a`${A}`)}else b.push(a`${A}`);c=a` order by ${a.join(b,a`, `)} `}const p=typeof s=="object"||typeof s=="number"&&s>=0?a` limit ${s}`:void 0,f=a.raw(`${t} ${r?"all ":""}`),g=o?a` offset ${o}`:void 0;return a`${l}${f}${d}${c}${p}${g}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:i,withList:s,select:n,overridingSystemValue_:o}){const l=[],d=e[v.Symbol.Columns],c=Object.entries(d).filter(([x,C])=>!C.shouldDisableInsert()),p=c.map(([,x])=>a.identifier(this.casing.getColumnCasing(x)));if(n){const x=t;h(x,w)?l.push(x):l.push(x.getSQL())}else{const x=t;l.push(a.raw("values "));for(const[C,k]of x.entries()){const N=[];for(const[J,I]of c){const R=k[J];if(R===void 0||h(R,pe)&&R.value===void 0)if(I.defaultFn!==void 0){const P=I.defaultFn(),T=h(P,w)?P:a.param(P,I);N.push(T)}else if(!I.default&&I.onUpdateFn!==void 0){const P=I.onUpdateFn(),T=h(P,w)?P:a.param(P,I);N.push(T)}else N.push(a`default`);else N.push(R)}l.push(N),C<x.length-1&&l.push(a`, `)}}const f=this.buildWithCTE(s),g=a.join(l),b=i?a` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,A=r?a` on conflict ${r}`:void 0;return a`${f}insert into ${e} ${p} ${o===!0?a`overriding system value `:void 0}${g}${A}${b}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){return a`refresh materialized view${t?a` concurrently`:void 0} ${e}${r?a` with no data`:void 0}`}prepareTyping(e){return h(e,zr)||h(e,Or)?"json":h(e,Fr)?"decimal":h(e,Er)?"time":h(e,Rr)||h(e,Mr)?"timestamp":h(e,jr)||h(e,Dr)?"date":h(e,Ur)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}_buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:i,tableConfig:s,queryConfig:n,tableAlias:o,nestedQueryRelation:l,joinOn:d}){let c=[],p,f,g=[],b;const A=[];if(n===!0)c=Object.entries(s.columns).map(([C,k])=>({dbKey:k.name,tsKey:C,field:re(k,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const C=Object.fromEntries(Object.entries(s.columns).map(([P,T])=>[P,re(T,o)]));if(n.where){const P=typeof n.where=="function"?n.where(C,uo()):n.where;b=P&&Ye(P,o)}const k=[];let N=[];if(n.columns){let P=!1;for(const[T,j]of Object.entries(n.columns))j!==void 0&&T in s.columns&&(!P&&j===!0&&(P=!0),N.push(T));N.length>0&&(N=P?N.filter(T=>n.columns?.[T]===!0):Object.keys(s.columns).filter(T=>!N.includes(T)))}else N=Object.keys(s.columns);for(const P of N){const T=s.columns[P];k.push({tsKey:P,value:T})}let J=[];n.with&&(J=Object.entries(n.with).filter(P=>!!P[1]).map(([P,T])=>({tsKey:P,queryConfig:T,relation:s.relations[P]})));let I;if(n.extras){I=typeof n.extras=="function"?n.extras(C,{sql:a}):n.extras;for(const[P,T]of Object.entries(I))k.push({tsKey:P,value:pr(T,o)})}for(const{tsKey:P,value:T}of k)c.push({dbKey:h(T,w.Aliased)?T.fieldAlias:s.columns[P].name,tsKey:P,field:h(T,L)?re(T,o):T,relationTableTsKey:void 0,isJson:!1,selection:[]});let R=typeof n.orderBy=="function"?n.orderBy(C,co()):n.orderBy??[];Array.isArray(R)||(R=[R]),g=R.map(P=>h(P,L)?re(P,o):Ye(P,o)),p=n.limit,f=n.offset;for(const{tsKey:P,queryConfig:T,relation:j}of J){const Z=po(t,r,j),K=r[ze(j.referencedTable)],G=`${o}_${P}`,ue=W(...Z.fields.map((qe,it)=>fe(re(Z.references[it],G),re(qe,o)))),D=this._buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:e[K],tableConfig:t[K],queryConfig:h(j,Fe)?T===!0?{limit:1}:{...T,limit:1}:T,tableAlias:G,joinOn:ue,nestedQueryRelation:j}),ee=a`${a.identifier(G)}.${a.identifier("data")}`.as(P);A.push({on:a`true`,table:new E(D.sql,{},G),alias:G,joinType:"left",lateral:!0}),c.push({dbKey:P,tsKey:P,field:ee,relationTableTsKey:K,isJson:!0,selection:D.selection})}}if(c.length===0)throw new De({message:`No fields selected for table "${s.tsName}" ("${o}")`});let x;if(b=W(d,b),l){let C=a`json_build_array(${a.join(c.map(({field:N,tsKey:J,isJson:I})=>I?a`${a.identifier(`${o}_${J}`)}.${a.identifier("data")}`:h(N,w.Aliased)?N.sql:N),a`, `)})`;h(l,Hr)&&(C=a`coalesce(json_agg(${C}${g.length>0?a` order by ${a.join(g,a`, `)}`:void 0}), '[]'::json)`);const k=[{dbKey:"data",tsKey:"data",field:C.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||f!==void 0||g.length>0?(x=this.buildSelectQuery({table:ie(i,o),fields:{},fieldsFlat:[{path:[],field:a.raw("*")}],where:b,limit:p,offset:f,orderBy:g,setOperators:[]}),b=void 0,p=void 0,f=void 0,g=[]):x=ie(i,o),x=this.buildSelectQuery({table:h(x,M)?x:new E(x,{},o),fields:{},fieldsFlat:k.map(({field:N})=>({path:[],field:h(N,L)?re(N,o):N})),joins:A,where:b,limit:p,offset:f,orderBy:g,setOperators:[]})}else x=this.buildSelectQuery({table:ie(i,o),fields:{},fieldsFlat:c.map(({field:C})=>({path:[],field:h(C,L)?re(C,o):C})),joins:A,where:b,limit:p,offset:f,orderBy:g,setOperators:[]});return{tableTsKey:s.tsName,sql:x,selection:c}}nestedSelectionerror(){throw new De({message:"Views with nested selections are not supported by the relational query builder"})}buildRqbColumn(e,t,r){if(h(t,L)){const i=a`${e}.${a.identifier(this.casing.getColumnCasing(t))}`;let s=t.columnType,n=t,o=0;for(;h(n,dr);)n=n.baseColumn,s=n.columnType,++o;switch(s){case"PgNumeric":case"PgNumericNumber":case"PgNumericBigInt":case"PgBigInt64":case"PgBigIntString":case"PgBigSerial64":case"PgTimestampString":case"PgGeometry":case"PgGeometryObject":case"PgBytea":{const l="[]".repeat(o);return a`${i}::text${a.raw(l).if(l)} as ${a.identifier(r)}`}case"PgCustomColumn":return a`${n.jsonSelectIdentifier(i,a,o>0?o:void 0)} as ${a.identifier(r)}`;default:return a`${i} as ${a.identifier(r)}`}}return a`${e}.${h(t,w.Aliased)?a.identifier(t.fieldAlias):xt(t)?a.identifier(r):this.nestedSelectionerror()} as ${a.identifier(r)}`}unwrapAllColumns=(e,t)=>a.join(Object.entries(e[me]).map(([r,i])=>(t.push({key:r,field:i}),this.buildRqbColumn(e,i,r))),a`, `);buildColumns=(e,t,r)=>r?.columns?(()=>{const i=Object.entries(r.columns),s=e[me],n=[];let o;for(const[l,d]of i)if(d!==void 0&&(o=o||d,d)){const c=s[l];n.push(this.buildRqbColumn(e,c,l)),t.push({key:l,field:c})}if(o===!1)for(const[l,d]of Object.entries(s))r.columns[l]!==!1&&(n.push(this.buildRqbColumn(e,d,l)),t.push({key:l,field:d}));return n.length?a.join(n,a`, `):void 0})():this.unwrapAllColumns(e,t);buildRelationalQuery({schema:e,table:t,tableConfig:r,queryConfig:i,relationWhere:s,mode:n,errorPath:o,depth:l,throughJoin:d}){const c=[],p=n==="first",f=i===!0?void 0:i,g=o??"",b=l??0;b||(t=ie(t,`d${b}`));const A=p?1:f?.limit,x=f?.offset,C=f?.where&&s?W(de(t,f.where,r.relations,e,this.casing),s):f?.where?de(t,f.where,r.relations,e,this.casing):s,k=f?.orderBy?Ys(t,f.orderBy):void 0,N=this.buildColumns(t,c,f),J=f?.extras?Xs(t,f.extras):void 0;J&&c.push(...J.selection);const I=N?[N]:[],R=f?(()=>{const{with:P}=f;if(!P)return;const T=Object.entries(P).filter(([j,Z])=>Z);if(T.length)return a.join(T.map(([j,Z])=>{const K=r.relations[j],G=h(K,qr),ue=ie(K.targetTable,`d${b+1}`),D=K.throughTable?ie(K.throughTable,`tr${b}`):void 0,{filter:ee,joinCondition:qe}=Ir(this.casing,K,t,ue,D);I.push(a`${a.identifier(j)}.${a.identifier("r")} as ${a.identifier(j)}`);const it=D?a` inner join ${Ae(D)} on ${qe}`:void 0,Bt=this.buildRelationalQuery({table:ue,mode:G?"first":"many",schema:e,queryConfig:Z,tableConfig:e[K.targetTableName],relationWhere:ee,errorPath:`${g.length?`${g}.`:""}${j}`,depth:b+1,throughJoin:it});return c.push({field:ue,key:j,selection:Bt.selection,isArray:!G,isOptional:(K.optional??!1)||Z!==!0&&!!Z.where}),a`left join lateral(select ${G?a`row_to_json(${a.identifier("t")}.*) ${a.identifier("r")}`:a`coalesce(json_agg(row_to_json(${a.identifier("t")}.*)), '[]') as ${a.identifier("r")}`} from (${Bt.sql}) as ${a.identifier("t")}) as ${a.identifier(j)} on true`}),a` `)})():void 0;if(J?.sql&&I.push(J.sql),!I.length)throw new De({message:`No fields selected for table "${r.name}"${g?` ("${g}")`:""}`});return{sql:a`select ${a.join(I.filter(P=>P!==void 0),a`, `)} from ${Ae(t)}${d}${a` ${R}`.if(R)}${a` where ${C}`.if(C)}${a` order by ${k}`.if(k)}${a` limit ${A}`.if(A!==void 0)}${a` offset ${x}`.if(x!==void 0)}`,selection:c}}},So=class{static[u]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}},X=class{static[u]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){const t=!!this.fields,r=e;let i;return this.fields?i=this.fields:h(r,E)?i=Object.fromEntries(Object.keys(r._.selectedFields).map(s=>[s,r[s]])):h(r,Xr)?i=r[q].selectedFields:h(r,w)?i={}:i=tn(r),new Zr({table:r,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Po=class extends So{static[u]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:r,session:i,dialect:s,withList:n,distinct:o}){super(),this.config={withList:n,table:e,fields:{...t},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=i,this.dialect=s,this._={selectedFields:t,config:this.config},this.tableName=we(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(const l of Pe(e))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return((r,i)=>{const s=this.tableName,n=we(r);for(const o of Pe(r))this.usedTables.add(o);if(typeof n=="string"&&this.config.joins?.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof n=="string"&&!h(r,w))){const o=h(r,E)?r._.selectedFields:h(r,ye)?r[q].selectedFields:r[v.Symbol.Columns];this.config.fields[n]=o}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:r,joinType:e,alias:n,lateral:t}),typeof n=="string")switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!1;break}return this})}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return r=>{const i=typeof r=="function"?r(xo()):r;if(!At(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{const t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){const t=[];if(t.push(...Pe(this.config.table)),this.config.joins)for(const r of this.config.joins)t.push(...Pe(r.table));return new Proxy(new E(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new U({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}},Zr=class extends Po{static[u]="PgSelect";_prepare(e){const{session:t,config:r,dialect:i,joinsNotNullableMap:s,authToken:n,cacheConfig:o,usedTables:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const{fields:d}=r;return B.startActiveSpan("drizzle.prepareQuery",()=>{const c=$e(d),p=t.prepareQuery(i.sqlToQuery(this.getSQL()),c,e,!0,void 0,{type:"select",tables:[...l]},o);return p.joinsNotNullableMap=s,p.setToken(n)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};en(Zr,[be]);function Be(e,t){return(r,i,...s)=>{const n=[i,...s].map(o=>({type:e,isAll:t,rightSelect:o}));for(const o of n)if(!At(r.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(n)}}var xo=()=>({union:$o,unionAll:To,intersect:Co,intersectAll:No,except:_o,exceptAll:Ao}),$o=Be("union",!1),To=Be("union",!0),Co=Be("intersect",!1),No=Be("intersect",!0),_o=Be("except",!1),Ao=Be("except",!0),ei=class{static[u]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=h(e,He)?e:void 0,this.dialectConfig=h(e,He)?void 0:e}$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(r)),new Proxy(new fr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){const t=this;function r(n){return new X({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(n){return new X({fields:n??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function s(n,o){return new X({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:n}})}return{select:r,selectDistinct:i,selectDistinctOn:s}}select(e){return new X({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new X({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new X({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new He(this.dialectConfig)),this.dialect}},Vt=class{constructor(e,t,r,i,s){this.table=e,this.session=t,this.dialect=r,this.withList=i,this.overridingSystemValue_=s}static[u]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");const t=e.map(r=>{const i={},s=this.table[v.Symbol.Columns];for(const n of Object.keys(r)){const o=r[n];i[n]=h(o,w)?o:new pe(o,s[n])}return i});return new Et(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){const t=typeof e=="function"?e(new ei):e;if(!h(t,w)&&!At(this.table[me],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Et(this.table,t,this.session,this.dialect,this.withList,!0)}},Et=class extends be{constructor(e,t,r,i,s,n,o){super(),this.session=r,this.dialect=i,this.config={table:e,values:t,withList:s,select:n,overridingSystemValue_:o}}static[u]="PgInsert";config;cacheConfig;returning(e=this.config.table[v.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=$e(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=a`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));const r=e.where?a` where ${e.where}`:void 0;this.config.onConflict=a`(${a.raw(t)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');const t=e.where?a` where ${e.where}`:void 0,r=e.targetWhere?a` where ${e.targetWhere}`:void 0,i=e.setWhere?a` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,kr(this.config.table,e.set));let n="";return n=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=a`(${a.raw(n)})${r} do update set ${s}${t}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Pe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},Lo=class extends be{constructor(e,t,r){super(),this.session=t,this.dialect=r,this.config={view:e}}static[u]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))},Rt=class{constructor(e,t,r,i){this.table=e,this.session=t,this.dialect=r,this.withList=i}static[u]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Bo(this.table,kr(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Bo=class extends be{constructor(e,t,r,i,s){super(),this.session=r,this.dialect=i,this.config={set:t,table:e,withList:s,joins:[]},this.tableName=we(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[u]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){const t=e,r=we(t);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=t,this}getTableLikeFields(e){return h(e,M)?e[v.Symbol.Columns]:h(e,E)?e._.selectedFields:e[q].selectedFields}createJoin(e){return((t,r)=>{const i=we(t);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof r=="function"){const s=this.config.from&&!h(this.config.from,w)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[v.Symbol.Columns],new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":this.joinsNotNullableMap[i]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break;case"inner":this.joinsNotNullableMap[i]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}return this})}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[v.Symbol.Columns]),this.config.from)){const t=we(this.config.from);if(typeof t=="string"&&this.config.from&&!h(this.config.from,w)){const r=this.getTableLikeFields(this.config.from);e[t]=r}for(const r of this.config.joins){const i=we(r.table);if(typeof i=="string"&&!h(r.table,w)){const s=this.getTableLikeFields(r.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=$e(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){const t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Pe(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},qo=class{constructor(e,t,r,i,s,n,o){this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o}static[u]="PgRelationalQueryBuilder";findMany(e){return new Mt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Mt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Mt=class extends be{constructor(e,t,r,i,s,n,o,l,d){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o,this.config=l,this.mode=d}static[u]="PgRelationalQuery";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(i,s)=>{const n=i.map(o=>pt(this.schema,this.tableConfig,o,t.selection,s));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect._buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},Qo=class gt extends w{constructor(t){super(gt.buildEmbeddedCount(t.source,t.filters).queryChunks),this.params=t,this.mapWith(Number),this.session=t.session,this.sql=gt.buildCount(t.source,t.filters)}sql;token;static[u]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(t,r){return a`(select count(*) from ${t}${a.raw(" where ").if(r)}${r})`}static buildCount(t,r){return a`select count(*) as count from ${t}${a.raw(" where ").if(r)}${r};`}setToken(t){return this.token=t,this}then(t,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(t,r)}catch(t){return this.then(void 0,t)}finally(t){return this.then(r=>(t?.(),r),r=>{throw t?.(),r})}},Io=class{constructor(e,t,r,i,s,n){this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.parseJson=n}static[u]="PgRelationalQueryBuilderV2";findMany(e){return new Ut(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"many",this.parseJson)}findFirst(e){return new Ut(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"first",this.parseJson)}},Ut=class extends be{constructor(e,t,r,i,s,n,o,l){super(),this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.config=n,this.mode=o,this.parseJson=l}static[u]="PgRelationalQueryV2";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareRelationalQuery(r,void 0,e,(i,s)=>{const n=i.map(o=>ht(o,t.selection,s,this.parseJson));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQuery({schema:this.schema,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,mode:this.mode})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},ko=class extends be{constructor(e,t,r,i){super(),this.execute=e,this.sql=t,this.query=r,this.mapBatchResult=i}static[u]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}},ti=class{constructor(e,t,r,i,s=!1){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,relations:r,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},relations:r,session:t},this._query={},this._.schema)for(const[n,o]of Object.entries(this._.schema))this._query[n]=new qo(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[n],o,e,t);this.query={};for(const[n,o]of Object.entries(r))this.query[n]=new Io(r,r[o.name].table,o,e,t,s);this.$cache={invalidate:async n=>{}}}static[u]="PgDatabase";_query;query;$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(new ei(r.dialect))),new Proxy(new fr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new Qo({source:e,filters:t,session:this.session})}$cache;with(...e){const t=this;function r(d){return new X({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(d){return new X({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function s(d,c){return new X({fields:c??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:d}})}function n(d){return new Rt(d,t.session,t.dialect,e)}function o(d){return new Vt(d,t.session,t.dialect,e)}function l(d){return new Ft(d,t.session,t.dialect,e)}return{select:r,selectDistinct:i,selectDistinctOn:s,update:n,insert:o,delete:l}}select(e){return new X({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new X({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new X({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Rt(e,this.session,this.dialect)}insert(e){return new Vt(e,this.session,this.dialect)}delete(e){return new Ft(e,this.session,this.dialect)}refreshMaterializedView(e){return new Lo(e,this.session,this.dialect)}authToken;execute(e){const t=typeof e=="string"?a.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(t),i=this.session.prepareQuery(r,void 0,void 0,!1);return new ko(()=>i.execute(void 0,this.authToken),t,r,s=>i.mapResult(s,!0))}transaction(e,t){return this.session.transaction(e,t)}},jo=class{static[u]="Cache"},ri=class extends jo{strategy(){return"all"}static[u]="NoopCache";async get(e){}async put(e,t,r,i){}async onMutate(e){}};async function Jt(e,t){const r=`${e}-${JSON.stringify(t)}`,i=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(s)].map(n=>n.toString(16).padStart(2,"0")).join("")}var Do=class{constructor(e,t,r,i){this.query=e,this.cache=t,this.queryMetadata=r,this.cacheConfig=i,t&&t.strategy()==="all"&&i===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[u]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,r){if(this.cache===void 0||h(this.cache,ri)||this.queryMetadata===void 0)try{return await r()}catch(i){throw new Ce(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await r()}catch(i){throw new Ce(e,t,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{const[i]=await Promise.all([r(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new Ce(e,t,i)}if(!this.cacheConfig)try{return await r()}catch(i){throw new Ce(e,t,i)}if(this.queryMetadata.type==="select"){const i=await this.cache.get(this.cacheConfig.tag??await Jt(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let s;try{s=await r()}catch(n){throw new Ce(e,t,n)}return await this.cache.put(this.cacheConfig.tag??await Jt(e,t),s,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),s}return i}try{return await r()}catch(i){throw new Ce(e,t,i)}}},Oo=class{constructor(e){this.dialect=e}static[u]="PgSession";execute(e,t){return B.startActiveSpan("drizzle.operation",()=>B.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){const r=await this.execute(e,t);return Number(r[0].count)}},zo=class extends ti{constructor(e,t,r,i,s=0,n){super(e,t,r,i,n),this.relations=r,this.schema=i,this.nestedIndex=s}static[u]="PgTransaction";rollback(){throw new zs}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),a.raw(t.join(" "))}setTransaction(e){return this.session.execute(a`set transaction ${this.getTransactionConfigSQL(e)}`)}},Kt=class extends Do{constructor(e,t,r,i,s,n,o,l,d,c,p){super({sql:t,params:r},s,n,o),this.client=e,this.queryString=t,this.params=r,this.logger=i,this.fields=l,this._isResponseInArrayMode=d,this.customResultMapper=c,this.isRqbV2Query=p}static[u]="PostgresJsPreparedQuery";async execute(e={}){return this.isRqbV2Query?this.executeRqbV2(e):B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{fields:i,queryString:s,client:n,joinsNotNullableMap:o,customResultMapper:l}=this;if(!i&&!l)return B.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(s,r,async()=>await n.unsafe(s,r)));const d=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":s,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(s,r,async()=>await n.unsafe(s,r).values())));return B.startActiveSpan("drizzle.mapResponse",()=>l?l(d):d.map(c=>Zs(i,c,o)))})}async executeRqbV2(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{queryString:i,client:s,customResultMapper:n}=this,o=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(r)}),s.unsafe(i,r)));return B.startActiveSpan("drizzle.mapResponse",()=>n(o))})}all(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r),B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(this.queryString,r,async()=>this.client.unsafe(this.queryString,r))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},ii=class si extends Oo{constructor(t,r,i,s,n={}){super(r),this.client=t,this.relations=i,this.schema=s,this.options=n,this.logger=n.logger??new Es,this.cache=n.cache??new ri}static[u]="PostgresJsSession";logger;cache;prepareQuery(t,r,i,s,n,o,l){return new Kt(this.client,t.sql,t.params,this.logger,this.cache,o,l,r,s,n)}prepareRelationalQuery(t,r,i,s){return new Kt(this.client,t.sql,t.params,this.logger,this.cache,void 0,void 0,r,!1,s,!0)}query(t,r){return this.logger.logQuery(t,r),this.client.unsafe(t,r).values()}queryObjects(t,r){return this.client.unsafe(t,r)}transaction(t,r){return this.client.begin(async i=>{const s=new si(i,this.dialect,this.relations,this.schema,this.options),n=new Fo(this.dialect,s,this.schema,this.relations);return r&&await n.setTransaction(r),t(n)})}},Fo=class ni extends zo{constructor(t,r,i,s,n=0){super(t,r,s,i,n),this.session=r}static[u]="PostgresJsTransaction";transaction(t){return this.session.client.savepoint(r=>{const i=new ii(r,this.dialect,this.relations,this.schema,this.session.options);return t(new ni(this.dialect,i,this.schema,this.relations))})}},Vo=class extends ti{static[u]="PostgresJsDatabase"};function Ie(e,t={}){const r=d=>d;for(const d of["1184","1082","1083","1114","1182","1185","1115","1231"])e.options.parsers[d]=r,e.options.serializers[d]=r;e.options.serializers[114]=r,e.options.serializers[3802]=r;const i=new He({casing:t.casing});let s;t.logger===!0?s=new Vs:t.logger!==!1&&(s=t.logger);let n;if(t.schema){const d=ho(t.schema,go);n={fullSchema:t.schema,schema:d.tables,tableNamesMap:d.tableNamesMap}}const o=t.relations??{},l=new Vo(i,new ii(e,i,o,n,{logger:s,cache:t.cache}),o,n);return l.$client=e,l.$cache=t.cache,l.$cache&&(l.$cache.invalidate=t.cache?.onMutate),l}function yt(...e){if(typeof e[0]=="string")return Ie(Ke(e[0]),e[1]);const{connection:t,client:r,...i}=e[0];if(r)return Ie(r,i);if(typeof t=="object"&&t.url!==void 0){const{url:s,...n}=t;return Ie(Ke(s,n),i)}return Ie(Ke(t),i)}(e=>{function t(r){return Ie({options:{parsers:{},serializers:{}}},r)}e.mock=t})(yt||(yt={}));var Eo=process.env.DATABASE_URL??`postgresql://${process.env.POSTGRES_USER??"prometheus"}:${process.env.POSTGRES_PASSWORD??"secret"}@${process.env.POSTGRES_HOST??"localhost"}:${process.env.POSTGRES_PORT??5433}/${process.env.POSTGRES_DB??"prometheus"}`,Ro=process.env.POSTGRES_SSL==="true"?"require":!1;const Mo=Ke(Eo,{max:5,ssl:Ro}),rt=yt({client:Mo}),le=Zt("store_items",{id:er("id").primaryKey(),name:lt("name").notNull(),price:xi("price",{precision:10,scale:2}).notNull(),createdAt:tr("created_at",{mode:"date",withTimezone:!1}).defaultNow()}),Ml=Zt("chat_messages",{id:er("id").primaryKey(),author:lt("author").notNull(),body:lt("body").notNull(),createdAt:tr("created_at",{mode:"date",withTimezone:!1}).defaultNow()});var ai=e=>{const t=Number.parseFloat(String(e.price));return{id:e.id,name:e.name,price:Number.isFinite(t)?t:0}};const Uo=({cacheControl:e})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60})};var oi=async e=>{const r=Number.isFinite(e)&&(e??0)>0?Number(e):0,i=rt.select().from(le),s=r>0?i.where(tt(le.id,r)):i;try{const n=(await s.orderBy(le.id).limit(6)).map(ai);return{items:n,cursor:n.length===6?n[n.length-1].id:null,source:"db"}}catch(n){return console.error("Failed to load store items",n),{items:[{id:-1,name:y`Sample adapter (offline)`,price:24.99},{id:-2,name:y`Edge cache pack (offline)`,price:12.5}],cursor:null,source:"fallback"}}},Jo=pi(async e=>oi(e),"o0FSe7O5kbg");const Ko=bi(_(Jo,"s_o0FSe7O5kbg"));var Wo=async()=>oi();const li=mi(_(Wo,"s_v669J74jz24"));var Ho=async e=>{const t=Number.parseInt(String(e.id??""),10);if(!Number.isFinite(t)||t<=0)return{success:!1,error:y`Invalid id.`};try{const[r]=await rt.delete(le).where(fe(le.id,t)).returning();return r?{success:!0,id:t}:{success:!1,error:y`Item not found.`}}catch(r){return console.error("Failed to delete store item",r),{success:!1,error:y`Unable to delete item right now.`}}};const ui=Gt(_(Ho,"s_R9VLNISWb6o"));var Go=async e=>{const t=String(e.name??"").trim(),r=Number.parseFloat(String(e.price??""));if(!t||Number.isNaN(r)||r<=0)return{success:!1,error:y`Name and positive price required.`};try{const[i]=await rt.insert(le).values({name:t,price:r.toString()}).returning();return{success:!0,item:ai(i)}}catch(i){return console.error("Failed to create store item",i),{success:!1,error:y`Unable to create item right now.`}}};const ci=Gt(_(Go,"s_nexPpNJs6FU"));var Lt=e=>{if(typeof document>"u"){e();return}const t=document.startViewTransition;if(typeof t=="function"){t.call(document,e);return}e()},di=(e,t)=>e[t]?e:{...e,[t]:!0},hi=(e,t)=>{if(!e[t])return e;const r={...e};return delete r[t],r},Yo=async(e=!1)=>{const[t,r,i,s,n,o]=Te();if(!o.value){o.value=!0,r.value=null;try{const l=await Ko(e?void 0:t.value??void 0),d=l?.items??[],c=e?d:[...n.value,...d];Lt(()=>{n.value=c}),t.value=l?.cursor??null,s.value=l?.source==="fallback",i.value=!0,r.value=l?.source==="fallback"?y`Database offline: showing fallback inventory.`:null}catch(l){console.error("Failed to load store items",l),r.value=y`Unable to load inventory right now.`}finally{o.value=!1}}},Xo=()=>{const[e,t]=Te();e.value||t(!0)},Zo=({track:e})=>{const[t,r,i,s,n,o]=Te(),l=e(()=>t.value);if(l?.success&&l.item){const d=[...o.value.filter(c=>c.id!==l.item.id),l.item];d.sort((c,p)=>c.id-p.id),n.value?Lt(()=>{o.value=d}):(r.value=di(r.value,l.item.id),o.value=d,setTimeout(()=>{r.value=hi(r.value,l.item.id)},320)),s.value=!0,i.value=null}},el=({track:e})=>{const[t,r,i,s,n]=Te(),o=e(()=>t.value);o?.success&&o.id?(s.value?Lt(()=>{n.value=n.value.filter(l=>l.id!==o.id)}):(i.value=di(i.value,o.id),setTimeout(()=>{n.value=n.value.filter(l=>l.id!==o.id),i.value=hi(i.value,o.id)},260)),r.value=null):o?.error&&(r.value=o.error)},tl=()=>{const e=li(),t=V(e.value.items),r=V(e.value.cursor),i=V(!1),s=V(e.value.items.length>0),n=V(e.value.source==="fallback"),o=V(e.value.source==="fallback"?y`Database offline: showing fallback inventory.`:null),l=ci(),d=ui(),c=V(!1),p=V({}),f=V({});Yt(te("s_AuJpa7ZJr0s",[c]));const g=_(Yo,"s_69ywUjDxRgU",[r,o,s,n,t,i]);return Ue(_(Xo,"s_h70dBAjCmqY",[s,g]),{eagerness:"visible"}),Ue(_(Zo,"s_fap9umrX08E",[l,p,o,s,c,t])),Ue(_(el,"s_ESNIfCDtZ0Q",[d,o,f,c,t])),m("div",null,{class:"gap-4 grid md:grid-cols-[1.2fr_1fr] bg-slate-900/60 mt-5 p-4 border border-slate-800 rounded-lg"},[m("div",null,{class:"space-y-4"},[m("div",null,{class:"flex justify-between items-center"},[m("p",null,{class:"text-slate-300 text-sm"},y`Inventory`,1,null),m("button",null,{type:"button",class:"bg-slate-800 hover:bg-slate-700 disabled:opacity-60 px-3 py-2 rounded-lg ring-1 ring-slate-700 font-semibold text-slate-100 text-xs transition",disabled:se(b=>b.value,[i],"p0.value"),onClick$:te("s_DM6GWHW8dls",[g])},y`Refresh`,1,null)],1,null),n.value&&m("p",null,{class:"text-amber-300 text-xs"},y`Showing fallback data while the database is unavailable.`,1,"YL_0"),!s.value&&m("p",null,{class:"text-slate-500 text-sm"},y`Inventory loads once this section is visible.`,1,"YL_1"),o.value&&m("p",null,{class:"text-rose-300 text-sm"},se(b=>b.value,[o],"p0.value"),3,"YL_2"),t.value.length?m("ul",null,{class:"gap-3 grid md:grid-cols-2",style:{viewTransitionName:"store-grid"}},t.value.map(b=>m("li",{class:["surface space-y-2 p-4",!c.value&&p.value[b.id]?"store-item-entering":"",!c.value&&f.value[b.id]?"store-item-exiting":""].filter(Boolean).join(" "),style:{viewTransitionName:`store-item-${b.id}`}},null,[m("div",null,{class:"flex justify-between items-start gap-3"},[m("div",null,null,[m("p",null,{class:"text-slate-400 text-sm"},y`SKU ${b.id}`,1,null),m("p",null,{class:"font-semibold text-slate-50 text-lg"},ne(b,"name"),1,null)],1,null),O(qt,{action:d,class:"shrink-0",children:[m("input",{value:ne(b,"id")},{type:"hidden",name:"id"},null,3,null),m("button",{disabled:d.isRunning||b.id<=0,"aria-label":y`Delete ${b.name}`},{type:"submit",class:"hover:bg-rose-500/10 disabled:opacity-60 px-2 py-1 rounded-md ring-1 ring-slate-700 hover:ring-rose-500 text-slate-400 hover:text-rose-200 text-xs transition"},y`Delete`,1,null)],[ce]:{action:ce,class:ce}},1,"YL_3")],1,null),m("p",null,{class:"text-emerald-300"},["$",b.price.toFixed(2)],1,null)],1,b.id)),1,"YL_4"):s.value&&!i.value&&m("p",null,{class:"text-slate-500 text-sm"},y`No items yet.`,1,"YL_5"),m("div",null,{class:"flex items-center gap-3"},[r.value!==null&&m("button",null,{type:"button",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-60 px-4 py-2 rounded-lg font-semibold text-emerald-950 text-sm transition",disabled:se(b=>b.value,[i],"p0.value"),onClick$:te("s_isBUq7NOKTw",[g])},y`Load more`,1,"YL_6"),i.value&&m("span",null,{class:"text-slate-400 text-xs"},y`Loading...`,1,"YL_7")],1,null)],1,null),m("div",null,{class:"space-y-3 bg-slate-900/80 p-4 border border-slate-800 rounded-lg"},[m("p",null,{class:"font-semibold text-slate-100 text-sm"},y`Add an item`,1,null),O(qt,{action:l,class:"space-y-3 text-slate-200 text-sm",children:[m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"name"},y`Name`,1,null),m("input",null,{id:"name",name:"name",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:y`Lightweight widget`,required:!0},null,3,null)],1,null),m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"price"},y`Price`,1,null),m("input",null,{id:"price",name:"price",type:"number",step:"0.01",min:"0",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:"24.99",required:!0},null,3,null)],1,null),m("button",null,{type:"submit",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-70 px-4 py-2 rounded-lg w-full font-semibold text-emerald-950 text-sm transition",disabled:se(b=>b.isRunning,[l],"p0.isRunning")},l.isRunning?y`Saving...`:y`Create item`,1,null),l.value?.error&&m("p",null,{class:"text-rose-300 text-xs"},se(b=>b.value.error,[l],"p0.value.error"),3,"YL_8"),l.value?.success&&l.value.item&&m("p",null,{class:"text-emerald-300 text-xs"},y`Added ${l.value.item.name}.`,1,"YL_9")],[ce]:{action:ce,class:ce}},1,"YL_10")],1,null)],1,"YL_11")};const rl=H(_(tl,"s_2aWAOZ0c5GI"));var il=".store-item-entering{transform-origin:top;animation:.26s ease-out both store-item-enter}.store-item-exiting{transform-origin:top;animation:.24s ease-in both store-item-exit}@keyframes store-item-enter{0%{opacity:0;transform:translateY(6px)scale(.99)}to{opacity:1;transform:translateY(0)scale(1)}}@keyframes store-item-exit{0%{opacity:1;transform:translateY(0)scale(1)}to{opacity:0;transform:translateY(-6px)scale(.98)}}",sl=ge({default:()=>al,head:()=>ol,onGet:()=>Uo,useCreateStoreItem:()=>ci,useDeleteStoreItem:()=>ui,useStoreItemsLoader:()=>li},1),nl=()=>(Ve(_(il,"s_cOQoV5jD0Q4")),m("section",null,{class:"p-6 surface"},[m("div",null,{class:"flex justify-between items-center gap-2"},[m("div",null,null,[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Store`,1,null),m("h1",null,{class:"font-semibold text-slate-50 text-2xl"},y`Fast browsing with tiny payloads`,1,null)],1,null),m("span",null,{class:"bg-slate-800 px-3 py-1 rounded-full text-slate-200 text-xs"},y`cached`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-slate-300 text-sm"},y`Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.`,1,null),m("div",null,{onQVisible$:te("s_CaVBY15goBk")},O(rl,null,3,"3h_0"),1,null)],1,"3h_1")),al=H(_(nl,"s_bZ8kc5UlLx4"));const ol=({withLocale:e})=>e(()=>({title:y`Store | Prometheus`,meta:[{name:"description",content:y`Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.`}]}));var ll=ge({onGet:()=>ul},1);const ul=async({cacheControl:e,query:t,json:r})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60});const i=Number.parseInt(t.get("limit")??"",10),s=Number.parseInt(t.get("cursor")??"",10),n=Number.isFinite(i)&&i>0?Math.min(i,50):10,o=Number.isFinite(s)&&s>0?s:0;try{const l=rt.select().from(le),d=(await(o>0?l.where(tt(le.id,o)):l).orderBy(le.id).limit(n)).map(c=>({...c,price:Number.parseFloat(String(c.price))}));r(200,{items:d,cursor:d.length===n?d[d.length-1].id:null})}catch(l){console.error("Failed to load store items",l),r(500,{error:"Unable to load items right now."})}},cl=[Oi];var Ne=()=>Zi;const dl=[["/",[Ne,()=>as],"/",["q-BgmBrRwE.js","q-CZ0qQuVs.js"]],["ai",[Ne,()=>ds],"/ai",["q-BgmBrRwE.js","q-CVlUOd8S.js"]],["chat",[Ne,()=>ws],"/chat",["q-BgmBrRwE.js","q-fLMbDHTK.js"]],["index",[Ne,()=>ss],"/index",["q-BgmBrRwE.js","q-BQIvlY8a.js"]],["store",[Ne,()=>sl],"/store",["q-BgmBrRwE.js","q-BnH7qI6M.js"]],["api/store/items",[Ne,()=>ll],"/api/store/items",["q-BgmBrRwE.js"]]],hl=[];var fl={routes:dl,serverPlugins:cl,menus:hl,trailingSlash:!1,basePathname:"/",cacheModules:!0},ml=({serverData:e})=>`/build${`/${e.locale}`}`,pl=()=>{Ti(()=>fi(Xe))},gl=()=>{const e=bt();return Yt(te("s_TVD7erg9zpo",[V(e.url.href),e])),O(Xt,null,3,"Dv_0")};const yl=H(_(gl,"s_w6dmeDadJmA"));var bl={};globalThis.__EXPERIMENTAL__=bl;var vl=()=>O(yi,{children:[m("head",null,null,[m("meta",null,{charSet:"utf-8"},null,3,null),O(nr,null,3,"xd_0")],1,null),m("body",null,{class:"app-shell"},O(yl,{children:O(vi,null,3,"xd_1")},1,"xd_2"),1,null)]},1,"xd_3"),wl=H(_(vl,"s_8txvw3enrrU"));pl();var Sl=e=>{const t=typeof e.base=="function"?e.base(e):e.base;return t?t.endsWith("/")?t:`${t}/`:"/build/"},Wt=e=>!!e&&typeof e=="object"&&"manifest"in e,Pl=e=>{const t=e.serverData?.locale;if(t)return t;let r=null;const i=e.serverData?.url;if(i)try{r=new URL(i).searchParams.get("locale")}catch{r=null}const s=e.serverData?.requestHeaders?.["accept-language"]??void 0;return wt({queryLocale:r,acceptLanguage:s})};function xl(e){const t=e.manifest??Ht,r=Wt(t)?t.manifest:t,i=Pl(e),s={...e.serverData,locale:i},n=Sl({...e,base:ml,serverData:s}),o=`${n}${r?.qwikLoader??"qwikloader.js"}`,l={...e.containerAttributes,lang:i,"q:locale":i},c={tag:"script",location:"head",attributes:{"data-qwik-lazy-loader":"1",dangerouslySetInnerHTML:`(function(){const src='${o}';if(!src)return;let started=false;const load=()=>{if(started||navigator.connection?.saveData)return;started=true;const s=document.createElement('script');s.type='module';s.defer=true;s.src=src;s.setAttribute('data-qwik-loader','lazy');document.head.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>triggers.forEach((event)=>document.removeEventListener(event,prime,listenerOpts));const triggers=['pointerdown','keydown','touchstart','focusin'];const listenerOpts={once:true,passive:true};triggers.forEach((event)=>document.addEventListener(event,prime,listenerOpts));document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible')prime();},{once:true});})();`}},p=r?Wt(t)?{...t,manifest:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],c]}}:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],c]}:t;return Si(O(wl,null,3,"CC_0"),{...e,base:n,serverData:s,manifest:p,qwikLoader:"never",preloader:!1,containerTagName:"html",containerAttributes:l,stream:e.stream??{static:{buffer:0},inOrder:["<html"]}})}var{router:$l,notFound:Tl}=gi({render:xl,qwikCityPlan:fl,manifest:Ht}),Ul={router:$l,notFound:Tl};export{Ul as default,Tl as notFound,$l as router};
