import{t as ye}from"./q-B9iggP75.js";import{A as Wt,C as H,D as M,E as ue,O as Ve,S as te,T as _,_ as O,a as di,b as re,c as bt,d as hi,f as Ht,g as ne,h as de,i as Gt,k as Ue,l as fi,m as Yt,n as mi,o as pi,p as Je,r as gi,s as yi,t as Bt,u as bi,v as m,w as vi,x as wi,y as Pe}from"./q-BTDiotA3.js";import{partytownSnippet as Si}from"@builder.io/partytown/integration";import Ke from"postgres";import{numeric as Pi,pgTable as Xt,serial as Zt,text as lt,timestamp as er}from"drizzle-orm/pg-core";const ut=["en","ko"],vt={en:"English",ko:"한국어"};let Xe="en",we,tr=()=>{if(we)return we;if(typeof document<"u"){const e=document.documentElement.lang;e&&e in vt&&(we=e)}return we||(we=Xe),we};var xi=e=>vt[e]?e:(console.error(`unknown locale ${e}`),Xe);const $i=e=>{tr=()=>we=xi(e())};var Ti=(e,t=[])=>{for(let r=0;typeof e=="object";r++){let i=e[t[r]]??e["*"];typeof i=="number"&&(i=e[i]),e=i}return typeof e=="string"?e.replace(/\$([\d$])/g,(r,i)=>i==="$"?"$":String(t[Number(i)-1]??"")):""},Ci=e=>e.map((t,r)=>`${r}${t.replace(/\$/g,()=>"$$")}`).join("$").slice(1);const Ni="English",_i={"Performance Lab":"Performance Lab",Home:"Home",Store:"Store",Chat:"Chat",AI:"AI","Performance first":"Performance first","Microscopic first load, big capability":"Microscopic first load, big capability","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.","- Ultra-thin home route with immutable caching":"- Ultra-thin home route with immutable caching","- Lazy feature routes for store, chat, and AI":"- Lazy feature routes for store, chat, and AI","- Optional Partytown for third-party isolation":"- Optional Partytown for third-party isolation","Latency budget":"Latency budget","Server render: sub-50ms target with streaming enabled":"Server render: sub-50ms target with streaming enabled","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny","Speculative nav: prerender store, prefetch chat":"Speculative nav: prerender store, prefetch chat","Sample adapter (offline)":"Sample adapter (offline)","Edge cache pack (offline)":"Edge cache pack (offline)","Invalid id.":"Invalid id.","Item not found.":"Item not found.","Unable to delete item right now.":"Unable to delete item right now.","Name and positive price required.":"Name and positive price required.","Unable to create item right now.":"Unable to create item right now.","Database offline: showing fallback inventory.":"Database offline: showing fallback inventory.","Unable to load inventory right now.":"Unable to load inventory right now.","Fast browsing with tiny payloads":"Fast browsing with tiny payloads",cached:"cached","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.",Inventory:"Inventory",Refresh:"Refresh","Showing fallback data while the database is unavailable.":"Showing fallback data while the database is unavailable.","Inventory loads once this section is visible.":"Inventory loads once this section is visible.","SKU $1":"SKU $1","Delete $1":"Delete $1",Delete:"Delete","No items yet.":"No items yet.","Load more":"Load more","Loading...":"Loading...","Add an item":"Add an item",Name:"Name","Lightweight widget":"Lightweight widget",Price:"Price","Saving...":"Saving...","Create item":"Create item","Added $1.":"Added $1.",Realtime:"Realtime","WebSocket chat via Valkey pub/sub":"WebSocket chat via Valkey pub/sub",websocket:"websocket","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.",Connected:"Connected","Connect to chat":"Connect to chat","No socket opened until you opt in.":"No socket opened until you opt in.","No messages yet.":"No messages yet.","Say something quick":"Say something quick",Send:"Send","AI tools":"AI tools","Edge-friendly utilities":"Edge-friendly utilities","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.","Type a quick prompt":"Type a quick prompt","Send to API":"Send to API","Response: $1":"Response: $1","Prometheus | Ultra-fast starter":"Prometheus | Ultra-fast starter","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey performance stack starter.","Store | Prometheus":"Store | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.","Chat | Prometheus":"Chat | Prometheus","WebSocket chat backed by Valkey pub/sub.":"WebSocket chat backed by Valkey pub/sub.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Minimal AI utility route hitting Bun API."};var Ai={locale:"en",name:Ni,translations:_i};const Li="한국어",Bi={"Performance Lab":"퍼포먼스 랩",Home:"홈",Store:"스토어",Chat:"채팅",AI:"AI","Performance first":"성능 우선","Microscopic first load, big capability":"초소형 첫 로드, 큰 역량","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR은 셸을 가볍게 유지합니다. 브라우저가 View Transitions와 Speculation Rules를 지원하면 탐색이 강화되고, 서드파티 스크립트는 메인 스레드를 벗어납니다.","- Ultra-thin home route with immutable caching":"- 초경량 홈 라우트와 불변 캐싱","- Lazy feature routes for store, chat, and AI":"- 스토어, 채팅, AI를 위한 지연 로드 기능 라우트","- Optional Partytown for third-party isolation":"- 서드파티 격리를 위한 Partytown 선택 옵션","Latency budget":"레이턴시 예산","Server render: sub-50ms target with streaming enabled":"서버 렌더링: 스트리밍 사용 시 50ms 미만 목표","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"크리티컬 CSS: UnoCSS + Lightning CSS로 페이로드를 최소화","Speculative nav: prerender store, prefetch chat":"추측 탐색: 스토어 프리렌더, 채팅 프리패치","Sample adapter (offline)":"샘플 어댑터(오프라인)","Edge cache pack (offline)":"엣지 캐시 팩(오프라인)","Invalid id.":"유효하지 않은 ID입니다.","Item not found.":"항목을 찾을 수 없습니다.","Unable to delete item right now.":"지금은 항목을 삭제할 수 없습니다.","Name and positive price required.":"이름과 양수 가격이 필요합니다.","Unable to create item right now.":"지금은 항목을 생성할 수 없습니다.","Database offline: showing fallback inventory.":"데이터베이스 오프라인: 대체 인벤토리를 표시합니다.","Unable to load inventory right now.":"지금은 인벤토리를 불러올 수 없습니다.","Fast browsing with tiny payloads":"초소형 페이로드로 빠른 탐색",cached:"캐시됨","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"항목은 Drizzle을 통해 Postgres에서 직접 스트리밍되며, 응답을 가볍게 유지하기 위해 커서 페이지네이션을 사용합니다. 데이터는 라우트가 보일 때만 깨어나 초기 페이로드를 극소화합니다.",Inventory:"인벤토리",Refresh:"새로고침","Showing fallback data while the database is unavailable.":"데이터베이스를 사용할 수 없어 대체 데이터를 표시합니다.","Inventory loads once this section is visible.":"이 섹션이 보일 때 인벤토리가 로드됩니다.","SKU $1":"SKU $1","Delete $1":"$1 삭제",Delete:"삭제","No items yet.":"아직 항목이 없습니다.","Load more":"더 불러오기","Loading...":"로딩 중...","Add an item":"항목 추가",Name:"이름","Lightweight widget":"경량 위젯",Price:"가격","Saving...":"저장 중...","Create item":"항목 만들기","Added $1.":"$1 추가됨.",Realtime:"실시간","WebSocket chat via Valkey pub/sub":"Valkey pub/sub 기반 WebSocket 채팅",websocket:"웹소켓","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"클라이언트는 홈 라우트를 극소화하기 위해 탐색 후에만 로드됩니다. 실시간이 필요할 때까지 bfcache 자격을 유지하도록 필요 시 연결합니다. 메시지는 API의 Valkey 채널을 통해 브로드캐스트됩니다.",Connected:"연결됨","Connect to chat":"채팅에 연결","No socket opened until you opt in.":"동의하기 전에는 소켓을 열지 않습니다.","No messages yet.":"메시지가 아직 없습니다.","Say something quick":"간단히 입력하세요",Send:"보내기","AI tools":"AI 도구","Edge-friendly utilities":"엣지 친화적 유틸리티","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"이 라우트는 상호작용을 단순하게 유지합니다. 추가 클라이언트 번들을 보내지 않고 Bun + Elysia를 테스트하는 왕복 에코 API입니다.","Type a quick prompt":"간단한 프롬프트를 입력하세요","Send to API":"API로 보내기","Response: $1":"응답: $1","Prometheus | Ultra-fast starter":"Prometheus | 초고속 스타터","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey 성능 스택 스타터.","Store | Prometheus":"스토어 | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle 기반 스토어로 Postgres에서 커서 페이지네이션과 지연 로드를 사용해 불러옵니다.","Chat | Prometheus":"채팅 | Prometheus","WebSocket chat backed by Valkey pub/sub.":"Valkey pub/sub 기반 WebSocket 채팅.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Bun API를 호출하는 최소 AI 유틸리티 라우트."};var qi={locale:"ko",fallback:"en",name:Li,translations:Bi},Qi={en:Ai,ko:qi},Ii=(e,t,r)=>{let i,s;do i=Qi[e],s=i.translations[t];while(!s&&(e=i.fallback));return s||(s=t),Ti(s,r)},ki=(e,...t)=>Ii(tr(),typeof e=="string"?e:Ci(e),t),y=ki,ct=e=>{if(!e)return;const t=e.trim();if(!t)return;const r=t.replace(/_/g,"-").toLowerCase(),i=r==="kr"?"ko":r,s=ut.find(o=>o.toLowerCase()===i);if(s)return s;const n=i.split("-")[0];if(n)return ut.find(o=>o.toLowerCase()===n)},Di=e=>{if(!e)return;const t=e.split(",");for(const r of t){const i=r.split(";")[0],s=ct(i);if(s)return s}};const wt=({queryLocale:e,cookieLocale:t,acceptLanguage:r})=>ct(e)||ct(t)||Di(r)||Xe;var ji=ye({onRequest:()=>Oi},1);const Oi=({query:e,cookie:t,headers:r,locale:i})=>{const s=wt({queryLocale:e.get("locale"),cookieLocale:t.get("locale")?.value,acceptLanguage:r.get("accept-language")});e.has("locale")&&(t.delete("locale"),t.set("locale",s,{})),i(s)};var zi=new Set(["style","font"]);const Fi=(e,t,r)=>{const i=new Set;return Array.from(e??[]).filter(s=>{if(s.rel!=="preload")return!0;if(t)return!1;const n=s.href,o=s.as;return typeof n!="string"||n.trim().length===0||r&&!r.has(n)||typeof o!="string"||!zi.has(o)||i.has(n)?!1:(i.add(n),!0)})};var Vi=[];const Ei=(e,t)=>[];var Ri=e=>typeof e=="string"&&e.trim().length>0;const Mi=new Set(Vi.flatMap(({links:e})=>e.map(t=>t.href)).filter(Ri));var Ui=(e,t)=>e===void 0?t:typeof e=="boolean"?e:e==="1"||e.toLowerCase()==="true",st=(e,t)=>Ui(e,t&&!0);const Ae={speculationRules:st(void 0,!0),viewTransitions:st(void 0,!0),partytown:st(void 0,!0)};var Ji=async e=>{const[t,r,i]=ue();if(r||e.defaultPrevented||e.button!==0||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return;if(e.preventDefault(),typeof document>"u"){await i(t);return}const s=document,n=Ae.viewTransitions?s.startViewTransition:void 0;if(n){n.call(s,()=>i(t))?.finished.catch(()=>{});return}await i(t)},Ki=()=>{const e=bt(),t=fi(),r=wt({queryLocale:e.url.searchParams.get("locale"),cookieLocale:typeof document<"u"?document.cookie.split(";").map(s=>s.trim()).find(s=>s.startsWith("locale="))?.split("=")[1]:void 0,acceptLanguage:typeof navigator<"u"?navigator.languages?.join(",")||navigator.language:void 0}),i=s=>{const n=new URLSearchParams(e.url.search);n.set("locale",s);const o=n.toString();return`${e.url.pathname}${o?`?${o}`:""}`};return m("div",null,{class:"flex items-center gap-1 text-xs"},ut.map(s=>{const n=s===r,o=i(s);return m("a",{href:o,"aria-disabled":n,style:n?{viewTransitionName:"locale-pill"}:void 0,class:["rounded-full border px-2 py-1 transition-colors",n?"border-emerald-500/40 bg-emerald-500/10 text-emerald-200 pointer-events-none":"border-slate-700 text-slate-300 hover:text-emerald-200 hover:border-emerald-500/40"].join(" "),onClick$:_(Ji,"s_CskzXQBKCjQ",[o,n,t])},null,vt[s]??s.toUpperCase(),0,s)}),1,"mU_0")};const Wi=H(_(Ki,"s_00eYrYyi6VA"));var nt=e=>{const t=typeof import.meta<"u"&&{BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!0}[e];if(t!==void 0)return t;if(typeof process<"u")return process.env?.[e]??process.env?.[e.replace(/^VITE_/,"")]},Y={gaId:nt("VITE_GTAG_ID"),adsClient:nt("VITE_ADSENSE_CLIENT"),supportWidgetSrc:nt("VITE_SUPPORT_WIDGET_SRC")},rr=[{id:"gtag",label:"Google Analytics 4",category:"analytics",src:Y.gaId?`https://www.googletagmanager.com/gtag/js?id=${Y.gaId}`:void 0,inline:Y.gaId?`window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', '${Y.gaId}', { transport_type: 'beacon', send_page_view: true });`:void 0,forward:["dataLayer.push","gtag"],attributes:{async:!0,"data-gtm-id":Y.gaId},budgetKb:90,load:"defer",partytown:!0,fallback:"Falls back to async tag when Partytown is disabled.",when:!!Y.gaId},{id:"adsense",label:"Google AdSense",category:"ads",src:Y.adsClient?`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${Y.adsClient}`:void 0,forward:["adsbygoogle.push"],attributes:{async:!0,"data-ad-client":Y.adsClient,crossOrigin:"anonymous"},budgetKb:95,load:"idle",partytown:!0,fallback:"Loads on idle/timeout when Partytown is off to avoid blocking hydration.",when:!!Y.adsClient},{id:"support-widget",label:"Support chat widget",category:"widget",src:Y.supportWidgetSrc,budgetKb:120,load:"interaction",partytown:!1,fallback:"Injected after user input, idle callback, or 5s timeout.",when:!!Y.supportWidgetSrc}];const Me=rr.filter(e=>e.when),Dl=Array.from(new Set(rr.flatMap(e=>e.forward??[])));var Hi=(e,t)=>`(()=>{const url='${t}';let loaded=false;const load=()=>{if(loaded||!url)return;loaded=true;const s=document.createElement('script');s.src=url;s.async=true;s.dataset.thirdParty='${e}';document.body.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>events.forEach((event)=>window.removeEventListener(event,prime,opts));const events=['pointerdown','keydown','touchstart','focusin'];const opts={once:true,passive:true};events.forEach((event)=>window.addEventListener(event,prime,opts));if('requestIdleCallback'in window){requestIdleCallback(()=>prime(),{timeout:5000});}else{setTimeout(prime,5000);}setTimeout(load,8000);})();`,Gi=()=>{const e=Me.some(r=>r.partytown),t=Ae.partytown?Array.from(new Set(Me.flatMap(r=>r.forward??[]))):[];return Me.length?O(Je,{children:[Ae.partytown&&e&&m("script",{dangerouslySetInnerHTML:Si({lib:"/~partytown/",forward:t})},null,null,3,"dH_0"),Me.map(r=>{if(!r.src&&!r.inline)return null;const i=r.attributes??{};if(r.partytown&&Ae.partytown)return O(Je,{children:[r.src&&Pe("script",{type:"text/partytown",...i,get src(){return r.src},src:te(r,"src")},{type:de},0,"dH_1"),r.inline&&Pe("script",{type:"text/partytown",...i,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:te(r,"inline")},{type:de},0,"dH_2")]},1,r.id);if(r.load==="interaction"&&r.src)return m("script",{dangerouslySetInnerHTML:Hi(r.id,r.src)},null,null,3,`${r.id}-loader`);const s=r.load==="defer"?{defer:!0}:{async:!0};return O(Je,{children:[r.src&&Pe("script",{...i,...s,get src(){return r.src},src:te(r,"src")},null,0,"dH_3"),r.inline&&Pe("script",{...i,...s,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:te(r,"inline")},null,0,"dH_4")]},1,r.id)})]},1,"dH_5"):null};const Yi=H(_(Gi,"s_mLjU5QE56DA"));var Xi=".route-transition{view-transition-name:route;contain:paint}",Zi=`:root {
  color-scheme: light dark;
}

:root[data-theme='light'],
:root.light {
  color-scheme: light;
}

:root[data-theme='dark'],
:root.dark {
  color-scheme: dark;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background-color: #020617;
  color: #e2e8f0;
  min-height: 100vh;
}
`,es=ye({RouterHead:()=>nr,_auto_isNonEmptyString:()=>ir,_auto_speculationCandidates:()=>St,_auto_toSpeculationRules:()=>sr,default:()=>is},1),St=[{url:"/store",action:"prerender"},{url:"/chat",action:"prefetch"}],ir=e=>typeof e=="string"&&e.trim().length>0,sr=e=>{const t=St.filter(({url:r})=>r!==e).reduce((r,i)=>(r[i.action].push({source:"list",urls:[i.url]}),r),{prefetch:[],prerender:[]});return t.prefetch.length||t.prerender.length?t:null},ts=()=>{const e=yi(),t=bt(),r=Ae.speculationRules&&!0,i=r?sr(t.url.pathname):null,s=Ei(t.url.pathname,!1),n=new Set([...Mi,...s.map(c=>c.href).filter(ir)]),o=Fi([...e.links,...s],!1,n),l=!1,d=r&&i?`(()=>{try{if(navigator.connection?.saveData)return;if(!HTMLScriptElement.supports?.('speculationrules'))return;const payload=${JSON.stringify(i)};const script=document.createElement('script');script.type='speculationrules';script.textContent=JSON.stringify(payload);document.head.append(script);}catch{}})();`:void 0;return O(Je,{children:[m("title",null,null,e.title||"Prometheus",1,null),m("meta",null,{name:"viewport",content:"width=device-width, initial-scale=1, viewport-fit=cover"},null,3,null),m("link",null,{rel:"canonical",href:ne(c=>c.url.href,[t],"p0.url.href")},null,3,null),m("style",null,{"data-critical":!0,dangerouslySetInnerHTML:Zi},null,3,null),e.meta.map(c=>Pe("meta",{...c},null,0,c.key)),o.map(c=>Pe("link",{...c},null,0,c.key)),r&&St.filter(({url:c})=>c!==t.url.pathname).map(({url:c,action:p})=>m("link",{rel:p,href:c},null,null,3,`${p}:${c}`)),e.styles.map(c=>Pe("style",{...c.props,get dangerouslySetInnerHTML(){return c.style},dangerouslySetInnerHTML:te(c,"style")},null,0,c.key)),d&&m("script",{dangerouslySetInnerHTML:d},null,null,3,"qG_0"),Ae.viewTransitions&&m("script",null,{dangerouslySetInnerHTML:"if ('startViewTransition' in document) {document.documentElement.classList.add('supports-view-transition');}"},null,3,"qG_1"),O(Yi,null,3,"qG_2"),l]},1,"qG_4")};const nr=H(_(ts,"s_0ZAFccQi4aM"));var rs=()=>(Ve(_(Xi,"s_ovuN5RMiUy0")),m("div",null,{class:"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950"},[m("header",null,{class:"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/80 backdrop-blur"},m("nav",null,{class:"mx-auto flex max-w-5xl items-center justify-between px-4 py-3 text-sm font-medium"},[m("div",null,{class:"flex items-center gap-2"},[m("span",null,{class:"rounded-full bg-emerald-500/10 px-3 py-1 text-emerald-300"},"Prometheus",3,null),m("span",null,{class:"text-slate-400"},y`Performance Lab`,1,null)],1,null),m("div",null,{class:"flex items-center gap-4 text-slate-200"},[m("a",null,{href:"/",class:"hover:text-emerald-300 transition-colors"},y`Home`,1,null),m("a",null,{href:"/store","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors"},y`Store`,1,null),m("a",null,{href:"/chat","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors"},y`Chat`,1,null),m("a",null,{href:"/ai",class:"hover:text-emerald-300 transition-colors"},y`AI`,1,null),O(Wi,null,3,"qG_5")],1,null)],1,null),1,null),m("main",null,{class:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-10 route-transition"},O(Yt,null,3,"qG_6"),1,null)],1,"qG_7")),is=H(_(rs,"s_wqKL2Up903o")),ss=".home-grid{gap:1.5rem;display:grid}@media (width>=768px){.home-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}",ns=ye({default:()=>or,head:()=>lr,onGet:()=>ar},1);const ar=({cacheControl:e})=>{e({public:!0,maxAge:900})};var as=()=>(Ve(_(ss,"s_RIE80aAOC7Q")),m("section",null,{class:"home-grid"},[m("div",null,{class:"p-6 surface"},[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Performance first`,1,null),m("h1",null,{class:"mt-2 font-semibold text-slate-50 text-3xl"},y`Microscopic first load, big capability`,1,null),m("p",null,{class:"mt-4 text-slate-300"},y`Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.`,1,null),m("div",null,{class:"gap-3 grid mt-6 text-slate-200 text-sm"},[m("div",null,{class:"flex items-center gap-2"},y`- Ultra-thin home route with immutable caching`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Lazy feature routes for store, chat, and AI`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Optional Partytown for third-party isolation`,1,null)],1,null)],1,null),m("div",null,{class:"p-6 text-slate-200 text-sm surface"},[m("h2",null,{class:"font-semibold text-slate-50 text-lg"},y`Latency budget`,1,null),m("ul",null,{class:"space-y-2 mt-3"},[m("li",null,null,y`Server render: sub-50ms target with streaming enabled`,1,null),m("li",null,null,y`Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny`,1,null),m("li",null,null,y`Speculative nav: prerender store, prefetch chat`,1,null)],1,null)],1,null)],1,"FW_0")),or=H(_(as,"s_e7mxYERDQJw"));const lr=({withLocale:e})=>e(()=>({title:y`Prometheus | Ultra-fast starter`,meta:[{name:"description",content:y`Qwik City + Bun + Valkey performance stack starter.`}]}));var os=ye({default:()=>or,head:()=>lr,onGet:()=>ar},1),ls=".ai-island{margin-top:1rem}",us=async()=>{const[e,t]=ue();if(!e.value)return;const r=await fetch("/api/ai/echo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.value})});if(r.ok){const{echo:i}=await r.json();t.value=i}},cs=()=>{const e=M(""),t=M(""),r=_(us,"s_rGtr6P02y5w",[e,t]);return m("div",null,{class:"ai-island space-y-3 text-sm text-slate-200"},[m("textarea",null,{value:ne(i=>i.value,[e],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2",placeholder:y`Type a quick prompt`,rows:4,onInput$:re("s_YrRlW66gD5Y",[e])},null,3,null),m("div",null,{class:"flex items-center gap-2"},[m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:r},y`Send to API`,1,null),t.value&&m("span",null,{class:"text-emerald-300"},y`Response: ${t.value}`,1,"9W_0")],1,null)],1,"9W_1")};const ds=H(_(cs,"s_6AcQXlwaGPM"));var hs=ye({default:()=>ms,head:()=>ps},1),fs=()=>(Ve(_(ls,"s_S5uQY9BGXbM")),m("section",null,{class:"surface p-6"},[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`AI tools`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`Edge-friendly utilities`,1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.`,1,null),m("div",null,{onQVisible$:re("s_08qeP0eGH6U")},O(ds,null,3,"gn_0"),1,null)],1,"gn_1")),ms=H(_(fs,"s_X8xIQqUjebE"));const ps=({withLocale:e})=>e(()=>({title:y`AI | Prometheus`,meta:[{name:"description",content:y`Minimal AI utility route hitting Bun API.`}]}));var gs=".chat-island{margin-top:1.25rem}.chat-messages{max-height:16rem}",ys=({cleanup:e})=>{const[t,r,i]=ue()},bs=()=>{const[e,t]=ue();!e.value||!t.value||(t.value.send(JSON.stringify({type:"chat",text:e.value})),e.value="")},vs=()=>{const e=M([]),t=M(null),r=M(""),i=M(!1);Ue(_(ys,"s_QOX90pOt9sA",[e,i,t]),{eagerness:"visible"});const s=_(bs,"s_0P85XrqKCfY",[r,t]);return m("div",null,{class:"chat-island"},[m("div",null,{class:"mt-4 flex items-center gap-3"},[m("button",null,{type:"button",class:"rounded-lg bg-slate-800 px-3 py-2 text-sm text-slate-100 ring-1 ring-slate-700 transition hover:bg-slate-700",disabled:ne(n=>n.value,[i],"p0.value"),onClick$:re("s_DoKYoyvM41g",[i])},i.value?y`Connected`:y`Connect to chat`,1,null),!i.value&&m("span",null,{class:"text-xs text-slate-400"},y`No socket opened until you opt in.`,1,"Ki_0")],1,null),m("div",null,{class:"mt-5 space-y-3 text-sm text-slate-200"},[m("div",null,{class:"surface chat-messages overflow-auto p-4"},[e.value.length===0&&m("p",null,{class:"text-slate-500"},y`No messages yet.`,1,"Ki_1"),e.value.map(n=>m("div",null,{class:"py-1"},[m("span",null,{class:"text-slate-400"},[te(n,"from"),":"],1,null)," ",m("span",null,null,te(n,"text"),1,null)],1,n.id))],1,null),m("div",null,{class:"flex gap-2"},[m("input",null,{value:ne(n=>n.value,[r],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100",placeholder:y`Say something quick`,onInput$:re("s_hgk47q7YSmg",[r])},null,3,null),m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:s},y`Send`,1,null)],1,null)],1,null)],1,"Ki_2")};const ws=H(_(vs,"s_54i2tFOIwmo"));var Ss=ye({default:()=>xs,head:()=>$s},1),Ps=()=>(Ve(_(gs,"s_hNgJ6QruKFA")),m("section",null,{class:"surface p-6"},[m("div",null,{class:"flex items-center justify-between gap-2"},[m("div",null,null,[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`Realtime`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`WebSocket chat via Valkey pub/sub`,1,null)],1,null),m("span",null,{class:"rounded-full bg-slate-800 px-3 py-1 text-xs text-slate-200"},y`websocket`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.`,1,null),m("div",null,{onQVisible$:re("s_ELa2ERJwGkM")},O(ws,null,3,"TX_0"),1,null)],1,"TX_1")),xs=H(_(Ps,"s_uFxaifyy6KQ"));const $s=({withLocale:e})=>e(()=>({title:y`Chat | Prometheus`,meta:[{name:"description",content:y`WebSocket chat backed by Valkey pub/sub.`}]}));var Pt=Symbol.for("drizzle:OriginalColumn"),u=Symbol.for("drizzle:entityKind"),jl=Symbol.for("drizzle:hasOwnEntityKind");function h(e,t){if(!e||typeof e!="object")return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,u))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(e).constructor;if(r)for(;r;){if(u in r&&r[u]===t[u])return!0;r=Object.getPrototypeOf(r)}return!1}var L=class{static[u]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;length;isLengthExact;isAlias;config;table;onInit(){}constructor(e,t){this.config=t,this.onInit(),this.table=e,this.name=t.name,this.isAlias=!1,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity,this.length=t.length,this.isLengthExact=t.isLengthExact}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}[Pt](){return this}},Ts=class{static[u]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}},fe=Symbol.for("drizzle:Name"),Cs=class{static[u]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{const{name:r,columns:i,foreignColumns:s}=e();return{name:r,columns:i,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Ns(e,this)}},Ns=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[u]="PgForeignKey";reference;onUpdate;onDelete;name;getName(){const{name:e,columns:t,foreignColumns:r}=this.reference(),i=t.map(o=>o.name),s=r.map(o=>o.name),n=[this.table[fe],...i,r[0].table[fe],...s];return e??`${n.join("_")}_fk`}isNameExplicit(){return!!this.reference().name}};function _s(e,...t){return e(...t)}function qt(e,t,r){for(let i=t;i<e.length;i++){const s=e[i];if(s==="\\"){i++;continue}if(s==='"')return[e.slice(t,i).replace(/\\/g,""),i+1];if(!r&&(s===","||s==="}"))return[e.slice(t,i).replace(/\\/g,""),i]}return[e.slice(t).replace(/\\/g,""),e.length]}function ur(e,t=0){const r=[];let i=t,s=!1;for(;i<e.length;){const n=e[i];if(n===","){(s||i===t)&&r.push(""),s=!0,i++;continue}if(s=!1,n==="\\"){i+=2;continue}if(n==='"'){const[d,c]=qt(e,i+1,!0);r.push(d),i=c;continue}if(n==="}")return[r,i+1];if(n==="{"){const[d,c]=ur(e,i+1);r.push(d),i=c;continue}const[o,l]=qt(e,i,!1);r.push(o),i=l}return[r,i]}function Qt(e){const[t]=ur(e,1);return t}function cr(e){return`{${e.map(t=>Array.isArray(t)?cr(t):typeof t=="string"?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}var T=class extends Ts{foreignKeyConfigs=[];static[u]="PgColumnBuilder";array(e){return new Ls(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,config:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,config:i})=>_s((s,n)=>{const o=new Cs(()=>{const l=s();return{name:n.name,columns:[e],foreignColumns:[l]}});return n.onUpdate&&o.onUpdate(n.onUpdate),n.onDelete&&o.onDelete(n.onDelete),o.build(t)},r,i))}buildExtraConfigColumn(e){return new As(e,this.config)}},S=class extends L{static[u]="PgColumn";table;constructor(e,t){super(e,t),this.table=e}},As=class extends S{static[u]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Ol=class{static[u]="IndexedColumn";constructor(e,t,r,i){this.name=e,this.keyAsName=t,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},Ls=class extends T{static[u]="PgArrayBuilder";constructor(e,t,r){super(e,"array basecolumn","PgArray"),this.config.baseBuilder=t,this.config.length=r}build(e){const t=this.config.baseBuilder.build(e);return new dr(e,this.config,t)}},dr=class hr extends S{constructor(t,r,i,s){super(t,r),this.baseColumn=i,this.range=s}static[u]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.length=="number"?this.length:""}]`}mapFromDriverValue(t){return typeof t=="string"&&(t=Qt(t)),t.map(r=>this.baseColumn.mapFromDriverValue(r))}mapFromJsonValue(t){typeof t=="string"&&(t=Qt(t));const r=this.baseColumn;return"mapFromJsonValue"in r?t.map(i=>r.mapFromJsonValue(i)):t.map(i=>r.mapFromDriverValue(i))}mapToDriverValue(t,r=!1){const i=t.map(s=>s===null?null:h(this.baseColumn,hr)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return r?i:cr(i)}},zl=class extends T{static[u]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumObjectColumn"),this.config.enum=t}build(e){return new Bs(e,this.config)}},Bs=class extends S{static[u]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},It=Symbol.for("drizzle:isPgEnum");function qs(e){return!!e&&typeof e=="function"&&It in e&&e[It]===!0}var Fl=class extends T{static[u]="PgEnumColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumColumn"),this.config.enum=t}build(e){return new Qs(e,this.config)}},Qs=class extends S{static[u]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},V=class{static[u]="Subquery";constructor(e,t,r,i=!1,s=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:i,usedTables:s}}},fr=class extends V{static[u]="WithSubquery"},B={startActiveSpan(e,t){return t()}},q=Symbol.for("drizzle:ViewBaseConfig"),oe=Symbol.for("drizzle:Schema"),pe=Symbol.for("drizzle:Columns"),kt=Symbol.for("drizzle:ExtraConfigColumns"),De=Symbol.for("drizzle:OriginalName"),at=Symbol.for("drizzle:BaseName"),Be=Symbol.for("drizzle:IsAlias"),Dt=Symbol.for("drizzle:ExtraConfigBuilder"),Is=Symbol.for("drizzle:IsDrizzleTable"),b=class{static[u]="Table";static Symbol={Name:fe,Schema:oe,OriginalName:De,Columns:pe,ExtraConfigColumns:kt,BaseName:at,IsAlias:Be,ExtraConfigBuilder:Dt};[fe];[De];[oe];[pe];[kt];[at];[Be]=!1;[Is]=!0;[Dt]=void 0;constructor(e,t,r){this[fe]=this[De]=e,this[oe]=t,this[at]=r}};function ae(e){return e[fe]}function ze(e){return`${e[oe]??"public"}.${e[fe]}`}var Vl=class{static[u]="FakePrimitiveParam"};function xt(e){return e!=null&&typeof e.getSQL=="function"}function ks(e){const t={sql:"",params:[]};for(const r of e)t.sql+=r.sql,t.params.push(...r.params),r.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}var F=class{static[u]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new v([this])}},v=class Ie{constructor(t){this.queryChunks=t;for(const r of t)if(h(r,b)){const i=r[b.Symbol.Schema];this.usedTables.push(i===void 0?r[b.Symbol.Name]:i+"."+r[b.Symbol.Name])}}static[u]="SQL";decoder=$t;shouldInlineParams=!1;usedTables=[];append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return B.startActiveSpan("drizzle.buildSQL",r=>{const i=this.buildQueryFromSourceParams(this.queryChunks,t);return r?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(t,r){const i=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:s,escapeName:n,escapeParam:o,prepareTyping:l,inlineParams:d,paramStartIndex:c,invokeSource:p}=i;return ks(t.map(f=>{if(h(f,F))return{sql:f.value.join(""),params:[]};if(h(f,dt))return{sql:n(f.value),params:[]};if(f===void 0)return{sql:"",params:[]};if(Array.isArray(f)){const g=[new F("(")];for(const[w,$]of f.entries())g.push($),w<f.length-1&&g.push(new F(", "));return g.push(new F(")")),this.buildQueryFromSourceParams(g,i)}if(h(f,Ie))return this.buildQueryFromSourceParams(f.queryChunks,{...i,inlineParams:d||f.shouldInlineParams});if(h(f,b)){const g=f[b.Symbol.Schema],w=f[b.Symbol.Name];return p==="mssql-view-with-schemabinding"?{sql:n(g===void 0?"dbo":g)+"."+n(w),params:[]}:{sql:g===void 0||f[Be]?n(w):n(g)+"."+n(w),params:[]}}if(h(f,L)){const g=s.getColumnCasing(f);if(r.invokeSource==="indexes")return{sql:n(g),params:[]};const w=p==="mssql-check"?void 0:f.table[b.Symbol.Schema];return{sql:f.isAlias?n(f.name):f.table[Be]||w===void 0?n(f.table[b.Symbol.Name])+"."+n(g):n(w)+"."+n(f.table[b.Symbol.Name])+"."+n(g),params:[]}}if(h(f,be)){const g=f[q].schema,w=f[q].name;return{sql:g===void 0||f[q].isAlias?n(w):n(g)+"."+n(w),params:[]}}if(h(f,ge)){if(h(f.value,$e))return{sql:o(c.value++,f),params:[f],typings:["none"]};const g=f.value===null?null:f.encoder.mapToDriverValue(f.value);if(h(g,Ie))return this.buildQueryFromSourceParams([g],i);if(d)return{sql:this.mapInlineParam(g,i),params:[]};let w=["none"];return l&&(w=[l(f.encoder)]),{sql:o(c.value++,g),params:[g],typings:w}}return h(f,$e)?{sql:o(c.value++,f),params:[f],typings:["none"]}:h(f,Ie.Aliased)&&f.fieldAlias!==void 0?{sql:n(f.fieldAlias),params:[]}:h(f,V)?f._.isWith?{sql:n(f._.alias),params:[]}:this.buildQueryFromSourceParams([new F("("),f._.sql,new F(") "),new dt(f._.alias)],i):qs(f)?f.schema?{sql:n(f.schema)+"."+n(f.enumName),params:[]}:{sql:n(f.enumName),params:[]}:xt(f)?f.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([f.getSQL()],i):this.buildQueryFromSourceParams([new F("("),f.getSQL(),new F(")")],i):d?{sql:this.mapInlineParam(f,i),params:[]}:{sql:o(c.value++,f),params:[f],typings:["none"]}}))}mapInlineParam(t,{escapeString:r}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(typeof t=="string")return r(t);if(typeof t=="object"){const i=t.toString();return r(i==="[object Object]"?JSON.stringify(t):i)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new Ie.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}},dt=class{constructor(e){this.value=e}static[u]="Name";brand;getSQL(){return new v([this])}};function Ds(e){return typeof e=="object"&&e!==null&&"mapToDriverValue"in e&&typeof e.mapToDriverValue=="function"}var $t={mapFromDriverValue:e=>e},mr={mapToDriverValue:e=>e},El={...$t,...mr},ge=class{constructor(e,t=mr){this.value=e,this.encoder=t}static[u]="Param";brand;getSQL(){return new v([this])}};function a(e,...t){const r=[];(t.length>0||e.length>0&&e[0]!=="")&&r.push(new F(e[0]));for(const[i,s]of t.entries())r.push(s,new F(e[i+1]));return new v(r)}(e=>{function t(){return new v([])}e.empty=t;function r(d){return new v(d)}e.fromList=r;function i(d){return new v([new F(d)])}e.raw=i;function s(d,c){const p=[];for(const[f,g]of d.entries())f>0&&c!==void 0&&p.push(c),p.push(g);return new v(p)}e.join=s;function n(d){return new dt(d)}e.identifier=n;function o(d){return new $e(d)}e.placeholder=o;function l(d,c){return new ge(d,c)}e.param=l})(a||(a={}));(e=>{class t{constructor(i,s){this.sql=i,this.fieldAlias=s}static[u]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new t(this.sql,this.fieldAlias)}}e.Aliased=t})(v||(v={}));var $e=class{constructor(e){this.name=e}static[u]="Placeholder";getSQL(){return new v([this])}};function ot(e,t){return e.map(r=>{if(h(r,$e)){if(!(r.name in t))throw new Error(`No value for placeholder "${r.name}" was provided`);return t[r.name]}if(h(r,ge)&&h(r.value,$e)){if(!(r.value.name in t))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(t[r.value.name])}return r})}var js=Symbol.for("drizzle:IsDrizzleView"),be=class{static[u]="View";[q];[js]=!0;get[fe](){return this[q].name}get[oe](){return this[q].schema}get[Be](){return this[q].isAlias}get[De](){return this[q].originalName}get[pe](){return this[q].selectedFields}constructor({name:e,schema:t,selectedFields:r,query:i}){this[q]={name:e,originalName:e,schema:t,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}};L.prototype.getSQL=function(){return new v([this])};V.prototype.getSQL=function(){return new v([this])};var Ge=class{constructor(e,t){this.table=e,this.ignoreColumnAlias=t}static[u]="ColumnTableAliasProxyHandler";get(e,t){return t==="table"?this.table:t==="isAlias"&&this.ignoreColumnAlias?!1:e[t]}},Tt=class{constructor(e,t,r){this.alias=e,this.replaceOriginalName=t,this.ignoreColumnAlias=r}static[u]="TableAliasProxyHandler";get(e,t){if(t===b.Symbol.IsAlias)return!0;if(t===b.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===b.Symbol.OriginalName)return this.alias;if(t===q)return{...e[q],name:this.alias,isAlias:!0};if(t===b.Symbol.Columns){const i=e[b.Symbol.Columns];if(!i)return i;const s={};return Object.keys(i).map(n=>{s[n]=new Proxy(i[n],new Ge(new Proxy(e,this),this.ignoreColumnAlias))}),s}const r=e[t];return h(r,L)?new Proxy(r,new Ge(new Proxy(e,this),this.ignoreColumnAlias)):r}},Os=class{constructor(e){this.alias=e}static[u]="ColumnAliasProxyHandler";get(e,t){return t==="isAlias"?!0:t==="name"?this.alias:t==="keyAsName"?!1:t===Pt?()=>e:e[t]}},Rl=class{constructor(e){this.alias=e}static[u]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?se(e.sourceTable,this.alias):e[t]}};function se(e,t){return new Proxy(e,new Tt(t,!1,!1))}function zs(e,t){return new Proxy(e,new Os(t))}function ie(e,t){return new Proxy(e,new Ge(new Proxy(e.table,new Tt(t,!1,!1)),!1))}function pr(e,t){return new v.Aliased(Ye(e.sql,t),e.fieldAlias)}function Ye(e,t){return a.join(e.queryChunks.map(r=>h(r,L)?ie(r,t):h(r,v)?Ye(r,t):h(r,v.Aliased)?pr(r,t):r))}L.prototype.as=function(e){return zs(this,e)};function jt(e){return e[Pt]()}var je=class extends Error{static[u]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Ce=class gr extends Error{constructor(t,r,i){super(`Failed query: ${t}
params: ${r}`),this.query=t,this.params=r,this.cause=i,Error.captureStackTrace(this,gr),i&&(this.cause=i)}static[u]="DrizzleQueryError"},Fs=class extends je{static[u]="TransactionRollbackError";constructor(){super({message:"Rollback"})}},Vs=class{static[u]="ConsoleLogWriter";write(e){console.log(e)}},Es=class{static[u]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Vs}logQuery(e,t){const r=t.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},Rs=class{static[u]="NoopLogger";logQuery(){}},ve=class{static[u]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};function Q(e,t){return Ds(t)&&!xt(e)&&!h(e,ge)&&!h(e,$e)&&!h(e,L)&&!h(e,b)&&!h(e,be)?new ge(e,t):e}var me=(e,t)=>a`${e} = ${Q(t,e)}`,yr=(e,t)=>a`${e} <> ${Q(t,e)}`;function W(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new v(t):new v([new F("("),a.join(t,new F(" and ")),new F(")")])}function Ze(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new v(t):new v([new F("("),a.join(t,new F(" or ")),new F(")")])}function et(e){return a`not ${e}`}var tt=(e,t)=>a`${e} > ${Q(t,e)}`,br=(e,t)=>a`${e} >= ${Q(t,e)}`,vr=(e,t)=>a`${e} < ${Q(t,e)}`,wr=(e,t)=>a`${e} <= ${Q(t,e)}`;function Sr(e,t){return Array.isArray(t)?t.length===0?a`false`:a`${e} in ${t.map(r=>Q(r,e))}`:a`${e} in ${Q(t,e)}`}function Pr(e,t){return Array.isArray(t)?t.length===0?a`true`:a`${e} not in ${t.map(r=>Q(r,e))}`:a`${e} not in ${Q(t,e)}`}function xr(e){return a`(${e} is null)`}function $r(e){return a`(${e} is not null)`}function Ct(e){return a`exists ${e}`}function Nt(e){return a`not exists ${e}`}function Tr(e,t,r){return a`${e} between ${Q(t,e)} and ${Q(r,e)}`}function Cr(e,t,r){return a`${e} not between ${Q(t,e)} and ${Q(r,e)}`}function Nr(e,t){return a`${e} like ${t}`}function _r(e,t){return a`${e} not like ${t}`}function Ar(e,t){return a`${e} ilike ${t}`}function Lr(e,t){return a`${e} not ilike ${t}`}function Ms(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContains requires at least one value");return a`${e} @> ${a`${Q(t,e)}`}`}return a`${e} @> ${Q(t,e)}`}function Us(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContained requires at least one value");return a`${e} <@ ${a`${Q(t,e)}`}`}return a`${e} <@ ${Q(t,e)}`}function Js(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayOverlaps requires at least one value");return a`${e} && ${a`${Q(t,e)}`}`}return a`${e} && ${Q(t,e)}`}function Oe(e){return a`${e} asc`}function _t(e){return a`${e} desc`}var Br=class{constructor(e,t){this.targetTableName=t,this.targetTable=e}static[u]="RelationV2";fieldName;sourceColumns;targetColumns;alias;where;sourceTable;targetTable;through;throughTable;isReversed;sourceColumnTableNames=[];targetColumnTableNames=[]},qr=class extends Br{static[u]="OneV2";relationType="one";optional;constructor(e,t,r,i){super(t,r),this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)}),this.optional=i?.optional??!0}},Ks=class extends Br{constructor(e,t,r,i){super(t,r),this.config=i,this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)})}static[u]="ManyV2";relationType="many"},Ws=class{static[u]="AggregatedField";table;onTable(e){return this.table=e,this}},Hs=class extends Ws{static[u]="AggregatedFieldCount";query;getSQL(){if(!this.query){if(!this.table)throw new Error("Table must be set before building aggregate field");this.query=a`select count(*) as ${a.identifier("r")} from ${Le(this.table)}`.mapWith(Number)}return this.query}},_e={and:W,between:Tr,eq:me,exists:Ct,gt:tt,gte:br,ilike:Ar,inArray:Sr,arrayContains:Ms,arrayContained:Us,arrayOverlaps:Js,isNull:xr,isNotNull:$r,like:Nr,lt:vr,lte:wr,ne:yr,not:et,notBetween:Cr,notExists:Nt,notLike:_r,notIlike:Lr,notInArray:Pr,or:Ze,sql:a},Gs={sql:a,asc:Oe,desc:_t};function ht(e,t,r=o=>o,i=!1,s=!1,n){for(const o of t){if(o.selection){const p=`${n?`${n}.`:""}${o.key}`;if(e[o.key]===null||i&&(e[o.key]=JSON.parse(e[o.key]),e[o.key]===null))continue;if(s&&typeof e[o.key]=="string"&&(e[o.key]=JSON.parse(e[o.key])),o.isArray){for(const f of e[o.key])ht(f,o.selection,r,!1,s,p);continue}ht(e[o.key],o.selection,r,!1,s,p);continue}const l=o.field,d=r(e[o.key]);if(d===null)continue;let c;h(l,L)?c=l:h(l,v)?c=l.decoder:h(l,v.Aliased)?c=l.sql.decoder:h(l,b)||h(l,be)?c=$t:c=l.getSQL().decoder,e[o.key]="mapFromJsonValue"in c?c.mapFromJsonValue(d):c.mapFromDriverValue(d)}return e}var Ml=class{static[u]="RelationsBuilderTable";_;constructor(e,t){this._={name:t,table:e}}},Ul=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r){this._={tableName:t,column:e,key:r}}through(e){return new Ys(this._.column,this._.tableName,this._.key,e)}},Ys=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r,i){this._={tableName:t,column:e,through:i,key:r}}},Jl=class{static[u]="RelationsHelperStatic";_;constructor(e){this._={tables:e};const t={},r={};for(const[i,s]of Object.entries(e))t[i]=n=>new qr(e,s,i,n),r[i]=n=>new Ks(e,s,i,n);this.one=t,this.many=r}one;many;aggs={count(){return new Hs}}};function Qr(e,t){const r=e[pe][t];return r?h(r,L)?r:h(r,v.Aliased)?a`${e}.${a.identifier(r.fieldAlias)}`:a`${e}.${a.identifier(t)}`:a`${e}.${a.identifier(t)}`}function We(e,t){if(typeof t!="object"||h(t,$e))return me(e,t);const r=Object.entries(t);if(!r.length)return;const i=[];for(const[s,n]of r)if(n!==void 0)switch(s){case"NOT":{const o=We(e,n);if(!o)continue;i.push(et(o));continue}case"OR":if(!n.length)continue;i.push(Ze(...n.map(o=>We(e,o))));continue;case"AND":if(!n.length)continue;i.push(W(...n.map(o=>We(e,o))));continue;case"isNotNull":case"isNull":if(!n)continue;i.push(_e[s](e));continue;case"in":i.push(_e.inArray(e,n));continue;case"notIn":i.push(_e.notInArray(e,n));continue;default:i.push(_e[s](e,n));continue}if(i.length)return W(...i)}function he(e,t,r={},i={},s,n=0){const o=Object.entries(t);if(!o.length)return;const l=[];for(const[d,c]of o)if(c!==void 0)switch(d){case"RAW":{const p=typeof c=="function"?c(e,_e):c.getSQL();l.push(p);continue}case"OR":if(!c?.length)continue;l.push(Ze(...c.map(p=>he(e,p,r,i,s,n))));continue;case"AND":if(!c?.length)continue;l.push(W(...c.map(p=>he(e,p,r,i,s,n))));continue;case"NOT":{if(c===void 0)continue;const p=he(e,c,r,i,s,n);if(!p)continue;l.push(et(p));continue}default:{if(e[pe][d]){const A=We(Qr(e,d),c);A&&l.push(A);continue}const p=r[d];if(!p)throw new je({message:`Unknown relational filter field: "${d}"`});const f=se(p.targetTable,`f${n}`),g=p.throughTable?se(p.throughTable,`ft${n}`):void 0,w=i[p.targetTableName],{filter:$,joinCondition:x}=Ir(s,p,e,f,g),N=W($,typeof c=="boolean"?void 0:he(f,c,w.relations,i,s,n+1)),k=g?a`(select * from ${Le(f)} inner join ${Le(g)} on ${x}${a` where ${N}`.if(N)} limit 1)`:a`(select * from ${Le(f)}${a` where ${N}`.if(N)} limit 1)`;N&&l.push((c?Ct:Nt)(k))}}return W(...l)}function Xs(e,t){if(typeof t=="function"){const i=t(e,Gs);return h(i,v)?i:Array.isArray(i)?i.length?a.join(i.map(s=>h(s,v)?s:Oe(s)),a`, `):void 0:h(i,L)?Oe(i):void 0}const r=Object.entries(t).filter(([i,s])=>s);if(r.length)return a.join(r.map(([i,s])=>(s==="asc"?Oe:_t)(Qr(e,i))),a`, `)}function Zs(e,t){const r=[],i=[];for(const[s,n]of Object.entries(t)){if(!n)continue;const o=typeof n=="function"?n(e,{sql:_e.sql}):n,l=a`(${o.getSQL()}) as ${a.identifier(s)}`;l.decoder=o.getSQL().decoder,r.push(l),i.push({key:s,field:l})}return{sql:r.length?a.join(r,a`, `):void 0,selection:i}}function Ir(e,t,r,i,s){if(t.through){const n=t.sourceColumns.map((l,d)=>{const c=t.through.source[d];return me(a`${r}.${a.identifier(e.getColumnCasing(l))}`,a`${s}.${a.identifier(h(c._.column,L)?e.getColumnCasing(c._.column):c._.key)}`)}),o=t.targetColumns.map((l,d)=>{const c=t.through.target[d];return me(a`${s}.${a.identifier(h(c._.column,L)?e.getColumnCasing(c._.column):c._.key)}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)});return{filter:W(t.where?he(t.isReversed?r:i,t.where):void 0,...n),joinCondition:W(...o)}}return{filter:W(...t.sourceColumns.map((n,o)=>{const l=t.targetColumns[o];return me(a`${r}.${a.identifier(e.getColumnCasing(n))}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)}),t.where?he(t.isReversed?r:i,t.where):void 0)}}function Le(e){return a`${e[Be]?a`${a`${a.identifier(e[oe]??"")}.`.if(e[oe])}${a.identifier(e[De])} as ${e}`:e}`}function en(e,t,r){const i={},s=e.reduce((n,{path:o,field:l},d)=>{let c;h(l,L)?c=l:h(l,v)?c=l.decoder:h(l,V)?c=l._.sql.decoder:c=l.sql.decoder;let p=n;for(const[f,g]of o.entries())if(f<o.length-1)g in p||(p[g]={}),p=p[g];else{const w=t[d],$=p[g]=w===null?null:c.mapFromDriverValue(w);if(r&&h(l,L)&&o.length===2){const x=o[0];x in i?typeof i[x]=="string"&&i[x]!==ae(l.table)&&(i[x]=!1):i[x]=$===null?ae(l.table):!1}}return n},{});if(r&&Object.keys(i).length>0)for(const[n,o]of Object.entries(i))typeof o=="string"&&!r[o]&&(s[n]=null);return s}function Te(e,t){return Object.entries(e).reduce((r,[i,s])=>{if(typeof i!="string")return r;const n=t?[...t,i]:[i];return h(s,L)||h(s,v)||h(s,v.Aliased)||h(s,V)?r.push({path:n,field:s}):h(s,b)?r.push(...Te(s[b.Symbol.Columns],n)):r.push(...Te(s,n)),r},[])}function At(e,t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const[s,n]of r.entries())if(n!==i[s])return!1;return!0}function kr(e,t){const r=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,s])=>h(s,v)||h(s,L)?[i,s]:[i,new ge(s,e[b.Symbol.Columns][i])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function tn(e,t){for(const r of t)for(const i of Object.getOwnPropertyNames(r.prototype))i!=="constructor"&&Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(r.prototype,i)||Object.create(null))}function rn(e){return e[b.Symbol.Columns]}function Se(e){return h(e,V)?e._.alias:h(e,be)?e[q].name:h(e,v)?void 0:e[b.Symbol.IsAlias]?e[b.Symbol.Name]:e[b.Symbol.BaseName]}function z(e,t){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:t}}var Kl=typeof TextDecoder>"u"?null:new TextDecoder,Ee=class extends T{static[u]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}},sn=class extends Ee{static[u]="PgBigInt53Builder";constructor(e){super(e,"number int53","PgBigInt53")}build(e){return new nn(e,this.config)}},nn=class extends S{static[u]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},an=class extends Ee{static[u]="PgBigInt64Builder";constructor(e){super(e,"bigint int64","PgBigInt64")}build(e){return new on(e,this.config)}},on=class extends S{static[u]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}},ln=class extends Ee{static[u]="PgBigIntStringBuilder";constructor(e){super(e,"string int64","PgBigIntString")}build(e){return new un(e,this.config)}},un=class extends S{static[u]="PgBigIntString";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}};function cn(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new sn(r):i.mode==="string"?new ln(r):new an(r)}var dn=class extends T{static[u]="PgBigSerial53Builder";constructor(e){super(e,"number int53","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new hn(e,this.config)}},hn=class extends S{static[u]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fn=class extends T{static[u]="PgBigSerial64Builder";constructor(e){super(e,"bigint int64","PgBigSerial64"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new mn(e,this.config)}},mn=class extends S{static[u]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function pn(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new dn(r):new fn(r)}var gn=class extends T{static[u]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new yn(e,this.config)}},yn=class extends S{static[u]="PgBoolean";getSQLType(){return"boolean"}};function bn(e){return new gn(e??"")}var vn=class extends T{static[u]="PgCharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgChar"),this.config.length=t.length??1,this.config.setLength=t.length!==void 0,this.config.enumValues=t.enum}build(e){return new wn(e,this.config)}},wn=class extends S{static[u]="PgChar";enumValues=this.config.enumValues;getSQLType(){return this.config.setLength?`char(${this.length})`:"char"}};function Sn(e,t={}){const{name:r,config:i}=z(e,t);return new vn(r,i)}var Pn=class extends T{static[u]="PgCidrBuilder";constructor(e){super(e,"string cidr","PgCidr")}build(e){return new xn(e,this.config)}},xn=class extends S{static[u]="PgCidr";getSQLType(){return"cidr"}};function $n(e){return new Pn(e??"")}var Tn=class extends T{static[u]="PgCustomColumnBuilder";constructor(e,t,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=r}build(e){return new Cn(e,this.config)}},Cn=class extends S{static[u]="PgCustomColumn";sqlName;mapTo;mapFrom;mapJson;forJsonSelect;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver,this.mapJson=t.customTypeParams.fromJson,this.forJsonSelect=t.customTypeParams.forJsonSelect}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapFromJsonValue(e){return typeof this.mapJson=="function"?this.mapJson(e):this.mapFromDriverValue(e)}jsonSelectIdentifier(e,t,r){if(typeof this.forJsonSelect=="function")return this.forJsonSelect(e,t,r);const i=this.getSQLType().toLowerCase(),s=i.indexOf("(");switch(s+1?i.slice(0,s):i){case"bytea":case"geometry":case"timestamp":case"numeric":case"bigint":{const n="[]".repeat(r??0);return t`${e}::text${t.raw(n).if(r)}`}default:return e}}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Nn(e){return(t,r)=>{const{name:i,config:s}=z(t,r);return new Tn(i,s,e)}}var Re=class extends T{static[u]="PgDateColumnBaseBuilder";defaultNow(){return this.default(a`now()`)}},_n=class extends Re{static[u]="PgDateBuilder";constructor(e){super(e,"object date","PgDate")}build(e){return new Dr(e,this.config)}},Dr=class extends S{static[u]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?new Date(e):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},An=class extends Re{static[u]="PgDateStringBuilder";constructor(e){super(e,"string date","PgDateString")}build(e){return new jr(e,this.config)}},jr=class extends S{static[u]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?e:e.toISOString().slice(0,-14)}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function Ln(e,t){const{name:r,config:i}=z(e,t);return i?.mode==="date"?new _n(r):new An(r)}var Bn=class extends T{static[u]="PgDoublePrecisionBuilder";constructor(e){super(e,"number double","PgDoublePrecision")}build(e){return new qn(e,this.config)}},qn=class extends S{static[u]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Qn(e){return new Bn(e??"")}var In=class extends T{static[u]="PgInetBuilder";constructor(e){super(e,"string inet","PgInet")}build(e){return new kn(e,this.config)}},kn=class extends S{static[u]="PgInet";getSQLType(){return"inet"}};function Dn(e){return new In(e??"")}var jn=class extends Ee{static[u]="PgIntegerBuilder";constructor(e){super(e,"number int32","PgInteger")}build(e){return new On(e,this.config)}},On=class extends S{static[u]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function zn(e){return new jn(e??"")}var Fn=class extends T{static[u]="PgIntervalBuilder";constructor(e,t){super(e,"string interval","PgInterval"),this.config.intervalConfig=t}build(e){return new Vn(e,this.config)}},Vn=class extends S{static[u]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){return`interval${this.fields?` ${this.fields}`:""}${this.precision?`(${this.precision})`:""}`}};function En(e,t={}){const{name:r,config:i}=z(e,t);return new Fn(r,i)}var Rn=class extends T{static[u]="PgJsonBuilder";constructor(e){super(e,"object json","PgJson")}build(e){return new Or(e,this.config)}},Or=class extends S{static[u]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Mn(e){return new Rn(e??"")}var Un=class extends T{static[u]="PgJsonbBuilder";constructor(e){super(e,"object json","PgJsonb")}build(e){return new zr(e,this.config)}},zr=class extends S{static[u]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Jn(e){return new Un(e??"")}var Kn=class extends T{static[u]="PgLineBuilder";constructor(e){super(e,"array line","PgLine")}build(e){return new Wn(e,this.config)}},Wn=class extends S{static[u]="PgLine";mode="tuple";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Hn=class extends T{static[u]="PgLineABCBuilder";constructor(e){super(e,"object line","PgLineABC")}build(e){return new Gn(e,this.config)}},Gn=class extends S{static[u]="PgLineABC";mode="abc";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Yn(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new Kn(r):new Hn(r)}var Xn=class extends T{static[u]="PgMacaddrBuilder";constructor(e){super(e,"string macaddr","PgMacaddr")}build(e){return new Zn(e,this.config)}},Zn=class extends S{static[u]="PgMacaddr";getSQLType(){return"macaddr"}};function ea(e){return new Xn(e??"")}var ta=class extends T{static[u]="PgMacaddr8Builder";constructor(e){super(e,"string macaddr8","PgMacaddr8")}build(e){return new ra(e,this.config)}},ra=class extends S{static[u]="PgMacaddr8";getSQLType(){return"macaddr8"}};function ia(e){return new ta(e??"")}var sa=class extends T{static[u]="PgNumericBuilder";constructor(e,t,r){super(e,"string numeric","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new Fr(e,this.config)}},Fr=class extends S{static[u]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},na=class extends T{static[u]="PgNumericNumberBuilder";constructor(e,t,r){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=r}build(e){return new aa(e,this.config)}},aa=class extends S{static[u]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},oa=class extends T{static[u]="PgNumericBigIntBuilder";constructor(e,t,r){super(e,"bigint int64","PgNumericBigInt"),this.config.precision=t,this.config.scale=r}build(e){return new la(e,this.config)}},la=class extends S{static[u]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function ua(e,t){const{name:r,config:i}=z(e,t),s=i?.mode;return s==="number"?new na(r,i?.precision,i?.scale):s==="bigint"?new oa(r,i?.precision,i?.scale):new sa(r,i?.precision,i?.scale)}var ca=class extends T{static[u]="PgPointTupleBuilder";constructor(e){super(e,"array point","PgPointTuple")}build(e){return new da(e,this.config)}},da=class extends S{static[u]="PgPointTuple";mode="tuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},ha=class extends T{static[u]="PgPointObjectBuilder";constructor(e){super(e,"object point","PgPointObject")}build(e){return new fa(e,this.config)}},fa=class extends S{static[u]="PgPointObject";mode="xy";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function ma(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new ca(r):new ha(r)}function pa(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(Number.parseInt(e.slice(r,r+2),16));return new Uint8Array(t)}function Ot(e,t){const r=new ArrayBuffer(8),i=new DataView(r);for(let s=0;s<8;s++)i.setUint8(s,e[t+s]);return i.getFloat64(0,!0)}function Vr(e){const t=pa(e);let r=0;const i=t[r];r+=1;const s=new DataView(t.buffer),n=s.getUint32(r,i===1);r+=4;let o;if(n&536870912&&(o=s.getUint32(r,i===1),r+=4),(n&65535)===1){const l=Ot(t,r);r+=8;const d=Ot(t,r);return r+=8,{srid:o,point:[l,d]}}throw new Error("Unsupported geometry type")}var ga=class extends T{static[u]="PgGeometryBuilder";constructor(e,t){super(e,"array geometry","PgGeometry"),this.config.srid=t}build(e){return new ya(e,this.config)}},ya=class extends S{static[u]="PgGeometry";srid=this.config.srid;mode="tuple";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){return typeof e!="string"?e:Vr(e).point}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},ba=class extends T{static[u]="PgGeometryObjectBuilder";constructor(e,t){super(e,"object geometry","PgGeometryObject"),this.config.srid=t}build(e){return new va(e,this.config)}},va=class extends S{static[u]="PgGeometryObject";srid=this.config.srid;mode="object";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){const t=Vr(e);return{x:t.point[0],y:t.point[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function wa(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new ga(r,i?.srid):new ba(r,i?.srid)}var Sa=class extends T{static[u]="PgRealBuilder";constructor(e,t){super(e,"number float","PgReal"),this.config.length=t}build(e){return new Pa(e,this.config)}},Pa=class extends S{static[u]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function xa(e){return new Sa(e??"")}var $a=class extends T{static[u]="PgSerialBuilder";constructor(e){super(e,"number int32","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Ta(e,this.config)}},Ta=class extends S{static[u]="PgSerial";getSQLType(){return"serial"}};function Ca(e){return new $a(e??"")}var Na=class extends Ee{static[u]="PgSmallIntBuilder";constructor(e){super(e,"number int16","PgSmallInt")}build(e){return new _a(e,this.config)}},_a=class extends S{static[u]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function Aa(e){return new Na(e??"")}var La=class extends T{static[u]="PgSmallSerialBuilder";constructor(e){super(e,"number int16","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Ba(e,this.config)}},Ba=class extends S{static[u]="PgSmallSerial";getSQLType(){return"smallserial"}};function qa(e){return new La(e??"")}var Qa=class extends T{static[u]="PgTextBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgText"),this.config.enumValues=t.enum}build(e){return new Ia(e,this.config,this.config.enumValues)}},Ia=class extends S{static[u]="PgText";enumValues;constructor(e,t,r){super(e,t),this.enumValues=r}getSQLType(){return"text"}};function ka(e,t={}){const{name:r,config:i}=z(e,t);return new Qa(r,i)}var Da=class extends Re{constructor(e,t,r){super(e,"string time","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}static[u]="PgTimeBuilder";build(e){return new Er(e,this.config)}},Er=class extends S{static[u]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function ja(e,t={}){const{name:r,config:i}=z(e,t);return new Da(r,i.withTimezone??!1,i.precision)}var Oa=class extends Re{static[u]="PgTimestampBuilder";constructor(e,t,r){super(e,"object date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Rr(e,this.config)}},Rr=class extends S{static[u]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){return typeof e=="string"?new Date(this.withTimezone?e:e+"+0000"):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},za=class extends Re{static[u]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string timestamp","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Mr(e,this.config)}},Mr=class extends S{static[u]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){if(typeof e=="string")return e;const t=e.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){const r=e.getTimezoneOffset();return`${t}${r<=0?"+":"-"}${Math.floor(Math.abs(r)/60).toString().padStart(2,"0")}`}return t}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function Fa(e,t={}){const{name:r,config:i}=z(e,t);return i?.mode==="string"?new za(r,i.withTimezone??!1,i.precision):new Oa(r,i?.withTimezone??!1,i?.precision)}var Va=class extends T{static[u]="PgUUIDBuilder";constructor(e){super(e,"string uuid","PgUUID")}defaultRandom(){return this.default(a`gen_random_uuid()`)}build(e){return new Ur(e,this.config)}},Ur=class extends S{static[u]="PgUUID";getSQLType(){return"uuid"}};function Ea(e){return new Va(e??"")}var Ra=class extends T{static[u]="PgVarcharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Ma(e,this.config)}},Ma=class extends S{static[u]="PgVarchar";enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function Ua(e,t={}){const{name:r,config:i}=z(e,t);return new Ra(r,i)}var Ja=class extends T{static[u]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string binary","PgBinaryVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new Ka(e,this.config)}},Ka=class extends S{static[u]="PgBinaryVector";getSQLType(){return`bit(${this.length})`}};function Wa(e,t){const{name:r,config:i}=z(e,t);return new Ja(r,i)}var Ha=class extends T{static[u]="PgHalfVectorBuilder";constructor(e,t){super(e,"array halfvector","PgHalfVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new Ga(e,this.config)}},Ga=class extends S{static[u]="PgHalfVector";getSQLType(){return`halfvec(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function Ya(e,t){const{name:r,config:i}=z(e,t);return new Ha(r,i)}var Xa=class extends T{static[u]="PgSparseVectorBuilder";constructor(e,t){super(e,"string sparsevec","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new Za(e,this.config)}},Za=class extends S{static[u]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function eo(e,t){const{name:r,config:i}=z(e,t);return new Xa(r,i)}var to=class extends T{static[u]="PgVectorBuilder";constructor(e,t){super(e,"array vector","PgVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new ro(e,this.config)}},ro=class extends S{static[u]="PgVector";getSQLType(){return`vector(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function io(e,t){const{name:r,config:i}=z(e,t);return new to(r,i)}function so(){return{bigint:cn,bigserial:pn,boolean:bn,char:Sn,cidr:$n,customType:Nn,date:Ln,doublePrecision:Qn,inet:Dn,integer:zn,interval:En,json:Mn,jsonb:Jn,line:Yn,macaddr:ea,macaddr8:ia,numeric:ua,point:ma,geometry:wa,real:xa,serial:Ca,smallint:Aa,smallserial:qa,text:ka,time:ja,timestamp:Fa,uuid:Ea,varchar:Ua,bit:Wa,halfvec:Ya,sparsevec:eo,vector:io}}var ft=Symbol.for("drizzle:PgInlineForeignKeys"),mt=Symbol.for("drizzle:EnableRLS"),R=class extends b{static[u]="PgTable";static Symbol=Object.assign({},b.Symbol,{InlineForeignKeys:ft,EnableRLS:mt});[ft]=[];[mt]=!1;[b.Symbol.ExtraConfigBuilder]=void 0;[b.Symbol.ExtraConfigColumns]={}};function Jr(e,t,r,i,s=e){const n=new R(e,i,s),o=typeof t=="function"?t(so()):t,l=Object.fromEntries(Object.entries(o).map(([p,f])=>{const g=f;g.setName(p);const w=g.build(n);return n[ft].push(...g.buildForeignKeys(w,n)),[p,w]})),d=Object.fromEntries(Object.entries(o).map(([p,f])=>{const g=f;return g.setName(p),[p,g.buildExtraConfigColumn(n)]})),c=Object.assign(n,l);return c[b.Symbol.Columns]=l,c[b.Symbol.ExtraConfigColumns]=d,r&&(c[R.Symbol.ExtraConfigBuilder]=r),Object.assign(c,{enableRLS:()=>(c[R.Symbol.EnableRLS]=!0,c)})}var no=(e,t,r)=>Jr(e,t,r,void 0),ao=(e,t,r)=>{const i=Jr(e,t,r,void 0);return i[mt]=!0,i},Wl=Object.assign(no,{withRLS:ao}),oo=class{static[u]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new lo(e,this.columns,this.name)}},lo=class{constructor(e,t,r){this.table=e,this.columns=t,this.name=r,this.isNameExplicit=!!r}static[u]="PgPrimaryKey";columns;name;isNameExplicit;getName(){return this.name??`${this.table[R.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}},Kr=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[b.Symbol.Name]}static[u]="Relation";referencedTableName;fieldName},uo=class{constructor(e,t){this.table=e,this.config=t}static[u]="Relations"},Fe=class Wr extends Kr{constructor(t,r,i,s){super(t,r,i?.relationName),this.config=i,this.isNullable=s}static[u]="One";withFieldName(t){const r=new Wr(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=t,r}},Hr=class Gr extends Kr{constructor(t,r,i){super(t,r,i?.relationName),this.config=i}static[u]="Many";withFieldName(t){const r=new Gr(this.sourceTable,this.referencedTable,this.config);return r.fieldName=t,r}};function co(){return{and:W,between:Tr,eq:me,exists:Ct,gt:tt,gte:br,ilike:Ar,inArray:Sr,isNull:xr,isNotNull:$r,like:Nr,lt:vr,lte:wr,ne:yr,not:et,notBetween:Cr,notExists:Nt,notLike:_r,notIlike:Lr,notInArray:Pr,or:Ze,sql:a}}function ho(){return{sql:a,asc:Oe,desc:_t}}function fo(e,t){Object.keys(e).length===1&&"default"in e&&!h(e.default,b)&&(e=e.default);const r={},i={},s={};for(const[n,o]of Object.entries(e))if(h(o,b)){const l=ze(o),d=i[l];r[l]=n,s[n]={tsName:n,dbName:o[b.Symbol.Name],schema:o[b.Symbol.Schema],columns:o[b.Symbol.Columns],relations:d?.relations??{},primaryKey:d?.primaryKey??[]};for(const p of Object.values(o[b.Symbol.Columns]))p.primary&&s[n].primaryKey.push(p);const c=o[b.Symbol.ExtraConfigBuilder]?.(o[b.Symbol.ExtraConfigColumns]);if(c)for(const p of Object.values(c))h(p,oo)&&s[n].primaryKey.push(...p.columns)}else if(h(o,uo)){const l=ze(o.table),d=r[l],c=o.config(t(o.table));for(const[p,f]of Object.entries(c))if(d){const g=s[d];g.relations[p]=f}else l in i||(i[l]={relations:{}}),i[l].relations[p]=f}return{tables:s,tableNamesMap:r}}function mo(e){return function(r,i){return new Fe(e,r,i,i?.fields.reduce((s,n)=>s&&n.notNull,!0)??!1)}}function po(e){return function(r,i){return new Hr(e,r,i)}}function go(e,t,r){if(h(r,Fe)&&r.config)return{fields:r.config.fields,references:r.config.references};const i=t[ze(r.referencedTable)];if(!i)throw new Error(`Table "${r.referencedTable[b.Symbol.Name]}" not found in schema`);const s=e[i];if(!s)throw new Error(`Table "${i}" not found in schema`);const n=r.sourceTable,o=t[ze(n)];if(!o)throw new Error(`Table "${n[b.Symbol.Name]}" not found in schema`);const l=[];for(const d of Object.values(s.relations))(r.relationName&&r!==d&&d.relationName===r.relationName||!r.relationName&&d.referencedTable===r.sourceTable)&&l.push(d);if(l.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${i}"`):new Error(`There are multiple relations between "${i}" and "${r.sourceTable[b.Symbol.Name]}". Please specify relation name`);if(l[0]&&h(l[0],Fe)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${r.fieldName}"`)}function yo(e){return{one:mo(e),many:po(e)}}function pt(e,t,r,i,s=n=>n){const n={};for(const[o,l]of i.entries())if(l.isJson){const d=t.relations[l.tsKey],c=r[o],p=typeof c=="string"?JSON.parse(c):c;n[l.tsKey]=h(d,Fe)?p&&pt(e,e[l.relationTableTsKey],p,l.selection,s):p.map(f=>pt(e,e[l.relationTableTsKey],f,l.selection,s))}else{const d=s(r[o]),c=l.field;let p;h(c,L)?p=c:h(c,v)?p=c.decoder:p=c.sql.decoder,n[l.tsKey]=d===null?null:p.mapFromDriverValue(d)}return n}var U=class Yr{static[u]="SelectionProxyHandler";config;constructor(t){this.config={...t}}get(t,r){if(r==="_")return{...t._,selectedFields:new Proxy(t._.selectedFields,this)};if(r===q)return{...t[q],selectedFields:new Proxy(t[q].selectedFields,this)};if(typeof r=="symbol")return t[r];const i=(h(t,V)?t._.selectedFields:h(t,be)?t[q].selectedFields:t)[r];if(h(i,v.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;const s=i.clone();return s.isSelectionField=!0,s}if(h(i,v)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return h(i,L)?this.config.alias?new Proxy(i,new Ge(new Proxy(i.table,new Tt(this.config.alias,this.config.replaceOriginalName??!1,!0)),!0)):i:typeof i!="object"||i===null?i:new Proxy(i,new Yr(this.config))}};function xe(e){return h(e,R)?[e[oe]?`${e[oe]}.${e[b.Symbol.BaseName]}`:e[b.Symbol.BaseName]]:h(e,V)?e._.usedTables??[]:h(e,v)?e.usedTables??[]:[]}var zt=class extends ve{constructor(e,t,r,i){super(),this.session=t,this.dialect=r,this.config={table:e,withList:i}}static[u]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Te(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:xe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function bo(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function vo(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,r,i)=>t+(i===0?r.toLowerCase():`${r[0].toUpperCase()}${r.slice(1)}`),"")}function wo(e){return e}var So=class{static[u]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?bo:e==="camelCase"?vo:wo}getColumnCasing(e){if(!e.keyAsName)return e.name;const t=`${e.table[b.Symbol.Schema]??"public"}.${e.table[b.Symbol.OriginalName]}.${e.name}`;return this.cache[t]||this.cacheTable(e.table),this.cache[t]}cacheTable(e){const t=`${e[b.Symbol.Schema]??"public"}.${e[b.Symbol.OriginalName]}`;if(!this.cachedTables[t]){for(const r of Object.values(e[b.Symbol.Columns])){if(!h(r,L))continue;const i=`${t}.${r.name}`;this.cache[i]=this.convert(r.name)}this.cachedTables[t]=!0}}clearCache(){this.cache={},this.cachedTables={}}},Xr=class extends be{static[u]="PgViewBase"},He=class{static[u]="PgDialect";casing;constructor(e){this.casing=new So(e?.casing)}async migrate(e,t,r){const i=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",s=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",n=a`
			CREATE TABLE IF NOT EXISTS ${a.identifier(s)}.${a.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(a`CREATE SCHEMA IF NOT EXISTS ${a.identifier(s)}`),await t.execute(n);const o=await t.all(a`select id, hash, created_at from ${a.identifier(s)}.${a.identifier(i)} order by created_at desc limit 1`);if(typeof r=="object"&&r.init){if(o.length)return{exitCode:"databaseMigrations"};if(e.length>1)return{exitCode:"localMigrations"};const[d]=e;if(!d)return;await t.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${d.hash}, ${d.folderMillis})`);return}const l=o[0];await t.transaction(async d=>{for await(const c of e)if(!l||Number(l.created_at)<c.folderMillis){for(const p of c.sql)await d.execute(a.raw(p));await d.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;const t=[a`with `];for(const[r,i]of e.entries())t.push(a`${a.identifier(i._.alias)} as (${i._.sql})`),r<e.length-1&&t.push(a`, `);return t.push(a` `),a.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:i}){const s=this.buildWithCTE(i),n=r?a` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0;return a`${s}delete from ${e}${t?a` where ${t}`:void 0}${n}`}buildUpdateSet(e,t){const r=e[b.Symbol.Columns],i=Object.keys(r).filter(n=>t[n]!==void 0||r[n]?.onUpdateFn!==void 0),s=i.length;return a.join(i.flatMap((n,o)=>{const l=r[n],d=l.onUpdateFn?.(),c=t[n]??(h(d,v)?d:a.param(d,l)),p=a`${a.identifier(this.casing.getColumnCasing(l))} = ${c}`;return o<s-1?[p,a.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:t,where:r,returning:i,withList:s,from:n,joins:o}){const l=this.buildWithCTE(s),d=e[R.Symbol.Name],c=e[R.Symbol.Schema],p=e[R.Symbol.OriginalName],f=d===p?void 0:d,g=a`${c?a`${a.identifier(c)}.`:void 0}${a.identifier(p)}${f&&a` ${a.identifier(f)}`}`,w=this.buildUpdateSet(e,t),$=n&&a.join([a.raw(" from "),this.buildFromTable(n)]),x=this.buildJoins(o),N=i?a` returning ${this.buildSelection(i,{isSingleTable:!n})}`:void 0;return a`${l}update ${g} set ${w}${$}${x}${r?a` where ${r}`:void 0}${N}`}buildSelection(e,{isSingleTable:t=!1}={}){const r=e.length,i=e.flatMap(({field:s},n)=>{const o=[];if(h(s,v.Aliased)&&s.isSelectionField)o.push(a.identifier(s.fieldAlias));else if(h(s,v.Aliased)||h(s,v)){const l=h(s,v.Aliased)?s.sql:s;t?o.push(new v(l.queryChunks.map(d=>h(d,S)?a.identifier(this.casing.getColumnCasing(d)):d))):o.push(l),h(s,v.Aliased)&&o.push(a` as ${a.identifier(s.fieldAlias)}`)}else if(h(s,L))t?o.push(s.isAlias?a`${a.identifier(this.casing.getColumnCasing(jt(s)))} as ${s}`:a.identifier(this.casing.getColumnCasing(s))):o.push(s.isAlias?a`${jt(s)} as ${s}`:s);else if(h(s,V)){const l=Object.entries(s._.selectedFields);if(l.length===1){const d=l[0][1],c=h(d,v)?d.decoder:h(d,L)?{mapFromDriverValue:p=>d.mapFromDriverValue(p)}:d.sql.decoder;c&&(s._.sql.decoder=c)}o.push(s)}return n<r-1&&o.push(a`, `),o});return a.join(i)}buildJoins(e){if(!e||e.length===0)return;const t=[];for(const[r,i]of e.entries()){r===0&&t.push(a` `);const s=i.table,n=i.lateral?a` lateral`:void 0,o=i.on?a` on ${i.on}`:void 0;if(h(s,R)){const l=s[R.Symbol.Name],d=s[R.Symbol.Schema],c=s[R.Symbol.OriginalName],p=l===c?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(c)}${p&&a` ${a.identifier(p)}`}${o}`)}else if(h(s,be)){const l=s[q].name,d=s[q].schema,c=s[q].originalName,p=l===c?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(c)}${p&&a` ${a.identifier(p)}`}${o}`)}else t.push(a`${a.raw(i.joinType)} join${n} ${s}${o}`);r<e.length-1&&t.push(a` `)}return a.join(t)}buildFromTable(e){if(h(e,b)&&e[b.Symbol.IsAlias]){let t=a`${a.identifier(e[b.Symbol.OriginalName])}`;return e[b.Symbol.Schema]&&(t=a`${a.identifier(e[b.Symbol.Schema])}.${t}`),a`${t} ${a.identifier(e[b.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:i,having:s,table:n,joins:o,orderBy:l,groupBy:d,limit:c,offset:p,lockingClause:f,distinct:g,setOperators:w}){const $=r??Te(t);for(const j of $)if(h(j.field,L)&&ae(j.field.table)!==(h(n,V)?n._.alias:h(n,Xr)?n[q].name:h(n,v)?void 0:ae(n))&&!(ee=>o?.some(({alias:Qe})=>Qe===(ee[b.Symbol.IsAlias]?ae(ee):ee[b.Symbol.BaseName])))(j.field.table)){const ee=ae(j.field.table);throw new Error(`Your "${j.path.join("->")}" field references a column "${ee}"."${j.field.name}", but the table "${ee}" is not part of the query! Did you forget to join it?`)}const x=!o||o.length===0,N=this.buildWithCTE(e);let k;g&&(k=g===!0?a` distinct`:a` distinct on (${a.join(g.on,a`, `)})`);const A=this.buildSelection($,{isSingleTable:x}),J=this.buildFromTable(n),I=this.buildJoins(o),E=i?a` where ${i}`:void 0,P=s?a` having ${s}`:void 0;let C;l&&l.length>0&&(C=a` order by ${a.join(l,a`, `)}`);let D;d&&d.length>0&&(D=a` group by ${a.join(d,a`, `)}`);const Z=typeof c=="object"||typeof c=="number"&&c>=0?a` limit ${c}`:void 0,K=p?a` offset ${p}`:void 0,G=a.empty();if(f){const j=a` for ${a.raw(f.strength)}`;f.config.of&&j.append(a` of ${a.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],a`, `)}`),f.config.noWait?j.append(a` nowait`):f.config.skipLocked&&j.append(a` skip locked`),G.append(j)}const ce=a`${N}select${k} ${A} from ${J}${I}${E}${D}${P}${C}${Z}${K}${G}`;return w.length>0?this.buildSetOperations(ce,w):ce}buildSetOperations(e,t){const[r,...i]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:i,limit:s,orderBy:n,offset:o}}){const l=a`(${e.getSQL()}) `,d=a`(${i.getSQL()})`;let c;if(n&&n.length>0){const w=[];for(const $ of n)if(h($,S))w.push(a.identifier($.name));else if(h($,v)){for(let x=0;x<$.queryChunks.length;x++){const N=$.queryChunks[x];h(N,S)&&($.queryChunks[x]=a.identifier(N.name))}w.push(a`${$}`)}else w.push(a`${$}`);c=a` order by ${a.join(w,a`, `)} `}const p=typeof s=="object"||typeof s=="number"&&s>=0?a` limit ${s}`:void 0,f=a.raw(`${t} ${r?"all ":""}`),g=o?a` offset ${o}`:void 0;return a`${l}${f}${d}${c}${p}${g}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:i,withList:s,select:n,overridingSystemValue_:o}){const l=[],d=e[b.Symbol.Columns],c=Object.entries(d).filter(([x,N])=>!N.shouldDisableInsert()),p=c.map(([,x])=>a.identifier(this.casing.getColumnCasing(x)));if(n){const x=t;h(x,v)?l.push(x):l.push(x.getSQL())}else{const x=t;l.push(a.raw("values "));for(const[N,k]of x.entries()){const A=[];for(const[J,I]of c){const E=k[J];if(E===void 0||h(E,ge)&&E.value===void 0)if(I.defaultFn!==void 0){const P=I.defaultFn(),C=h(P,v)?P:a.param(P,I);A.push(C)}else if(!I.default&&I.onUpdateFn!==void 0){const P=I.onUpdateFn(),C=h(P,v)?P:a.param(P,I);A.push(C)}else A.push(a`default`);else A.push(E)}l.push(A),N<x.length-1&&l.push(a`, `)}}const f=this.buildWithCTE(s),g=a.join(l),w=i?a` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,$=r?a` on conflict ${r}`:void 0;return a`${f}insert into ${e} ${p} ${o===!0?a`overriding system value `:void 0}${g}${$}${w}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){return a`refresh materialized view${t?a` concurrently`:void 0} ${e}${r?a` with no data`:void 0}`}prepareTyping(e){return h(e,zr)||h(e,Or)?"json":h(e,Fr)?"decimal":h(e,Er)?"time":h(e,Rr)||h(e,Mr)?"timestamp":h(e,Dr)||h(e,jr)?"date":h(e,Ur)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}_buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:i,tableConfig:s,queryConfig:n,tableAlias:o,nestedQueryRelation:l,joinOn:d}){let c=[],p,f,g=[],w;const $=[];if(n===!0)c=Object.entries(s.columns).map(([N,k])=>({dbKey:k.name,tsKey:N,field:ie(k,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const N=Object.fromEntries(Object.entries(s.columns).map(([P,C])=>[P,ie(C,o)]));if(n.where){const P=typeof n.where=="function"?n.where(N,co()):n.where;w=P&&Ye(P,o)}const k=[];let A=[];if(n.columns){let P=!1;for(const[C,D]of Object.entries(n.columns))D!==void 0&&C in s.columns&&(!P&&D===!0&&(P=!0),A.push(C));A.length>0&&(A=P?A.filter(C=>n.columns?.[C]===!0):Object.keys(s.columns).filter(C=>!A.includes(C)))}else A=Object.keys(s.columns);for(const P of A){const C=s.columns[P];k.push({tsKey:P,value:C})}let J=[];n.with&&(J=Object.entries(n.with).filter(P=>!!P[1]).map(([P,C])=>({tsKey:P,queryConfig:C,relation:s.relations[P]})));let I;if(n.extras){I=typeof n.extras=="function"?n.extras(N,{sql:a}):n.extras;for(const[P,C]of Object.entries(I))k.push({tsKey:P,value:pr(C,o)})}for(const{tsKey:P,value:C}of k)c.push({dbKey:h(C,v.Aliased)?C.fieldAlias:s.columns[P].name,tsKey:P,field:h(C,L)?ie(C,o):C,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof n.orderBy=="function"?n.orderBy(N,ho()):n.orderBy??[];Array.isArray(E)||(E=[E]),g=E.map(P=>h(P,L)?ie(P,o):Ye(P,o)),p=n.limit,f=n.offset;for(const{tsKey:P,queryConfig:C,relation:D}of J){const Z=go(t,r,D),K=r[ze(D.referencedTable)],G=`${o}_${P}`,ce=W(...Z.fields.map((Qe,it)=>me(ie(Z.references[it],G),ie(Qe,o)))),j=this._buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:e[K],tableConfig:t[K],queryConfig:h(D,Fe)?C===!0?{limit:1}:{...C,limit:1}:C,tableAlias:G,joinOn:ce,nestedQueryRelation:D}),ee=a`${a.identifier(G)}.${a.identifier("data")}`.as(P);$.push({on:a`true`,table:new V(j.sql,{},G),alias:G,joinType:"left",lateral:!0}),c.push({dbKey:P,tsKey:P,field:ee,relationTableTsKey:K,isJson:!0,selection:j.selection})}}if(c.length===0)throw new je({message:`No fields selected for table "${s.tsName}" ("${o}")`});let x;if(w=W(d,w),l){let N=a`json_build_array(${a.join(c.map(({field:A,tsKey:J,isJson:I})=>I?a`${a.identifier(`${o}_${J}`)}.${a.identifier("data")}`:h(A,v.Aliased)?A.sql:A),a`, `)})`;h(l,Hr)&&(N=a`coalesce(json_agg(${N}${g.length>0?a` order by ${a.join(g,a`, `)}`:void 0}), '[]'::json)`);const k=[{dbKey:"data",tsKey:"data",field:N.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||f!==void 0||g.length>0?(x=this.buildSelectQuery({table:se(i,o),fields:{},fieldsFlat:[{path:[],field:a.raw("*")}],where:w,limit:p,offset:f,orderBy:g,setOperators:[]}),w=void 0,p=void 0,f=void 0,g=[]):x=se(i,o),x=this.buildSelectQuery({table:h(x,R)?x:new V(x,{},o),fields:{},fieldsFlat:k.map(({field:A})=>({path:[],field:h(A,L)?ie(A,o):A})),joins:$,where:w,limit:p,offset:f,orderBy:g,setOperators:[]})}else x=this.buildSelectQuery({table:se(i,o),fields:{},fieldsFlat:c.map(({field:N})=>({path:[],field:h(N,L)?ie(N,o):N})),joins:$,where:w,limit:p,offset:f,orderBy:g,setOperators:[]});return{tableTsKey:s.tsName,sql:x,selection:c}}nestedSelectionerror(){throw new je({message:"Views with nested selections are not supported by the relational query builder"})}buildRqbColumn(e,t,r){if(h(t,L)){const i=a`${e}.${a.identifier(this.casing.getColumnCasing(t))}`;let s=t.columnType,n=t,o=0;for(;h(n,dr);)n=n.baseColumn,s=n.columnType,++o;switch(s){case"PgNumeric":case"PgNumericNumber":case"PgNumericBigInt":case"PgBigInt64":case"PgBigIntString":case"PgBigSerial64":case"PgTimestampString":case"PgGeometry":case"PgGeometryObject":case"PgBytea":{const l="[]".repeat(o);return a`${i}::text${a.raw(l).if(l)} as ${a.identifier(r)}`}case"PgCustomColumn":return a`${n.jsonSelectIdentifier(i,a,o>0?o:void 0)} as ${a.identifier(r)}`;default:return a`${i} as ${a.identifier(r)}`}}return a`${e}.${h(t,v.Aliased)?a.identifier(t.fieldAlias):xt(t)?a.identifier(r):this.nestedSelectionerror()} as ${a.identifier(r)}`}unwrapAllColumns=(e,t)=>a.join(Object.entries(e[pe]).map(([r,i])=>(t.push({key:r,field:i}),this.buildRqbColumn(e,i,r))),a`, `);buildColumns=(e,t,r)=>r?.columns?(()=>{const i=Object.entries(r.columns),s=e[pe],n=[];let o;for(const[l,d]of i)if(d!==void 0&&(o=o||d,d)){const c=s[l];n.push(this.buildRqbColumn(e,c,l)),t.push({key:l,field:c})}if(o===!1)for(const[l,d]of Object.entries(s))r.columns[l]!==!1&&(n.push(this.buildRqbColumn(e,d,l)),t.push({key:l,field:d}));return n.length?a.join(n,a`, `):void 0})():this.unwrapAllColumns(e,t);buildRelationalQuery({schema:e,table:t,tableConfig:r,queryConfig:i,relationWhere:s,mode:n,errorPath:o,depth:l,throughJoin:d}){const c=[],p=n==="first",f=i===!0?void 0:i,g=o??"",w=l??0;w||(t=se(t,`d${w}`));const $=p?1:f?.limit,x=f?.offset,N=f?.where&&s?W(he(t,f.where,r.relations,e,this.casing),s):f?.where?he(t,f.where,r.relations,e,this.casing):s,k=f?.orderBy?Xs(t,f.orderBy):void 0,A=this.buildColumns(t,c,f),J=f?.extras?Zs(t,f.extras):void 0;J&&c.push(...J.selection);const I=A?[A]:[],E=f?(()=>{const{with:P}=f;if(!P)return;const C=Object.entries(P).filter(([D,Z])=>Z);if(C.length)return a.join(C.map(([D,Z])=>{const K=r.relations[D],G=h(K,qr),ce=se(K.targetTable,`d${w+1}`),j=K.throughTable?se(K.throughTable,`tr${w}`):void 0,{filter:ee,joinCondition:Qe}=Ir(this.casing,K,t,ce,j);I.push(a`${a.identifier(D)}.${a.identifier("r")} as ${a.identifier(D)}`);const it=j?a` inner join ${Le(j)} on ${Qe}`:void 0,Lt=this.buildRelationalQuery({table:ce,mode:G?"first":"many",schema:e,queryConfig:Z,tableConfig:e[K.targetTableName],relationWhere:ee,errorPath:`${g.length?`${g}.`:""}${D}`,depth:w+1,throughJoin:it});return c.push({field:ce,key:D,selection:Lt.selection,isArray:!G,isOptional:(K.optional??!1)||Z!==!0&&!!Z.where}),a`left join lateral(select ${G?a`row_to_json(${a.identifier("t")}.*) ${a.identifier("r")}`:a`coalesce(json_agg(row_to_json(${a.identifier("t")}.*)), '[]') as ${a.identifier("r")}`} from (${Lt.sql}) as ${a.identifier("t")}) as ${a.identifier(D)} on true`}),a` `)})():void 0;if(J?.sql&&I.push(J.sql),!I.length)throw new je({message:`No fields selected for table "${r.name}"${g?` ("${g}")`:""}`});return{sql:a`select ${a.join(I.filter(P=>P!==void 0),a`, `)} from ${Le(t)}${d}${a` ${E}`.if(E)}${a` where ${N}`.if(N)}${a` order by ${k}`.if(k)}${a` limit ${$}`.if($!==void 0)}${a` offset ${x}`.if(x!==void 0)}`,selection:c}}},Po=class{static[u]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}},X=class{static[u]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){const t=!!this.fields,r=e;let i;return this.fields?i=this.fields:h(r,V)?i=Object.fromEntries(Object.keys(r._.selectedFields).map(s=>[s,r[s]])):h(r,Xr)?i=r[q].selectedFields:h(r,v)?i={}:i=rn(r),new Zr({table:r,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},xo=class extends Po{static[u]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:r,session:i,dialect:s,withList:n,distinct:o}){super(),this.config={withList:n,table:e,fields:{...t},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=i,this.dialect=s,this._={selectedFields:t,config:this.config},this.tableName=Se(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(const l of xe(e))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return((r,i)=>{const s=this.tableName,n=Se(r);for(const o of xe(r))this.usedTables.add(o);if(typeof n=="string"&&this.config.joins?.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof n=="string"&&!h(r,v))){const o=h(r,V)?r._.selectedFields:h(r,be)?r[q].selectedFields:r[b.Symbol.Columns];this.config.fields[n]=o}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:r,joinType:e,alias:n,lateral:t}),typeof n=="string")switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!1;break}return this})}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return r=>{const i=typeof r=="function"?r($o()):r;if(!At(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{const t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){const t=[];if(t.push(...xe(this.config.table)),this.config.joins)for(const r of this.config.joins)t.push(...xe(r.table));return new Proxy(new V(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new U({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}},Zr=class extends xo{static[u]="PgSelect";_prepare(e){const{session:t,config:r,dialect:i,joinsNotNullableMap:s,authToken:n,cacheConfig:o,usedTables:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const{fields:d}=r;return B.startActiveSpan("drizzle.prepareQuery",()=>{const c=Te(d),p=t.prepareQuery(i.sqlToQuery(this.getSQL()),c,e,!0,void 0,{type:"select",tables:[...l]},o);return p.joinsNotNullableMap=s,p.setToken(n)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};tn(Zr,[ve]);function qe(e,t){return(r,i,...s)=>{const n=[i,...s].map(o=>({type:e,isAll:t,rightSelect:o}));for(const o of n)if(!At(r.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(n)}}var $o=()=>({union:To,unionAll:Co,intersect:No,intersectAll:_o,except:Ao,exceptAll:Lo}),To=qe("union",!1),Co=qe("union",!0),No=qe("intersect",!1),_o=qe("intersect",!0),Ao=qe("except",!1),Lo=qe("except",!0),ei=class{static[u]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=h(e,He)?e:void 0,this.dialectConfig=h(e,He)?void 0:e}$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(r)),new Proxy(new fr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){const t=this;function r(n){return new X({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(n){return new X({fields:n??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function s(n,o){return new X({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:n}})}return{select:r,selectDistinct:i,selectDistinctOn:s}}select(e){return new X({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new X({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new X({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new He(this.dialectConfig)),this.dialect}},Ft=class{constructor(e,t,r,i,s){this.table=e,this.session=t,this.dialect=r,this.withList=i,this.overridingSystemValue_=s}static[u]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");const t=e.map(r=>{const i={},s=this.table[b.Symbol.Columns];for(const n of Object.keys(r)){const o=r[n];i[n]=h(o,v)?o:new ge(o,s[n])}return i});return new Vt(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){const t=typeof e=="function"?e(new ei):e;if(!h(t,v)&&!At(this.table[pe],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Vt(this.table,t,this.session,this.dialect,this.withList,!0)}},Vt=class extends ve{constructor(e,t,r,i,s,n,o){super(),this.session=r,this.dialect=i,this.config={table:e,values:t,withList:s,select:n,overridingSystemValue_:o}}static[u]="PgInsert";config;cacheConfig;returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Te(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=a`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));const r=e.where?a` where ${e.where}`:void 0;this.config.onConflict=a`(${a.raw(t)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');const t=e.where?a` where ${e.where}`:void 0,r=e.targetWhere?a` where ${e.targetWhere}`:void 0,i=e.setWhere?a` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,kr(this.config.table,e.set));let n="";return n=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=a`(${a.raw(n)})${r} do update set ${s}${t}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:xe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},Bo=class extends ve{constructor(e,t,r){super(),this.session=t,this.dialect=r,this.config={view:e}}static[u]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))},Et=class{constructor(e,t,r,i){this.table=e,this.session=t,this.dialect=r,this.withList=i}static[u]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new qo(this.table,kr(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},qo=class extends ve{constructor(e,t,r,i,s){super(),this.session=r,this.dialect=i,this.config={set:t,table:e,withList:s,joins:[]},this.tableName=Se(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[u]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){const t=e,r=Se(t);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=t,this}getTableLikeFields(e){return h(e,R)?e[b.Symbol.Columns]:h(e,V)?e._.selectedFields:e[q].selectedFields}createJoin(e){return((t,r)=>{const i=Se(t);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof r=="function"){const s=this.config.from&&!h(this.config.from,v)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[b.Symbol.Columns],new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":this.joinsNotNullableMap[i]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break;case"inner":this.joinsNotNullableMap[i]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}return this})}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[b.Symbol.Columns]),this.config.from)){const t=Se(this.config.from);if(typeof t=="string"&&this.config.from&&!h(this.config.from,v)){const r=this.getTableLikeFields(this.config.from);e[t]=r}for(const r of this.config.joins){const i=Se(r.table);if(typeof i=="string"&&!h(r.table,v)){const s=this.getTableLikeFields(r.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Te(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){const t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:xe(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new U({alias:ae(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},Qo=class{constructor(e,t,r,i,s,n,o){this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o}static[u]="PgRelationalQueryBuilder";findMany(e){return new Rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Rt=class extends ve{constructor(e,t,r,i,s,n,o,l,d){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o,this.config=l,this.mode=d}static[u]="PgRelationalQuery";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(i,s)=>{const n=i.map(o=>pt(this.schema,this.tableConfig,o,t.selection,s));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect._buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},Io=class gt extends v{constructor(t){super(gt.buildEmbeddedCount(t.source,t.filters).queryChunks),this.params=t,this.mapWith(Number),this.session=t.session,this.sql=gt.buildCount(t.source,t.filters)}sql;token;static[u]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(t,r){return a`(select count(*) from ${t}${a.raw(" where ").if(r)}${r})`}static buildCount(t,r){return a`select count(*) as count from ${t}${a.raw(" where ").if(r)}${r};`}setToken(t){return this.token=t,this}then(t,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(t,r)}catch(t){return this.then(void 0,t)}finally(t){return this.then(r=>(t?.(),r),r=>{throw t?.(),r})}},ko=class{constructor(e,t,r,i,s,n){this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.parseJson=n}static[u]="PgRelationalQueryBuilderV2";findMany(e){return new Mt(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"many",this.parseJson)}findFirst(e){return new Mt(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"first",this.parseJson)}},Mt=class extends ve{constructor(e,t,r,i,s,n,o,l){super(),this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.config=n,this.mode=o,this.parseJson=l}static[u]="PgRelationalQueryV2";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareRelationalQuery(r,void 0,e,(i,s)=>{const n=i.map(o=>ht(o,t.selection,s,this.parseJson));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQuery({schema:this.schema,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,mode:this.mode})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},Do=class extends ve{constructor(e,t,r,i){super(),this.execute=e,this.sql=t,this.query=r,this.mapBatchResult=i}static[u]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}},ti=class{constructor(e,t,r,i,s=!1){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,relations:r,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},relations:r,session:t},this._query={},this._.schema)for(const[n,o]of Object.entries(this._.schema))this._query[n]=new Qo(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[n],o,e,t);this.query={};for(const[n,o]of Object.entries(r))this.query[n]=new ko(r,r[o.name].table,o,e,t,s);this.$cache={invalidate:async n=>{}}}static[u]="PgDatabase";_query;query;$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(new ei(r.dialect))),new Proxy(new fr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new Io({source:e,filters:t,session:this.session})}$cache;with(...e){const t=this;function r(d){return new X({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(d){return new X({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function s(d,c){return new X({fields:c??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:d}})}function n(d){return new Et(d,t.session,t.dialect,e)}function o(d){return new Ft(d,t.session,t.dialect,e)}function l(d){return new zt(d,t.session,t.dialect,e)}return{select:r,selectDistinct:i,selectDistinctOn:s,update:n,insert:o,delete:l}}select(e){return new X({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new X({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new X({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Et(e,this.session,this.dialect)}insert(e){return new Ft(e,this.session,this.dialect)}delete(e){return new zt(e,this.session,this.dialect)}refreshMaterializedView(e){return new Bo(e,this.session,this.dialect)}authToken;execute(e){const t=typeof e=="string"?a.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(t),i=this.session.prepareQuery(r,void 0,void 0,!1);return new Do(()=>i.execute(void 0,this.authToken),t,r,s=>i.mapResult(s,!0))}transaction(e,t){return this.session.transaction(e,t)}},jo=class{static[u]="Cache"},ri=class extends jo{strategy(){return"all"}static[u]="NoopCache";async get(e){}async put(e,t,r,i){}async onMutate(e){}};async function Ut(e,t){const r=`${e}-${JSON.stringify(t)}`,i=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(s)].map(n=>n.toString(16).padStart(2,"0")).join("")}var Oo=class{constructor(e,t,r,i){this.query=e,this.cache=t,this.queryMetadata=r,this.cacheConfig=i,t&&t.strategy()==="all"&&i===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[u]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,r){if(this.cache===void 0||h(this.cache,ri)||this.queryMetadata===void 0)try{return await r()}catch(i){throw new Ce(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await r()}catch(i){throw new Ce(e,t,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{const[i]=await Promise.all([r(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new Ce(e,t,i)}if(!this.cacheConfig)try{return await r()}catch(i){throw new Ce(e,t,i)}if(this.queryMetadata.type==="select"){const i=await this.cache.get(this.cacheConfig.tag??await Ut(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let s;try{s=await r()}catch(n){throw new Ce(e,t,n)}return await this.cache.put(this.cacheConfig.tag??await Ut(e,t),s,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),s}return i}try{return await r()}catch(i){throw new Ce(e,t,i)}}},zo=class{constructor(e){this.dialect=e}static[u]="PgSession";execute(e,t){return B.startActiveSpan("drizzle.operation",()=>B.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){const r=await this.execute(e,t);return Number(r[0].count)}},Fo=class extends ti{constructor(e,t,r,i,s=0,n){super(e,t,r,i,n),this.relations=r,this.schema=i,this.nestedIndex=s}static[u]="PgTransaction";rollback(){throw new Fs}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),a.raw(t.join(" "))}setTransaction(e){return this.session.execute(a`set transaction ${this.getTransactionConfigSQL(e)}`)}},Jt=class extends Oo{constructor(e,t,r,i,s,n,o,l,d,c,p){super({sql:t,params:r},s,n,o),this.client=e,this.queryString=t,this.params=r,this.logger=i,this.fields=l,this._isResponseInArrayMode=d,this.customResultMapper=c,this.isRqbV2Query=p}static[u]="PostgresJsPreparedQuery";async execute(e={}){return this.isRqbV2Query?this.executeRqbV2(e):B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{fields:i,queryString:s,client:n,joinsNotNullableMap:o,customResultMapper:l}=this;if(!i&&!l)return B.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(s,r,async()=>await n.unsafe(s,r)));const d=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":s,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(s,r,async()=>await n.unsafe(s,r).values())));return B.startActiveSpan("drizzle.mapResponse",()=>l?l(d):d.map(c=>en(i,c,o)))})}async executeRqbV2(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{queryString:i,client:s,customResultMapper:n}=this,o=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(r)}),s.unsafe(i,r)));return B.startActiveSpan("drizzle.mapResponse",()=>n(o))})}all(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=ot(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r),B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(this.queryString,r,async()=>this.client.unsafe(this.queryString,r))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},ii=class si extends zo{constructor(t,r,i,s,n={}){super(r),this.client=t,this.relations=i,this.schema=s,this.options=n,this.logger=n.logger??new Rs,this.cache=n.cache??new ri}static[u]="PostgresJsSession";logger;cache;prepareQuery(t,r,i,s,n,o,l){return new Jt(this.client,t.sql,t.params,this.logger,this.cache,o,l,r,s,n)}prepareRelationalQuery(t,r,i,s){return new Jt(this.client,t.sql,t.params,this.logger,this.cache,void 0,void 0,r,!1,s,!0)}query(t,r){return this.logger.logQuery(t,r),this.client.unsafe(t,r).values()}queryObjects(t,r){return this.client.unsafe(t,r)}transaction(t,r){return this.client.begin(async i=>{const s=new si(i,this.dialect,this.relations,this.schema,this.options),n=new Vo(this.dialect,s,this.schema,this.relations);return r&&await n.setTransaction(r),t(n)})}},Vo=class ni extends Fo{constructor(t,r,i,s,n=0){super(t,r,s,i,n),this.session=r}static[u]="PostgresJsTransaction";transaction(t){return this.session.client.savepoint(r=>{const i=new ii(r,this.dialect,this.relations,this.schema,this.session.options);return t(new ni(this.dialect,i,this.schema,this.relations))})}},Eo=class extends ti{static[u]="PostgresJsDatabase"};function ke(e,t={}){const r=d=>d;for(const d of["1184","1082","1083","1114","1182","1185","1115","1231"])e.options.parsers[d]=r,e.options.serializers[d]=r;e.options.serializers[114]=r,e.options.serializers[3802]=r;const i=new He({casing:t.casing});let s;t.logger===!0?s=new Es:t.logger!==!1&&(s=t.logger);let n;if(t.schema){const d=fo(t.schema,yo);n={fullSchema:t.schema,schema:d.tables,tableNamesMap:d.tableNamesMap}}const o=t.relations??{},l=new Eo(i,new ii(e,i,o,n,{logger:s,cache:t.cache}),o,n);return l.$client=e,l.$cache=t.cache,l.$cache&&(l.$cache.invalidate=t.cache?.onMutate),l}function yt(...e){if(typeof e[0]=="string")return ke(Ke(e[0]),e[1]);const{connection:t,client:r,...i}=e[0];if(r)return ke(r,i);if(typeof t=="object"&&t.url!==void 0){const{url:s,...n}=t;return ke(Ke(s,n),i)}return ke(Ke(t),i)}(e=>{function t(r){return ke({options:{parsers:{},serializers:{}}},r)}e.mock=t})(yt||(yt={}));var Ro=process.env.DATABASE_URL??`postgresql://${process.env.POSTGRES_USER??"prometheus"}:${process.env.POSTGRES_PASSWORD??"secret"}@${process.env.POSTGRES_HOST??"localhost"}:${process.env.POSTGRES_PORT??5433}/${process.env.POSTGRES_DB??"prometheus"}`,Mo=process.env.POSTGRES_SSL==="true"?"require":!1;const Uo=Ke(Ro,{max:5,ssl:Mo}),rt=yt({client:Uo}),le=Xt("store_items",{id:Zt("id").primaryKey(),name:lt("name").notNull(),price:Pi("price",{precision:10,scale:2}).notNull(),createdAt:er("created_at",{mode:"date",withTimezone:!1}).defaultNow()}),Hl=Xt("chat_messages",{id:Zt("id").primaryKey(),author:lt("author").notNull(),body:lt("body").notNull(),createdAt:er("created_at",{mode:"date",withTimezone:!1}).defaultNow()});var ai=e=>{const t=Number.parseFloat(String(e.price));return{id:e.id,name:e.name,price:Number.isFinite(t)?t:0}};const Jo=({cacheControl:e})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60})};var oi=async e=>{const r=Number.isFinite(e)&&(e??0)>0?Number(e):0,i=rt.select().from(le),s=r>0?i.where(tt(le.id,r)):i;try{const n=(await s.orderBy(le.id).limit(6)).map(ai);return{items:n,cursor:n.length===6?n[n.length-1].id:null,source:"db"}}catch(n){return console.error("Failed to load store items",n),{items:[{id:-1,name:y`Sample adapter (offline)`,price:24.99},{id:-2,name:y`Edge cache pack (offline)`,price:12.5}],cursor:null,source:"fallback"}}},Ko=wi(async e=>oi(e),"o0FSe7O5kbg");const Wo=pi(_(Ko,"s_o0FSe7O5kbg"));var Ho=async()=>oi();const li=di(_(Ho,"s_v669J74jz24"));var Go=async e=>{const t=Number.parseInt(String(e.id??""),10);if(!Number.isFinite(t)||t<=0)return{success:!1,error:y`Invalid id.`};try{const[r]=await rt.delete(le).where(me(le.id,t)).returning();return r?{success:!0,id:t}:{success:!1,error:y`Item not found.`}}catch(r){return console.error("Failed to delete store item",r),{success:!1,error:y`Unable to delete item right now.`}}};const ui=Gt(_(Go,"s_R9VLNISWb6o"));var Yo=async e=>{const t=String(e.name??"").trim(),r=Number.parseFloat(String(e.price??""));if(!t||Number.isNaN(r)||r<=0)return{success:!1,error:y`Name and positive price required.`};try{const[i]=await rt.insert(le).values({name:t,price:r.toString()}).returning();return{success:!0,item:ai(i)}}catch(i){return console.error("Failed to create store item",i),{success:!1,error:y`Unable to create item right now.`}}};const ci=Gt(_(Yo,"s_nexPpNJs6FU"));var Xo=[.16,1,.3,1],Zo=[.4,0,1,1],el=async e=>{if(typeof document>"u"||!e.length||typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion: reduce)").matches)return;const t=e.map(s=>document.querySelector(`[data-store-item-id="${s}"]`)).filter(s=>!!s);if(!t.length)return;const{animateMini:r,stagger:i}=await import("motion");try{await r(t,{opacity:[0,1],y:[8,0],scaleX:[.98,1],scaleY:[.98,1]},{duration:.32,ease:Xo,delay:i(.04)}).finished}catch(s){console.error("Failed to run entrance animations",s)}},tl=async e=>{const[t]=ue(),r=()=>{const n=()=>{t.value=t.value.filter(l=>l.id!==e)};if(typeof document>"u"){n();return}const o=document.startViewTransition;if(typeof o=="function"){o.call(document,n);return}n()};if(typeof document>"u"||typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion: reduce)").matches)return r();const i=document.querySelector(`[data-store-item-id="${e}"]`);if(!i){r();return}const{animateMini:s}=await import("motion");try{await s(i,{opacity:0,y:-8,scaleX:.96,scaleY:.96},{duration:.22,ease:Zo}).finished}catch(n){console.error("Failed to animate removal",n)}r()},rl=async(e=!1)=>{const[t,r,i,s,n,o,l]=ue();if(!o.value){o.value=!0,r.value=null;try{const d=await Wo(e?void 0:t.value??void 0),c=d?.items??[],p=e?c:[...n.value,...c],f=e?new Set:new Set(n.value.map($=>$.id)),g=c.map($=>$.id).filter($=>!f.has($)),w=()=>{n.value=p,l.value=g};if(typeof document>"u")w();else{const $=document.startViewTransition;typeof $=="function"?$.call(document,w):w()}t.value=d?.cursor??null,s.value=d?.source==="fallback",i.value=!0,r.value=d?.source==="fallback"?y`Database offline: showing fallback inventory.`:null}catch(d){console.error("Failed to load store items",d),r.value=y`Unable to load inventory right now.`}finally{o.value=!1}}},il=()=>{const[e,t]=ue();e.value||t(!0)},sl=({track:e})=>{const[t,r,i,s,n]=ue(),o=e(()=>t.value);if(o?.success&&o.item){const l=[...s.value.filter(c=>c.id!==o.item.id),o.item];l.sort((c,p)=>c.id-p.id);const d=()=>{s.value=l,n.value=[o.item.id]};if(typeof document>"u")d();else{const c=document.startViewTransition;typeof c=="function"?c.call(document,d):d()}i.value=!0,r.value=null}},nl=({track:e})=>{const[t,r,i]=ue(),s=e(()=>r.value);s?.success&&s.id?(t(s.id),i.value=null):s?.error&&(i.value=s.error)},al=()=>{const e=li(),t=M(e.value.items),r=M(e.value.cursor),i=M(!1),s=M(e.value.items.length>0),n=M(e.value.source==="fallback"),o=M(e.value.source==="fallback"?y`Database offline: showing fallback inventory.`:null),l=ci(),d=ui(),c=M([]);Wt(re("s_AuJpa7ZJr0s",[_(el,"s_ZF5ox75ncAY"),c]));const p=_(tl,"s_i5YbwZ5sHVc",[t]),f=_(rl,"s_69ywUjDxRgU",[r,o,s,n,t,i,c]);return Ue(_(il,"s_h70dBAjCmqY",[s,f]),{eagerness:"visible"}),Ue(_(sl,"s_fap9umrX08E",[l,o,s,t,c])),Ue(_(nl,"s_ESNIfCDtZ0Q",[p,d,o])),m("div",null,{class:"gap-4 grid md:grid-cols-[1.2fr_1fr] bg-slate-900/60 mt-5 p-4 border border-slate-800 rounded-lg"},[m("div",null,{class:"space-y-4"},[m("div",null,{class:"flex justify-between items-center"},[m("p",null,{class:"text-slate-300 text-sm"},y`Inventory`,1,null),m("button",null,{type:"button",class:"bg-slate-800 hover:bg-slate-700 disabled:opacity-60 px-3 py-2 rounded-lg ring-1 ring-slate-700 font-semibold text-slate-100 text-xs transition",disabled:ne(g=>g.value,[i],"p0.value"),onClick$:re("s_DM6GWHW8dls",[f])},y`Refresh`,1,null)],1,null),n.value&&m("p",null,{class:"text-amber-300 text-xs"},y`Showing fallback data while the database is unavailable.`,1,"YL_0"),!s.value&&m("p",null,{class:"text-slate-500 text-sm"},y`Inventory loads once this section is visible.`,1,"YL_1"),o.value&&m("p",null,{class:"text-rose-300 text-sm"},ne(g=>g.value,[o],"p0.value"),3,"YL_2"),t.value.length?m("ul",null,{class:"gap-3 grid md:grid-cols-2",style:{viewTransitionName:"store-grid"}},t.value.map(g=>m("li",{"data-store-item-id":te(g,"id"),style:{viewTransitionName:`store-item-${g.id}`}},{class:"surface space-y-2 p-4"},[m("div",null,{class:"flex justify-between items-start gap-3"},[m("div",null,null,[m("p",null,{class:"text-slate-400 text-sm"},y`SKU ${g.id}`,1,null),m("p",null,{class:"font-semibold text-slate-50 text-lg"},te(g,"name"),1,null)],1,null),O(Bt,{action:d,class:"shrink-0",children:[m("input",{value:te(g,"id")},{type:"hidden",name:"id"},null,3,null),m("button",{disabled:d.isRunning||g.id<=0,"aria-label":y`Delete ${g.name}`},{type:"submit",class:"hover:bg-rose-500/10 disabled:opacity-60 px-2 py-1 rounded-md ring-1 ring-slate-700 hover:ring-rose-500 text-slate-400 hover:text-rose-200 text-xs transition"},y`Delete`,1,null)],[de]:{action:de,class:de}},1,"YL_3")],1,null),m("p",null,{class:"text-emerald-300"},["$",g.price.toFixed(2)],1,null)],1,g.id)),1,"YL_4"):s.value&&!i.value&&m("p",null,{class:"text-slate-500 text-sm"},y`No items yet.`,1,"YL_5"),m("div",null,{class:"flex items-center gap-3"},[r.value!==null&&m("button",null,{type:"button",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-60 px-4 py-2 rounded-lg font-semibold text-emerald-950 text-sm transition",disabled:ne(g=>g.value,[i],"p0.value"),onClick$:re("s_isBUq7NOKTw",[f])},y`Load more`,1,"YL_6"),i.value&&m("span",null,{class:"text-slate-400 text-xs"},y`Loading...`,1,"YL_7")],1,null)],1,null),m("div",null,{class:"space-y-3 bg-slate-900/80 p-4 border border-slate-800 rounded-lg"},[m("p",null,{class:"font-semibold text-slate-100 text-sm"},y`Add an item`,1,null),O(Bt,{action:l,class:"space-y-3 text-slate-200 text-sm",children:[m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"name"},y`Name`,1,null),m("input",null,{id:"name",name:"name",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:y`Lightweight widget`,required:!0},null,3,null)],1,null),m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"price"},y`Price`,1,null),m("input",null,{id:"price",name:"price",type:"number",step:"0.01",min:"0",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:"24.99",required:!0},null,3,null)],1,null),m("button",null,{type:"submit",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-70 px-4 py-2 rounded-lg w-full font-semibold text-emerald-950 text-sm transition",disabled:ne(g=>g.isRunning,[l],"p0.isRunning")},l.isRunning?y`Saving...`:y`Create item`,1,null),l.value?.error&&m("p",null,{class:"text-rose-300 text-xs"},ne(g=>g.value.error,[l],"p0.value.error"),3,"YL_8"),l.value?.success&&l.value.item&&m("p",null,{class:"text-emerald-300 text-xs"},y`Added ${l.value.item.name}.`,1,"YL_9")],[de]:{action:de,class:de}},1,"YL_10")],1,null)],1,"YL_11")};const ol=H(_(al,"s_2aWAOZ0c5GI"));var ll="[data-store-item-id]{transform-origin:top;will-change:transform,opacity}@media (prefers-reduced-motion:reduce){[data-store-item-id]{transition:none!important;animation:none!important}}",ul=ye({default:()=>dl,head:()=>hl,onGet:()=>Jo,useCreateStoreItem:()=>ci,useDeleteStoreItem:()=>ui,useStoreItemsLoader:()=>li},1),cl=()=>(Ve(_(ll,"s_cOQoV5jD0Q4")),m("section",null,{class:"p-6 surface"},[m("div",null,{class:"flex justify-between items-center gap-2"},[m("div",null,null,[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Store`,1,null),m("h1",null,{class:"font-semibold text-slate-50 text-2xl"},y`Fast browsing with tiny payloads`,1,null)],1,null),m("span",null,{class:"bg-slate-800 px-3 py-1 rounded-full text-slate-200 text-xs"},y`cached`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-slate-300 text-sm"},y`Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.`,1,null),m("div",null,{onQVisible$:re("s_CaVBY15goBk")},O(ol,null,3,"3h_0"),1,null)],1,"3h_1")),dl=H(_(cl,"s_bZ8kc5UlLx4"));const hl=({withLocale:e})=>e(()=>({title:y`Store | Prometheus`,meta:[{name:"description",content:y`Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.`}]}));var fl=ye({onGet:()=>ml},1);const ml=async({cacheControl:e,query:t,json:r})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60});const i=Number.parseInt(t.get("limit")??"",10),s=Number.parseInt(t.get("cursor")??"",10),n=Number.isFinite(i)&&i>0?Math.min(i,50):10,o=Number.isFinite(s)&&s>0?s:0;try{const l=rt.select().from(le),d=(await(o>0?l.where(tt(le.id,o)):l).orderBy(le.id).limit(n)).map(c=>({...c,price:Number.parseFloat(String(c.price))}));r(200,{items:d,cursor:d.length===n?d[d.length-1].id:null})}catch(l){console.error("Failed to load store items",l),r(500,{error:"Unable to load items right now."})}},pl=[ji];var Ne=()=>es;const gl=[["/",[Ne,()=>os],"/",["q-DOIWzHyw.js","q-CXy3XuXz.js"]],["ai",[Ne,()=>hs],"/ai",["q-DOIWzHyw.js","q-BMpxWP2L.js"]],["chat",[Ne,()=>Ss],"/chat",["q-DOIWzHyw.js","q-vcyB1d_9.js"]],["index",[Ne,()=>ns],"/index",["q-DOIWzHyw.js","q-x8WQtDGb.js"]],["store",[Ne,()=>ul],"/store",["q-DOIWzHyw.js","q-DwVSbtdR.js"]],["api/store/items",[Ne,()=>fl],"/api/store/items",["q-DOIWzHyw.js"]]],yl=[];var bl={routes:gl,serverPlugins:pl,menus:yl,trailingSlash:!1,basePathname:"/",cacheModules:!0},vl=({serverData:e})=>`/build${`/${e.locale}`}`,wl=()=>{$i(()=>vi(Xe))},Sl=()=>{const e=bt();return Wt(re("s_TVD7erg9zpo",[M(e.url.href),e])),O(Yt,null,3,"Dv_0")};const Pl=H(_(Sl,"s_w6dmeDadJmA"));var xl={};globalThis.__EXPERIMENTAL__=xl;var $l=()=>O(mi,{children:[m("head",null,null,[m("meta",null,{charSet:"utf-8"},null,3,null),O(nr,null,3,"xd_0")],1,null),m("body",null,{class:"app-shell"},O(Pl,{children:O(gi,null,3,"xd_1")},1,"xd_2"),1,null)]},1,"xd_3"),Tl=H(_($l,"s_8txvw3enrrU"));wl();var Cl=e=>{const t=typeof e.base=="function"?e.base(e):e.base;return t?t.endsWith("/")?t:`${t}/`:"/build/"},Kt=e=>!!e&&typeof e=="object"&&"manifest"in e,Nl=e=>{const t=e.serverData?.locale;if(t)return t;let r=null;const i=e.serverData?.url;if(i)try{r=new URL(i).searchParams.get("locale")}catch{r=null}const s=e.serverData?.requestHeaders?.["accept-language"]??void 0;return wt({queryLocale:r,acceptLanguage:s})};function _l(e){const t=e.manifest??Ht,r=Kt(t)?t.manifest:t,i=Nl(e),s={...e.serverData,locale:i},n=Cl({...e,base:vl,serverData:s}),o=`${n}${r?.qwikLoader??"qwikloader.js"}`,l={...e.containerAttributes,lang:i,"q:locale":i},c={tag:"script",location:"head",attributes:{"data-qwik-lazy-loader":"1",dangerouslySetInnerHTML:`(function(){const src='${o}';if(!src)return;let started=false;const load=()=>{if(started||navigator.connection?.saveData)return;started=true;const s=document.createElement('script');s.type='module';s.defer=true;s.src=src;s.setAttribute('data-qwik-loader','lazy');document.head.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>triggers.forEach((event)=>document.removeEventListener(event,prime,listenerOpts));const triggers=['pointerdown','keydown','touchstart','focusin'];const listenerOpts={once:true,passive:true};triggers.forEach((event)=>document.addEventListener(event,prime,listenerOpts));document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible')prime();},{once:true});})();`}},p=r?Kt(t)?{...t,manifest:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],c]}}:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],c]}:t;return hi(O(Tl,null,3,"CC_0"),{...e,base:n,serverData:s,manifest:p,qwikLoader:"never",preloader:!1,containerTagName:"html",containerAttributes:l,stream:e.stream??{static:{buffer:0},inOrder:["<html"]}})}var{router:Al,notFound:Ll}=bi({render:_l,qwikCityPlan:bl,manifest:Ht}),Gl={router:Al,notFound:Ll};export{Gl as default,Ll as notFound,Al as router};
