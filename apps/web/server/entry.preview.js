import{t as x}from"./q-B9iggP75.js";import{C as g,D as I,E as f,S as _,T as y,_ as h,a as $,b as w,c as K,d as D,f as P,g as m,h as u,i as H,l as Y,m as W,n as k,o as B,p as J,r as Z,s as V,t as X,u as ee,v as e,w as c,x as te,y as S}from"./q-Cf26u15_.js";import{gt as E}from"drizzle-orm";import{drizzle as le}from"drizzle-orm/postgres-js";import se from"postgres";import{numeric as ae,pgTable as R,serial as N,text as L,timestamp as Q}from"drizzle-orm/pg-core";var ne=new Set(["style","script","fetch","image","worker"]);const re=(t,l)=>{const n=new Set;return Array.from(t??[]).filter(a=>{if(a.rel!=="preload")return!0;if(l)return!1;const r=a.href,s=a.as;return typeof r!="string"||r.trim().length===0||typeof s!="string"||!ne.has(s)||s==="font"||n.has(r)?!1:(n.add(r),!0)})};var ie=x({RouterHead:()=>j,default:()=>ce},1),oe=()=>{const t=K(),l=Y(),n=re(t.links,!1),a=!1,r="(()=>{try{if(navigator.connection?.saveData)return;if(!HTMLScriptElement.supports?.('speculationrules'))return;const seen=new Set();const install=(kind,href)=>{if(!href||seen.has(href))return;seen.add(href);const script=document.createElement('script');script.type='speculationrules';script.textContent=JSON.stringify({[kind]:[{source:'list',urls:[href]}]});document.head.append(script);};const queue=(kind,href)=>{const run=()=>install(kind,href);(self.requestIdleCallback||((cb)=>setTimeout(cb,600)))(run,{timeout:900});};document.querySelectorAll('[data-speculate]').forEach((link)=>{const href=link.getAttribute('href');const kind=link.getAttribute('data-speculate')||'prefetch';if(!href)return;const prime=()=>install(kind,href);link.addEventListener('pointerdown',prime,{once:true});link.addEventListener('focus',prime,{once:true});link.addEventListener('mouseenter',()=>queue(kind,href),{once:true});});}catch{}})();";return h(J,{children:[e("title",null,null,t.title||"Prometheus",1,null),e("meta",null,{name:"viewport",content:"width=device-width, initial-scale=1, viewport-fit=cover"},null,3,null),e("link",null,{rel:"canonical",href:m(s=>s.url.href,[l],"p0.url.href")},null,3,null),t.meta.map(s=>S("meta",{...s},null,0,s.key)),n.map(s=>S("link",{...s},null,0,s.key)),t.styles.map(s=>S("style",{...s.props,get dangerouslySetInnerHTML(){return s.style},dangerouslySetInnerHTML:_(s,"style")},null,0,s.key)),r&&e("script",{dangerouslySetInnerHTML:r},null,null,3,"qG_0"),e("script",null,{dangerouslySetInnerHTML:"if ('startViewTransition' in document) {document.documentElement.classList.add('supports-view-transition');}"},null,3,null),a]},1,"qG_2")};const j=g(c(oe,"s_0ZAFccQi4aM"));var ue=()=>e("div",null,{class:"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950"},[e("header",null,{class:"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/80 backdrop-blur"},e("nav",null,{class:"mx-auto flex max-w-5xl items-center justify-between px-4 py-3 text-sm font-medium"},[e("div",null,{class:"flex items-center gap-2"},[e("span",null,{class:"rounded-full bg-emerald-500/10 px-3 py-1 text-emerald-300"},"Prometheus",3,null),e("span",null,{class:"text-slate-400"},"Performance Lab",3,null)],3,null),e("div",null,{class:"flex items-center gap-4 text-slate-200"},[h(k,{href:"/",class:"hover:text-emerald-300 transition-colors",children:"Home",[u]:{href:u,class:u}},3,"qG_3"),h(k,{href:"/store","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors",children:"Store",[u]:{href:u,"data-speculate":u,class:u}},3,"qG_4"),h(k,{href:"/chat","data-speculate":"prefetch",class:"hover:text-emerald-300 transition-colors",children:"Chat",[u]:{href:u,"data-speculate":u,class:u}},3,"qG_5"),h(k,{href:"/ai",class:"hover:text-emerald-300 transition-colors",children:"AI",[u]:{href:u,class:u}},3,"qG_6")],1,null)],1,null),1,null),e("main",null,{class:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-10 route-transition"},h(W,null,3,"qG_7"),1,null)],1,"qG_8"),ce=g(c(ue,"s_wqKL2Up903o")),de=x({default:()=>F,head:()=>M,onGet:()=>z},1);const z=({cacheControl:t})=>{t({public:!0,maxAge:900})};var pe=()=>e("section",null,{class:"gap-6 grid md:grid-cols-2"},[e("div",null,{class:"p-6 surface"},[e("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},"Performance first",3,null),e("h1",null,{class:"mt-2 font-semibold text-slate-50 text-3xl"},"Microscopic first load, big capability",3,null),e("p",null,{class:"mt-4 text-slate-300"},"Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.",3,null),e("div",null,{class:"gap-3 grid mt-6 text-slate-200 text-sm"},[e("div",null,{class:"flex items-center gap-2"},"- Ultra-thin home route with immutable caching",3,null),e("div",null,{class:"flex items-center gap-2"},"- Lazy feature routes for store, chat, and AI",3,null),e("div",null,{class:"flex items-center gap-2"},"- Optional Partytown for third-party isolation",3,null)],3,null)],3,null),e("div",null,{class:"p-6 text-slate-200 text-sm surface"},[e("h2",null,{class:"font-semibold text-slate-50 text-lg"},"Latency budget",3,null),e("ul",null,{class:"space-y-2 mt-3"},[e("li",null,null,"Server render: sub-50ms target with streaming enabled",3,null),e("li",null,null,"Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny",3,null),e("li",null,null,"Speculative nav: prerender store, prefetch chat",3,null)],3,null)],3,null)],3,"FW_0"),F=g(c(pe,"s_e7mxYERDQJw"));const M={title:"Prometheus | Ultra-fast starter",meta:[{name:"description",content:"Qwik City + Bun + Valkey performance stack starter."}]};var me=x({default:()=>F,head:()=>M,onGet:()=>z},1),fe=x({default:()=>xe,head:()=>ge},1),he=async()=>{const[t,l]=y();if(!t.value)return;const n=await fetch("/api/ai/echo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t.value})});if(n.ok){const{echo:a}=await n.json();l.value=a}},ve=()=>{const t=f(""),l=f(""),n=c(he,"s_IeTPFYT6ASQ",[t,l]);return e("section",null,{class:"surface p-6"},[e("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},"AI tools",3,null),e("h1",null,{class:"text-2xl font-semibold text-slate-50"},"Edge-friendly utilities",3,null),e("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},"This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.",3,null),e("div",null,{class:"mt-4 space-y-3 text-sm text-slate-200"},[e("textarea",null,{value:m(a=>a.value,[t],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2",placeholder:"Type a quick prompt",rows:4,onInput$:w("s_LABJ4QOQ7gI",[t])},null,3,null),e("div",null,{class:"flex items-center gap-2"},[e("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:n},"Send to API",3,null),l.value&&e("span",null,{class:"text-emerald-300"},["Response: ",m(a=>a.value,[l],"p0.value")],3,"gn_0")],1,null)],1,null)],1,"gn_1")},xe=g(c(ve,"s_X8xIQqUjebE"));const ge={title:"AI | Prometheus",meta:[{name:"description",content:"Minimal AI utility route hitting Bun API."}]};var be=x({default:()=>ke,head:()=>Se},1),ye=({cleanup:t})=>{const[l,n,a]=y()},_e=()=>{const[t,l]=y();!t.value||!l.value||(l.value.send(JSON.stringify({type:"chat",text:t.value})),t.value="")},we=()=>{const t=f([]),l=f(null),n=f(""),a=f(!1);I(c(ye,"s_IJ05ZFgM0H4",[t,a,l]),{eagerness:"visible"});const r=c(_e,"s_ub0KtQnLT0Q",[n,l]);return e("section",null,{class:"surface p-6"},[e("div",null,{class:"flex items-center justify-between gap-2"},[e("div",null,null,[e("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},"Realtime",3,null),e("h1",null,{class:"text-2xl font-semibold text-slate-50"},"WebSocket chat via Valkey pub/sub",3,null)],3,null),e("span",null,{class:"rounded-full bg-slate-800 px-3 py-1 text-xs text-slate-200"},"websocket",3,null)],3,null),e("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},"The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.",3,null),e("div",null,{class:"mt-4 flex items-center gap-3"},[e("button",null,{type:"button",class:"rounded-lg bg-slate-800 px-3 py-2 text-sm text-slate-100 ring-1 ring-slate-700 transition hover:bg-slate-700",disabled:m(s=>s.value,[a],"p0.value"),onClick$:w("s_kZj4pe9s4wU",[a])},m(s=>s.value?"Connected":"Connect to chat",[a],'p0.value?"Connected":"Connect to chat"'),3,null),!a.value&&e("span",null,{class:"text-xs text-slate-400"},"No socket opened until you opt in.",3,"TX_0")],1,null),e("div",null,{class:"mt-5 space-y-3 text-sm text-slate-200"},[e("div",null,{class:"surface max-h-64 overflow-auto p-4"},[t.value.length===0&&e("p",null,{class:"text-slate-500"},"No messages yet.",3,"TX_1"),t.value.map(s=>e("div",null,{class:"py-1"},[e("span",null,{class:"text-slate-400"},[_(s,"from"),":"],1,null)," ",e("span",null,null,_(s,"text"),1,null)],1,s.id))],1,null),e("div",null,{class:"flex gap-2"},[e("input",null,{value:m(s=>s.value,[n],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100",placeholder:"Say something quick",onInput$:w("s_wKLih1EFcnc",[n])},null,3,null),e("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:r},"Send",3,null)],3,null)],1,null)],1,"TX_2")},ke=g(c(we,"s_uFxaifyy6KQ"));const Se={title:"Chat | Prometheus",meta:[{name:"description",content:"WebSocket chat backed by Valkey pub/sub."}]};var Ie=`postgresql://${process.env.POSTGRES_USER??"prometheus"}:${process.env.POSTGRES_PASSWORD??"secret"}@${process.env.POSTGRES_HOST??"localhost"}:${process.env.POSTGRES_PORT??5433}/${process.env.POSTGRES_DB??"prometheus"}`;const Le=se(Ie,{max:5}),q=le(Le),v=R("store_items",{id:N("id").primaryKey(),name:L("name").notNull(),price:ae("price",{precision:10,scale:2}).notNull(),createdAt:Q("created_at",{mode:"date",withTimezone:!1}).defaultNow()}),lt=R("chat_messages",{id:N("id").primaryKey(),author:L("author").notNull(),body:L("body").notNull(),createdAt:Q("created_at",{mode:"date",withTimezone:!1}).defaultNow()});var qe=x({_auto_fetchStoreItems:()=>G,_auto_loadStoreItems:()=>C,_auto_normalizeItem:()=>A,default:()=>Qe,head:()=>je,onGet:()=>Ae,useCreateStoreItem:()=>U,useStoreItemsLoader:()=>O},1),A=t=>{const l=Number.parseFloat(String(t.price));return{...t,price:Number.isFinite(l)?l:0}};const Ae=({cacheControl:t})=>{t({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60})};var C=async t=>{const n=Number.isFinite(t)&&(t??0)>0?Number(t):0,a=q.select().from(v),r=n>0?a.where(E(v.id,n)):a;try{const s=(await r.orderBy(v.id).limit(6)).map(A);return{items:s,cursor:s.length===6?s[s.length-1].id:null,source:"db"}}catch(s){return console.error("Failed to load store items",s),{items:[{id:-1,name:"Sample adapter (offline)",price:24.99,createdAt:new Date},{id:-2,name:"Edge cache pack (offline)",price:12.5,createdAt:new Date}],cursor:null,source:"fallback"}}},G=V(c(te(async t=>C(t),"JpWhzM5IYRQ"),"s_JpWhzM5IYRQ")),Ce=async()=>C();const O=B(c(Ce,"s_U3a40FEZUMI"));var Te=async t=>{const l=String(t.name??"").trim(),n=Number.parseFloat(String(t.price??""));if(!l||Number.isNaN(n)||n<=0)return{success:!1,error:"Name and positive price required."};try{const[a]=await q.insert(v).values({name:l,price:n.toString()}).returning();return{success:!0,item:A(a)}}catch(a){return console.error("Failed to create store item",a),{success:!1,error:"Unable to create item right now."}}};const U=$(c(Te,"s_akWfhm1utK8"));var Pe=async(t=!1)=>{const[l,n,a,r,s,d]=y();if(!d.value){d.value=!0,n.value=null;try{const i=await G(t?void 0:l.value??void 0),p=i?.items??[];s.value=t?p:[...s.value,...p],l.value=i?.cursor??null,r.value=i?.source==="fallback",a.value=!0,n.value=i?.source==="fallback"?"Database offline: showing fallback inventory.":null}catch(i){console.error("Failed to load store items",i),n.value="Unable to load inventory right now."}finally{d.value=!1}}},Ee=()=>{const[t,l]=y();t.value||l(!0)},Re=({track:t})=>{const[l,n,a,r]=y(),s=t(()=>l.value);if(s?.success&&s.item){const d=[...r.value.filter(i=>i.id!==s.item.id),s.item];d.sort((i,p)=>i.id-p.id),r.value=d,a.value=!0,n.value=null}},Ne=()=>{const t=O(),l=f(t.value.items),n=f(t.value.cursor),a=f(!1),r=f(t.value.items.length>0),s=f(t.value.source==="fallback"),d=f(t.value.source==="fallback"?"Database offline: showing fallback inventory.":null),i=U(),p=c(Pe,"s_eOx2vYwfLnA",[n,d,r,s,l,a]);return I(c(Ee,"s_Yr4TxNikUdQ",[r,p]),{eagerness:"visible"}),I(c(Re,"s_3zYSb5qP7so",[i,d,r,l])),e("section",null,{class:"surface p-6"},[e("div",null,{class:"flex items-center justify-between gap-2"},[e("div",null,null,[e("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},"Store",3,null),e("h1",null,{class:"text-2xl font-semibold text-slate-50"},"Fast browsing with tiny payloads",3,null)],3,null),e("span",null,{class:"rounded-full bg-slate-800 px-3 py-1 text-xs text-slate-200"},"cached",3,null)],3,null),e("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},"Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.",3,null),e("div",null,{class:"mt-5 grid gap-4 rounded-lg border border-slate-800 bg-slate-900/60 p-4 md:grid-cols-[1.2fr_1fr]"},[e("div",null,{class:"space-y-4"},[e("div",null,{class:"flex items-center justify-between"},[e("p",null,{class:"text-sm text-slate-300"},"Inventory",3,null),e("button",null,{type:"button",class:"rounded-lg bg-slate-800 px-3 py-2 text-xs font-semibold text-slate-100 ring-1 ring-slate-700 transition hover:bg-slate-700 disabled:opacity-60",disabled:m(o=>o.value,[a],"p0.value"),onClick$:w("s_AyR4iJGOG10",[p])},"Refresh",3,null)],3,null),s.value&&e("p",null,{class:"text-xs text-amber-300"},"Showing fallback data while the database is unavailable.",3,"3h_0"),!r.value&&e("p",null,{class:"text-sm text-slate-500"},"Inventory loads once this section is visible.",3,"3h_1"),d.value&&e("p",null,{class:"text-sm text-rose-300"},m(o=>o.value,[d],"p0.value"),3,"3h_2"),l.value.length?e("ul",null,{class:"grid gap-3 md:grid-cols-2"},l.value.map(o=>e("li",null,{class:"surface p-4"},[e("p",null,{class:"text-sm text-slate-400"},["SKU ",_(o,"id")],1,null),e("p",null,{class:"text-lg font-semibold text-slate-50"},_(o,"name"),1,null),e("p",null,{class:"text-emerald-300"},["$",o.price.toFixed(2)],1,null)],1,o.id)),1,"3h_3"):r.value&&!a.value&&e("p",null,{class:"text-sm text-slate-500"},"No items yet.",3,"3h_4"),e("div",null,{class:"flex items-center gap-3"},[n.value!==null&&e("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950 transition hover:bg-emerald-400 disabled:opacity-60",disabled:m(o=>o.value,[a],"p0.value"),onClick$:w("s_yGSj8DRTmYs",[p])},"Load more",3,"3h_5"),a.value&&e("span",null,{class:"text-xs text-slate-400"},"Loading...",3,"3h_6")],1,null)],1,null),e("div",null,{class:"space-y-3 rounded-lg border border-slate-800 bg-slate-900/80 p-4"},[e("p",null,{class:"text-sm font-semibold text-slate-100"},"Add an item",3,null),h(X,{action:i,class:"space-y-3 text-sm text-slate-200",children:[e("div",null,{class:"space-y-1"},[e("label",null,{class:"text-xs uppercase tracking-wide text-slate-400",for:"name"},"Name",3,null),e("input",null,{id:"name",name:"name",class:"w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-slate-100",placeholder:"Lightweight widget",required:!0},null,3,null)],3,null),e("div",null,{class:"space-y-1"},[e("label",null,{class:"text-xs uppercase tracking-wide text-slate-400",for:"price"},"Price",3,null),e("input",null,{id:"price",name:"price",type:"number",step:"0.01",min:"0",class:"w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 text-slate-100",placeholder:"24.99",required:!0},null,3,null)],3,null),e("button",null,{type:"submit",class:"w-full rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950 transition hover:bg-emerald-400 disabled:opacity-70",disabled:m(o=>o.isRunning,[i],"p0.isRunning")},m(o=>o.isRunning?"Saving...":"Create item",[i],'p0.isRunning?"Saving...":"Create item"'),3,null),i.value?.error&&e("p",null,{class:"text-xs text-rose-300"},m(o=>o.value.error,[i],"p0.value.error"),3,"3h_7"),i.value?.success&&i.value.item&&e("p",null,{class:"text-xs text-emerald-300"},["Added ",m(o=>o.value.item.name,[i],"p0.value.item.name"),"."],3,"3h_8")],[u]:{action:u,class:u}},1,"3h_9")],1,null)],1,null)],1,"3h_10")},Qe=g(c(Ne,"s_bZ8kc5UlLx4"));const je={title:"Store | Prometheus",meta:[{name:"description",content:"Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading."}]};var ze=x({onGet:()=>Fe},1);const Fe=async({cacheControl:t,query:l,json:n})=>{t({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60});const a=Number.parseInt(l.get("limit")??"",10),r=Number.parseInt(l.get("cursor")??"",10),s=Number.isFinite(a)&&a>0?Math.min(a,50):10,d=Number.isFinite(r)&&r>0?r:0;try{const i=q.select().from(v),p=(await(d>0?i.where(E(v.id,d)):i).orderBy(v.id).limit(s)).map(o=>({...o,price:Number.parseFloat(String(o.price))}));n(200,{items:p,cursor:p.length===s?p[p.length-1].id:null})}catch(i){console.error("Failed to load store items",i),n(500,{error:"Unable to load items right now."})}},Me=[];var b=()=>ie;const Ge=[["/",[b,()=>me],"/",["q-CKp2q_tz.js","q-Dxn9tO1P.js"]],["ai",[b,()=>fe],"/ai",["q-CKp2q_tz.js","q-BSdglLjj.js"]],["chat",[b,()=>be],"/chat",["q-CKp2q_tz.js","q-BV7YggNZ.js"]],["index",[b,()=>de],"/index",["q-CKp2q_tz.js","q-ExKAbPqR.js"]],["store",[b,()=>qe],"/store",["q-CKp2q_tz.js","q-7KpTOVeK.js"]],["api/store/items",[b,()=>ze],"/api/store/items",["q-CKp2q_tz.js"]]],Oe=[];var Ue={routes:Ge,serverPlugins:Me,menus:Oe,trailingSlash:!1,basePathname:"/",cacheModules:!0},$e={};globalThis.__EXPERIMENTAL__=$e;var Ke=()=>h(Z,{children:[e("head",null,null,[e("meta",null,{charSet:"utf-8"},null,3,null),h(j,null,3,"xd_0")],1,null),e("body",null,{class:"app-shell"},h(H,null,3,"xd_1"),1,null)]},1,"xd_2"),De=g(c(Ke,"s_8txvw3enrrU")),He=t=>{const l=typeof t.base=="function"?t.base(t):t.base;return l?l.endsWith("/")?l:`${l}/`:"/build/"},T=t=>!!t&&typeof t=="object"&&"manifest"in t;function Ye(t){const l=t.manifest??P,n=T(l)?l.manifest:l,a=He(t),r=`${a}${n?.qwikLoader??"qwikloader.js"}`,s=t.containerAttributes?{lang:"en",...t.containerAttributes}:{lang:"en"},i={tag:"script",location:"head",attributes:{"data-qwik-lazy-loader":"1",dangerouslySetInnerHTML:`(function(){const src='${r}';if(!src)return;let started=false;const load=()=>{if(started||navigator.connection?.saveData)return;started=true;const s=document.createElement('script');s.type='module';s.defer=true;s.src=src;s.setAttribute('data-qwik-loader','lazy');document.head.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>triggers.forEach((event)=>document.removeEventListener(event,prime,listenerOpts));const triggers=['pointerdown','keydown','touchstart','focusin'];const listenerOpts={once:true,passive:true};triggers.forEach((event)=>document.addEventListener(event,prime,listenerOpts));document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible')prime();},{once:true});})();`}},p=n?T(l)?{...l,manifest:{...n,core:void 0,preloader:void 0,injections:[...n?.injections??[],i]}}:{...n,core:void 0,preloader:void 0,injections:[...n?.injections??[],i]}:l;return D(h(De,null,3,"CC_0"),{...t,base:a,manifest:p,qwikLoader:"never",preloader:!1,containerTagName:"html",containerAttributes:s,stream:t.stream??{static:{buffer:0},inOrder:["<html"]}})}var{router:We,notFound:Be}=ee({render:Ye,qwikCityPlan:Ue,manifest:P}),st={router:We,notFound:Be};export{st as default,Be as notFound,We as router};
