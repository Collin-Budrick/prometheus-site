import{t as ge}from"./q-B9iggP75.js";import{A as bi,C as W,D as X,E as le,O as Ee,S as te,T as N,_ as O,a as vi,b as Le,c as bt,d as wi,f as Wt,g as se,h as ce,i as Ht,k as ot,l as Si,m as Gt,n as Pi,o as $i,p as Ue,r as xi,s as Ti,t as Bt,u as Ci,v as m,w as Ni,x as _i,y as Se}from"./q-C0v9QpRa.js";import{partytownSnippet as Ai}from"@builder.io/partytown/integration";import Je from"postgres";import{numeric as Li,pgTable as Yt,serial as Xt,text as lt,timestamp as Zt}from"drizzle-orm/pg-core";const ut=["en","ko"],vt={en:"English",ko:"한국어"};let Ye="en",ve,er=()=>{if(ve)return ve;if(typeof document<"u"){const e=document.documentElement.lang;e&&e in vt&&(ve=e)}return ve||(ve=Ye),ve};var Bi=e=>vt[e]?e:(console.error(`unknown locale ${e}`),Ye);const qi=e=>{er=()=>ve=Bi(e())};var Qi=(e,t=[])=>{for(let r=0;typeof e=="object";r++){let i=e[t[r]]??e["*"];typeof i=="number"&&(i=e[i]),e=i}return typeof e=="string"?e.replace(/\$([\d$])/g,(r,i)=>i==="$"?"$":String(t[Number(i)-1]??"")):""},ki=e=>e.map((t,r)=>`${r}${t.replace(/\$/g,()=>"$$")}`).join("$").slice(1);const Ii="English",ji={"Performance Lab":"Performance Lab",Home:"Home",Store:"Store",Chat:"Chat",AI:"AI","Performance first":"Performance first","Microscopic first load, big capability":"Microscopic first load, big capability","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.","- Ultra-thin home route with immutable caching":"- Ultra-thin home route with immutable caching","- Lazy feature routes for store, chat, and AI":"- Lazy feature routes for store, chat, and AI","- Optional Partytown for third-party isolation":"- Optional Partytown for third-party isolation","Latency budget":"Latency budget","Server render: sub-50ms target with streaming enabled":"Server render: sub-50ms target with streaming enabled","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny","Speculative nav: prerender store, prefetch chat":"Speculative nav: prerender store, prefetch chat","Sample adapter (offline)":"Sample adapter (offline)","Edge cache pack (offline)":"Edge cache pack (offline)","Invalid id.":"Invalid id.","Item not found.":"Item not found.","Unable to delete item right now.":"Unable to delete item right now.","Name and positive price required.":"Name and positive price required.","Unable to create item right now.":"Unable to create item right now.","Database offline: showing fallback inventory.":"Database offline: showing fallback inventory.","Unable to load inventory right now.":"Unable to load inventory right now.","Fast browsing with tiny payloads":"Fast browsing with tiny payloads",cached:"cached","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.",Inventory:"Inventory",Refresh:"Refresh","Showing fallback data while the database is unavailable.":"Showing fallback data while the database is unavailable.","Inventory loads once this section is visible.":"Inventory loads once this section is visible.","SKU $1":"SKU $1","Delete $1":"Delete $1",Delete:"Delete","No items yet.":"No items yet.","Load more":"Load more","Loading...":"Loading...","Add an item":"Add an item",Name:"Name","Lightweight widget":"Lightweight widget",Price:"Price","Saving...":"Saving...","Create item":"Create item","Added $1.":"Added $1.",Realtime:"Realtime","WebSocket chat via Valkey pub/sub":"WebSocket chat via Valkey pub/sub",websocket:"websocket","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.",Connected:"Connected","Connect to chat":"Connect to chat","No socket opened until you opt in.":"No socket opened until you opt in.","No messages yet.":"No messages yet.","Say something quick":"Say something quick",Send:"Send","AI tools":"AI tools","Edge-friendly utilities":"Edge-friendly utilities","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.","Type a quick prompt":"Type a quick prompt","Send to API":"Send to API","Response: $1":"Response: $1","Prometheus | Ultra-fast starter":"Prometheus | Ultra-fast starter","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey performance stack starter.","Store | Prometheus":"Store | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.","Chat | Prometheus":"Chat | Prometheus","WebSocket chat backed by Valkey pub/sub.":"WebSocket chat backed by Valkey pub/sub.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Minimal AI utility route hitting Bun API.","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Interactivity wakes up only when you click.":""};var Di={locale:"en",name:Ii,translations:ji};const Oi="한국어",zi={"Performance Lab":"퍼포먼스 랩",Home:"홈",Store:"스토어",Chat:"채팅",AI:"AI","Performance first":"성능 우선","Microscopic first load, big capability":"초소형 첫 로드, 큰 역량","Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.":"Qwik City SSR은 셸을 가볍게 유지합니다. 브라우저가 View Transitions와 Speculation Rules를 지원하면 탐색이 강화되고, 서드파티 스크립트는 메인 스레드를 벗어납니다.","- Ultra-thin home route with immutable caching":"- 초경량 홈 라우트와 불변 캐싱","- Lazy feature routes for store, chat, and AI":"- 스토어, 채팅, AI를 위한 지연 로드 기능 라우트","- Optional Partytown for third-party isolation":"- 서드파티 격리를 위한 Partytown 선택 옵션","Latency budget":"레이턴시 예산","Server render: sub-50ms target with streaming enabled":"서버 렌더링: 스트리밍 사용 시 50ms 미만 목표","Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny":"크리티컬 CSS: UnoCSS + Lightning CSS로 페이로드를 최소화","Speculative nav: prerender store, prefetch chat":"추측 탐색: 스토어 프리렌더, 채팅 프리패치","Sample adapter (offline)":"샘플 어댑터(오프라인)","Edge cache pack (offline)":"엣지 캐시 팩(오프라인)","Invalid id.":"유효하지 않은 ID입니다.","Item not found.":"항목을 찾을 수 없습니다.","Unable to delete item right now.":"지금은 항목을 삭제할 수 없습니다.","Name and positive price required.":"이름과 양수 가격이 필요합니다.","Unable to create item right now.":"지금은 항목을 생성할 수 없습니다.","Database offline: showing fallback inventory.":"데이터베이스 오프라인: 대체 인벤토리를 표시합니다.","Unable to load inventory right now.":"지금은 인벤토리를 불러올 수 없습니다.","Fast browsing with tiny payloads":"초소형 페이로드로 빠른 탐색",cached:"캐시됨","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Data only wakes up once the route is visible to keep initial payloads microscopic.":"항목은 Drizzle을 통해 Postgres에서 직접 스트리밍되며, 응답을 가볍게 유지하기 위해 커서 페이지네이션을 사용합니다. 데이터는 라우트가 보일 때만 깨어나 초기 페이로드를 극소화합니다.",Inventory:"인벤토리",Refresh:"새로고침","Showing fallback data while the database is unavailable.":"데이터베이스를 사용할 수 없어 대체 데이터를 표시합니다.","Inventory loads once this section is visible.":"이 섹션이 보일 때 인벤토리가 로드됩니다.","SKU $1":"SKU $1","Delete $1":"$1 삭제",Delete:"삭제","No items yet.":"아직 항목이 없습니다.","Load more":"더 불러오기","Loading...":"로딩 중...","Add an item":"항목 추가",Name:"이름","Lightweight widget":"경량 위젯",Price:"가격","Saving...":"저장 중...","Create item":"항목 만들기","Added $1.":"$1 추가됨.",Realtime:"실시간","WebSocket chat via Valkey pub/sub":"Valkey pub/sub 기반 WebSocket 채팅",websocket:"웹소켓","The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.":"클라이언트는 홈 라우트를 극소화하기 위해 탐색 후에만 로드됩니다. 실시간이 필요할 때까지 bfcache 자격을 유지하도록 필요 시 연결합니다. 메시지는 API의 Valkey 채널을 통해 브로드캐스트됩니다.",Connected:"연결됨","Connect to chat":"채팅에 연결","No socket opened until you opt in.":"동의하기 전에는 소켓을 열지 않습니다.","No messages yet.":"메시지가 아직 없습니다.","Say something quick":"간단히 입력하세요",Send:"보내기","AI tools":"AI 도구","Edge-friendly utilities":"엣지 친화적 유틸리티","This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.":"이 라우트는 상호작용을 단순하게 유지합니다. 추가 클라이언트 번들을 보내지 않고 Bun + Elysia를 테스트하는 왕복 에코 API입니다.","Type a quick prompt":"간단한 프롬프트를 입력하세요","Send to API":"API로 보내기","Response: $1":"응답: $1","Prometheus | Ultra-fast starter":"Prometheus | 초고속 스타터","Qwik City + Bun + Valkey performance stack starter.":"Qwik City + Bun + Valkey 성능 스택 스타터.","Store | Prometheus":"스토어 | Prometheus","Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.":"Drizzle 기반 스토어로 Postgres에서 커서 페이지네이션과 지연 로드를 사용해 불러옵니다.","Chat | Prometheus":"채팅 | Prometheus","WebSocket chat backed by Valkey pub/sub.":"Valkey pub/sub 기반 WebSocket 채팅.","AI | Prometheus":"AI | Prometheus","Minimal AI utility route hitting Bun API.":"Bun API를 호출하는 최소 AI 유틸리티 라우트.","Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Interactivity wakes up only when you click.":""};var Fi={locale:"ko",fallback:"en",name:Oi,translations:zi},Vi={en:Di,ko:Fi},Ei=(e,t,r)=>{let i,s;do i=Vi[e],s=i.translations[t];while(!s&&(e=i.fallback));return s||(s=t),Qi(s,r)},Ri=(e,...t)=>Ei(er(),typeof e=="string"?e:ki(e),t),y=Ri,ct=e=>{if(!e)return;const t=e.trim();if(!t)return;const r=t.replace(/_/g,"-").toLowerCase(),i=r==="kr"?"ko":r,s=ut.find(o=>o.toLowerCase()===i);if(s)return s;const n=i.split("-")[0];if(n)return ut.find(o=>o.toLowerCase()===n)},Mi=e=>{if(!e)return;const t=e.split(",");for(const r of t){const i=r.split(";")[0],s=ct(i);if(s)return s}};const wt=({queryLocale:e,cookieLocale:t,acceptLanguage:r})=>ct(e)||ct(t)||Mi(r)||Ye;var Ui={path:"/",sameSite:"lax",maxAge:31536e3};const Ji=e=>({query:t,cookie:r,headers:i,locale:s})=>{const n=e({queryLocale:t.get("locale"),cookieLocale:r.get("locale")?.value,acceptLanguage:i.get("accept-language")});t.has("locale")&&(r.delete("locale"),r.delete("locale",{path:"/"}),r.set("locale",n,Ui)),s(n)};var Ki=ge({onRequest:()=>Wi},1);const Wi=Ji(wt);var Hi=new Set(["style","font","script","image"]);const Gi=(e,t,r)=>{const i=new Set;return Array.from(e??[]).filter(s=>{if(s.rel!=="preload")return!0;if(t)return!1;const n=s.href,o=s.as;return typeof n!="string"||n.trim().length===0||r&&!r.has(n)||typeof o!="string"||!Hi.has(o)||i.has(n)?!1:(i.add(n),!0)})},tr="/assets/critical.css";var rr=[{pattern:/^\/(?:.*)?$/,links:[{rel:"preload",href:tr,as:"style"}]}];const Yi=(e,t)=>{if(t)return[];const r=new Set;return rr.filter(({pattern:i})=>i.test(e)).flatMap(({links:i})=>i).filter(i=>{const s=i.href;if(typeof s!="string"||s.trim().length===0)return!1;const n=`${i.rel}:${s}`;return r.has(n)?!1:(r.add(n),!0)})};var Xi=e=>typeof e=="string"&&e.trim().length>0;const Zi=new Set(rr.flatMap(({links:e})=>e).filter(e=>e.rel==="preload").map(e=>e.href).filter(Xi));var es=(e,t)=>e===void 0?t:typeof e=="boolean"?e:e==="1"||e.toLowerCase()==="true",it=(e,t)=>es(e,t&&!0);const _e={speculationRules:it(void 0,!0),viewTransitions:it(void 0,!0),partytown:it(void 0,!0)};var ts=async e=>{const[t,r,i]=le();if(r||e.defaultPrevented||e.button!==0||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return;if(e.preventDefault(),typeof document>"u"){await i(t);return}const s=document,n=_e.viewTransitions?s.startViewTransition:void 0;if(n){n.call(s,()=>i(t))?.finished.catch(()=>{});return}await i(t)},rs=()=>{const e=bt(),t=Si(),r=wt({queryLocale:e.url.searchParams.get("locale"),cookieLocale:typeof document<"u"?document.cookie.split(";").map(s=>s.trim()).find(s=>s.startsWith("locale="))?.split("=")[1]:void 0,acceptLanguage:typeof navigator<"u"?navigator.languages?.join(",")||navigator.language:void 0}),i=s=>{const n=new URLSearchParams(e.url.search);n.set("locale",s);const o=n.toString();return`${e.url.pathname}${o?`?${o}`:""}`};return m("div",null,{class:"flex items-center gap-1 text-xs"},ut.map(s=>{const n=s===r,o=i(s);return m("a",{href:o,"aria-disabled":n,style:n?{viewTransitionName:"locale-pill"}:void 0,class:["rounded-full border px-2 py-1 transition-colors",n?"border-emerald-500/40 bg-emerald-500/10 text-emerald-200 pointer-events-none":"border-slate-700 text-slate-300 hover:text-emerald-200 hover:border-emerald-500/40"].join(" "),onClick$:N(ts,"s_CskzXQBKCjQ",[o,n,t])},null,vt[s]??s.toUpperCase(),0,s)}),1,"mU_0")};const is=W(N(rs,"s_00eYrYyi6VA"));var st=e=>{const t=typeof import.meta<"u"&&{BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!0}[e];if(t!==void 0)return t;if(typeof process<"u")return process.env?.[e]??process.env?.[e.replace(/^VITE_/,"")]},G={gaId:st("VITE_GTAG_ID"),adsClient:st("VITE_ADSENSE_CLIENT"),supportWidgetSrc:st("VITE_SUPPORT_WIDGET_SRC")},ir=[{id:"gtag",label:"Google Analytics 4",category:"analytics",src:G.gaId?`https://www.googletagmanager.com/gtag/js?id=${G.gaId}`:void 0,inline:G.gaId?`window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', '${G.gaId}', { transport_type: 'beacon', send_page_view: true });`:void 0,forward:["dataLayer.push","gtag"],attributes:{async:!0,"data-gtm-id":G.gaId},budgetKb:90,load:"defer",partytown:!0,fallback:"Falls back to async tag when Partytown is disabled.",when:!!G.gaId},{id:"adsense",label:"Google AdSense",category:"ads",src:G.adsClient?`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${G.adsClient}`:void 0,forward:["adsbygoogle.push"],attributes:{async:!0,"data-ad-client":G.adsClient,crossOrigin:"anonymous"},budgetKb:95,load:"idle",partytown:!0,fallback:"Loads on idle/timeout when Partytown is off to avoid blocking hydration.",when:!!G.adsClient},{id:"support-widget",label:"Support chat widget",category:"widget",src:G.supportWidgetSrc,budgetKb:120,load:"interaction",partytown:!1,fallback:"Injected after user input, idle callback, or 5s timeout.",when:!!G.supportWidgetSrc}];const ke=ir.filter(e=>e.when),Wl=Array.from(new Set(ir.flatMap(e=>e.forward??[])));var ss=(e,t)=>`(()=>{const url='${t}';let loaded=false;const load=()=>{if(loaded||!url)return;loaded=true;const s=document.createElement('script');s.src=url;s.async=true;s.dataset.thirdParty='${e}';document.body.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>events.forEach((event)=>window.removeEventListener(event,prime,opts));const events=['pointerdown','keydown','touchstart','focusin'];const opts={once:true,passive:true};events.forEach((event)=>window.addEventListener(event,prime,opts));if('requestIdleCallback'in window){requestIdleCallback(()=>prime(),{timeout:5000});}else{setTimeout(prime,5000);}setTimeout(load,8000);})();`,ns=()=>{const e=ke.some(r=>r.partytown),t=_e.partytown?Array.from(new Set(ke.flatMap(r=>r.forward??[]))):[];return ke.length?O(Ue,{children:[_e.partytown&&e&&m("script",{dangerouslySetInnerHTML:Ai({lib:"/~partytown/",forward:t})},null,null,3,"dH_0"),ke.map(r=>{if(!r.src&&!r.inline)return null;const i=r.attributes??{};if(r.partytown&&_e.partytown)return O(Ue,{children:[r.src&&Se("script",{type:"text/partytown",...i,get src(){return r.src},src:te(r,"src")},{type:ce},0,"dH_1"),r.inline&&Se("script",{type:"text/partytown",...i,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:te(r,"inline")},{type:ce},0,"dH_2")]},1,r.id);if(r.load==="interaction"&&r.src)return m("script",{dangerouslySetInnerHTML:ss(r.id,r.src)},null,null,3,`${r.id}-loader`);const s=r.load==="defer"?{defer:!0}:{async:!0};return O(Ue,{children:[r.src&&Se("script",{...i,...s,get src(){return r.src},src:te(r,"src")},null,0,"dH_3"),r.inline&&Se("script",{...i,...s,get dangerouslySetInnerHTML(){return r.inline},dangerouslySetInnerHTML:te(r,"inline")},null,0,"dH_4")]},1,r.id)})]},1,"dH_5"):null};const as=W(N(ns,"s_mLjU5QE56DA"));var os=".route-transition{view-transition-name:route;contain:paint}",ls=ge({RouterHead:()=>lr,_auto_isNonEmptyString:()=>sr,_auto_navLinks:()=>St,_auto_resolveSpeculationCandidates:()=>nr,_auto_resolveThirdPartyOrigins:()=>or,_auto_toSpeculationRules:()=>ar,default:()=>ds},1),St=[{href:"/",label:()=>y`Home`},{href:"/store",label:()=>y`Store`,dataSpeculate:"prerender"},{href:"/chat",label:()=>y`Chat`,dataSpeculate:"prefetch"},{href:"/ai",label:()=>y`AI`}],sr=e=>typeof e=="string"&&e.trim().length>0,nr=e=>St.filter(t=>!!t.dataSpeculate&&t.href!==e).map(({href:t,dataSpeculate:r})=>({url:t,action:r})),ar=e=>{const t=e.reduce((r,i)=>(r[i.action].push({source:"list",urls:[i.url]}),r),{prefetch:[],prerender:[]});return t.prefetch.length||t.prerender.length?t:null},or=e=>Array.from(e.reduce((t,r)=>{if(!r.src)return t;try{const{origin:i}=new URL(r.src);i&&t.add(i)}catch{}return t},new Set)),us=()=>{const e=Ti(),t=bt(),r=_e.speculationRules&&!0,i=r?nr(t.url.pathname):[],s=r?ar(i):null,n=Yi(t.url.pathname,!1),o=new Set([...Zi,...n.map(c=>c.href).filter(sr)]),l=or(ke),d=Gi([...e.links,...n],!1,o),h=!1,p=r&&s?`(()=>{try{if(navigator.connection?.saveData)return;if(!HTMLScriptElement.supports?.('speculationrules'))return;const payload=${JSON.stringify(s)};const script=document.createElement('script');script.type='speculationrules';script.textContent=JSON.stringify(payload);document.head.append(script);}catch{}})();`:void 0;return O(Ue,{children:[m("title",null,null,e.title||"Prometheus",1,null),m("meta",null,{name:"viewport",content:"width=device-width, initial-scale=1, viewport-fit=cover"},null,3,null),m("link",null,{rel:"canonical",href:se(c=>c.url.href,[t],"p0.url.href")},null,3,null),m("link",null,{rel:"stylesheet",href:tr},null,3,null),e.meta.map(c=>Se("meta",{...c},null,0,c.key)),d.map(c=>Se("link",{...c},null,0,c.key)),l.map(c=>m("link",{href:c},{rel:"dns-prefetch"},null,3,`dns:${c}`)),l.map(c=>m("link",{href:c},{rel:"preconnect",crossOrigin:"anonymous"},null,3,`preconnect:${c}`)),r&&i.map(({url:c,action:g})=>m("link",{rel:g,href:c},null,null,3,`${g}:${c}`)),e.styles.map(c=>Se("style",{...c.props,get dangerouslySetInnerHTML(){return c.style},dangerouslySetInnerHTML:te(c,"style")},null,0,c.key)),p&&m("script",{dangerouslySetInnerHTML:p},null,null,3,"qG_0"),_e.viewTransitions&&m("script",null,{dangerouslySetInnerHTML:"if ('startViewTransition' in document) {document.documentElement.classList.add('supports-view-transition');}"},null,3,"qG_1"),O(as,null,3,"qG_2"),h]},1,"qG_4")};const lr=W(N(us,"s_0ZAFccQi4aM"));var cs=()=>(Ee(N(os,"s_ovuN5RMiUy0")),m("div",null,{class:"min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950"},[m("header",null,{class:"sticky top-0 z-20 border-b border-slate-800 bg-slate-950/80 backdrop-blur"},m("nav",null,{class:"mx-auto flex max-w-5xl items-center justify-between px-4 py-3 text-sm font-medium"},[m("div",null,{class:"flex items-center gap-2"},[m("span",null,{class:"rounded-full bg-emerald-500/10 px-3 py-1 text-emerald-300"},"Prometheus",3,null),m("span",null,{class:"text-slate-400"},y`Performance Lab`,1,null)],1,null),m("div",null,{class:"flex items-center gap-4 text-slate-200"},[St.map(({href:e,label:t,dataSpeculate:r})=>m("a",{href:e,"data-speculate":r},{class:"hover:text-emerald-300 transition-colors"},t(),1,e)),O(is,null,3,"qG_5")],1,null)],1,null),1,null),m("main",null,{class:"mx-auto flex max-w-5xl flex-col gap-6 px-4 py-10 route-transition"},O(Gt,null,3,"qG_6"),1,null)],1,"qG_7")),ds=W(N(cs,"s_wqKL2Up903o")),hs=".home-grid{gap:1.5rem;display:grid}@media (width>=768px){.home-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}",fs=ge({default:()=>cr,head:()=>dr,onGet:()=>ur},1);const ur=({cacheControl:e})=>{e({public:!0,maxAge:900})};var ms=()=>(Ee(N(hs,"s_RIE80aAOC7Q")),m("section",null,{class:"home-grid"},[m("div",null,{class:"p-6 surface"},[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Performance first`,1,null),m("h1",null,{class:"mt-2 font-semibold text-slate-50 text-3xl"},y`Microscopic first load, big capability`,1,null),m("p",null,{class:"mt-4 text-slate-300"},y`Qwik City SSR keeps the shell light. Navigation is enhanced with View Transitions and Speculation Rules when the browser supports them, and third-party scripts stay off the main thread.`,1,null),m("div",null,{class:"gap-3 grid mt-6 text-slate-200 text-sm"},[m("div",null,{class:"flex items-center gap-2"},y`- Ultra-thin home route with immutable caching`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Lazy feature routes for store, chat, and AI`,1,null),m("div",null,{class:"flex items-center gap-2"},y`- Optional Partytown for third-party isolation`,1,null)],1,null)],1,null),m("div",null,{class:"p-6 text-slate-200 text-sm surface"},[m("h2",null,{class:"font-semibold text-slate-50 text-lg"},y`Latency budget`,1,null),m("ul",null,{class:"space-y-2 mt-3"},[m("li",null,null,y`Server render: sub-50ms target with streaming enabled`,1,null),m("li",null,null,y`Critical CSS: UnoCSS + Lightning CSS keeps payloads tiny`,1,null),m("li",null,null,y`Speculative nav: prerender store, prefetch chat`,1,null)],1,null)],1,null)],1,"FW_0")),cr=W(N(ms,"s_e7mxYERDQJw"));const dr=({withLocale:e})=>e(()=>({title:y`Prometheus | Ultra-fast starter`,meta:[{name:"description",content:y`Qwik City + Bun + Valkey performance stack starter.`}]}));var ps=ge({default:()=>cr,head:()=>dr,onGet:()=>ur},1),gs=".ai-island{margin-top:1rem}",ys=async()=>{const[e,t]=le();if(!e.value)return;const r=await fetch("/api/ai/echo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.value})});if(r.ok){const{echo:i}=await r.json();t.value=i}},bs=()=>{const e=X(""),t=X(""),r=N(ys,"s_rGtr6P02y5w",[e,t]);return m("div",null,{class:"ai-island space-y-3 text-sm text-slate-200"},[m("textarea",null,{value:se(i=>i.value,[e],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2",placeholder:y`Type a quick prompt`,rows:4,onInput$:Le("s_YrRlW66gD5Y",[e])},null,3,null),m("div",null,{class:"flex items-center gap-2"},[m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:r},y`Send to API`,1,null),t.value&&m("span",null,{class:"text-emerald-300"},y`Response: ${t.value}`,1,"9W_0")],1,null)],1,"9W_1")};const vs=W(N(bs,"s_6AcQXlwaGPM"));var ws=ge({default:()=>Ps,head:()=>$s},1),Ss=()=>(Ee(N(gs,"s_S5uQY9BGXbM")),m("section",null,{class:"surface p-6"},[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`AI tools`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`Edge-friendly utilities`,1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`This route keeps the interaction simple: a round-trip echo API that exercises Bun + Elysia without shipping extra client bundles.`,1,null),m("div",null,{onQVisible$:Le("s_08qeP0eGH6U")},O(vs,null,3,"gn_0"),1,null)],1,"gn_1")),Ps=W(N(Ss,"s_X8xIQqUjebE"));const $s=({withLocale:e})=>e(()=>({title:y`AI | Prometheus`,meta:[{name:"description",content:y`Minimal AI utility route hitting Bun API.`}]}));var xs=".chat-island{margin-top:1.25rem}.chat-messages{max-height:16rem}",Ts=({cleanup:e})=>{const[t,r,i]=le()},Cs=()=>{const[e,t]=le();!e.value||!t.value||(t.value.send(JSON.stringify({type:"chat",text:e.value})),e.value="")},Ns=()=>{const e=X([]),t=X(null),r=X(""),i=X(!1);ot(N(Ts,"s_QOX90pOt9sA",[e,i,t]),{eagerness:"visible"});const s=N(Cs,"s_0P85XrqKCfY",[r,t]);return m("div",null,{class:"chat-island"},[m("div",null,{class:"mt-4 flex items-center gap-3"},[m("button",null,{type:"button",class:"rounded-lg bg-slate-800 px-3 py-2 text-sm text-slate-100 ring-1 ring-slate-700 transition hover:bg-slate-700",disabled:se(n=>n.value,[i],"p0.value"),onClick$:Le("s_DoKYoyvM41g",[i])},i.value?y`Connected`:y`Connect to chat`,1,null),!i.value&&m("span",null,{class:"text-xs text-slate-400"},y`No socket opened until you opt in.`,1,"Ki_0")],1,null),m("div",null,{class:"mt-5 space-y-3 text-sm text-slate-200"},[m("div",null,{class:"surface chat-messages overflow-auto p-4"},[e.value.length===0&&m("p",null,{class:"text-slate-500"},y`No messages yet.`,1,"Ki_1"),e.value.map(n=>m("div",null,{class:"py-1"},[m("span",null,{class:"text-slate-400"},[te(n,"from"),":"],1,null)," ",m("span",null,null,te(n,"text"),1,null)],1,n.id))],1,null),m("div",null,{class:"flex gap-2"},[m("input",null,{value:se(n=>n.value,[r],"p0.value"),class:"w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100",placeholder:y`Say something quick`,onInput$:Le("s_hgk47q7YSmg",[r])},null,3,null),m("button",null,{type:"button",class:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-emerald-950",onClick$:s},y`Send`,1,null)],1,null)],1,null)],1,"Ki_2")};const _s=W(N(Ns,"s_54i2tFOIwmo"));var As=ge({default:()=>Bs,head:()=>qs},1),Ls=()=>(Ee(N(xs,"s_hNgJ6QruKFA")),m("section",null,{class:"surface p-6"},[m("div",null,{class:"flex items-center justify-between gap-2"},[m("div",null,null,[m("p",null,{class:"text-sm uppercase tracking-wide text-emerald-300"},y`Realtime`,1,null),m("h1",null,{class:"text-2xl font-semibold text-slate-50"},y`WebSocket chat via Valkey pub/sub`,1,null)],1,null),m("span",null,{class:"rounded-full bg-slate-800 px-3 py-1 text-xs text-slate-200"},y`websocket`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-sm text-slate-300"},y`The client only loads after navigation to keep the home route microscopic. Connect on demand to keep bfcache eligibility until realtime is needed. Messages fan out through Valkey channels on the API.`,1,null),m("div",null,{onQVisible$:Le("s_ELa2ERJwGkM")},O(_s,null,3,"TX_0"),1,null)],1,"TX_1")),Bs=W(N(Ls,"s_uFxaifyy6KQ"));const qs=({withLocale:e})=>e(()=>({title:y`Chat | Prometheus`,meta:[{name:"description",content:y`WebSocket chat backed by Valkey pub/sub.`}]}));var Pt=Symbol.for("drizzle:OriginalColumn"),u=Symbol.for("drizzle:entityKind"),Hl=Symbol.for("drizzle:hasOwnEntityKind");function f(e,t){if(!e||typeof e!="object")return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,u))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(e).constructor;if(r)for(;r;){if(u in r&&r[u]===t[u])return!0;r=Object.getPrototypeOf(r)}return!1}var L=class{static[u]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;length;isLengthExact;isAlias;config;table;onInit(){}constructor(e,t){this.config=t,this.onInit(),this.table=e,this.name=t.name,this.isAlias=!1,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity,this.length=t.length,this.isLengthExact=t.isLengthExact}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}[Pt](){return this}},Qs=class{static[u]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}},he=Symbol.for("drizzle:Name"),ks=class{static[u]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{const{name:r,columns:i,foreignColumns:s}=e();return{name:r,columns:i,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Is(e,this)}},Is=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[u]="PgForeignKey";reference;onUpdate;onDelete;name;getName(){const{name:e,columns:t,foreignColumns:r}=this.reference(),i=t.map(o=>o.name),s=r.map(o=>o.name),n=[this.table[he],...i,r[0].table[he],...s];return e??`${n.join("_")}_fk`}isNameExplicit(){return!!this.reference().name}};function js(e,...t){return e(...t)}function qt(e,t,r){for(let i=t;i<e.length;i++){const s=e[i];if(s==="\\"){i++;continue}if(s==='"')return[e.slice(t,i).replace(/\\/g,""),i+1];if(!r&&(s===","||s==="}"))return[e.slice(t,i).replace(/\\/g,""),i]}return[e.slice(t).replace(/\\/g,""),e.length]}function hr(e,t=0){const r=[];let i=t,s=!1;for(;i<e.length;){const n=e[i];if(n===","){(s||i===t)&&r.push(""),s=!0,i++;continue}if(s=!1,n==="\\"){i+=2;continue}if(n==='"'){const[d,h]=qt(e,i+1,!0);r.push(d),i=h;continue}if(n==="}")return[r,i+1];if(n==="{"){const[d,h]=hr(e,i+1);r.push(d),i=h;continue}const[o,l]=qt(e,i,!1);r.push(o),i=l}return[r,i]}function Qt(e){const[t]=hr(e,1);return t}function fr(e){return`{${e.map(t=>Array.isArray(t)?fr(t):typeof t=="string"?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}var x=class extends Qs{foreignKeyConfigs=[];static[u]="PgColumnBuilder";array(e){return new Os(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,config:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,config:i})=>js((s,n)=>{const o=new ks(()=>{const l=s();return{name:n.name,columns:[e],foreignColumns:[l]}});return n.onUpdate&&o.onUpdate(n.onUpdate),n.onDelete&&o.onDelete(n.onDelete),o.build(t)},r,i))}buildExtraConfigColumn(e){return new Ds(e,this.config)}},S=class extends L{static[u]="PgColumn";table;constructor(e,t){super(e,t),this.table=e}},Ds=class extends S{static[u]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Gl=class{static[u]="IndexedColumn";constructor(e,t,r,i){this.name=e,this.keyAsName=t,this.type=r,this.indexConfig=i}name;keyAsName;type;indexConfig},Os=class extends x{static[u]="PgArrayBuilder";constructor(e,t,r){super(e,"array basecolumn","PgArray"),this.config.baseBuilder=t,this.config.length=r}build(e){const t=this.config.baseBuilder.build(e);return new mr(e,this.config,t)}},mr=class pr extends S{constructor(t,r,i,s){super(t,r),this.baseColumn=i,this.range=s}static[u]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.length=="number"?this.length:""}]`}mapFromDriverValue(t){return typeof t=="string"&&(t=Qt(t)),t.map(r=>this.baseColumn.mapFromDriverValue(r))}mapFromJsonValue(t){typeof t=="string"&&(t=Qt(t));const r=this.baseColumn;return"mapFromJsonValue"in r?t.map(i=>r.mapFromJsonValue(i)):t.map(i=>r.mapFromDriverValue(i))}mapToDriverValue(t,r=!1){const i=t.map(s=>s===null?null:f(this.baseColumn,pr)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return r?i:fr(i)}},Yl=class extends x{static[u]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumObjectColumn"),this.config.enum=t}build(e){return new zs(e,this.config)}},zs=class extends S{static[u]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},kt=Symbol.for("drizzle:isPgEnum");function Fs(e){return!!e&&typeof e=="function"&&kt in e&&e[kt]===!0}var Xl=class extends x{static[u]="PgEnumColumnBuilder";constructor(e,t){super(e,"string enum","PgEnumColumn"),this.config.enum=t}build(e){return new Vs(e,this.config)}},Vs=class extends S{static[u]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},V=class{static[u]="Subquery";constructor(e,t,r,i=!1,s=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:i,usedTables:s}}},gr=class extends V{static[u]="WithSubquery"},B={startActiveSpan(e,t){return t()}},q=Symbol.for("drizzle:ViewBaseConfig"),ae=Symbol.for("drizzle:Schema"),me=Symbol.for("drizzle:Columns"),It=Symbol.for("drizzle:ExtraConfigColumns"),De=Symbol.for("drizzle:OriginalName"),nt=Symbol.for("drizzle:BaseName"),Be=Symbol.for("drizzle:IsAlias"),jt=Symbol.for("drizzle:ExtraConfigBuilder"),Es=Symbol.for("drizzle:IsDrizzleTable"),b=class{static[u]="Table";static Symbol={Name:he,Schema:ae,OriginalName:De,Columns:me,ExtraConfigColumns:It,BaseName:nt,IsAlias:Be,ExtraConfigBuilder:jt};[he];[De];[ae];[me];[It];[nt];[Be]=!1;[Es]=!0;[jt]=void 0;constructor(e,t,r){this[he]=this[De]=e,this[ae]=t,this[nt]=r}};function ne(e){return e[he]}function Fe(e){return`${e[ae]??"public"}.${e[he]}`}var Zl=class{static[u]="FakePrimitiveParam"};function $t(e){return e!=null&&typeof e.getSQL=="function"}function Rs(e){const t={sql:"",params:[]};for(const r of e)t.sql+=r.sql,t.params.push(...r.params),r.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}var F=class{static[u]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new v([this])}},v=class Ie{constructor(t){this.queryChunks=t;for(const r of t)if(f(r,b)){const i=r[b.Symbol.Schema];this.usedTables.push(i===void 0?r[b.Symbol.Name]:i+"."+r[b.Symbol.Name])}}static[u]="SQL";decoder=xt;shouldInlineParams=!1;usedTables=[];append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return B.startActiveSpan("drizzle.buildSQL",r=>{const i=this.buildQueryFromSourceParams(this.queryChunks,t);return r?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(t,r){const i=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:s,escapeName:n,escapeParam:o,prepareTyping:l,inlineParams:d,paramStartIndex:h,invokeSource:p}=i;return Rs(t.map(c=>{if(f(c,F))return{sql:c.value.join(""),params:[]};if(f(c,dt))return{sql:n(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){const g=[new F("(")];for(const[w,A]of c.entries())g.push(A),w<c.length-1&&g.push(new F(", "));return g.push(new F(")")),this.buildQueryFromSourceParams(g,i)}if(f(c,Ie))return this.buildQueryFromSourceParams(c.queryChunks,{...i,inlineParams:d||c.shouldInlineParams});if(f(c,b)){const g=c[b.Symbol.Schema],w=c[b.Symbol.Name];return p==="mssql-view-with-schemabinding"?{sql:n(g===void 0?"dbo":g)+"."+n(w),params:[]}:{sql:g===void 0||c[Be]?n(w):n(g)+"."+n(w),params:[]}}if(f(c,L)){const g=s.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:n(g),params:[]};const w=p==="mssql-check"?void 0:c.table[b.Symbol.Schema];return{sql:c.isAlias?n(c.name):c.table[Be]||w===void 0?n(c.table[b.Symbol.Name])+"."+n(g):n(w)+"."+n(c.table[b.Symbol.Name])+"."+n(g),params:[]}}if(f(c,ye)){const g=c[q].schema,w=c[q].name;return{sql:g===void 0||c[q].isAlias?n(w):n(g)+"."+n(w),params:[]}}if(f(c,pe)){if(f(c.value,$e))return{sql:o(h.value++,c),params:[c],typings:["none"]};const g=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(f(g,Ie))return this.buildQueryFromSourceParams([g],i);if(d)return{sql:this.mapInlineParam(g,i),params:[]};let w=["none"];return l&&(w=[l(c.encoder)]),{sql:o(h.value++,g),params:[g],typings:w}}return f(c,$e)?{sql:o(h.value++,c),params:[c],typings:["none"]}:f(c,Ie.Aliased)&&c.fieldAlias!==void 0?{sql:n(c.fieldAlias),params:[]}:f(c,V)?c._.isWith?{sql:n(c._.alias),params:[]}:this.buildQueryFromSourceParams([new F("("),c._.sql,new F(") "),new dt(c._.alias)],i):Fs(c)?c.schema?{sql:n(c.schema)+"."+n(c.enumName),params:[]}:{sql:n(c.enumName),params:[]}:$t(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],i):this.buildQueryFromSourceParams([new F("("),c.getSQL(),new F(")")],i):d?{sql:this.mapInlineParam(c,i),params:[]}:{sql:o(h.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(t,{escapeString:r}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(typeof t=="string")return r(t);if(typeof t=="object"){const i=t.toString();return r(i==="[object Object]"?JSON.stringify(t):i)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new Ie.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}},dt=class{constructor(e){this.value=e}static[u]="Name";brand;getSQL(){return new v([this])}};function Ms(e){return typeof e=="object"&&e!==null&&"mapToDriverValue"in e&&typeof e.mapToDriverValue=="function"}var xt={mapFromDriverValue:e=>e},yr={mapToDriverValue:e=>e},eu={...xt,...yr},pe=class{constructor(e,t=yr){this.value=e,this.encoder=t}static[u]="Param";brand;getSQL(){return new v([this])}};function a(e,...t){const r=[];(t.length>0||e.length>0&&e[0]!=="")&&r.push(new F(e[0]));for(const[i,s]of t.entries())r.push(s,new F(e[i+1]));return new v(r)}(e=>{function t(){return new v([])}e.empty=t;function r(d){return new v(d)}e.fromList=r;function i(d){return new v([new F(d)])}e.raw=i;function s(d,h){const p=[];for(const[c,g]of d.entries())c>0&&h!==void 0&&p.push(h),p.push(g);return new v(p)}e.join=s;function n(d){return new dt(d)}e.identifier=n;function o(d){return new $e(d)}e.placeholder=o;function l(d,h){return new pe(d,h)}e.param=l})(a||(a={}));(e=>{class t{constructor(i,s){this.sql=i,this.fieldAlias=s}static[u]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new t(this.sql,this.fieldAlias)}}e.Aliased=t})(v||(v={}));var $e=class{constructor(e){this.name=e}static[u]="Placeholder";getSQL(){return new v([this])}};function at(e,t){return e.map(r=>{if(f(r,$e)){if(!(r.name in t))throw new Error(`No value for placeholder "${r.name}" was provided`);return t[r.name]}if(f(r,pe)&&f(r.value,$e)){if(!(r.value.name in t))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(t[r.value.name])}return r})}var Us=Symbol.for("drizzle:IsDrizzleView"),ye=class{static[u]="View";[q];[Us]=!0;get[he](){return this[q].name}get[ae](){return this[q].schema}get[Be](){return this[q].isAlias}get[De](){return this[q].originalName}get[me](){return this[q].selectedFields}constructor({name:e,schema:t,selectedFields:r,query:i}){this[q]={name:e,originalName:e,schema:t,selectedFields:r,query:i,isExisting:!i,isAlias:!1}}};L.prototype.getSQL=function(){return new v([this])};V.prototype.getSQL=function(){return new v([this])};var He=class{constructor(e,t){this.table=e,this.ignoreColumnAlias=t}static[u]="ColumnTableAliasProxyHandler";get(e,t){return t==="table"?this.table:t==="isAlias"&&this.ignoreColumnAlias?!1:e[t]}},Tt=class{constructor(e,t,r){this.alias=e,this.replaceOriginalName=t,this.ignoreColumnAlias=r}static[u]="TableAliasProxyHandler";get(e,t){if(t===b.Symbol.IsAlias)return!0;if(t===b.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===b.Symbol.OriginalName)return this.alias;if(t===q)return{...e[q],name:this.alias,isAlias:!0};if(t===b.Symbol.Columns){const i=e[b.Symbol.Columns];if(!i)return i;const s={};return Object.keys(i).map(n=>{s[n]=new Proxy(i[n],new He(new Proxy(e,this),this.ignoreColumnAlias))}),s}const r=e[t];return f(r,L)?new Proxy(r,new He(new Proxy(e,this),this.ignoreColumnAlias)):r}},Js=class{constructor(e){this.alias=e}static[u]="ColumnAliasProxyHandler";get(e,t){return t==="isAlias"?!0:t==="name"?this.alias:t==="keyAsName"?!1:t===Pt?()=>e:e[t]}},tu=class{constructor(e){this.alias=e}static[u]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?ie(e.sourceTable,this.alias):e[t]}};function ie(e,t){return new Proxy(e,new Tt(t,!1,!1))}function Ks(e,t){return new Proxy(e,new Js(t))}function re(e,t){return new Proxy(e,new He(new Proxy(e.table,new Tt(t,!1,!1)),!1))}function br(e,t){return new v.Aliased(Ge(e.sql,t),e.fieldAlias)}function Ge(e,t){return a.join(e.queryChunks.map(r=>f(r,L)?re(r,t):f(r,v)?Ge(r,t):f(r,v.Aliased)?br(r,t):r))}L.prototype.as=function(e){return Ks(this,e)};function Dt(e){return e[Pt]()}var Oe=class extends Error{static[u]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Te=class vr extends Error{constructor(t,r,i){super(`Failed query: ${t}
params: ${r}`),this.query=t,this.params=r,this.cause=i,Error.captureStackTrace(this,vr),i&&(this.cause=i)}static[u]="DrizzleQueryError"},Ws=class extends Oe{static[u]="TransactionRollbackError";constructor(){super({message:"Rollback"})}},Hs=class{static[u]="ConsoleLogWriter";write(e){console.log(e)}},Gs=class{static[u]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Hs}logQuery(e,t){const r=t.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},Ys=class{static[u]="NoopLogger";logQuery(){}},be=class{static[u]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};function Q(e,t){return Ms(t)&&!$t(e)&&!f(e,pe)&&!f(e,$e)&&!f(e,L)&&!f(e,b)&&!f(e,ye)?new pe(e,t):e}var fe=(e,t)=>a`${e} = ${Q(t,e)}`,wr=(e,t)=>a`${e} <> ${Q(t,e)}`;function K(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new v(t):new v([new F("("),a.join(t,new F(" and ")),new F(")")])}function Xe(...e){const t=e.filter(r=>r!==void 0);if(t.length!==0)return t.length===1?new v(t):new v([new F("("),a.join(t,new F(" or ")),new F(")")])}function Ze(e){return a`not ${e}`}var et=(e,t)=>a`${e} > ${Q(t,e)}`,Sr=(e,t)=>a`${e} >= ${Q(t,e)}`,Pr=(e,t)=>a`${e} < ${Q(t,e)}`,$r=(e,t)=>a`${e} <= ${Q(t,e)}`;function xr(e,t){return Array.isArray(t)?t.length===0?a`false`:a`${e} in ${t.map(r=>Q(r,e))}`:a`${e} in ${Q(t,e)}`}function Tr(e,t){return Array.isArray(t)?t.length===0?a`true`:a`${e} not in ${t.map(r=>Q(r,e))}`:a`${e} not in ${Q(t,e)}`}function Cr(e){return a`(${e} is null)`}function Nr(e){return a`(${e} is not null)`}function Ct(e){return a`exists ${e}`}function Nt(e){return a`not exists ${e}`}function _r(e,t,r){return a`${e} between ${Q(t,e)} and ${Q(r,e)}`}function Ar(e,t,r){return a`${e} not between ${Q(t,e)} and ${Q(r,e)}`}function Lr(e,t){return a`${e} like ${t}`}function Br(e,t){return a`${e} not like ${t}`}function qr(e,t){return a`${e} ilike ${t}`}function Qr(e,t){return a`${e} not ilike ${t}`}function Xs(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContains requires at least one value");return a`${e} @> ${a`${Q(t,e)}`}`}return a`${e} @> ${Q(t,e)}`}function Zs(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayContained requires at least one value");return a`${e} <@ ${a`${Q(t,e)}`}`}return a`${e} <@ ${Q(t,e)}`}function en(e,t){if(Array.isArray(t)){if(t.length===0)throw new Error("arrayOverlaps requires at least one value");return a`${e} && ${a`${Q(t,e)}`}`}return a`${e} && ${Q(t,e)}`}function ze(e){return a`${e} asc`}function _t(e){return a`${e} desc`}var kr=class{constructor(e,t){this.targetTableName=t,this.targetTable=e}static[u]="RelationV2";fieldName;sourceColumns;targetColumns;alias;where;sourceTable;targetTable;through;throughTable;isReversed;sourceColumnTableNames=[];targetColumnTableNames=[]},Ir=class extends kr{static[u]="OneV2";relationType="one";optional;constructor(e,t,r,i){super(t,r),this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)}),this.optional=i?.optional??!0}},tn=class extends kr{constructor(e,t,r,i){super(t,r),this.config=i,this.alias=i?.alias,this.where=i?.where,i?.from&&(this.sourceColumns=(Array.isArray(i.from)?i.from:[i.from]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.sourceColumnTableNames.push(s._.tableName),s._.column))),i?.to&&(this.targetColumns=(Array.isArray(i.to)?i.to:[i.to]).map(s=>(this.throughTable??=s._.through?e[s._.through._.tableName]:void 0,this.targetColumnTableNames.push(s._.tableName),s._.column))),this.throughTable&&(this.through={source:(Array.isArray(i?.from)?i.from:i?.from?[i.from]:[]).map(s=>s._.through),target:(Array.isArray(i?.to)?i.to:i?.to?[i.to]:[]).map(s=>s._.through)})}static[u]="ManyV2";relationType="many"},rn=class{static[u]="AggregatedField";table;onTable(e){return this.table=e,this}},sn=class extends rn{static[u]="AggregatedFieldCount";query;getSQL(){if(!this.query){if(!this.table)throw new Error("Table must be set before building aggregate field");this.query=a`select count(*) as ${a.identifier("r")} from ${Ae(this.table)}`.mapWith(Number)}return this.query}},Ne={and:K,between:_r,eq:fe,exists:Ct,gt:et,gte:Sr,ilike:qr,inArray:xr,arrayContains:Xs,arrayContained:Zs,arrayOverlaps:en,isNull:Cr,isNotNull:Nr,like:Lr,lt:Pr,lte:$r,ne:wr,not:Ze,notBetween:Ar,notExists:Nt,notLike:Br,notIlike:Qr,notInArray:Tr,or:Xe,sql:a},nn={sql:a,asc:ze,desc:_t};function ht(e,t,r=o=>o,i=!1,s=!1,n){for(const o of t){if(o.selection){const p=`${n?`${n}.`:""}${o.key}`;if(e[o.key]===null||i&&(e[o.key]=JSON.parse(e[o.key]),e[o.key]===null))continue;if(s&&typeof e[o.key]=="string"&&(e[o.key]=JSON.parse(e[o.key])),o.isArray){for(const c of e[o.key])ht(c,o.selection,r,!1,s,p);continue}ht(e[o.key],o.selection,r,!1,s,p);continue}const l=o.field,d=r(e[o.key]);if(d===null)continue;let h;f(l,L)?h=l:f(l,v)?h=l.decoder:f(l,v.Aliased)?h=l.sql.decoder:f(l,b)||f(l,ye)?h=xt:h=l.getSQL().decoder,e[o.key]="mapFromJsonValue"in h?h.mapFromJsonValue(d):h.mapFromDriverValue(d)}return e}var ru=class{static[u]="RelationsBuilderTable";_;constructor(e,t){this._={name:t,table:e}}},iu=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r){this._={tableName:t,column:e,key:r}}through(e){return new an(this._.column,this._.tableName,this._.key,e)}},an=class{static[u]="RelationsBuilderColumn";_;constructor(e,t,r,i){this._={tableName:t,column:e,through:i,key:r}}},su=class{static[u]="RelationsHelperStatic";_;constructor(e){this._={tables:e};const t={},r={};for(const[i,s]of Object.entries(e))t[i]=n=>new Ir(e,s,i,n),r[i]=n=>new tn(e,s,i,n);this.one=t,this.many=r}one;many;aggs={count(){return new sn}}};function jr(e,t){const r=e[me][t];return r?f(r,L)?r:f(r,v.Aliased)?a`${e}.${a.identifier(r.fieldAlias)}`:a`${e}.${a.identifier(t)}`:a`${e}.${a.identifier(t)}`}function Ke(e,t){if(typeof t!="object"||f(t,$e))return fe(e,t);const r=Object.entries(t);if(!r.length)return;const i=[];for(const[s,n]of r)if(n!==void 0)switch(s){case"NOT":{const o=Ke(e,n);if(!o)continue;i.push(Ze(o));continue}case"OR":if(!n.length)continue;i.push(Xe(...n.map(o=>Ke(e,o))));continue;case"AND":if(!n.length)continue;i.push(K(...n.map(o=>Ke(e,o))));continue;case"isNotNull":case"isNull":if(!n)continue;i.push(Ne[s](e));continue;case"in":i.push(Ne.inArray(e,n));continue;case"notIn":i.push(Ne.notInArray(e,n));continue;default:i.push(Ne[s](e,n));continue}if(i.length)return K(...i)}function de(e,t,r={},i={},s,n=0){const o=Object.entries(t);if(!o.length)return;const l=[];for(const[d,h]of o)if(h!==void 0)switch(d){case"RAW":{const p=typeof h=="function"?h(e,Ne):h.getSQL();l.push(p);continue}case"OR":if(!h?.length)continue;l.push(Xe(...h.map(p=>de(e,p,r,i,s,n))));continue;case"AND":if(!h?.length)continue;l.push(K(...h.map(p=>de(e,p,r,i,s,n))));continue;case"NOT":{if(h===void 0)continue;const p=de(e,h,r,i,s,n);if(!p)continue;l.push(Ze(p));continue}default:{if(e[me][d]){const _=Ke(jr(e,d),h);_&&l.push(_);continue}const p=r[d];if(!p)throw new Oe({message:`Unknown relational filter field: "${d}"`});const c=ie(p.targetTable,`f${n}`),g=p.throughTable?ie(p.throughTable,`ft${n}`):void 0,w=i[p.targetTableName],{filter:A,joinCondition:$}=Dr(s,p,e,c,g),C=K(A,typeof h=="boolean"?void 0:de(c,h,w.relations,i,s,n+1)),I=g?a`(select * from ${Ae(c)} inner join ${Ae(g)} on ${$}${a` where ${C}`.if(C)} limit 1)`:a`(select * from ${Ae(c)}${a` where ${C}`.if(C)} limit 1)`;C&&l.push((h?Ct:Nt)(I))}}return K(...l)}function on(e,t){if(typeof t=="function"){const i=t(e,nn);return f(i,v)?i:Array.isArray(i)?i.length?a.join(i.map(s=>f(s,v)?s:ze(s)),a`, `):void 0:f(i,L)?ze(i):void 0}const r=Object.entries(t).filter(([i,s])=>s);if(r.length)return a.join(r.map(([i,s])=>(s==="asc"?ze:_t)(jr(e,i))),a`, `)}function ln(e,t){const r=[],i=[];for(const[s,n]of Object.entries(t)){if(!n)continue;const o=typeof n=="function"?n(e,{sql:Ne.sql}):n,l=a`(${o.getSQL()}) as ${a.identifier(s)}`;l.decoder=o.getSQL().decoder,r.push(l),i.push({key:s,field:l})}return{sql:r.length?a.join(r,a`, `):void 0,selection:i}}function Dr(e,t,r,i,s){if(t.through){const n=t.sourceColumns.map((l,d)=>{const h=t.through.source[d];return fe(a`${r}.${a.identifier(e.getColumnCasing(l))}`,a`${s}.${a.identifier(f(h._.column,L)?e.getColumnCasing(h._.column):h._.key)}`)}),o=t.targetColumns.map((l,d)=>{const h=t.through.target[d];return fe(a`${s}.${a.identifier(f(h._.column,L)?e.getColumnCasing(h._.column):h._.key)}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)});return{filter:K(t.where?de(t.isReversed?r:i,t.where):void 0,...n),joinCondition:K(...o)}}return{filter:K(...t.sourceColumns.map((n,o)=>{const l=t.targetColumns[o];return fe(a`${r}.${a.identifier(e.getColumnCasing(n))}`,a`${i}.${a.identifier(e.getColumnCasing(l))}`)}),t.where?de(t.isReversed?r:i,t.where):void 0)}}function Ae(e){return a`${e[Be]?a`${a`${a.identifier(e[ae]??"")}.`.if(e[ae])}${a.identifier(e[De])} as ${e}`:e}`}function un(e,t,r){const i={},s=e.reduce((n,{path:o,field:l},d)=>{let h;f(l,L)?h=l:f(l,v)?h=l.decoder:f(l,V)?h=l._.sql.decoder:h=l.sql.decoder;let p=n;for(const[c,g]of o.entries())if(c<o.length-1)g in p||(p[g]={}),p=p[g];else{const w=t[d],A=p[g]=w===null?null:h.mapFromDriverValue(w);if(r&&f(l,L)&&o.length===2){const $=o[0];$ in i?typeof i[$]=="string"&&i[$]!==ne(l.table)&&(i[$]=!1):i[$]=A===null?ne(l.table):!1}}return n},{});if(r&&Object.keys(i).length>0)for(const[n,o]of Object.entries(i))typeof o=="string"&&!r[o]&&(s[n]=null);return s}function xe(e,t){return Object.entries(e).reduce((r,[i,s])=>{if(typeof i!="string")return r;const n=t?[...t,i]:[i];return f(s,L)||f(s,v)||f(s,v.Aliased)||f(s,V)?r.push({path:n,field:s}):f(s,b)?r.push(...xe(s[b.Symbol.Columns],n)):r.push(...xe(s,n)),r},[])}function At(e,t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const[s,n]of r.entries())if(n!==i[s])return!1;return!0}function Or(e,t){const r=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,s])=>f(s,v)||f(s,L)?[i,s]:[i,new pe(s,e[b.Symbol.Columns][i])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function cn(e,t){for(const r of t)for(const i of Object.getOwnPropertyNames(r.prototype))i!=="constructor"&&Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(r.prototype,i)||Object.create(null))}function dn(e){return e[b.Symbol.Columns]}function we(e){return f(e,V)?e._.alias:f(e,ye)?e[q].name:f(e,v)?void 0:e[b.Symbol.IsAlias]?e[b.Symbol.Name]:e[b.Symbol.BaseName]}function z(e,t){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:t}}var nu=typeof TextDecoder>"u"?null:new TextDecoder,Re=class extends x{static[u]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:t,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}},hn=class extends Re{static[u]="PgBigInt53Builder";constructor(e){super(e,"number int53","PgBigInt53")}build(e){return new fn(e,this.config)}},fn=class extends S{static[u]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},mn=class extends Re{static[u]="PgBigInt64Builder";constructor(e){super(e,"bigint int64","PgBigInt64")}build(e){return new pn(e,this.config)}},pn=class extends S{static[u]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}},gn=class extends Re{static[u]="PgBigIntStringBuilder";constructor(e){super(e,"string int64","PgBigIntString")}build(e){return new yn(e,this.config)}},yn=class extends S{static[u]="PgBigIntString";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}};function bn(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new hn(r):i.mode==="string"?new gn(r):new mn(r)}var vn=class extends x{static[u]="PgBigSerial53Builder";constructor(e){super(e,"number int53","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new wn(e,this.config)}},wn=class extends S{static[u]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Sn=class extends x{static[u]="PgBigSerial64Builder";constructor(e){super(e,"bigint int64","PgBigSerial64"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Pn(e,this.config)}},Pn=class extends S{static[u]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function $n(e,t){const{name:r,config:i}=z(e,t);return i.mode==="number"?new vn(r):new Sn(r)}var xn=class extends x{static[u]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new Tn(e,this.config)}},Tn=class extends S{static[u]="PgBoolean";getSQLType(){return"boolean"}};function Cn(e){return new xn(e??"")}var Nn=class extends x{static[u]="PgCharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgChar"),this.config.length=t.length??1,this.config.setLength=t.length!==void 0,this.config.enumValues=t.enum}build(e){return new _n(e,this.config)}},_n=class extends S{static[u]="PgChar";enumValues=this.config.enumValues;getSQLType(){return this.config.setLength?`char(${this.length})`:"char"}};function An(e,t={}){const{name:r,config:i}=z(e,t);return new Nn(r,i)}var Ln=class extends x{static[u]="PgCidrBuilder";constructor(e){super(e,"string cidr","PgCidr")}build(e){return new Bn(e,this.config)}},Bn=class extends S{static[u]="PgCidr";getSQLType(){return"cidr"}};function qn(e){return new Ln(e??"")}var Qn=class extends x{static[u]="PgCustomColumnBuilder";constructor(e,t,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=r}build(e){return new kn(e,this.config)}},kn=class extends S{static[u]="PgCustomColumn";sqlName;mapTo;mapFrom;mapJson;forJsonSelect;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver,this.mapJson=t.customTypeParams.fromJson,this.forJsonSelect=t.customTypeParams.forJsonSelect}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapFromJsonValue(e){return typeof this.mapJson=="function"?this.mapJson(e):this.mapFromDriverValue(e)}jsonSelectIdentifier(e,t,r){if(typeof this.forJsonSelect=="function")return this.forJsonSelect(e,t,r);const i=this.getSQLType().toLowerCase(),s=i.indexOf("(");switch(s+1?i.slice(0,s):i){case"bytea":case"geometry":case"timestamp":case"numeric":case"bigint":{const n="[]".repeat(r??0);return t`${e}::text${t.raw(n).if(r)}`}default:return e}}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function In(e){return(t,r)=>{const{name:i,config:s}=z(t,r);return new Qn(i,s,e)}}var Me=class extends x{static[u]="PgDateColumnBaseBuilder";defaultNow(){return this.default(a`now()`)}},jn=class extends Me{static[u]="PgDateBuilder";constructor(e){super(e,"object date","PgDate")}build(e){return new zr(e,this.config)}},zr=class extends S{static[u]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?new Date(e):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},Dn=class extends Me{static[u]="PgDateStringBuilder";constructor(e){super(e,"string date","PgDateString")}build(e){return new Fr(e,this.config)}},Fr=class extends S{static[u]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?e:e.toISOString().slice(0,-14)}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function On(e,t){const{name:r,config:i}=z(e,t);return i?.mode==="date"?new jn(r):new Dn(r)}var zn=class extends x{static[u]="PgDoublePrecisionBuilder";constructor(e){super(e,"number double","PgDoublePrecision")}build(e){return new Fn(e,this.config)}},Fn=class extends S{static[u]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Vn(e){return new zn(e??"")}var En=class extends x{static[u]="PgInetBuilder";constructor(e){super(e,"string inet","PgInet")}build(e){return new Rn(e,this.config)}},Rn=class extends S{static[u]="PgInet";getSQLType(){return"inet"}};function Mn(e){return new En(e??"")}var Un=class extends Re{static[u]="PgIntegerBuilder";constructor(e){super(e,"number int32","PgInteger")}build(e){return new Jn(e,this.config)}},Jn=class extends S{static[u]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Kn(e){return new Un(e??"")}var Wn=class extends x{static[u]="PgIntervalBuilder";constructor(e,t){super(e,"string interval","PgInterval"),this.config.intervalConfig=t}build(e){return new Hn(e,this.config)}},Hn=class extends S{static[u]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){return`interval${this.fields?` ${this.fields}`:""}${this.precision?`(${this.precision})`:""}`}};function Gn(e,t={}){const{name:r,config:i}=z(e,t);return new Wn(r,i)}var Yn=class extends x{static[u]="PgJsonBuilder";constructor(e){super(e,"object json","PgJson")}build(e){return new Vr(e,this.config)}},Vr=class extends S{static[u]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Xn(e){return new Yn(e??"")}var Zn=class extends x{static[u]="PgJsonbBuilder";constructor(e){super(e,"object json","PgJsonb")}build(e){return new Er(e,this.config)}},Er=class extends S{static[u]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function ea(e){return new Zn(e??"")}var ta=class extends x{static[u]="PgLineBuilder";constructor(e){super(e,"array line","PgLine")}build(e){return new ra(e,this.config)}},ra=class extends S{static[u]="PgLine";mode="tuple";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},ia=class extends x{static[u]="PgLineABCBuilder";constructor(e){super(e,"object line","PgLineABC")}build(e){return new sa(e,this.config)}},sa=class extends S{static[u]="PgLineABC";mode="abc";getSQLType(){return"line"}mapFromDriverValue(e){const[t,r,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(r),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function na(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new ta(r):new ia(r)}var aa=class extends x{static[u]="PgMacaddrBuilder";constructor(e){super(e,"string macaddr","PgMacaddr")}build(e){return new oa(e,this.config)}},oa=class extends S{static[u]="PgMacaddr";getSQLType(){return"macaddr"}};function la(e){return new aa(e??"")}var ua=class extends x{static[u]="PgMacaddr8Builder";constructor(e){super(e,"string macaddr8","PgMacaddr8")}build(e){return new ca(e,this.config)}},ca=class extends S{static[u]="PgMacaddr8";getSQLType(){return"macaddr8"}};function da(e){return new ua(e??"")}var ha=class extends x{static[u]="PgNumericBuilder";constructor(e,t,r){super(e,"string numeric","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new Rr(e,this.config)}},Rr=class extends S{static[u]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},fa=class extends x{static[u]="PgNumericNumberBuilder";constructor(e,t,r){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=r}build(e){return new ma(e,this.config)}},ma=class extends S{static[u]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},pa=class extends x{static[u]="PgNumericBigIntBuilder";constructor(e,t,r){super(e,"bigint int64","PgNumericBigInt"),this.config.precision=t,this.config.scale=r}build(e){return new ga(e,this.config)}},ga=class extends S{static[u]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function ya(e,t){const{name:r,config:i}=z(e,t),s=i?.mode;return s==="number"?new fa(r,i?.precision,i?.scale):s==="bigint"?new pa(r,i?.precision,i?.scale):new ha(r,i?.precision,i?.scale)}var ba=class extends x{static[u]="PgPointTupleBuilder";constructor(e){super(e,"array point","PgPointTuple")}build(e){return new va(e,this.config)}},va=class extends S{static[u]="PgPointTuple";mode="tuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},wa=class extends x{static[u]="PgPointObjectBuilder";constructor(e){super(e,"object point","PgPointObject")}build(e){return new Sa(e,this.config)}},Sa=class extends S{static[u]="PgPointObject";mode="xy";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){const[t,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function Pa(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new ba(r):new wa(r)}function $a(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(Number.parseInt(e.slice(r,r+2),16));return new Uint8Array(t)}function Ot(e,t){const r=new ArrayBuffer(8),i=new DataView(r);for(let s=0;s<8;s++)i.setUint8(s,e[t+s]);return i.getFloat64(0,!0)}function Mr(e){const t=$a(e);let r=0;const i=t[r];r+=1;const s=new DataView(t.buffer),n=s.getUint32(r,i===1);r+=4;let o;if(n&536870912&&(o=s.getUint32(r,i===1),r+=4),(n&65535)===1){const l=Ot(t,r);r+=8;const d=Ot(t,r);return r+=8,{srid:o,point:[l,d]}}throw new Error("Unsupported geometry type")}var xa=class extends x{static[u]="PgGeometryBuilder";constructor(e,t){super(e,"array geometry","PgGeometry"),this.config.srid=t}build(e){return new Ta(e,this.config)}},Ta=class extends S{static[u]="PgGeometry";srid=this.config.srid;mode="tuple";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){return typeof e!="string"?e:Mr(e).point}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},Ca=class extends x{static[u]="PgGeometryObjectBuilder";constructor(e,t){super(e,"object geometry","PgGeometryObject"),this.config.srid=t}build(e){return new Na(e,this.config)}},Na=class extends S{static[u]="PgGeometryObject";srid=this.config.srid;mode="object";getSQLType(){return`geometry(point${this.srid===void 0?"":`,${this.srid}`})`}mapFromDriverValue(e){const t=Mr(e);return{x:t.point[0],y:t.point[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function _a(e,t){const{name:r,config:i}=z(e,t);return!i?.mode||i.mode==="tuple"?new xa(r,i?.srid):new Ca(r,i?.srid)}var Aa=class extends x{static[u]="PgRealBuilder";constructor(e,t){super(e,"number float","PgReal"),this.config.length=t}build(e){return new La(e,this.config)}},La=class extends S{static[u]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function Ba(e){return new Aa(e??"")}var qa=class extends x{static[u]="PgSerialBuilder";constructor(e){super(e,"number int32","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Qa(e,this.config)}},Qa=class extends S{static[u]="PgSerial";getSQLType(){return"serial"}};function ka(e){return new qa(e??"")}var Ia=class extends Re{static[u]="PgSmallIntBuilder";constructor(e){super(e,"number int16","PgSmallInt")}build(e){return new ja(e,this.config)}},ja=class extends S{static[u]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function Da(e){return new Ia(e??"")}var Oa=class extends x{static[u]="PgSmallSerialBuilder";constructor(e){super(e,"number int16","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new za(e,this.config)}},za=class extends S{static[u]="PgSmallSerial";getSQLType(){return"smallserial"}};function Fa(e){return new Oa(e??"")}var Va=class extends x{static[u]="PgTextBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgText"),this.config.enumValues=t.enum}build(e){return new Ea(e,this.config,this.config.enumValues)}},Ea=class extends S{static[u]="PgText";enumValues;constructor(e,t,r){super(e,t),this.enumValues=r}getSQLType(){return"text"}};function Ra(e,t={}){const{name:r,config:i}=z(e,t);return new Va(r,i)}var Ma=class extends Me{constructor(e,t,r){super(e,"string time","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}static[u]="PgTimeBuilder";build(e){return new Ur(e,this.config)}},Ur=class extends S{static[u]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function Ua(e,t={}){const{name:r,config:i}=z(e,t);return new Ma(r,i.withTimezone??!1,i.precision)}var Ja=class extends Me{static[u]="PgTimestampBuilder";constructor(e,t,r){super(e,"object date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Jr(e,this.config)}},Jr=class extends S{static[u]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){return typeof e=="string"?new Date(this.withTimezone?e:e+"+0000"):e}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}},Ka=class extends Me{static[u]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string timestamp","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Kr(e,this.config)}},Kr=class extends S{static[u]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){if(typeof e=="string")return e;const t=e.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){const r=e.getTimezoneOffset();return`${t}${r<=0?"+":"-"}${Math.floor(Math.abs(r)/60).toString().padStart(2,"0")}`}return t}mapToDriverValue(e){return typeof e=="string"?e:e.toISOString()}};function Wa(e,t={}){const{name:r,config:i}=z(e,t);return i?.mode==="string"?new Ka(r,i.withTimezone??!1,i.precision):new Ja(r,i?.withTimezone??!1,i?.precision)}var Ha=class extends x{static[u]="PgUUIDBuilder";constructor(e){super(e,"string uuid","PgUUID")}defaultRandom(){return this.default(a`gen_random_uuid()`)}build(e){return new Wr(e,this.config)}},Wr=class extends S{static[u]="PgUUID";getSQLType(){return"uuid"}};function Ga(e){return new Ha(e??"")}var Ya=class extends x{static[u]="PgVarcharBuilder";constructor(e,t){super(e,t.enum?.length?"string enum":"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Xa(e,this.config)}},Xa=class extends S{static[u]="PgVarchar";enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function Za(e,t={}){const{name:r,config:i}=z(e,t);return new Ya(r,i)}var eo=class extends x{static[u]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string binary","PgBinaryVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new to(e,this.config)}},to=class extends S{static[u]="PgBinaryVector";getSQLType(){return`bit(${this.length})`}};function ro(e,t){const{name:r,config:i}=z(e,t);return new eo(r,i)}var io=class extends x{static[u]="PgHalfVectorBuilder";constructor(e,t){super(e,"array halfvector","PgHalfVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new so(e,this.config)}},so=class extends S{static[u]="PgHalfVector";getSQLType(){return`halfvec(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function no(e,t){const{name:r,config:i}=z(e,t);return new io(r,i)}var ao=class extends x{static[u]="PgSparseVectorBuilder";constructor(e,t){super(e,"string sparsevec","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new oo(e,this.config)}},oo=class extends S{static[u]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function lo(e,t){const{name:r,config:i}=z(e,t);return new ao(r,i)}var uo=class extends x{static[u]="PgVectorBuilder";constructor(e,t){super(e,"array vector","PgVector"),this.config.length=t.dimensions,this.config.isLengthExact=!0}build(e){return new co(e,this.config)}},co=class extends S{static[u]="PgVector";getSQLType(){return`vector(${this.length})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function ho(e,t){const{name:r,config:i}=z(e,t);return new uo(r,i)}function fo(){return{bigint:bn,bigserial:$n,boolean:Cn,char:An,cidr:qn,customType:In,date:On,doublePrecision:Vn,inet:Mn,integer:Kn,interval:Gn,json:Xn,jsonb:ea,line:na,macaddr:la,macaddr8:da,numeric:ya,point:Pa,geometry:_a,real:Ba,serial:ka,smallint:Da,smallserial:Fa,text:Ra,time:Ua,timestamp:Wa,uuid:Ga,varchar:Za,bit:ro,halfvec:no,sparsevec:lo,vector:ho}}var ft=Symbol.for("drizzle:PgInlineForeignKeys"),mt=Symbol.for("drizzle:EnableRLS"),R=class extends b{static[u]="PgTable";static Symbol=Object.assign({},b.Symbol,{InlineForeignKeys:ft,EnableRLS:mt});[ft]=[];[mt]=!1;[b.Symbol.ExtraConfigBuilder]=void 0;[b.Symbol.ExtraConfigColumns]={}};function Hr(e,t,r,i,s=e){const n=new R(e,i,s),o=typeof t=="function"?t(fo()):t,l=Object.fromEntries(Object.entries(o).map(([p,c])=>{const g=c;g.setName(p);const w=g.build(n);return n[ft].push(...g.buildForeignKeys(w,n)),[p,w]})),d=Object.fromEntries(Object.entries(o).map(([p,c])=>{const g=c;return g.setName(p),[p,g.buildExtraConfigColumn(n)]})),h=Object.assign(n,l);return h[b.Symbol.Columns]=l,h[b.Symbol.ExtraConfigColumns]=d,r&&(h[R.Symbol.ExtraConfigBuilder]=r),Object.assign(h,{enableRLS:()=>(h[R.Symbol.EnableRLS]=!0,h)})}var mo=(e,t,r)=>Hr(e,t,r,void 0),po=(e,t,r)=>{const i=Hr(e,t,r,void 0);return i[mt]=!0,i},au=Object.assign(mo,{withRLS:po}),go=class{static[u]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new yo(e,this.columns,this.name)}},yo=class{constructor(e,t,r){this.table=e,this.columns=t,this.name=r,this.isNameExplicit=!!r}static[u]="PgPrimaryKey";columns;name;isNameExplicit;getName(){return this.name??`${this.table[R.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}},Gr=class{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[b.Symbol.Name]}static[u]="Relation";referencedTableName;fieldName},bo=class{constructor(e,t){this.table=e,this.config=t}static[u]="Relations"},Ve=class Yr extends Gr{constructor(t,r,i,s){super(t,r,i?.relationName),this.config=i,this.isNullable=s}static[u]="One";withFieldName(t){const r=new Yr(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=t,r}},Xr=class Zr extends Gr{constructor(t,r,i){super(t,r,i?.relationName),this.config=i}static[u]="Many";withFieldName(t){const r=new Zr(this.sourceTable,this.referencedTable,this.config);return r.fieldName=t,r}};function vo(){return{and:K,between:_r,eq:fe,exists:Ct,gt:et,gte:Sr,ilike:qr,inArray:xr,isNull:Cr,isNotNull:Nr,like:Lr,lt:Pr,lte:$r,ne:wr,not:Ze,notBetween:Ar,notExists:Nt,notLike:Br,notIlike:Qr,notInArray:Tr,or:Xe,sql:a}}function wo(){return{sql:a,asc:ze,desc:_t}}function So(e,t){Object.keys(e).length===1&&"default"in e&&!f(e.default,b)&&(e=e.default);const r={},i={},s={};for(const[n,o]of Object.entries(e))if(f(o,b)){const l=Fe(o),d=i[l];r[l]=n,s[n]={tsName:n,dbName:o[b.Symbol.Name],schema:o[b.Symbol.Schema],columns:o[b.Symbol.Columns],relations:d?.relations??{},primaryKey:d?.primaryKey??[]};for(const p of Object.values(o[b.Symbol.Columns]))p.primary&&s[n].primaryKey.push(p);const h=o[b.Symbol.ExtraConfigBuilder]?.(o[b.Symbol.ExtraConfigColumns]);if(h)for(const p of Object.values(h))f(p,go)&&s[n].primaryKey.push(...p.columns)}else if(f(o,bo)){const l=Fe(o.table),d=r[l],h=o.config(t(o.table));for(const[p,c]of Object.entries(h))if(d){const g=s[d];g.relations[p]=c}else l in i||(i[l]={relations:{}}),i[l].relations[p]=c}return{tables:s,tableNamesMap:r}}function Po(e){return function(r,i){return new Ve(e,r,i,i?.fields.reduce((s,n)=>s&&n.notNull,!0)??!1)}}function $o(e){return function(r,i){return new Xr(e,r,i)}}function xo(e,t,r){if(f(r,Ve)&&r.config)return{fields:r.config.fields,references:r.config.references};const i=t[Fe(r.referencedTable)];if(!i)throw new Error(`Table "${r.referencedTable[b.Symbol.Name]}" not found in schema`);const s=e[i];if(!s)throw new Error(`Table "${i}" not found in schema`);const n=r.sourceTable,o=t[Fe(n)];if(!o)throw new Error(`Table "${n[b.Symbol.Name]}" not found in schema`);const l=[];for(const d of Object.values(s.relations))(r.relationName&&r!==d&&d.relationName===r.relationName||!r.relationName&&d.referencedTable===r.sourceTable)&&l.push(d);if(l.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${i}"`):new Error(`There are multiple relations between "${i}" and "${r.sourceTable[b.Symbol.Name]}". Please specify relation name`);if(l[0]&&f(l[0],Ve)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${r.fieldName}"`)}function To(e){return{one:Po(e),many:$o(e)}}function pt(e,t,r,i,s=n=>n){const n={};for(const[o,l]of i.entries())if(l.isJson){const d=t.relations[l.tsKey],h=r[o],p=typeof h=="string"?JSON.parse(h):h;n[l.tsKey]=f(d,Ve)?p&&pt(e,e[l.relationTableTsKey],p,l.selection,s):p.map(c=>pt(e,e[l.relationTableTsKey],c,l.selection,s))}else{const d=s(r[o]),h=l.field;let p;f(h,L)?p=h:f(h,v)?p=h.decoder:p=h.sql.decoder,n[l.tsKey]=d===null?null:p.mapFromDriverValue(d)}return n}var M=class ei{static[u]="SelectionProxyHandler";config;constructor(t){this.config={...t}}get(t,r){if(r==="_")return{...t._,selectedFields:new Proxy(t._.selectedFields,this)};if(r===q)return{...t[q],selectedFields:new Proxy(t[q].selectedFields,this)};if(typeof r=="symbol")return t[r];const i=(f(t,V)?t._.selectedFields:f(t,ye)?t[q].selectedFields:t)[r];if(f(i,v.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;const s=i.clone();return s.isSelectionField=!0,s}if(f(i,v)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return f(i,L)?this.config.alias?new Proxy(i,new He(new Proxy(i.table,new Tt(this.config.alias,this.config.replaceOriginalName??!1,!0)),!0)):i:typeof i!="object"||i===null?i:new Proxy(i,new ei(this.config))}};function Pe(e){return f(e,R)?[e[ae]?`${e[ae]}.${e[b.Symbol.BaseName]}`:e[b.Symbol.BaseName]]:f(e,V)?e._.usedTables??[]:f(e,v)?e.usedTables??[]:[]}var zt=class extends be{constructor(e,t,r,i){super(),this.session=t,this.dialect=r,this.config={table:e,withList:i}}static[u]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=xe(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:Pe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new M({alias:ne(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function Co(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function No(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,r,i)=>t+(i===0?r.toLowerCase():`${r[0].toUpperCase()}${r.slice(1)}`),"")}function _o(e){return e}var Ao=class{static[u]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?Co:e==="camelCase"?No:_o}getColumnCasing(e){if(!e.keyAsName)return e.name;const t=`${e.table[b.Symbol.Schema]??"public"}.${e.table[b.Symbol.OriginalName]}.${e.name}`;return this.cache[t]||this.cacheTable(e.table),this.cache[t]}cacheTable(e){const t=`${e[b.Symbol.Schema]??"public"}.${e[b.Symbol.OriginalName]}`;if(!this.cachedTables[t]){for(const r of Object.values(e[b.Symbol.Columns])){if(!f(r,L))continue;const i=`${t}.${r.name}`;this.cache[i]=this.convert(r.name)}this.cachedTables[t]=!0}}clearCache(){this.cache={},this.cachedTables={}}},ti=class extends ye{static[u]="PgViewBase"},We=class{static[u]="PgDialect";casing;constructor(e){this.casing=new Ao(e?.casing)}async migrate(e,t,r){const i=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",s=typeof r=="string"?"drizzle":r.migrationsSchema??"drizzle",n=a`
			CREATE TABLE IF NOT EXISTS ${a.identifier(s)}.${a.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(a`CREATE SCHEMA IF NOT EXISTS ${a.identifier(s)}`),await t.execute(n);const o=await t.all(a`select id, hash, created_at from ${a.identifier(s)}.${a.identifier(i)} order by created_at desc limit 1`);if(typeof r=="object"&&r.init){if(o.length)return{exitCode:"databaseMigrations"};if(e.length>1)return{exitCode:"localMigrations"};const[d]=e;if(!d)return;await t.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${d.hash}, ${d.folderMillis})`);return}const l=o[0];await t.transaction(async d=>{for await(const h of e)if(!l||Number(l.created_at)<h.folderMillis){for(const p of h.sql)await d.execute(a.raw(p));await d.execute(a`insert into ${a.identifier(s)}.${a.identifier(i)} ("hash", "created_at") values(${h.hash}, ${h.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;const t=[a`with `];for(const[r,i]of e.entries())t.push(a`${a.identifier(i._.alias)} as (${i._.sql})`),r<e.length-1&&t.push(a`, `);return t.push(a` `),a.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:i}){const s=this.buildWithCTE(i),n=r?a` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0;return a`${s}delete from ${e}${t?a` where ${t}`:void 0}${n}`}buildUpdateSet(e,t){const r=e[b.Symbol.Columns],i=Object.keys(r).filter(n=>t[n]!==void 0||r[n]?.onUpdateFn!==void 0),s=i.length;return a.join(i.flatMap((n,o)=>{const l=r[n],d=l.onUpdateFn?.(),h=t[n]??(f(d,v)?d:a.param(d,l)),p=a`${a.identifier(this.casing.getColumnCasing(l))} = ${h}`;return o<s-1?[p,a.raw(", ")]:[p]}))}buildUpdateQuery({table:e,set:t,where:r,returning:i,withList:s,from:n,joins:o}){const l=this.buildWithCTE(s),d=e[R.Symbol.Name],h=e[R.Symbol.Schema],p=e[R.Symbol.OriginalName],c=d===p?void 0:d,g=a`${h?a`${a.identifier(h)}.`:void 0}${a.identifier(p)}${c&&a` ${a.identifier(c)}`}`,w=this.buildUpdateSet(e,t),A=n&&a.join([a.raw(" from "),this.buildFromTable(n)]),$=this.buildJoins(o),C=i?a` returning ${this.buildSelection(i,{isSingleTable:!n})}`:void 0;return a`${l}update ${g} set ${w}${A}${$}${r?a` where ${r}`:void 0}${C}`}buildSelection(e,{isSingleTable:t=!1}={}){const r=e.length,i=e.flatMap(({field:s},n)=>{const o=[];if(f(s,v.Aliased)&&s.isSelectionField)o.push(a.identifier(s.fieldAlias));else if(f(s,v.Aliased)||f(s,v)){const l=f(s,v.Aliased)?s.sql:s;t?o.push(new v(l.queryChunks.map(d=>f(d,S)?a.identifier(this.casing.getColumnCasing(d)):d))):o.push(l),f(s,v.Aliased)&&o.push(a` as ${a.identifier(s.fieldAlias)}`)}else if(f(s,L))t?o.push(s.isAlias?a`${a.identifier(this.casing.getColumnCasing(Dt(s)))} as ${s}`:a.identifier(this.casing.getColumnCasing(s))):o.push(s.isAlias?a`${Dt(s)} as ${s}`:s);else if(f(s,V)){const l=Object.entries(s._.selectedFields);if(l.length===1){const d=l[0][1],h=f(d,v)?d.decoder:f(d,L)?{mapFromDriverValue:p=>d.mapFromDriverValue(p)}:d.sql.decoder;h&&(s._.sql.decoder=h)}o.push(s)}return n<r-1&&o.push(a`, `),o});return a.join(i)}buildJoins(e){if(!e||e.length===0)return;const t=[];for(const[r,i]of e.entries()){r===0&&t.push(a` `);const s=i.table,n=i.lateral?a` lateral`:void 0,o=i.on?a` on ${i.on}`:void 0;if(f(s,R)){const l=s[R.Symbol.Name],d=s[R.Symbol.Schema],h=s[R.Symbol.OriginalName],p=l===h?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(h)}${p&&a` ${a.identifier(p)}`}${o}`)}else if(f(s,ye)){const l=s[q].name,d=s[q].schema,h=s[q].originalName,p=l===h?void 0:i.alias;t.push(a`${a.raw(i.joinType)} join${n} ${d?a`${a.identifier(d)}.`:void 0}${a.identifier(h)}${p&&a` ${a.identifier(p)}`}${o}`)}else t.push(a`${a.raw(i.joinType)} join${n} ${s}${o}`);r<e.length-1&&t.push(a` `)}return a.join(t)}buildFromTable(e){if(f(e,b)&&e[b.Symbol.IsAlias]){let t=a`${a.identifier(e[b.Symbol.OriginalName])}`;return e[b.Symbol.Schema]&&(t=a`${a.identifier(e[b.Symbol.Schema])}.${t}`),a`${t} ${a.identifier(e[b.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:i,having:s,table:n,joins:o,orderBy:l,groupBy:d,limit:h,offset:p,lockingClause:c,distinct:g,setOperators:w}){const A=r??xe(t);for(const D of A)if(f(D.field,L)&&ne(D.field.table)!==(f(n,V)?n._.alias:f(n,ti)?n[q].name:f(n,v)?void 0:ne(n))&&!(ee=>o?.some(({alias:Qe})=>Qe===(ee[b.Symbol.IsAlias]?ne(ee):ee[b.Symbol.BaseName])))(D.field.table)){const ee=ne(D.field.table);throw new Error(`Your "${D.path.join("->")}" field references a column "${ee}"."${D.field.name}", but the table "${ee}" is not part of the query! Did you forget to join it?`)}const $=!o||o.length===0,C=this.buildWithCTE(e);let I;g&&(I=g===!0?a` distinct`:a` distinct on (${a.join(g.on,a`, `)})`);const _=this.buildSelection(A,{isSingleTable:$}),U=this.buildFromTable(n),k=this.buildJoins(o),E=i?a` where ${i}`:void 0,P=s?a` having ${s}`:void 0;let T;l&&l.length>0&&(T=a` order by ${a.join(l,a`, `)}`);let j;d&&d.length>0&&(j=a` group by ${a.join(d,a`, `)}`);const Z=typeof h=="object"||typeof h=="number"&&h>=0?a` limit ${h}`:void 0,J=p?a` offset ${p}`:void 0,H=a.empty();if(c){const D=a` for ${a.raw(c.strength)}`;c.config.of&&D.append(a` of ${a.join(Array.isArray(c.config.of)?c.config.of:[c.config.of],a`, `)}`),c.config.noWait?D.append(a` nowait`):c.config.skipLocked&&D.append(a` skip locked`),H.append(D)}const ue=a`${C}select${I} ${_} from ${U}${k}${E}${j}${P}${T}${Z}${J}${H}`;return w.length>0?this.buildSetOperations(ue,w):ue}buildSetOperations(e,t){const[r,...i]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:i,limit:s,orderBy:n,offset:o}}){const l=a`(${e.getSQL()}) `,d=a`(${i.getSQL()})`;let h;if(n&&n.length>0){const w=[];for(const A of n)if(f(A,S))w.push(a.identifier(A.name));else if(f(A,v)){for(let $=0;$<A.queryChunks.length;$++){const C=A.queryChunks[$];f(C,S)&&(A.queryChunks[$]=a.identifier(C.name))}w.push(a`${A}`)}else w.push(a`${A}`);h=a` order by ${a.join(w,a`, `)} `}const p=typeof s=="object"||typeof s=="number"&&s>=0?a` limit ${s}`:void 0,c=a.raw(`${t} ${r?"all ":""}`),g=o?a` offset ${o}`:void 0;return a`${l}${c}${d}${h}${p}${g}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:i,withList:s,select:n,overridingSystemValue_:o}){const l=[],d=e[b.Symbol.Columns],h=Object.entries(d).filter(([$,C])=>!C.shouldDisableInsert()),p=h.map(([,$])=>a.identifier(this.casing.getColumnCasing($)));if(n){const $=t;f($,v)?l.push($):l.push($.getSQL())}else{const $=t;l.push(a.raw("values "));for(const[C,I]of $.entries()){const _=[];for(const[U,k]of h){const E=I[U];if(E===void 0||f(E,pe)&&E.value===void 0)if(k.defaultFn!==void 0){const P=k.defaultFn(),T=f(P,v)?P:a.param(P,k);_.push(T)}else if(!k.default&&k.onUpdateFn!==void 0){const P=k.onUpdateFn(),T=f(P,v)?P:a.param(P,k);_.push(T)}else _.push(a`default`);else _.push(E)}l.push(_),C<$.length-1&&l.push(a`, `)}}const c=this.buildWithCTE(s),g=a.join(l),w=i?a` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,A=r?a` on conflict ${r}`:void 0;return a`${c}insert into ${e} ${p} ${o===!0?a`overriding system value `:void 0}${g}${A}${w}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){return a`refresh materialized view${t?a` concurrently`:void 0} ${e}${r?a` with no data`:void 0}`}prepareTyping(e){return f(e,Er)||f(e,Vr)?"json":f(e,Rr)?"decimal":f(e,Ur)?"time":f(e,Jr)||f(e,Kr)?"timestamp":f(e,zr)||f(e,Fr)?"date":f(e,Wr)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}_buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:i,tableConfig:s,queryConfig:n,tableAlias:o,nestedQueryRelation:l,joinOn:d}){let h=[],p,c,g=[],w;const A=[];if(n===!0)h=Object.entries(s.columns).map(([C,I])=>({dbKey:I.name,tsKey:C,field:re(I,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const C=Object.fromEntries(Object.entries(s.columns).map(([P,T])=>[P,re(T,o)]));if(n.where){const P=typeof n.where=="function"?n.where(C,vo()):n.where;w=P&&Ge(P,o)}const I=[];let _=[];if(n.columns){let P=!1;for(const[T,j]of Object.entries(n.columns))j!==void 0&&T in s.columns&&(!P&&j===!0&&(P=!0),_.push(T));_.length>0&&(_=P?_.filter(T=>n.columns?.[T]===!0):Object.keys(s.columns).filter(T=>!_.includes(T)))}else _=Object.keys(s.columns);for(const P of _){const T=s.columns[P];I.push({tsKey:P,value:T})}let U=[];n.with&&(U=Object.entries(n.with).filter(P=>!!P[1]).map(([P,T])=>({tsKey:P,queryConfig:T,relation:s.relations[P]})));let k;if(n.extras){k=typeof n.extras=="function"?n.extras(C,{sql:a}):n.extras;for(const[P,T]of Object.entries(k))I.push({tsKey:P,value:br(T,o)})}for(const{tsKey:P,value:T}of I)h.push({dbKey:f(T,v.Aliased)?T.fieldAlias:s.columns[P].name,tsKey:P,field:f(T,L)?re(T,o):T,relationTableTsKey:void 0,isJson:!1,selection:[]});let E=typeof n.orderBy=="function"?n.orderBy(C,wo()):n.orderBy??[];Array.isArray(E)||(E=[E]),g=E.map(P=>f(P,L)?re(P,o):Ge(P,o)),p=n.limit,c=n.offset;for(const{tsKey:P,queryConfig:T,relation:j}of U){const Z=xo(t,r,j),J=r[Fe(j.referencedTable)],H=`${o}_${P}`,ue=K(...Z.fields.map((Qe,rt)=>fe(re(Z.references[rt],H),re(Qe,o)))),D=this._buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:r,table:e[J],tableConfig:t[J],queryConfig:f(j,Ve)?T===!0?{limit:1}:{...T,limit:1}:T,tableAlias:H,joinOn:ue,nestedQueryRelation:j}),ee=a`${a.identifier(H)}.${a.identifier("data")}`.as(P);A.push({on:a`true`,table:new V(D.sql,{},H),alias:H,joinType:"left",lateral:!0}),h.push({dbKey:P,tsKey:P,field:ee,relationTableTsKey:J,isJson:!0,selection:D.selection})}}if(h.length===0)throw new Oe({message:`No fields selected for table "${s.tsName}" ("${o}")`});let $;if(w=K(d,w),l){let C=a`json_build_array(${a.join(h.map(({field:_,tsKey:U,isJson:k})=>k?a`${a.identifier(`${o}_${U}`)}.${a.identifier("data")}`:f(_,v.Aliased)?_.sql:_),a`, `)})`;f(l,Xr)&&(C=a`coalesce(json_agg(${C}${g.length>0?a` order by ${a.join(g,a`, `)}`:void 0}), '[]'::json)`);const I=[{dbKey:"data",tsKey:"data",field:C.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:h}];p!==void 0||c!==void 0||g.length>0?($=this.buildSelectQuery({table:ie(i,o),fields:{},fieldsFlat:[{path:[],field:a.raw("*")}],where:w,limit:p,offset:c,orderBy:g,setOperators:[]}),w=void 0,p=void 0,c=void 0,g=[]):$=ie(i,o),$=this.buildSelectQuery({table:f($,R)?$:new V($,{},o),fields:{},fieldsFlat:I.map(({field:_})=>({path:[],field:f(_,L)?re(_,o):_})),joins:A,where:w,limit:p,offset:c,orderBy:g,setOperators:[]})}else $=this.buildSelectQuery({table:ie(i,o),fields:{},fieldsFlat:h.map(({field:C})=>({path:[],field:f(C,L)?re(C,o):C})),joins:A,where:w,limit:p,offset:c,orderBy:g,setOperators:[]});return{tableTsKey:s.tsName,sql:$,selection:h}}nestedSelectionerror(){throw new Oe({message:"Views with nested selections are not supported by the relational query builder"})}buildRqbColumn(e,t,r){if(f(t,L)){const i=a`${e}.${a.identifier(this.casing.getColumnCasing(t))}`;let s=t.columnType,n=t,o=0;for(;f(n,mr);)n=n.baseColumn,s=n.columnType,++o;switch(s){case"PgNumeric":case"PgNumericNumber":case"PgNumericBigInt":case"PgBigInt64":case"PgBigIntString":case"PgBigSerial64":case"PgTimestampString":case"PgGeometry":case"PgGeometryObject":case"PgBytea":{const l="[]".repeat(o);return a`${i}::text${a.raw(l).if(l)} as ${a.identifier(r)}`}case"PgCustomColumn":return a`${n.jsonSelectIdentifier(i,a,o>0?o:void 0)} as ${a.identifier(r)}`;default:return a`${i} as ${a.identifier(r)}`}}return a`${e}.${f(t,v.Aliased)?a.identifier(t.fieldAlias):$t(t)?a.identifier(r):this.nestedSelectionerror()} as ${a.identifier(r)}`}unwrapAllColumns=(e,t)=>a.join(Object.entries(e[me]).map(([r,i])=>(t.push({key:r,field:i}),this.buildRqbColumn(e,i,r))),a`, `);buildColumns=(e,t,r)=>r?.columns?(()=>{const i=Object.entries(r.columns),s=e[me],n=[];let o;for(const[l,d]of i)if(d!==void 0&&(o=o||d,d)){const h=s[l];n.push(this.buildRqbColumn(e,h,l)),t.push({key:l,field:h})}if(o===!1)for(const[l,d]of Object.entries(s))r.columns[l]!==!1&&(n.push(this.buildRqbColumn(e,d,l)),t.push({key:l,field:d}));return n.length?a.join(n,a`, `):void 0})():this.unwrapAllColumns(e,t);buildRelationalQuery({schema:e,table:t,tableConfig:r,queryConfig:i,relationWhere:s,mode:n,errorPath:o,depth:l,throughJoin:d}){const h=[],p=n==="first",c=i===!0?void 0:i,g=o??"",w=l??0;w||(t=ie(t,`d${w}`));const A=p?1:c?.limit,$=c?.offset,C=c?.where&&s?K(de(t,c.where,r.relations,e,this.casing),s):c?.where?de(t,c.where,r.relations,e,this.casing):s,I=c?.orderBy?on(t,c.orderBy):void 0,_=this.buildColumns(t,h,c),U=c?.extras?ln(t,c.extras):void 0;U&&h.push(...U.selection);const k=_?[_]:[],E=c?(()=>{const{with:P}=c;if(!P)return;const T=Object.entries(P).filter(([j,Z])=>Z);if(T.length)return a.join(T.map(([j,Z])=>{const J=r.relations[j],H=f(J,Ir),ue=ie(J.targetTable,`d${w+1}`),D=J.throughTable?ie(J.throughTable,`tr${w}`):void 0,{filter:ee,joinCondition:Qe}=Dr(this.casing,J,t,ue,D);k.push(a`${a.identifier(j)}.${a.identifier("r")} as ${a.identifier(j)}`);const rt=D?a` inner join ${Ae(D)} on ${Qe}`:void 0,Lt=this.buildRelationalQuery({table:ue,mode:H?"first":"many",schema:e,queryConfig:Z,tableConfig:e[J.targetTableName],relationWhere:ee,errorPath:`${g.length?`${g}.`:""}${j}`,depth:w+1,throughJoin:rt});return h.push({field:ue,key:j,selection:Lt.selection,isArray:!H,isOptional:(J.optional??!1)||Z!==!0&&!!Z.where}),a`left join lateral(select ${H?a`row_to_json(${a.identifier("t")}.*) ${a.identifier("r")}`:a`coalesce(json_agg(row_to_json(${a.identifier("t")}.*)), '[]') as ${a.identifier("r")}`} from (${Lt.sql}) as ${a.identifier("t")}) as ${a.identifier(j)} on true`}),a` `)})():void 0;if(U?.sql&&k.push(U.sql),!k.length)throw new Oe({message:`No fields selected for table "${r.name}"${g?` ("${g}")`:""}`});return{sql:a`select ${a.join(k.filter(P=>P!==void 0),a`, `)} from ${Ae(t)}${d}${a` ${E}`.if(E)}${a` where ${C}`.if(C)}${a` order by ${I}`.if(I)}${a` limit ${A}`.if(A!==void 0)}${a` offset ${$}`.if($!==void 0)}`,selection:h}}},Lo=class{static[u]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}},Y=class{static[u]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){const t=!!this.fields,r=e;let i;return this.fields?i=this.fields:f(r,V)?i=Object.fromEntries(Object.keys(r._.selectedFields).map(s=>[s,r[s]])):f(r,ti)?i=r[q].selectedFields:f(r,v)?i={}:i=dn(r),new ri({table:r,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Bo=class extends Lo{static[u]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:r,session:i,dialect:s,withList:n,distinct:o}){super(),this.config={withList:n,table:e,fields:{...t},distinct:o,setOperators:[]},this.isPartialSelect=r,this.session=i,this.dialect=s,this._={selectedFields:t,config:this.config},this.tableName=we(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(const l of Pe(e))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return((r,i)=>{const s=this.tableName,n=we(r);for(const o of Pe(r))this.usedTables.add(o);if(typeof n=="string"&&this.config.joins?.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof n=="string"&&!f(r,v))){const o=f(r,V)?r._.selectedFields:f(r,ye)?r[q].selectedFields:r[b.Symbol.Columns];this.config.fields[n]=o}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new M({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:r,joinType:e,alias:n,lateral:t}),typeof n=="string")switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!1;break}return this})}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return r=>{const i=typeof r=="function"?r(qo()):r;if(!At(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new M({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new M({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new M({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){const t=e[0](new Proxy(this.config.fields,new M({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{const t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){const t=[];if(t.push(...Pe(this.config.table)),this.config.joins)for(const r of this.config.joins)t.push(...Pe(r.table));return new Proxy(new V(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new M({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new M({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}},ri=class extends Bo{static[u]="PgSelect";_prepare(e){const{session:t,config:r,dialect:i,joinsNotNullableMap:s,authToken:n,cacheConfig:o,usedTables:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const{fields:d}=r;return B.startActiveSpan("drizzle.prepareQuery",()=>{const h=xe(d),p=t.prepareQuery(i.sqlToQuery(this.getSQL()),h,e,!0,void 0,{type:"select",tables:[...l]},o);return p.joinsNotNullableMap=s,p.setToken(n)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};cn(ri,[be]);function qe(e,t){return(r,i,...s)=>{const n=[i,...s].map(o=>({type:e,isAll:t,rightSelect:o}));for(const o of n)if(!At(r.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(n)}}var qo=()=>({union:Qo,unionAll:ko,intersect:Io,intersectAll:jo,except:Do,exceptAll:Oo}),Qo=qe("union",!1),ko=qe("union",!0),Io=qe("intersect",!1),jo=qe("intersect",!0),Do=qe("except",!1),Oo=qe("except",!0),ii=class{static[u]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=f(e,We)?e:void 0,this.dialectConfig=f(e,We)?void 0:e}$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(r)),new Proxy(new gr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new M({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){const t=this;function r(n){return new Y({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(n){return new Y({fields:n??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function s(n,o){return new Y({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:n}})}return{select:r,selectDistinct:i,selectDistinctOn:s}}select(e){return new Y({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Y({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new Y({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new We(this.dialectConfig)),this.dialect}},Ft=class{constructor(e,t,r,i,s){this.table=e,this.session=t,this.dialect=r,this.withList=i,this.overridingSystemValue_=s}static[u]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");const t=e.map(r=>{const i={},s=this.table[b.Symbol.Columns];for(const n of Object.keys(r)){const o=r[n];i[n]=f(o,v)?o:new pe(o,s[n])}return i});return new Vt(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){const t=typeof e=="function"?e(new ii):e;if(!f(t,v)&&!At(this.table[me],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Vt(this.table,t,this.session,this.dialect,this.withList,!0)}},Vt=class extends be{constructor(e,t,r,i,s,n,o){super(),this.session=r,this.dialect=i,this.config={table:e,values:t,withList:s,select:n,overridingSystemValue_:o}}static[u]="PgInsert";config;cacheConfig;returning(e=this.config.table[b.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=xe(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=a`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));const r=e.where?a` where ${e.where}`:void 0;this.config.onConflict=a`(${a.raw(t)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');const t=e.where?a` where ${e.where}`:void 0,r=e.targetWhere?a` where ${e.targetWhere}`:void 0,i=e.setWhere?a` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Or(this.config.table,e.set));let n="";return n=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=a`(${a.raw(n)})${r} do update set ${s}${t}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Pe(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new M({alias:ne(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},zo=class extends be{constructor(e,t,r){super(),this.session=t,this.dialect=r,this.config={view:e}}static[u]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))},Et=class{constructor(e,t,r,i){this.table=e,this.session=t,this.dialect=r,this.withList=i}static[u]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Fo(this.table,Or(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Fo=class extends be{constructor(e,t,r,i,s){super(),this.session=r,this.dialect=i,this.config={set:t,table:e,withList:s,joins:[]},this.tableName=we(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[u]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){const t=e,r=we(t);return typeof r=="string"&&(this.joinsNotNullableMap[r]=!0),this.config.from=t,this}getTableLikeFields(e){return f(e,R)?e[b.Symbol.Columns]:f(e,V)?e._.selectedFields:e[q].selectedFields}createJoin(e){return((t,r)=>{const i=we(t);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof r=="function"){const s=this.config.from&&!f(this.config.from,v)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[b.Symbol.Columns],new M({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new M({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":this.joinsNotNullableMap[i]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break;case"inner":this.joinsNotNullableMap[i]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}return this})}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[b.Symbol.Columns]),this.config.from)){const t=we(this.config.from);if(typeof t=="string"&&this.config.from&&!f(this.config.from,v)){const r=this.getTableLikeFields(this.config.from);e[t]=r}for(const r of this.config.joins){const i=we(r.table);if(typeof i=="string"&&!f(r.table,v)){const s=this.getTableLikeFields(r.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=xe(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){const t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Pe(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new M({alias:ne(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}},Vo=class{constructor(e,t,r,i,s,n,o){this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o}static[u]="PgRelationalQueryBuilder";findMany(e){return new Rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Rt=class extends be{constructor(e,t,r,i,s,n,o,l,d){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=i,this.tableConfig=s,this.dialect=n,this.session=o,this.config=l,this.mode=d}static[u]="PgRelationalQuery";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(i,s)=>{const n=i.map(o=>pt(this.schema,this.tableConfig,o,t.selection,s));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect._buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},Eo=class gt extends v{constructor(t){super(gt.buildEmbeddedCount(t.source,t.filters).queryChunks),this.params=t,this.mapWith(Number),this.session=t.session,this.sql=gt.buildCount(t.source,t.filters)}sql;token;static[u]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(t,r){return a`(select count(*) from ${t}${a.raw(" where ").if(r)}${r})`}static buildCount(t,r){return a`select count(*) as count from ${t}${a.raw(" where ").if(r)}${r};`}setToken(t){return this.token=t,this}then(t,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(t,r)}catch(t){return this.then(void 0,t)}finally(t){return this.then(r=>(t?.(),r),r=>{throw t?.(),r})}},Ro=class{constructor(e,t,r,i,s,n){this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.parseJson=n}static[u]="PgRelationalQueryBuilderV2";findMany(e){return new Mt(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"many",this.parseJson)}findFirst(e){return new Mt(this.schema,this.table,this.tableConfig,this.dialect,this.session,e??!0,"first",this.parseJson)}},Mt=class extends be{constructor(e,t,r,i,s,n,o,l){super(),this.schema=e,this.table=t,this.tableConfig=r,this.dialect=i,this.session=s,this.config=n,this.mode=o,this.parseJson=l}static[u]="PgRelationalQueryV2";_prepare(e){return B.startActiveSpan("drizzle.prepareQuery",()=>{const{query:t,builtQuery:r}=this._toSQL();return this.session.prepareRelationalQuery(r,void 0,e,(i,s)=>{const n=i.map(o=>ht(o,t.selection,s,this.parseJson));return this.mode==="first"?n[0]:n})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQuery({schema:this.schema,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,mode:this.mode})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return B.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}},Mo=class extends be{constructor(e,t,r,i){super(),this.execute=e,this.sql=t,this.query=r,this.mapBatchResult=i}static[u]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}},si=class{constructor(e,t,r,i,s=!1){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,relations:r,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},relations:r,session:t},this._query={},this._.schema)for(const[n,o]of Object.entries(this._.schema))this._query[n]=new Vo(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[n],o,e,t);this.query={};for(const[n,o]of Object.entries(r))this.query[n]=new Ro(r,r[o.name].table,o,e,t,s);this.$cache={invalidate:async n=>{}}}static[u]="PgDatabase";_query;query;$with=(e,t)=>{const r=this;return{as:s=>(typeof s=="function"&&(s=s(new ii(r.dialect))),new Proxy(new gr(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new M({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new Eo({source:e,filters:t,session:this.session})}$cache;with(...e){const t=this;function r(d){return new Y({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(d){return new Y({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function s(d,h){return new Y({fields:h??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:d}})}function n(d){return new Et(d,t.session,t.dialect,e)}function o(d){return new Ft(d,t.session,t.dialect,e)}function l(d){return new zt(d,t.session,t.dialect,e)}return{select:r,selectDistinct:i,selectDistinctOn:s,update:n,insert:o,delete:l}}select(e){return new Y({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Y({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new Y({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Et(e,this.session,this.dialect)}insert(e){return new Ft(e,this.session,this.dialect)}delete(e){return new zt(e,this.session,this.dialect)}refreshMaterializedView(e){return new zo(e,this.session,this.dialect)}authToken;execute(e){const t=typeof e=="string"?a.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(t),i=this.session.prepareQuery(r,void 0,void 0,!1);return new Mo(()=>i.execute(void 0,this.authToken),t,r,s=>i.mapResult(s,!0))}transaction(e,t){return this.session.transaction(e,t)}},Uo=class{static[u]="Cache"},ni=class extends Uo{strategy(){return"all"}static[u]="NoopCache";async get(e){}async put(e,t,r,i){}async onMutate(e){}};async function Ut(e,t){const r=`${e}-${JSON.stringify(t)}`,i=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(s)].map(n=>n.toString(16).padStart(2,"0")).join("")}var Jo=class{constructor(e,t,r,i){this.query=e,this.cache=t,this.queryMetadata=r,this.cacheConfig=i,t&&t.strategy()==="all"&&i===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[u]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,r){if(this.cache===void 0||f(this.cache,ni)||this.queryMetadata===void 0)try{return await r()}catch(i){throw new Te(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await r()}catch(i){throw new Te(e,t,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{const[i]=await Promise.all([r(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new Te(e,t,i)}if(!this.cacheConfig)try{return await r()}catch(i){throw new Te(e,t,i)}if(this.queryMetadata.type==="select"){const i=await this.cache.get(this.cacheConfig.tag??await Ut(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let s;try{s=await r()}catch(n){throw new Te(e,t,n)}return await this.cache.put(this.cacheConfig.tag??await Ut(e,t),s,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),s}return i}try{return await r()}catch(i){throw new Te(e,t,i)}}},Ko=class{constructor(e){this.dialect=e}static[u]="PgSession";execute(e,t){return B.startActiveSpan("drizzle.operation",()=>B.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){const r=await this.execute(e,t);return Number(r[0].count)}},Wo=class extends si{constructor(e,t,r,i,s=0,n){super(e,t,r,i,n),this.relations=r,this.schema=i,this.nestedIndex=s}static[u]="PgTransaction";rollback(){throw new Ws}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),a.raw(t.join(" "))}setTransaction(e){return this.session.execute(a`set transaction ${this.getTransactionConfigSQL(e)}`)}},Jt=class extends Jo{constructor(e,t,r,i,s,n,o,l,d,h,p){super({sql:t,params:r},s,n,o),this.client=e,this.queryString=t,this.params=r,this.logger=i,this.fields=l,this._isResponseInArrayMode=d,this.customResultMapper=h,this.isRqbV2Query=p}static[u]="PostgresJsPreparedQuery";async execute(e={}){return this.isRqbV2Query?this.executeRqbV2(e):B.startActiveSpan("drizzle.execute",async t=>{const r=at(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{fields:i,queryString:s,client:n,joinsNotNullableMap:o,customResultMapper:l}=this;if(!i&&!l)return B.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(s,r,async()=>await n.unsafe(s,r)));const d=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":s,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(s,r,async()=>await n.unsafe(s,r).values())));return B.startActiveSpan("drizzle.mapResponse",()=>l?l(d):d.map(h=>un(i,h,o)))})}async executeRqbV2(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=at(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r);const{queryString:i,client:s,customResultMapper:n}=this,o=await B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(r)}),s.unsafe(i,r)));return B.startActiveSpan("drizzle.mapResponse",()=>n(o))})}all(e={}){return B.startActiveSpan("drizzle.execute",async t=>{const r=at(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.queryString,r),B.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(r)}),this.queryWithCache(this.queryString,r,async()=>this.client.unsafe(this.queryString,r))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},ai=class oi extends Ko{constructor(t,r,i,s,n={}){super(r),this.client=t,this.relations=i,this.schema=s,this.options=n,this.logger=n.logger??new Ys,this.cache=n.cache??new ni}static[u]="PostgresJsSession";logger;cache;prepareQuery(t,r,i,s,n,o,l){return new Jt(this.client,t.sql,t.params,this.logger,this.cache,o,l,r,s,n)}prepareRelationalQuery(t,r,i,s){return new Jt(this.client,t.sql,t.params,this.logger,this.cache,void 0,void 0,r,!1,s,!0)}query(t,r){return this.logger.logQuery(t,r),this.client.unsafe(t,r).values()}queryObjects(t,r){return this.client.unsafe(t,r)}transaction(t,r){return this.client.begin(async i=>{const s=new oi(i,this.dialect,this.relations,this.schema,this.options),n=new Ho(this.dialect,s,this.schema,this.relations);return r&&await n.setTransaction(r),t(n)})}},Ho=class li extends Wo{constructor(t,r,i,s,n=0){super(t,r,s,i,n),this.session=r}static[u]="PostgresJsTransaction";transaction(t){return this.session.client.savepoint(r=>{const i=new ai(r,this.dialect,this.relations,this.schema,this.session.options);return t(new li(this.dialect,i,this.schema,this.relations))})}},Go=class extends si{static[u]="PostgresJsDatabase"};function je(e,t={}){const r=d=>d;for(const d of["1184","1082","1083","1114","1182","1185","1115","1231"])e.options.parsers[d]=r,e.options.serializers[d]=r;e.options.serializers[114]=r,e.options.serializers[3802]=r;const i=new We({casing:t.casing});let s;t.logger===!0?s=new Gs:t.logger!==!1&&(s=t.logger);let n;if(t.schema){const d=So(t.schema,To);n={fullSchema:t.schema,schema:d.tables,tableNamesMap:d.tableNamesMap}}const o=t.relations??{},l=new Go(i,new ai(e,i,o,n,{logger:s,cache:t.cache}),o,n);return l.$client=e,l.$cache=t.cache,l.$cache&&(l.$cache.invalidate=t.cache?.onMutate),l}function yt(...e){if(typeof e[0]=="string")return je(Je(e[0]),e[1]);const{connection:t,client:r,...i}=e[0];if(r)return je(r,i);if(typeof t=="object"&&t.url!==void 0){const{url:s,...n}=t;return je(Je(s,n),i)}return je(Je(t),i)}(e=>{function t(r){return je({options:{parsers:{},serializers:{}}},r)}e.mock=t})(yt||(yt={}));var Yo=process.env.DATABASE_URL??`postgresql://${process.env.POSTGRES_USER??"prometheus"}:${process.env.POSTGRES_PASSWORD??"secret"}@${process.env.POSTGRES_HOST??"localhost"}:${process.env.POSTGRES_PORT??5433}/${process.env.POSTGRES_DB??"prometheus"}`,Xo=process.env.POSTGRES_SSL==="true"?"require":!1;const Zo=Je(Yo,{max:5,ssl:Xo}),tt=yt({client:Zo}),oe=Yt("store_items",{id:Xt("id").primaryKey(),name:lt("name").notNull(),price:Li("price",{precision:10,scale:2}).notNull(),createdAt:Zt("created_at",{mode:"date",withTimezone:!1}).defaultNow()}),ou=Yt("chat_messages",{id:Xt("id").primaryKey(),author:lt("author").notNull(),body:lt("body").notNull(),createdAt:Zt("created_at",{mode:"date",withTimezone:!1}).defaultNow()});var ui=e=>{const t=Number.parseFloat(String(e.price));return{id:e.id,name:e.name,price:Number.isFinite(t)?t:0}};const el=({cacheControl:e})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60})};var ci=async e=>{const r=Number.isFinite(e)&&(e??0)>0?Number(e):0,i=tt.select().from(oe),s=r>0?i.where(et(oe.id,r)):i;try{const n=(await s.orderBy(oe.id).limit(6)).map(ui);return{items:n,cursor:n.length===6?n[n.length-1].id:null,source:"db"}}catch(n){return console.error("Failed to load store items",n),{items:[{id:-1,name:y`Sample adapter (offline)`,price:24.99},{id:-2,name:y`Edge cache pack (offline)`,price:12.5}],cursor:null,source:"fallback"}}},tl=_i(async e=>ci(e),"o0FSe7O5kbg");const rl=$i(N(tl,"s_o0FSe7O5kbg"));var il=async()=>ci();const di=vi(N(il,"s_v669J74jz24"));var sl=async e=>{const t=Number.parseInt(String(e.id??""),10);if(!Number.isFinite(t)||t<=0)return{success:!1,error:y`Invalid id.`};try{const[r]=await tt.delete(oe).where(fe(oe.id,t)).returning();return r?{success:!0,id:t}:{success:!1,error:y`Item not found.`}}catch(r){return console.error("Failed to delete store item",r),{success:!1,error:y`Unable to delete item right now.`}}};const hi=Ht(N(sl,"s_R9VLNISWb6o"));var nl=async e=>{const t=String(e.name??"").trim(),r=Number.parseFloat(String(e.price??""));if(!t||Number.isNaN(r)||r<=0)return{success:!1,error:y`Name and positive price required.`};try{const[i]=await tt.insert(oe).values({name:t,price:r.toString()}).returning();return{success:!0,item:ui(i)}}catch(i){return console.error("Failed to create store item",i),{success:!1,error:y`Unable to create item right now.`}}};const fi=Ht(N(nl,"s_nexPpNJs6FU"));var al=[.16,1,.3,1],ol=[.4,0,1,1],mi=()=>typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion: reduce)").matches,pi=e=>`cubic-bezier(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`,ll=()=>new Promise(e=>{if(typeof requestAnimationFrame!="function"){e();return}requestAnimationFrame(()=>requestAnimationFrame(()=>e()))}),gi=e=>e.finished?.then(()=>{})??new Promise((t,r)=>{e.addEventListener("finish",()=>t(),{once:!0}),e.addEventListener("cancel",()=>r(new Error("Animation cancelled")),{once:!0})}),ul=async(e,t,r)=>{if(!e.length||typeof document>"u"||typeof e[0]?.animate!="function")return;const i=e.map((s,n)=>{const o=typeof r.delay=="function"?r.delay(n):r.delay;return s.animate(t,{...r,delay:o})});await Promise.all(i.map(s=>gi(s)))},cl=async(e,t="new")=>{if(typeof document>"u"||!e.length||mi())return;await ll();const r=e.map(i=>document.querySelector(`[data-store-item-id="${i}"]`)).filter(i=>!!i);if(r.length)try{const i=t==="initial"?.7:0,s=t==="initial"?12:8,n=t==="initial"?.99:.98,o=t==="initial"?500:380,l=t==="initial"?60:45;await ul(r,[{opacity:i,transform:`translate3d(0, ${s}px, 0) scale(${n})`},{opacity:1,transform:"translate3d(0, 0, 0) scale(1)"}],{duration:o,easing:pi(al),fill:"none",delay:d=>d*l})}catch(i){console.error("Failed to run entrance animations",i)}},dl=async e=>{const[t]=le(),r=()=>{const s=()=>{t.value=t.value.filter(o=>o.id!==e)};if(typeof document>"u"){s();return}const n=document.startViewTransition;if(typeof n=="function"){n.call(document,s);return}s()};if(typeof document>"u"||mi())return r();const i=document.querySelector(`[data-store-item-id="${e}"]`);if(!i){r();return}try{await gi(i.animate([{opacity:1,transform:"translate3d(0, 0, 0) scale(1)"},{opacity:0,transform:"translate3d(0, -8px, 0) scale(0.96)"}],{duration:220,easing:pi(ol),fill:"both"}))}catch(s){console.error("Failed to animate removal",s)}r()},hl=async(e=!1)=>{const[t,r,i,s,n,o]=le();if(!o.value){o.value=!0,i.value=null;try{const l=await rl(e?void 0:r.value??void 0),d=l?.items??[],h=e?d:[...n.value,...d],p=e?new Set:new Set(n.value.map(w=>w.id)),c=d.map(w=>w.id).filter(w=>!p.has(w)),g=()=>{n.value=h};if(typeof document>"u")g();else{const w=document.startViewTransition;typeof w=="function"?w.call(document,g):g()}r.value=l?.cursor??null,s.value=l?.source==="fallback",i.value=l?.source==="fallback"?y`Database offline: showing fallback inventory.`:null,t(c)}catch(l){console.error("Failed to load store items",l),i.value=y`Unable to load inventory right now.`}finally{o.value=!1}}},fl=async(e,t)=>{const[r]=le();await r(t.dataset.reset==="1")},ml=({track:e})=>{const[t,r,i,s]=le(),n=e(()=>r.value);if(n?.success&&n.item){const o=[...s.value.filter(d=>d.id!==n.item.id),n.item];o.sort((d,h)=>d.id-h.id);const l=()=>{s.value=o};if(typeof document>"u")l();else{const d=document.startViewTransition;typeof d=="function"?d.call(document,l):l()}i.value=null,t([n.item.id])}},pl=({track:e})=>{const[t,r,i]=le(),s=e(()=>r.value);s?.success&&s.id?(t(s.id),i.value=null):s?.error&&(i.value=s.error)},gl=()=>{const e=di(),t=X(e.value.items),r=X(e.value.cursor),i=X(!1),s=X(e.value.source==="fallback"),n=X(e.value.source==="fallback"?y`Database offline: showing fallback inventory.`:null),o=fi(),l=hi(),d=N(cl,"s_ZF5ox75ncAY"),h=N(dl,"s_i5YbwZ5sHVc",[t]),p=N(fl,"s_dQlMqeLWpD0",[N(hl,"s_69ywUjDxRgU",[d,r,n,s,t,i])]);return ot(N(ml,"s_h70dBAjCmqY",[d,o,n,t]),{eagerness:"idle"}),ot(N(pl,"s_fap9umrX08E",[h,l,n]),{eagerness:"idle"}),m("div",null,{class:"gap-4 grid md:grid-cols-[1.2fr_1fr] bg-slate-900/60 mt-5 p-4 border border-slate-800 rounded-lg"},[m("div",null,{class:"space-y-4"},[m("div",null,{class:"flex justify-between items-center"},[m("p",null,{class:"text-slate-300 text-sm"},y`Inventory`,1,null),m("button",null,{type:"button",class:"bg-slate-800 hover:bg-slate-700 disabled:opacity-60 px-3 py-2 rounded-lg ring-1 ring-slate-700 font-semibold text-slate-100 text-xs transition","data-reset":"1",disabled:se(c=>c.value,[i],"p0.value"),onClick$:p},y`Refresh`,1,null)],1,null),s.value&&m("p",null,{class:"text-amber-300 text-xs"},y`Showing fallback data while the database is unavailable.`,1,"YL_0"),n.value&&m("p",null,{class:"text-rose-300 text-sm"},se(c=>c.value,[n],"p0.value"),3,"YL_1"),t.value.length?m("ul",null,{class:"gap-3 grid md:grid-cols-2",style:{viewTransitionName:"store-grid"}},t.value.map(c=>m("li",{"data-store-item-id":te(c,"id"),style:{viewTransitionName:`store-item-${c.id}`}},{class:"surface space-y-2 p-4"},[m("div",null,{class:"flex justify-between items-start gap-3"},[m("div",null,null,[m("p",null,{class:"text-slate-400 text-sm"},y`SKU ${c.id}`,1,null),m("p",null,{class:"font-semibold text-slate-50 text-lg"},te(c,"name"),1,null)],1,null),O(Bt,{action:l,class:"shrink-0",children:[m("input",{value:te(c,"id")},{type:"hidden",name:"id"},null,3,null),m("button",{disabled:l.isRunning||c.id<=0,"aria-label":y`Delete ${c.name}`},{type:"submit",class:"hover:bg-rose-500/10 disabled:opacity-60 px-2 py-1 rounded-md ring-1 ring-slate-700 hover:ring-rose-500 text-slate-400 hover:text-rose-200 text-xs transition"},y`Delete`,1,null)],[ce]:{action:ce,class:ce}},1,"YL_2")],1,null),m("p",null,{class:"text-emerald-300"},["$",c.price.toFixed(2)],1,null)],1,c.id)),1,"YL_3"):!i.value&&m("p",null,{class:"text-slate-500 text-sm"},y`No items yet.`,1,"YL_4"),m("div",null,{class:"flex items-center gap-3"},[r.value!==null&&m("button",null,{type:"button",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-60 px-4 py-2 rounded-lg font-semibold text-emerald-950 text-sm transition",disabled:se(c=>c.value,[i],"p0.value"),onClick$:p},y`Load more`,1,"YL_5"),i.value&&m("span",null,{class:"text-slate-400 text-xs"},y`Loading...`,1,"YL_6")],1,null)],1,null),m("div",null,{class:"space-y-3 bg-slate-900/80 p-4 border border-slate-800 rounded-lg"},[m("p",null,{class:"font-semibold text-slate-100 text-sm"},y`Add an item`,1,null),O(Bt,{action:o,class:"space-y-3 text-slate-200 text-sm",children:[m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"name"},y`Name`,1,null),m("input",null,{id:"name",name:"name",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:y`Lightweight widget`,required:!0},null,3,null)],1,null),m("div",null,{class:"space-y-1"},[m("label",null,{class:"text-slate-400 text-xs uppercase tracking-wide",for:"price"},y`Price`,1,null),m("input",null,{id:"price",name:"price",type:"number",step:"0.01",min:"0",class:"bg-slate-950 px-3 py-2 border border-slate-800 rounded-lg w-full text-slate-100",placeholder:"24.99",required:!0},null,3,null)],1,null),m("button",null,{type:"submit",class:"bg-emerald-500 hover:bg-emerald-400 disabled:opacity-70 px-4 py-2 rounded-lg w-full font-semibold text-emerald-950 text-sm transition",disabled:se(c=>c.isRunning,[o],"p0.isRunning")},o.isRunning?y`Saving...`:y`Create item`,1,null),o.value?.error&&m("p",null,{class:"text-rose-300 text-xs"},se(c=>c.value.error,[o],"p0.value.error"),3,"YL_7"),o.value?.success&&o.value.item&&m("p",null,{class:"text-emerald-300 text-xs"},y`Added ${o.value.item.name}.`,1,"YL_8")],[ce]:{action:ce,class:ce}},1,"YL_9")],1,null)],1,"YL_10")};const yl=W(N(gl,"s_2aWAOZ0c5GI"));var bl="[data-store-item-id]{transform-origin:top;will-change:transform,opacity}@media (prefers-reduced-motion:reduce){[data-store-item-id]{transition:none!important;animation:none!important}}",vl=ge({default:()=>Sl,head:()=>Pl,onGet:()=>el,useCreateStoreItem:()=>fi,useDeleteStoreItem:()=>hi,useStoreItemsLoader:()=>di},1),wl=()=>(Ee(N(bl,"s_cOQoV5jD0Q4")),m("section",null,{class:"p-6 surface"},[m("div",null,{class:"flex justify-between items-center gap-2"},[m("div",null,null,[m("p",null,{class:"text-emerald-300 text-sm uppercase tracking-wide"},y`Store`,1,null),m("h1",null,{class:"font-semibold text-slate-50 text-2xl"},y`Fast browsing with tiny payloads`,1,null)],1,null),m("span",null,{class:"bg-slate-800 px-3 py-1 rounded-full text-slate-200 text-xs"},y`cached`,1,null)],1,null),m("p",null,{class:"mt-3 max-w-2xl text-slate-300 text-sm"},y`Items stream directly from Postgres via Drizzle, with cursor pagination to keep responses lean. Interactivity wakes up only when you click.`,1,null),O(yl,null,3,"3h_0")],1,"3h_1")),Sl=W(N(wl,"s_bZ8kc5UlLx4"));const Pl=({withLocale:e})=>e(()=>({title:y`Store | Prometheus`,meta:[{name:"description",content:y`Drizzle-powered store pulling from Postgres with cursor pagination and lazy loading.`}]}));var $l=ge({onGet:()=>xl},1);const xl=async({cacheControl:e,query:t,json:r})=>{e({public:!0,maxAge:300,sMaxAge:900,staleWhileRevalidate:60});const i=Number.parseInt(t.get("limit")??"",10),s=Number.parseInt(t.get("cursor")??"",10),n=Number.isFinite(i)&&i>0?Math.min(i,50):10,o=Number.isFinite(s)&&s>0?s:0;try{const l=tt.select().from(oe),d=(await(o>0?l.where(et(oe.id,o)):l).orderBy(oe.id).limit(n)).map(h=>({...h,price:Number.parseFloat(String(h.price))}));r(200,{items:d,cursor:d.length===n?d[d.length-1].id:null})}catch(l){console.error("Failed to load store items",l),r(500,{error:"Unable to load items right now."})}},Tl=[Ki];var Ce=()=>ls;const Cl=[["/",[Ce,()=>ps],"/",["q-BVNuLbAP.js","q-dfyaaQj0.js"]],["ai",[Ce,()=>ws],"/ai",["q-BVNuLbAP.js","q-Da_9n3Hj.js"]],["chat",[Ce,()=>As],"/chat",["q-BVNuLbAP.js","q-Cr7mdLxV.js"]],["index",[Ce,()=>fs],"/index",["q-BVNuLbAP.js","q-CHHh6Rgr.js"]],["store",[Ce,()=>vl],"/store",["q-BVNuLbAP.js","q-lMS3FNyy.js"]],["api/store/items",[Ce,()=>$l],"/api/store/items",["q-BVNuLbAP.js"]]],Nl=[];var yi={routes:Cl,serverPlugins:Tl,menus:Nl,trailingSlash:!1,basePathname:"/",cacheModules:!0},_l=({serverData:e})=>`/build${`/${e.locale}`}`,Al=()=>{qi(()=>Ni(Ye))},Ll=()=>{const e=bt();return bi(Le("s_TVD7erg9zpo",[X(e.url.href),e])),O(Gt,null,3,"Dv_0")};const Bl=W(N(Ll,"s_w6dmeDadJmA"));var ql={};globalThis.__EXPERIMENTAL__=ql;var Ql=()=>O(Pi,{children:[m("head",null,null,[m("meta",null,{charSet:"utf-8"},null,3,null),O(lr,null,3,"xd_0")],1,null),m("body",null,{class:"app-shell"},O(Bl,{children:O(xi,null,3,"xd_1")},1,"xd_2"),1,null)]},1,"xd_3"),kl=W(N(Ql,"s_8txvw3enrrU"));Al();var Il=e=>{const t=typeof e.base=="function"?e.base(e):e.base;return t?t.endsWith("/")?t:`${t}/`:"/build/"},Kt=e=>!!e&&typeof e=="object"&&"manifest"in e,jl=e=>{const t=e.serverData?.locale;if(t)return t;let r=null;const i=e.serverData?.url;if(i)try{r=new URL(i).searchParams.get("locale")}catch{r=null}const s=e.serverData?.requestHeaders?.["accept-language"]??void 0;return wt({queryLocale:r,acceptLanguage:s})},Dl=e=>{const t=e.serverData?.url;if(typeof t=="string"&&t.length>0)try{return new URL(t).pathname}catch{}return"/"},Ol=e=>{const t=yi.routes;if(!Array.isArray(t))return[];const r=e.startsWith("/")?e:`/${e}`,i=new Set(["/","/index"]);for(const s of t){if(!Array.isArray(s)||s.length<4)continue;const n=s[2],o=s[3];if(!(typeof n!="string"||!Array.isArray(o))){if(i.has(n)&&i.has(r))return o.filter(l=>typeof l=="string"&&l.length>0);if(n===r)return o.filter(l=>typeof l=="string"&&l.length>0)}}return[]},zl=(e,t,r)=>{const i=t&&typeof t=="object"?t:null,s=[typeof i?.qwikLoader=="string"?i.qwikLoader:null,typeof i?.core=="string"?i.core:null,typeof i?.preloader=="string"?i.preloader:null,...Ol(r)].filter(o=>typeof o=="string"),n=new Set;return s.filter(o=>n.has(o)?!1:(n.add(o),!0)).map(o=>({tag:"link",location:"head",attributes:{rel:"modulepreload",href:`${e}${o}`,crossorigin:"anonymous"}}))};function Fl(e){const t=e.manifest??Wt,r=Kt(t)?t.manifest:t,i=Dl(e),s=jl(e),n={...e.serverData,locale:s},o=Il({...e,base:_l,serverData:n}),l=`${o}${r?.qwikLoader??"qwikloader.js"}`,d={...e.containerAttributes,lang:s,"q:locale":s},p={tag:"script",location:"head",attributes:{"data-qwik-lazy-loader":"1",dangerouslySetInnerHTML:`(function(){const src='${l}';if(!src)return;let started=false;const load=()=>{if(started||navigator.connection?.saveData)return;started=true;const s=document.createElement('script');s.type='module';s.defer=true;s.src=src;s.setAttribute('data-qwik-loader','lazy');document.head.appendChild(s);};const prime=()=>{load();cleanup();};const cleanup=()=>triggers.forEach((event)=>document.removeEventListener(event,prime,listenerOpts));const triggers=['pointerdown','keydown','touchstart','focusin'];const listenerOpts={once:true,passive:true};triggers.forEach((event)=>document.addEventListener(event,prime,listenerOpts));document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible')prime();},{once:true});})();`}},c=zl(o,r,i),g=r?Kt(t)?{...t,manifest:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],...c,p]}}:{...r,core:void 0,preloader:void 0,injections:[...r?.injections??[],...c,p]}:t;return wi(O(kl,null,3,"CC_0"),{...e,base:o,serverData:n,manifest:g,qwikLoader:"never",preloader:!1,containerTagName:"html",containerAttributes:d,stream:e.stream??{static:{buffer:0},inOrder:["<html"]}})}var{router:Vl,notFound:El}=Ci({render:Fl,qwikCityPlan:yi,manifest:Wt}),lu={router:Vl,notFound:El};export{lu as default,El as notFound,Vl as router};
