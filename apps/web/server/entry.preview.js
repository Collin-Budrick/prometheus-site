import{C as Pe,M as De,_ as Oe,t as We}from"./q-CnDsmpmY.js";import{n as Ne,r as Ue,t as Ie}from"./q-CgKKcftO.js";import{getNotFound as Le}from"./@qwik-city-not-found-paths.js";import{isStaticPath as ee}from"./@qwik-city-static-paths.js";import{createReadStream as je}from"node:fs";import{basename as Fe,extname as ze,join as H}from"node:path";import{fileURLToPath as Qe}from"node:url";import{Http2ServerRequest as Ge}from"node:http2";import{ReadableStream as Be,TextDecoderStream as Je,TextEncoderStream as Ke,WritableStream as Xe}from"node:stream/web";import{FormData as Ye,Headers as Ve,Request as Ze,Response as Ee,fetch as qe}from"undici";import et from"crypto";function Q(e,t){let n="Server Error";return t!=null&&(typeof t.message=="string"?n=t.message:n=String(t)),"<html>"+tt(e,n)+"</html>"}function tt(e,t){typeof e!="number"&&(e=500),typeof t=="string"?t=rt(t):t="";const n=typeof t=="string"?"600px":"300px",r=e>=500?it:at;return`
<head>
  <meta charset="utf-8">
  <meta http-equiv="Status" content="${e}">
  <title>${e} ${t}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { color: ${r}; background-color: #fafafa; padding: 30px; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Roboto, sans-serif; }
    p { max-width: ${n}; margin: 60px auto 30px auto; background: white; border-radius: 4px; box-shadow: 0px 0px 50px -20px ${r}; overflow: hidden; }
    strong { display: inline-block; padding: 15px; background: ${r}; color: white; }
    span { display: inline-block; padding: 15px; }
  </style>
</head>
<body><p><strong>${e}</strong> <span>${t}</span></p></body>
`}var nt=/[&<>]/g,rt=e=>e.replace(nt,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return""}}),at="#006ce9",it="#713fc2",st={lax:"Lax",Lax:"Lax",None:"None",none:"None",strict:"Strict",Strict:"Strict"},ot={seconds:1,minutes:60,hours:3600,days:3600*24,weeks:3600*24*7},te=(e,t,n)=>{const r=[`${e}=${t}`];typeof n.domain=="string"&&r.push(`Domain=${n.domain}`),typeof n.maxAge=="number"?r.push(`Max-Age=${n.maxAge}`):Array.isArray(n.maxAge)?r.push(`Max-Age=${n.maxAge[0]*ot[n.maxAge[1]]}`):typeof n.expires=="number"||typeof n.expires=="string"?r.push(`Expires=${n.expires}`):n.expires instanceof Date&&r.push(`Expires=${n.expires.toUTCString()}`),n.httpOnly&&r.push("HttpOnly"),typeof n.path=="string"&&r.push(`Path=${n.path}`);const s=lt(n.sameSite);return s&&r.push(`SameSite=${s}`),n.secure&&r.push("Secure"),r.join("; ")};function ne(e){try{return decodeURIComponent(e)}catch{return e}}var ct=e=>{const t={};if(typeof e=="string"&&e!==""){const n=e.split(";");for(const r of n){const s=r.indexOf("=");s!==-1&&(t[ne(r.slice(0,s).trim())]=ne(r.slice(s+1).trim()))}}return t};function lt(e){if(e===!0)return"Strict";if(e===!1)return"None";if(e)return st[e]}var C=Symbol("request-cookies"),P=Symbol("response-cookies"),R=Symbol("live-cookies"),ft=class{[C];[P]={};[R]={};appendCounter=0;constructor(e){this[C]=ct(e),this[R]={...this[C]}}get(e,t=!0){const n=this[t?R:C][e];return n?{value:n,json(){return JSON.parse(n)},number(){return Number(n)}}:null}getAll(e=!0){return Object.keys(this[e?R:C]).reduce((t,n)=>(t[n]=this.get(n),t),{})}has(e,t=!0){return!!this[t?R:C][e]}set(e,t,n={}){this[R][e]=typeof t=="string"?t:JSON.stringify(t);const r=typeof t=="string"?t:encodeURIComponent(JSON.stringify(t));this[P][e]=te(e,r,n)}append(e,t,n={}){this[R][e]=typeof t=="string"?t:JSON.stringify(t);const r=typeof t=="string"?t:encodeURIComponent(JSON.stringify(t));this[P][++this.appendCounter]=te(e,r,n)}delete(e,t){this.set(e,"deleted",{...t,maxAge:0}),this[R][e]=null}headers(){return Object.values(this[P])}},D=class extends Error{constructor(e,t){super(typeof t=="string"?t:void 0),this.status=e,this.data=t}},U=class{},Y=class extends U{},ge=class extends U{constructor(e){super(),this.pathname=e}},re=new WeakMap,ae="qaction",ut="qfunc",ie="qdata";function dt(e,t){return ye(e,ce(e),se(e),t,ce(t),se(t))}function ye(e,t,n,r,s,a){if(r.startsWith("/build/"))return null;let c=null;for(;t<n;){const i=e.charCodeAt(t++),o=r.charCodeAt(s++);if(i===91){const f=we(e,t),l=t+(f?3:0),u=G(e,l,n,93),d=e.substring(l,u),m=G(e,u+1,n,47),g=e.substring(u+1,m);t=u+1;const y=s-1;if(f){const A=mt(d,g,r,y,a,e,t+g.length+1,n);if(A)return Object.assign(c||(c={}),A)}const w=G(r,y,a,47,g);if(w==-1)return null;const S=r.substring(y,w);if(!f&&!g&&!S)return null;s=w,(c||(c={}))[d]=decodeURIComponent(S)}else if(i!==o&&!(isNaN(o)&&ht(e,t)))return null}return oe(e,t)&&oe(r,s)?c||{}:null}function ht(e,t){return e.charCodeAt(t)===91&&we(e,t+1)}function se(e){const t=e.length;return t>1&&e.charCodeAt(t-1)===47?t-1:t}function oe(e,t){const n=e.length;return t>=n||t==n-1&&e.charCodeAt(t)===47}function ce(e){return e.charCodeAt(0)===47?1:0}function we(e,t){return e.charCodeAt(t)===46&&e.charCodeAt(t+1)===46&&e.charCodeAt(t+2)===46}function G(e,t,n,r,s=""){for(;t<n&&e.charCodeAt(t)!==r;)t++;const a=s.length;for(let c=0;c<a;c++)if(e.charCodeAt(t-a+c)!==s.charCodeAt(c))return-1;return t-a}function mt(e,t,n,r,s,a,c,i){n.charCodeAt(r)===47&&r++;let o=s;const f=t+"/";for(;o>=r;){const l=ye(a,c,i,n,o,s);if(l){let d=n.substring(r,Math.min(o,s));return d.endsWith(f)&&(d=d.substring(0,d.length-f.length)),l[e]=decodeURIComponent(d),l}const u=pt(n,r,f,o,r-1)+f.length;if(o===u)break;o=u}return null}function pt(e,t,n,r,s){let a=e.lastIndexOf(n,r);return a==r-n.length&&(a=e.lastIndexOf(n,r-n.length-1)),a>t?a:s}var gt=async(e,t,n,r,s)=>{if(!Array.isArray(e))return null;for(const a of e){const c=a[0],i=dt(c,r);if(!i)continue;const o=a[1],f=a[3],l=new Array(o.length),u=[];o.forEach((m,g)=>{le(m,u,y=>l[g]=y,n)});let d;return s||le(yt(t,r),u,m=>d=m?.default,n),u.length>0&&await Promise.all(u),[c,i,l,d,f]}return null},le=(e,t,n,r)=>{if(typeof e=="function"){const s=re.get(e);if(s)n(s);else{const a=e();typeof a.then=="function"?t.push(a.then(c=>{r!==!1&&re.set(e,c),n(c)})):a&&n(a)}}},yt=(e,t)=>{if(e){t=t.endsWith("/")?t:t+"/";const n=e.find(r=>r[0]===t||t.startsWith(r[0]));if(n)return n[1]}},wt=e=>e&&typeof e.then=="function";function bt(e){const t=[];return e==="day"?e=3600*24:e==="week"?e=3600*24*7:e==="month"?e=3600*24*30:e==="year"?e=3600*24*365:e==="private"?e={private:!0,noCache:!0}:e==="immutable"?e={public:!0,immutable:!0,maxAge:3600*24*365}:e==="no-cache"&&(e={noCache:!0}),typeof e=="number"&&(e={maxAge:e,sMaxAge:e}),e.immutable&&t.push("immutable"),e.maxAge&&t.push(`max-age=${e.maxAge}`),e.sMaxAge&&t.push(`s-maxage=${e.sMaxAge}`),e.noStore&&t.push("no-store"),e.noCache&&t.push("no-cache"),e.private&&t.push("private"),e.public&&t.push("public"),e.staleWhileRevalidate&&t.push(`stale-while-revalidate=${e.staleWhileRevalidate}`),e.staleIfError&&t.push(`stale-if-error=${e.staleIfError}`),t.join(", ")}var O;import("node:async_hooks").then(e=>{const t=e.AsyncLocalStorage;O=new t,globalThis.qcAsyncRequestStore=O}).catch(e=>{console.warn("AsyncLocalStorage not available, continuing without it. This might impact concurrent server calls.",e)});function St(e,t,n,r,s=!0,a="/",c){let i;const o=new Promise(l=>i=l),f=Tt(e,t,n,s,a,c,i);return{response:o,requestEv:f,completion:O?O.run(f,fe,f,r,i):fe(f,r,i)}}async function fe(e,t,n){try{(c=>new URL(c.pathname+c.search,c))(e.originalUrl)}catch{const c="Resource Not Found";e.status(404);const i=Q(404,c);return e.html(404,i),new D(404,c)}let r=1;async function s(){try{await e.next()}catch(a){if(a instanceof Y)await e.getWritableStream().close();else if(a instanceof ge){if(r>50)throw new Error("Infinite rewrite loop");r+=1;const c=new URL(e.url);c.pathname=a.pathname;const{loadedRoute:i,requestHandlers:o}=await t(c);return e.resetRoute(i,o,c),await s()}else if(a instanceof D){if(!e.headersSent){const c=a.status,i=e.request.headers.get("Accept");if(i&&!i.includes("text/html")){const o=e[$];e.headers.set("Content-Type","application/qwik-json"),e.send(c,await o._serializeData(a.data,!0))}else{const o=Q(a.status,a.data);e.html(c,o)}}}else if(!(a instanceof U)){if(j(e)!=="dev")try{e.headersSent||(e.headers.set("content-type","text/html; charset=utf-8"),e.cacheControl({noCache:!0}),e.status(500));const c=e.getWritableStream();if(!c.locked){const i=c.getWriter();await i.write(F.encode(Q(500,"Internal Server Error"))),await i.close()}}catch{console.error("Unable to render error page")}return a}}}try{return await s()}finally{e.isDirty()||n(null)}}function X(e,t){const n=e.endsWith(M);if(n){const r=e.length-M.length+(t?1:0);e=e.slice(0,r),e===""&&(e="/")}return{pathname:e,isInternal:n}}var V="@isQData",M="/q-data.json",be=Symbol("RequestEvLoaders"),Se=Symbol("RequestEvMode"),xe=Symbol("RequestEvRoute"),$=Symbol("RequestEvQwikSerializer"),Te=Symbol("RequestEvTrailingSlash"),Re="@routeName",I="@actionId",Ae="@actionFormData",xt="@nonce",_e="@rewrite";function Tt(e,t,n,r,s,a,c){const{request:i,platform:o,env:f}=e,l=new Map,u=new ft(i.headers.get("cookie")),d=new Headers,m=new URL(i.url),{pathname:g,isInternal:y}=X(m.pathname,r);y&&(m.pathname=g,l.set(V,!0));let w=-1,S=null,A,E=e.locale,T=200;const Me=async()=>{for(w++;w<n.length;){const h=n[w],p=globalThis.qcAsyncRequestStore,b=p?.run?p.run(x,h,x):h(x);wt(b)&&await b,w++}},$e=(h,p,b=m)=>{t=h,n=p,m.pathname=b.pathname,m.search=b.search,w=-1},_=()=>{if(S!==null)throw new Error("Response already sent")},k=(h,p)=>{if(_(),typeof h=="number"){T=h;const b=x.getWritableStream().getWriter();b.write(typeof p=="string"?F.encode(p):p),b.close()}else if(T=h.status,h.headers.forEach((b,v)=>{v.toLowerCase()!=="set-cookie"&&d.append(v,b)}),h.headers.getSetCookie().forEach(b=>{const v=b.indexOf("=");if(v===-1)return;const ke=b.slice(0,v).trim(),He=b.slice(v+1).trim();u.set(ke,He)}),h.body){const b=x.getWritableStream();h.body.pipeTo(b)}else x.getWritableStream().getWriter().close();return q()},q=()=>(w=B,new U),z={},x={[be]:z,[Se]:e.mode,[Te]:r,get[xe](){return t},[$]:a,cookie:u,headers:d,env:f,method:i.method,signal:i.signal,originalUrl:new URL(m),get params(){return t?.[1]??{}},get pathname(){return m.pathname},platform:o,get query(){return m.searchParams},request:i,url:m,basePathname:s,sharedMap:l,get headersSent(){return S!==null},get exited(){return w>=B},get clientConn(){return e.getClientConn()},next:Me,resetRoute:$e,exit:q,cacheControl:(h,p="Cache-Control")=>{_(),d.set(p,bt(h))},resolveValue:(async h=>{const p=h.__id;if(h.__brand==="server_loader"&&!(p in z))throw new Error("You can not get the returned data of a loader that has not been executed for this request.");return z[p]}),status:h=>typeof h=="number"?(_(),T=h,h):T,locale:h=>(typeof h=="string"&&(E=h),E||""),error:(h,p)=>(T=h,d.delete("Cache-Control"),new D(h,p)),redirect:(h,p)=>{if(_(),T=h,p){if(/([^:])\/{2,}/.test(p)){const b=p.replace(/([^:])\/{2,}/g,"$1/");console.warn(`Redirect URL ${p} is invalid, fixing to ${b}`),p=b}d.set("Location",p)}return d.delete("Cache-Control"),h>301&&d.set("Cache-Control","no-store"),w=B,new Y},rewrite:h=>{if(_(),h.startsWith("http"))throw new Error("Rewrite does not support absolute urls");return l.set(_e,!0),new ge(h.replace(/\/+/g,"/"))},defer:h=>typeof h=="function"?h:()=>h,fail:(h,p)=>(_(),T=h,d.delete("Cache-Control"),{failed:!0,...p}),text:(h,p)=>(d.set("Content-Type","text/plain; charset=utf-8"),k(h,p)),html:(h,p)=>(d.set("Content-Type","text/html; charset=utf-8"),k(h,p)),parseBody:async()=>A!==void 0?A:A=At(x,l,a),json:(h,p)=>(d.set("Content-Type","application/json; charset=utf-8"),k(h,JSON.stringify(p))),send:k,isDirty:()=>S!==null,getWritableStream:()=>{if(S===null){if(e.mode==="dev"){const h=l.get("@serverTiming");h&&d.set("Server-Timing",h.map(p=>`${p[0]};dur=${p[1]}`).join(","))}S=e.getWritableStream(T,d,u,c,x)}return S}};return Object.freeze(x)}function L(e){return e[be]}function Z(e){return e[Te]}function Rt(e){return e[xe]}function j(e){return e[Se]}var B=Number.MAX_SAFE_INTEGER,At=async({request:e,method:t,query:n},r,s)=>{var a;const c=((a=e.headers.get("content-type"))==null?void 0:a.split(/[;,]/,1)[0].trim())??"";if(c==="application/x-www-form-urlencoded"||c==="multipart/form-data"){const i=await e.formData();return r.set(Ae,i),_t(i)}else{if(c==="application/json")return await e.json();if(c==="application/qwik-json"){if(t==="GET"&&n.has(ie)){const i=n.get(ie);if(i)try{return s._deserializeData(decodeURIComponent(i))}catch{}}return s._deserializeData(await e.text())}}},_t=e=>[...e.entries()].reduce((t,[n,r])=>(n.split(".").reduce((s,a,c,i)=>{if(a.endsWith("[]")){const o=a.slice(0,-2);return s[o]=s[o]||[],s[o]=[...s[o],r]}return c<i.length-1?s[a]=s[a]||(Number.isNaN(+i[c+1])?{}:[]):s[a]=r},t),t),{});function vt(e){const{params:t,request:n,status:r,locale:s,originalUrl:a}=e,c={};n.headers.forEach((y,w)=>c[w]=y);const i=e.sharedMap.get(I),o=e.sharedMap.get(Ae),f=e.sharedMap.get(Re),l=e.sharedMap.get(xt),u=e.request.headers,d=new URL(a.pathname+a.search,a),m=u.get("X-Forwarded-Host"),g=u.get("X-Forwarded-Proto");return m&&(d.port="",d.host=m),g&&(d.protocol=g),{url:d.href,requestHeaders:c,locale:s(),nonce:l,containerAttributes:{"q:route":f},qwikcity:{routeName:f,ev:e,params:{...t},loadedRoute:Rt(e),response:{status:r(),loaders:L(e),action:i,formData:o}}}}var Ct=(e,t,n,r,s,a)=>{const c=[],i=[],o=[],f=!!(t&&Dt(t[2]));if(a&&o.push(Ut),e&&ue(c,i,o,e,f,n),t){const l=t[0];r&&(n==="POST"||n==="PUT"||n==="PATCH"||n==="DELETE")&&(r==="lax-proto"?o.unshift(Ot):o.unshift(Wt)),f&&((n==="POST"||n==="GET")&&o.push(kt),o.push(Ht),a&&o.push(It));const u=t[2];ue(c,i,o,u,f,n),f&&(o.push(d=>{d.sharedMap.set(Re,l)}),o.push(Mt(i,c)),o.push(s))}return o},ue=(e,t,n,r,s,a)=>{for(const c of r){typeof c.onRequest=="function"?n.push(c.onRequest):Array.isArray(c.onRequest)&&n.push(...c.onRequest);let i;switch(a){case"GET":i=c.onGet;break;case"POST":i=c.onPost;break;case"PUT":i=c.onPut;break;case"PATCH":i=c.onPatch;break;case"DELETE":i=c.onDelete;break;case"OPTIONS":i=c.onOptions;break;case"HEAD":i=c.onHead;break}if(typeof i=="function"?n.push(i):Array.isArray(i)&&n.push(...i),s)for(const o of Object.values(c))typeof o=="function"&&(o.__brand==="server_loader"?e.push(o):o.__brand==="server_action"&&t.push(o))}};function Mt(e,t){return async n=>{if(n.headersSent){n.exit();return}const{method:r}=n,s=L(n),a=j(n)==="dev",c=n[$];if(a&&r==="GET"&&n.query.has(ae)&&console.warn(`Seems like you are submitting a Qwik Action via GET request. Qwik Actions should be submitted via POST request.
Make sure your <form> has method="POST" attribute, like this: <form method="POST">`),r==="POST"){const i=n.query.get(ae);if(i){const o=globalThis._qwikActionsMap,f=e.find(l=>l.__id===i)??o?.get(i);if(f){n.sharedMap.set(I,i);const l=await n.parseBody();if(!l||typeof l!="object")throw new Error(`Expected request data for the action id ${i} to be an object`);const u=await de(n,f.__validators,l,a);if(!u.success)s[i]=n.fail(u.status??500,u.error);else{const d=a?await N(n,f.__qrl.getSymbol().split("_",1)[0],()=>f.__qrl.call(n,u.data,n)):await f.__qrl.call(n,u.data,n);a&&W(c,d,f.__qrl),s[i]=d}}}}if(t.length>0){const i=t.map(o=>{const f=o.__id;return s[f]=de(n,o.__validators,void 0,a).then(l=>l.success?a?N(n,o.__qrl.getSymbol().split("_",1)[0],()=>o.__qrl.call(n,n)):o.__qrl.call(n,n):n.fail(l.status??500,l.error)).then(l=>(typeof l=="function"?s[f]=l():(a&&W(c,l,o.__qrl),s[f]=l),l)),s[f]});await Promise.all(i)}}}async function de(e,t,n,r){let s={success:!0,data:n};if(t)for(const a of t)if(r?s=await N(e,"validator$",()=>a.validate(e,n)):s=await a.validate(e,n),s.success)n=s.data;else return s;return s}function $t(e){return e?typeof e=="object"&&Symbol.asyncIterator in e:!1}async function kt(e){const t=e.query.get(ut);if(t&&e.request.headers.get("X-QRL")===t&&e.request.headers.get("Content-Type")==="application/qwik-json"){e.exit();const n=j(e)==="dev",r=e[$],s=await e.parseBody();if(Array.isArray(s)){const[a,...c]=s;if(Pt(a)&&a.getHash()===t){let i;try{n?i=await N(e,`server_${a.getSymbol()}`,()=>a.apply(e,c)):i=await a.apply(e,c)}catch(o){throw o instanceof D?e.error(o.status,o.data):e.error(500,"Invalid request")}if($t(i)){e.headers.set("Content-Type","text/qwik-json-stream");const o=e.getWritableStream().getWriter();for await(const f of i){n&&W(r,f,a);const l=await r._serializeData(f,!0);if(e.signal.aborted)break;await o.write(F.encode(`${l}
`))}o.close()}else{W(r,i,a),e.headers.set("Content-Type","application/qwik-json");const o=await r._serializeData(i,!0);e.send(200,o)}return}}throw e.error(500,"Invalid request")}}function Ht(e){const t=Z(e),{basePathname:n,originalUrl:r,sharedMap:s}=e,{pathname:a,search:c}=r;if(!s.has(V)&&a!==n&&!a.endsWith(".html")){if(t){if(!a.endsWith("/"))throw e.redirect(301,a+"/"+c)}else if(a.endsWith("/"))throw e.redirect(301,a.slice(0,a.length-1)+c)}}function W(e,t,n){try{e._verifySerializable(t,void 0)}catch(r){throw r instanceof Error&&n.dev&&(r.loc=n.dev),r}}var Pt=e=>typeof e=="function"&&typeof e.getSymbol=="function";function Dt(e){const t=e[e.length-1];return t&&typeof t.default=="function"}function ve(e,t){e=new URL(e),e.pathname.endsWith(M)&&(e.pathname=e.pathname.slice(0,-M.length)),t?e.pathname.endsWith("/")||(e.pathname+="/"):e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1));const n=e.search.slice(1).replaceAll(/&?q(action|data|func)=[^&]+/g,"");return`${e.pathname}${n?`?${n}`:""}${e.hash}`}var F=new TextEncoder;function Ot(e){Ce(e,"lax-proto")}function Wt(e){Ce(e)}function Ce(e,t){if(jt(e.request.headers,"application/x-www-form-urlencoded","multipart/form-data","text/plain")){const n=e.request.headers.get("origin"),r=e.url.origin;let s=n!==r;if(s&&t&&n?.replace(/^http(s)?/g,"")===r.replace(/^http(s)?/g,"")&&(s=!1),s)throw e.error(403,`CSRF check failed. Cross-site ${e.method} form submissions are forbidden.
The request origin "${n}" does not match the server origin "${r}".`)}}function Nt(e){return async t=>{if(t.headersSent||t.sharedMap.has(V))return;const n={};t.request.headers.forEach((u,d)=>n[d]=u);const r=t.headers;r.has("Content-Type")||r.set("Content-Type","text/html; charset=utf-8");const s=Z(t),{readable:a,writable:c}=new TextEncoderStream,i=t.getWritableStream(),o=a.pipeTo(i,{preventClose:!0}),f=c.getWriter(),l=t.status();try{const u=j(t)==="static",d=vt(t),m=await e({base:t.basePathname+"build/",stream:f,serverData:d,containerAttributes:{"q:render":u?"static":"",...d.containerAttributes}}),g={loaders:L(t),action:t.sharedMap.get(I),status:l!==200?l:200,href:ve(t.url,s)};typeof m.html=="string"&&await f.write(m.html),t.sharedMap.set("qData",g)}finally{await f.ready,await f.close(),await o}await i.close()}}async function Ut(e){try{await e.next()}catch(r){if(!(r instanceof Y))throw r}if(e.headersSent)return;const t=e.status(),n=e.headers.get("Location");if(t>=301&&t<=308&&n){const r=Lt(n);if(r){e.headers.set("Location",r),e.getWritableStream().close();return}else e.status(200),e.headers.delete("Location")}}async function It(e){if(await e.next(),e.headersSent||e.exited)return;const t=e.status(),n=e.headers.get("Location"),r=Z(e),s={};e.request.headers.forEach((o,f)=>s[f]=o),e.headers.set("Content-Type","application/json; charset=utf-8");const a={loaders:L(e),action:e.sharedMap.get(I),status:t!==200?t:200,href:ve(e.url,r),redirect:n??void 0,isRewrite:e.sharedMap.get(_e)},c=e.getWritableStream().getWriter(),i=await e[$]._serializeData(a,!0);c.write(F.encode(i)),e.sharedMap.set("qData",a),c.close()}function Lt(e){if(e.startsWith("/")){if(!e.includes(M)){const t=new URL(e,"http://localhost");return(t.pathname.endsWith("/")?t.pathname.slice(0,-1):t.pathname)+M+t.search}return e}else return}function he(){return typeof performance<"u"?performance.now():0}async function N(e,t,n){const r=he();try{return await n()}finally{const s=he()-r;let a=e.sharedMap.get("@serverTiming");a||e.sharedMap.set("@serverTiming",a=[]),a.push([t,s])}}function jt(e,...t){var n;const r=((n=e.get("content-type"))==null?void 0:n.split(/;/,1)[0].trim())??"";return t.includes(r)}async function Ft(e,t,n){const{render:r,qwikCityPlan:s,checkOrigin:a}=t,{pathname:c,isInternal:i}=X(e.url.pathname,s.trailingSlash),o=await me(s,c,e.request.method,a??!0,r,i);if(o){const[f,l]=o;return St(e,f,l,async d=>{const{pathname:m}=X(d.pathname,s.trailingSlash),g=await me(s,m,e.request.method,a??!0,r,i);if(g){const[y,w]=g;return{loadedRoute:y,requestHandlers:w}}else return{loadedRoute:null,requestHandlers:[]}},s.trailingSlash,s.basePathname,n)}return null}async function me(e,t,n,r,s,a){const{routes:c,serverPlugins:i,menus:o,cacheModules:f}=e,l=await gt(c,o,f,t,a),u=Ct(i,l,n,r,Nt(s),a);return u.length>0?[l,u]:null}function J(e,t){var n;return((n=t?.getOrigin)==null?void 0:n.call(t,e))??t?.origin??process.env.ORIGIN??zt(e)}function zt(e){const{PROTOCOL_HEADER:t,HOST_HEADER:n}=process.env,r=e.headers;return`${t&&r[t]||(e.socket.encrypted||e.connection.encrypted?"https":"http")}://${r[n??(e instanceof Ge?":authority":"host")]}`}function K(e,t){return Gt(e.originalUrl||e.url||"/",t)}function Qt(e=""){return["The stream has been destroyed","write after end"].some(t=>e.includes(t))}var pe=/^:(method|scheme|authority|path)$/i;function Gt(e,t){return new URL(e.replace(/\/\/|\\\\/g,"/"),t)}async function Bt(e,t,n,r,s){const a=new Headers,c=t.headers;try{for(const[u,d]of Object.entries(c))if(!pe.test(u)){if(typeof d=="string")a.set(u,d);else if(Array.isArray(d))for(const m of d)a.append(u,m)}}catch(u){console.error(u)}const i=async function*(){for await(const u of t)yield u},o=t.method==="HEAD"||t.method==="GET"?void 0:i(),f=new AbortController,l={method:t.method,headers:a,body:o,signal:f.signal,duplex:"half"};return n.on("close",()=>{f.abort()}),{mode:r,url:e,request:new Request(e.href,l),env:{get(u){return process.env[u]}},getWritableStream:(u,d,m)=>{n.statusCode=u;try{for(const[y,w]of d)pe.test(y)||n.setHeader(y,w);const g=m.headers();g.length>0&&n.setHeader("Set-Cookie",g)}catch(g){console.error(g)}return new WritableStream({write(g){n.closed||n.destroyed||n.write(g,y=>{y&&!Qt(y.message)&&console.error(y)})},close(){n.end()}})},getClientConn:()=>s?s(t):{ip:t.socket.remoteAddress},platform:{ssr:!0,incomingMessage:t,node:process.versions.node},locale:void 0}}var Jt={"3gp":"video/3gpp","3gpp":"video/3gpp",asf:"video/x-ms-asf",asx:"video/x-ms-asf",avi:"video/x-msvideo",avif:"image/avif",bmp:"image/x-ms-bmp",css:"text/css",flv:"video/x-flv",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",jng:"image/x-jng",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",kar:"audio/midi",m4a:"audio/x-m4a",m4v:"video/x-m4v",mid:"audio/midi",midi:"audio/midi",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ogg:"audio/ogg",pdf:"application/pdf",png:"image/png",rar:"application/x-rar-compressed",shtml:"text/html",svg:"image/svg+xml",svgz:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",txt:"text/plain",wbmp:"image/vnd.wap.wbmp",webm:"video/webm",webp:"image/webp",wmv:"video/x-ms-wmv",woff:"font/woff",woff2:"font/woff2",xml:"text/xml",zip:"application/zip"};function Kt(){typeof global<"u"&&typeof globalThis.fetch!="function"&&typeof process<"u"&&process.versions.node&&(globalThis.fetch=qe,globalThis.Headers=Ve,globalThis.Request=Ze,globalThis.Response=Ee,globalThis.FormData=Ye),typeof globalThis.TextEncoderStream>"u"&&(globalThis.TextEncoderStream=Ke,globalThis.TextDecoderStream=Je),typeof globalThis.WritableStream>"u"&&(globalThis.WritableStream=Xe,globalThis.ReadableStream=Be),typeof globalThis.crypto>"u"&&(globalThis.crypto=et.webcrypto)}function Xt(e){var t;Kt();const n={_deserializeData:Oe,_serializeData:Pe,_verifySerializable:De};e.manifest&&Ne(e.manifest);const r=((t=e.static)==null?void 0:t.root)??H(Qe(import.meta.url),"..","..","dist");return{router:async(i,o,f)=>{try{const l=await Ft(await Bt(K(i,J(i,e)),i,o,"server",e.getClientConn),e,n);if(l){const u=await l.completion;if(u)throw u;if(l.requestEv.headersSent)return}f()}catch(l){console.error(l),f(l)}},notFound:async(i,o,f)=>{try{if(!o.headersSent){const l=K(i,J(i,e)),u=ee(i.method||"GET",l)?"Not Found":Le(l.pathname);o.writeHead(404,{"Content-Type":"text/html; charset=utf-8","X-Not-Found":l.pathname}),o.end(u)}}catch(l){console.error(l),f(l)}},staticFile:async(i,o,f)=>{var l;try{const u=K(i,J(i,e));if(ee(i.method||"GET",u)){const d=u.pathname;let m;Fe(d).includes(".")?m=H(r,d):e.qwikCityPlan.trailingSlash?m=H(r,d+"index.html"):m=H(r,d,"index.html");const g=ze(m).replace(/^\./,""),y=je(m);y.on("error",f);const w=Jt[g];w&&o.setHeader("Content-Type",w),(l=e.static)!=null&&l.cacheControl&&o.setHeader("Cache-Control",e.static.cacheControl),y.pipe(o);return}return f()}catch(u){console.error(u),f(u)}}}}var{router:Yt,notFound:Vt}=Xt({render:Ie,qwikCityPlan:We,manifest:Ue}),ln={router:Yt,notFound:Vt};export{ln as default,Vt as notFound,Yt as router};
